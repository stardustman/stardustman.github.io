<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>select_poll_epoll - stardustman</title>
<meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="stardust"><meta name=description content="弄清楚 I/O Multiplexing 和 Linux 中 select, poll, epoll 之间的关系. multiplexer Multiplexer is a combinational circuit that has maximum of 2^n data inputs, n selection lines and single output line. One of these data inputs will be connected to the output based on the values of selection lines. Since there are n selection lines, there will be 2^n possible combinations of zeros and"><meta name=keywords content="Hugo,theme,even"><meta name=generator content="Hugo 0.123.7 with theme even"><link rel=canonical href=http://stardustman.github.io/2019/09/19/select_poll_epoll/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="select_poll_epoll"><meta property="og:description" content="弄清楚 I/O Multiplexing 和 Linux 中 select, poll, epoll 之间的关系. multiplexer Multiplexer is a combinational circuit that has maximum of 2^n data inputs, n selection lines and single output line. One of these data inputs will be connected to the output based on the values of selection lines. Since there are n selection lines, there will be 2^n possible combinations of zeros and"><meta property="og:type" content="article"><meta property="og:url" content="http://stardustman.github.io/2019/09/19/select_poll_epoll/"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-09-19T14:43:18+08:00"><meta property="article:modified_time" content="2019-09-19T14:43:18+08:00"><meta itemprop=name content="select_poll_epoll"><meta itemprop=description content="弄清楚 I/O Multiplexing 和 Linux 中 select, poll, epoll 之间的关系. multiplexer Multiplexer is a combinational circuit that has maximum of 2^n data inputs, n selection lines and single output line. One of these data inputs will be connected to the output based on the values of selection lines. Since there are n selection lines, there will be 2^n possible combinations of zeros and"><meta itemprop=datePublished content="2019-09-19T14:43:18+08:00"><meta itemprop=dateModified content="2019-09-19T14:43:18+08:00"><meta itemprop=wordCount content="1069"><meta itemprop=keywords content="io,"><meta name=twitter:card content="summary"><meta name=twitter:title content="select_poll_epoll"><meta name=twitter:description content="弄清楚 I/O Multiplexing 和 Linux 中 select, poll, epoll 之间的关系. multiplexer Multiplexer is a combinational circuit that has maximum of 2^n data inputs, n selection lines and single output line. One of these data inputs will be connected to the output based on the values of selection lines. Since there are n selection lines, there will be 2^n possible combinations of zeros and"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>keep writing</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/2022/03/27/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>keep writing</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/2022/03/27/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>select_poll_epoll</h1><div class=post-meta><span class=post-time>2019-09-19 </span><span class=more-meta>1069 words </span><span class=more-meta>3 mins read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#multiplexer>multiplexer</a><ul><li><a href=#4x1-multiplexer-分析>4x1 Multiplexer 分析</a></li><li><a href=#block-diagram-of-4x1-multiplexer>Block diagram of 4x1 Multiplexer</a></li><li><a href=#ysuboutputsub-输出值的分析>Y<sub>(output)</sub> 输出值的分析</a></li><li><a href=#truth-table-of-4x1-multiplexer>Truth table of 4x1 Multiplexer</a></li><li><a href=#multiplexer-mux>Multiplexer (Mux)</a></li></ul></li><li><a href=#io-multiplexing>I/O Multiplexing</a></li><li><a href=#io-multiplexing-和-multiplexer>I/O Multiplexing 和 Multiplexer</a><ul><li><a href=#select>select</a></li><li><a href=#poll>poll</a></li><li><a href=#epoll>epoll</a></li></ul></li><li><a href=#references>References</a></li></ul></li></ul></nav></div></div><div class=post-content><blockquote><p>弄清楚 I/O Multiplexing 和 Linux 中 select, poll, epoll 之间的关系.</p></blockquote><h2 id=multiplexer>multiplexer</h2><blockquote><p><code>Multiplexer</code> is a combinational circuit that has maximum of 2^n data inputs, <code>n</code> <code>selection lines</code> and <code>single output line</code>. One of these data inputs will be connected to the output based on the values of selection lines.
Since there are <code>n</code> selection lines, there will be 2^n possible combinations of zeros and ones. So, each combination will select only one data input. Multiplexer is also called as Mux.
聚合多个输入, 通过 selection lines 来选择一个输出.</p></blockquote><h3 id=4x1-multiplexer-分析>4x1 Multiplexer 分析</h3><blockquote><p>聚合 I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub> 这 4 个输入, 通过 S1 和 S0 来选择一个输出.</p></blockquote><h3 id=block-diagram-of-4x1-multiplexer>Block diagram of 4x1 Multiplexer</h3><p><img src=https://github.com/stardustman/pictures/raw/main/img/4x1_Multiplexer.png alt=4x1_Multiplexer></p><h3 id=ysuboutputsub-输出值的分析>Y<sub>(output)</sub> 输出值的分析</h3><h4 id=ssub1sub--0-ssub0sub--0-时-y-的值由-isub0sub-决定>S<sub>1</sub> = 0, S<sub>0</sub> = 0 时 Y 的值由 I<sub>0</sub> 决定</h4><p><img src=https://github.com/stardustman/pictures/raw/main/img/multiplexers_S1_S0_I0.png alt=multiplexers_S1_S0_I0></p><blockquote><p>S1 = 0, S0 = 0. 此时的 I1, I2, I3, 无论是 0 还是 1, 对应的 <code>and gate</code> 输出都是 0, 对最终输出 <code>Y</code> 没有影响. 此时 I0 的输入决定 <code>Y</code> 的值. 也就是 <code>Y</code> = I0.</p></blockquote><h4 id=ssub1sub--0-ssub0sub--1-时-y-的值由-isub1sub-决定>S<sub>1</sub> = 0, S<sub>0</sub> = 1 时 Y 的值由 I<sub>1</sub> 决定</h4><p><img src=https://github.com/stardustman/pictures/raw/main/img/multiplexers_S1_S0_I1.png alt=multiplexers_S1_S0_I1></p><blockquote><p>S1 = 0, S0 = 1. 此时的 I0, I2, I3, 无论是 0 还是 1, 对应的 <code>and gate</code> 输出都是 0, 对最终输出 <code>Y</code> 没有影响. 此时 I1 的输入决定 <code>Y</code> 的值. 也就是 <code>Y</code> = I1.</p></blockquote><h4 id=ssub1sub--1-ssub0sub--0-时-y-的值由-isub2sub-决定>S<sub>1</sub> = 1, S<sub>0</sub> = 0 时 Y 的值由 I<sub>2</sub> 决定</h4><p><img src=https://github.com/stardustman/pictures/raw/main/img/multiplexers_S1_S0_I2.png alt=multiplexers_S1_S0_I2></p><blockquote><p>S1 = 1, S0 = 0. 此时的 I0, I1, I3, 无论是 0 还是 1, 对应的 <code>and gate</code> 输出都是 0, 对最终输出 <code>Y</code> 没有影响. 此时 I2 的输入决定 <code>Y</code> 的值. 也就是 <code>Y</code> = I2.</p></blockquote><h4 id=ssub1sub--1-ssub1sub--0-时-y-的值由-isub3sub-决定>S<sub>1</sub> = 1, S<sub>1</sub> = 0 时 Y 的值由 I<sub>3</sub> 决定</h4><p><img src=https://github.com/stardustman/pictures/raw/main/img/multiplexers_S1_S0_I3.png alt=multiplexers_S1_S0_I3></p><blockquote><p>S1 = 1, S0 = 1. 此时的 I0, I1, I2, 无论是 0 还是 1, 对应的 <code>and gate</code> 输出都是 0, 对最终输出 <code>Y</code> 没有影响. 此时 I3 的输入决定 <code>Y</code> 的值. 也就是 <code>Y</code> = I3.</p></blockquote><h3 id=truth-table-of-4x1-multiplexer>Truth table of 4x1 Multiplexer</h3><table><thead><tr><th>S1(高位)</th><th>S0(低位)</th><th>S1S0(值)</th><th>Y</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>I<sub>0</sub></td></tr><tr><td>0</td><td>1</td><td>1</td><td>I<sub>1</sub></td></tr><tr><td>1</td><td>0</td><td>2</td><td>I<sub>2</sub></td></tr><tr><td>1</td><td>1</td><td>3</td><td>I<sub>3</sub></td></tr></tbody></table><h3 id=multiplexer-mux>Multiplexer (Mux)</h3><blockquote><p>4x1 Multiplexer 相当于提供了一种映射, Y = I<sub>(S1S0)</sub>.
通过组合S<sub>1</sub> 和 S<sub>0</sub> 的值, 可以直接得到 I<sub>S1S0</sub> 的值.也就是通过 4x1 Multiplexer 输出的 Y 值是 I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub> 之一.</p></blockquote><h2 id=io-multiplexing>I/O Multiplexing</h2><blockquote><p>I/O multiplexing 这里面的 multiplexing 指的其实是在单个线程通过记录跟踪每一个 Sock(I/O 流)的状态.
select, poll, epoll 都是 I/O multiplexing的具体的实现, 之所以有这三个存在，其实是他们出现是有先后顺序的.</p></blockquote><h2 id=io-multiplexing-和-multiplexer>I/O Multiplexing 和 Multiplexer</h2><blockquote><p>I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub> 视为 4 个 I/O 流. 值为 1 时, 视为一个 I/O 流. 4x1 Multiplexer 作为硬件实现的 I/O multiplexing. 可以周期性的设置S<sub>1</sub> 和 S<sub>0</sub> 的值, 通过监测 Y 的输出, 得到 I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub> 的输入.
{% asset_img multiplexers_S1_S0_I0.png multiplexers_S1_S0_I0 %}</p></blockquote><h3 id=select>select</h3><p>select 被实现以后, 很快就暴露出了很多问题.</p><ul><li>select 会修改传入的参数数组, 这个对于一个需要调用很多次的函数, 是非常不友好的.</li><li>select 如果任何一个 sock(I/O stream) 出现了数据, select 仅仅会返回, 但是并不会告诉你是那个 sock 上有数,于是你只能自己一个一个的找.</li></ul><blockquote><p>相当于监测到 <code>Mutiplexer</code> 的 Y = 1, 但是不知道 I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub>哪一个的输入是 1. 也就是不告诉 S<sub>1</sub> 和 S<sub>0</sub>的值, 那就只好再去具体查看一次.
I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub>的值.</p></blockquote><ul><li>select 只能监视 1024 个链接. 相当于实现了一个 1024x1 的 Mutiplexer. 只能有1024 个输入.</li><li>select 不是线程安全的.</li></ul><h3 id=poll>poll</h3><blockquote><p>修复版的 select</p></blockquote><ul><li>poll 去掉了 1024 个链接的限制</li></ul><h3 id=epoll>epoll</h3><p>epoll 可以说是 I/O 多路复用最新的一个实现, epoll 修复了 poll 和 select 绝大部分问题, 比如:</p><ul><li>epoll 现在是线程安全的。</li><li>epoll 现在不仅告诉你 sock 组里面数据，还会告诉你具体哪个 sock 有数据, 你不用自己去找了.</li></ul><blockquote><p>相当于监测到 <code>Mutiplexer</code> 的 Y = 1, 且告知了此时的 S<sub>1</sub> 和 S<sub>0</sub> 的值, 通过组合就可以知道是哪一个具体的输入是 1 了.</p></blockquote><h2 id=references>References</h2><ol><li><a href=https://www.tutorialspoint.com/digital_circuits/digital_circuits_multiplexers.htm>circuits_multiplexers</a></li><li><a href=https://www.tutorialspoint.com/digital_circuits/digital_circuits_demultiplexers.htm>circuits_demultiplexers</a></li><li><a href=https://zhuanlan.zhihu.com/p/64138532>epoll的本质</a></li><li><a href=https://www.zhihu.com/question/32163005>I/O multiplexing</a></li></ol></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>stardust</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2019-09-19</span></p><p class=copyright-item><span class=item-title>Markdown</span>
<span class=item-content><a class=link-to-markdown href=http://stardustman.github.io/2019/09/19/select_poll_epoll/index.md target=_blank>The Markdown version »</a></span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/io/>io</a></div><nav class=post-nav><a class=prev href=/2019/10/16/x86-64-architecture/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">x86-64-architecture</span>
<span class="prev-text nav-mobile">Prev</span>
</a><a class=next href=/2019/09/10/wireshark/><span class="next-text nav-default">wireshark</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=stardustman/comments issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:aoyunyoung@gmail.com class="iconfont icon-email" title=email></a><a href=https://stackoverflow.com/users/9112817/cloud-young class="iconfont icon-stack-overflow" title=stack-overflow></a><a href=https://github.com/stardustman class="iconfont icon-github" title=github></a><a href=http://stardustman.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span><span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span><span class=copyright-year>&copy;
2019 -
2024<span class=heart><i class="iconfont icon-heart"></i></span><span>stardust</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script></body></html>