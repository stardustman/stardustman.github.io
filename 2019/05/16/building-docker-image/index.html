<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>building-docker-image - stardustman</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="stardust"><meta name=description content="Docker images are built based on a Dockerfile. A Dockerfile defines all the steps required to create a Docker image with your application configured and ready to be run as a container. The image itself contains everything, from operating system to dependencies and configuration required to run your application. Having everything within the image allows you to migrate images between different environments and be confident that if it works in one environment, then it will work in another."><meta name=keywords content="Hugo,theme,even"><meta name=generator content="Hugo 0.115.3 with theme even"><link rel=canonical href=http://stardustman.github.io/2019/05/16/building-docker-image/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="building-docker-image"><meta property="og:description" content="Docker images are built based on a Dockerfile. A Dockerfile defines all the steps required to create a Docker image with your application configured and ready to be run as a container. The image itself contains everything, from operating system to dependencies and configuration required to run your application. Having everything within the image allows you to migrate images between different environments and be confident that if it works in one environment, then it will work in another."><meta property="og:type" content="article"><meta property="og:url" content="http://stardustman.github.io/2019/05/16/building-docker-image/"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-05-16T17:33:01+08:00"><meta property="article:modified_time" content="2019-05-16T17:33:01+08:00"><meta itemprop=name content="building-docker-image"><meta itemprop=description content="Docker images are built based on a Dockerfile. A Dockerfile defines all the steps required to create a Docker image with your application configured and ready to be run as a container. The image itself contains everything, from operating system to dependencies and configuration required to run your application. Having everything within the image allows you to migrate images between different environments and be confident that if it works in one environment, then it will work in another."><meta itemprop=datePublished content="2019-05-16T17:33:01+08:00"><meta itemprop=dateModified content="2019-05-16T17:33:01+08:00"><meta itemprop=wordCount content="862"><meta itemprop=keywords content="docker,"><meta name=twitter:card content="summary"><meta name=twitter:title content="building-docker-image"><meta name=twitter:description content="Docker images are built based on a Dockerfile. A Dockerfile defines all the steps required to create a Docker image with your application configured and ready to be run as a container. The image itself contains everything, from operating system to dependencies and configuration required to run your application. Having everything within the image allows you to migrate images between different environments and be confident that if it works in one environment, then it will work in another."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>keep writing</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/2022/03/27/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>keep writing</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/2022/03/27/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>building-docker-image</h1><div class=post-meta><span class=post-time>2019-05-16</span>
<span class=more-meta>862 words</span>
<span class=more-meta>5 mins read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#steps>steps</a><ul><li><a href=#base-images>Base images</a></li><li><a href=#running-commands>Running commands</a></li><li><a href=#exposing-ports>Exposing ports</a></li><li><a href=#default-commands>Default commands</a></li><li><a href=#building-containers>Building containers</a></li><li><a href=#launching-new-image>Launching new image</a></li></ul></li></ul></nav></div></div><div class=post-content><blockquote><p><em><strong>Docker images</strong></em> are built based on a Dockerfile. A Dockerfile defines <strong>all the steps</strong> required to create a Docker image with your application configured and ready to be run as a container. The image itself contains everything, from operating system to dependencies and configuration required to run your application.
Having everything within the image allows you to migrate images between different environments and be confident that if it works in one environment, then it will work in another.
The Dockerfile allows for images to be composable, enabling users to extend existing images instead of building from scratch. <em>By building on an existing image, you only need to define the steps to setup your application</em>. The base images can be basic operating system installations or configured systems which simply need some additional customisations.</p></blockquote><h1 id=steps>steps</h1><h2 id=base-images>Base images</h2><blockquote><p>All Docker images start from a base image. A base image is the same images from the Docker Registry which are used to start containers. Along with the image name, we can also include the image tag to indicate which particular version we want, <em>by default, this is latest</em>.
These base images are used as the foundation for your additional changes to run your application. For example, in this scenario, we require NGINX to be configured and running on the system before we can deploy our static HTML files. As such we want to use NGINX as our base image.
Dockerfile&rsquo;s are simple text files with a command on each line. To define a base image we use the instruction <strong>FROM image-name:tag</strong></p></blockquote><pre><code class=language-Dockerfile>FROM nginx:1.11-alpine
</code></pre><h2 id=running-commands>Running commands</h2><blockquote><p>With the base image defined, we need to run various commands to configure our image. There are many commands to help with this, the main commands two are COPY and RUN.
<em><strong>RUN</strong></em> command allows you to execute any command as you would at a command prompt, for example installing different application packages or running a build command. The results of the RUN are <strong>persisted</strong> to the image so it&rsquo;s important not to leave any unnecessary or temporary files on the disk as these will be included in the image.
<em><strong>COPY src dest</strong></em> allows you to copy files from the directory containing the Dockerfile to the container&rsquo;s image. This is extremely useful for <strong>source code</strong> and assets that you want to be deployed inside your container
*A new index.html file has been created for you which we want to serve from our container. On the next line after the <em><strong>FROM</strong></em> command, use the COPY command to copy index.html into a directory called **/usr/share/nginx/*<em>html</em></p></blockquote><pre><code class=language-Dockerfile>FROM nginx:1.11-alpine
COPY index.html /usr/share/nginx/html/index.html
</code></pre><h2 id=exposing-ports>Exposing ports</h2><blockquote><p>With our files copied into our image and any dependencies downloaded, you need to define which port application needs to be accessible on.
Using the <em><strong>EXPOSE port</strong></em> command you tell Docker which ports should be open and can be bound too. You can define multiple ports on the single command, for example, EXPOSE 80 433 or EXPOSE 7000-8000</p></blockquote><pre><code class=language-Dockerfile>FROM nginx:1.11-alpine
COPY index.html /usr/share/nginx/html/index.html
# web server to be accessible via port 80
EXPOSE 80
</code></pre><h2 id=default-commands>Default commands</h2><blockquote><p>With the Docker image configured and having defined which ports we want accessible, we now need to define the command that launches the application.
<em>The <em><strong>CMD</strong></em> line in a Dockerfile defines the default command to run when a container is launched.</em> If the command requires arguments then it&rsquo;s recommended to use an array, for example [&ldquo;cmd&rdquo;, &ldquo;-a&rdquo;, &ldquo;arga value&rdquo;, &ldquo;-b&rdquo;, &ldquo;argb-value&rdquo;], which will be combined together and the command
*<strong>cmd -a &ldquo;arga value&rdquo; -b argb-value</strong> would be run.
An alternative approach to CMD is ENTRYPOINT. While a CMD can be overridden when the container starts, a ENTRYPOINT defines a command which can have arguments passed to it when the container launches.</p></blockquote><pre><code class=language-Dockerfile>FROM nginx:1.11-alpine
COPY index.html /usr/share/nginx/html/index.html
# web server to be accessible via port 80
EXPOSE 80
# The command to run NGINX is nginx -g daemon off;
CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]
</code></pre><h2 id=building-containers>Building containers</h2><blockquote><p>After writing your Dockerfile you need to use <em><strong>docker build</strong></em> to turn it into an image. <em>The build command takes in a directory containing the Dockerfile, executes the steps and stores the image in your local Docker Engine.</em> If one fails because of an error then the build stops.
Using the docker build command to build the image. You can give the image a <em><strong>friendly name by using the -t name option.</strong></em></p></blockquote><pre><code class=language-bash>docker build -t my-nginx-image:latest
&gt;Sending build context to Docker daemon  3.072kB
Step 1/5 : FROM nginx:1.11-alpine
 ---&gt; bedece1f06cc
Step 2/5 : COPY index.html /usr/share/nginx/html/index.html
 ---&gt; Using cache
 ---&gt; 2be98924804a
Step 3/5 : EXPOSE 80
 ---&gt; Using cache
 ---&gt; 233ea4308326
Step 4/5 : CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]
 ---&gt; Using cache
 ---&gt; 1a518260bb2b
Step 5/5 : CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]
 ---&gt; Using cache
 ---&gt; 563c68c52ed7
Successfully built 563c68c52ed7
Successfully tagged my-nginx-image:latest
</code></pre><h2 id=launching-new-image>Launching new image</h2><blockquote><p>NGINX is designed to run as a background service so you should include the option -d. To make the web server accessible, bind it to port 80 using p 80:80</p></blockquote><pre><code class=language-bash>docker run -d -p 80:80 my-nginx-image:latest
</code></pre><blockquote><p>access the launched web server via the hostname docker. the command <em><strong>curl -i http://docker</strong></em> will return our index file via NGINX and the image we built.</p></blockquote><pre><code class=language-bash>curl -i http://docker
</code></pre></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>stardust</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2019-05-16</span></p><p class=copyright-item><span class=item-title>Markdown</span>
<span class=item-content><a class=link-to-markdown href=http://stardustman.github.io/2019/05/16/building-docker-image/index.md target=_blank>The Markdown version »</a></span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/docker/>docker</a></div><nav class=post-nav><a class=prev href=/2019/05/20/csapp-memory-hierarchy/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">csapp-memory-hierarchy</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/2019/05/16/deploy-static-website/><span class="next-text nav-default">deploy-static-website</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=stardustman/comments issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:aoyunyoung@gmail.com class="iconfont icon-email" title=email></a>
<a href=https://stackoverflow.com/users/9112817/cloud-young class="iconfont icon-stack-overflow" title=stack-overflow></a>
<a href=https://github.com/stardustman class="iconfont icon-github" title=github></a>
<a href=http://stardustman.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2019 -
2023<span class=heart><i class="iconfont icon-heart"></i></span><span>stardust</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script></body></html>