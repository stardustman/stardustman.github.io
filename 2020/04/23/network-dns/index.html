<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">






  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="network,dns,">





  <link rel="alternate" href="/atom.xml" title="stardustman" type="application/atom+xml">






<meta name="description" content="怎样学习一个新的东西，也可以按照一定的套路的。这个东西解决什么问题？这个东西怎样解决问题？还有没有其他方法？  三步走分析一下 DNS解决什么问题根据域名找到 IP。为啥要找到域名对应的 IP 呢？答案很简单，因为 TCP/IP 协议栈需要。很常见的一个问题就是浏览器得到一个 web page 的流程是啥样的。 什么方式解决问题怎样组织域名(domain name)？这是域名系统的首要问题。底层">
<meta name="keywords" content="network,dns">
<meta property="og:type" content="article">
<meta property="og:title" content="network-dns">
<meta property="og:url" content="http://stardustman.github.io/2020/04/23/network-dns/index.html">
<meta property="og:site_name" content="stardustman">
<meta property="og:description" content="怎样学习一个新的东西，也可以按照一定的套路的。这个东西解决什么问题？这个东西怎样解决问题？还有没有其他方法？  三步走分析一下 DNS解决什么问题根据域名找到 IP。为啥要找到域名对应的 IP 呢？答案很简单，因为 TCP/IP 协议栈需要。很常见的一个问题就是浏览器得到一个 web page 的流程是啥样的。 什么方式解决问题怎样组织域名(domain name)？这是域名系统的首要问题。底层">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://stardustman.github.io/2020/04/23/network-dns/dns-hierarchy.svg">
<meta property="og:image" content="http://stardustman.github.io/2020/04/23/network-dns/dns-zone.svg">
<meta property="og:image" content="http://stardustman.github.io/2020/04/23/network-dns/network-dns.svg">
<meta property="og:image" content="http://stardustman.github.io/2020/04/23/network-dns/tcp-ip-stack-dns.png">
<meta property="og:updated_time" content="2020-05-10T11:53:44.152Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="network-dns">
<meta name="twitter:description" content="怎样学习一个新的东西，也可以按照一定的套路的。这个东西解决什么问题？这个东西怎样解决问题？还有没有其他方法？  三步走分析一下 DNS解决什么问题根据域名找到 IP。为啥要找到域名对应的 IP 呢？答案很简单，因为 TCP/IP 协议栈需要。很常见的一个问题就是浏览器得到一个 web page 的流程是啥样的。 什么方式解决问题怎样组织域名(domain name)？这是域名系统的首要问题。底层">
<meta name="twitter:image" content="http://stardustman.github.io/2020/04/23/network-dns/dns-hierarchy.svg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://stardustman.github.io/2020/04/23/network-dns/">





  <title>network-dns | stardustman</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">stardustman</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://stardustman.github.io/2020/04/23/network-dns/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="stardustman">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stardustman">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">network-dns</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-04-23T10:27:04+08:00">
                2020-04-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/04/23/network-dns/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/04/23/network-dns/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <blockquote>
<p>怎样学习一个新的东西，也可以按照一定的套路的。这个东西解决什么问题？这个东西怎样解决问题？<br>还有没有其他方法？</p>
</blockquote>
<h2 id="三步走分析一下-DNS"><a href="#三步走分析一下-DNS" class="headerlink" title="三步走分析一下 DNS"></a>三步走分析一下 DNS</h2><h3 id="解决什么问题"><a href="#解决什么问题" class="headerlink" title="解决什么问题"></a>解决什么问题</h3><p>根据域名找到 IP。为啥要找到域名对应的 IP 呢？答案很简单，因为 <code>TCP/IP</code> 协议栈需要。<br>很常见的一个问题就是浏览器得到一个 web page 的流程是啥样的。</p>
<h3 id="什么方式解决问题"><a href="#什么方式解决问题" class="headerlink" title="什么方式解决问题"></a>什么方式解决问题</h3><p>怎样组织<code>域名(domain name)</code>？这是域名系统的首要问题。底层的组织架构，决定了域名解析的流程。有点经济基础决定上层建筑的意思。域名少的时候可以直接放在一个文件里。对，这个文件在类 unix 系统里就是 <code>/etc/hosts</code> 的文件。但是域名超级多怎么办？分类、组成层次结构。就像 Linux 的文件系统的组织方式一样。组织成一个树状结构。DNS 的查询问题，那就可以视为树的遍历问题。</p>
<h4 id="top-level-domain"><a href="#top-level-domain" class="headerlink" title="top level domain"></a>top level domain</h4><p><code>com</code>、<code>org</code>、 <code>cn</code> 等等就是所谓的<a href="http://data.iana.org/TLD/tlds-alpha-by-domain.txt" target="_blank" rel="noopener">顶级域名</a>。也就是一级域名。那么问题就来了，这些顶级域名存放在哪呢？存放到 <a href="https://www.cloudflare.com/learning/dns/glossary/dns-root-server/" target="_blank" rel="noopener">root server</a>。换一种理解方法就是，这些 root server 就是顶级域名的 metadata。这些 <a href="https://www.iana.org/domains/root/servers" target="_blank" rel="noopener">root server IP</a> 是固定的。实现 DNS 这个功能的软件内置这些 root server 的 ip。这一点很重要。</p>
<h4 id="second-level-domain"><a href="#second-level-domain" class="headerlink" title="second level domain"></a>second level domain</h4><p>以 <code>www.google.com.</code> 为例 <code>google</code> 就是二级域名。其他的依此类推。</p>
<h4 id="DNS-层级树"><a href="#DNS-层级树" class="headerlink" title="DNS 层级树"></a>DNS 层级树</h4><img src="/2020/04/23/network-dns/dns-hierarchy.svg" title="DNS 层级树">

<blockquote>
<p>可以看到整个 DNS 的入口就是 root。也就是记录顶级域名在哪些服务器上的信息。这是 <code>root</code> 也就是不需要解析这些记录顶级域名的服务器。直接固定了这些 <a href="https://www.iana.org/domains/root/servers" target="_blank" rel="noopener">root server 的 IP</a> 地址。实现 DNS 功能的软件，直接内置这些固定的 IP。DNS 查询第一步就是向这些 root server 查询顶级域名对应哪些 nameserver，也就是顶级域名对应的 IP。其实 DNS也就是个分布式层级数据库。注册域名也就是向数据库添加一条记录。但是不是免费注册的。</p>
</blockquote>
<h4 id="DNS-Zone"><a href="#DNS-Zone" class="headerlink" title="DNS Zone"></a>DNS Zone</h4><img src="/2020/04/23/network-dns/dns-zone.svg" title="DNS Zone">

<blockquote>
<p>可以看到整个 DNS 层级树，每一个节点对应一个 Zone。</p>
</blockquote>
<h4 id="uncached-DNS-lookup"><a href="#uncached-DNS-lookup" class="headerlink" title="uncached DNS lookup"></a>uncached DNS lookup</h4><img src="/2020/04/23/network-dns/network-dns.svg" title="dns-look-up">

<blockquote>
<p>图中 <code>OS stub resovler</code> 就是负责 DNS 解析的进程，发起 DNS 递归查询请求。<br><code>local dns server</code> 发起迭代查询，查询域名对应的 IP。之后返给 <code>OS stub resovler</code>。</p>
</blockquote>
<ol>
<li>这个进程向 <code>local dns server</code> 发起递归查询。也就是只需要等 <code>local dns server</code> 查询结果就行。</li>
<li><code>local dns server</code> 发起迭代查询。因为 <code>local dns server</code> 有所有 root server 的 IP，选择一个 IP，根据顶级域名属于哪一个 <code>TLD Zone</code>， 发起迭代查询。</li>
<li>可以查询得到记录这个顶级域名的 TLD server 有哪些，以及这些服务器的 IP。</li>
<li><code>local dns server</code> 选择一个 TLD server，发起迭代查询。</li>
<li>得到这个域名的权威服务器。</li>
<li>选择一个权威服务器，发起迭代查询，查询域名对应的 IP。</li>
<li><code>local dns server</code> 从权威服务器得到域名对应的 IP。</li>
<li>返还给 <code>OS stub resovler</code>。递归查询结束。</li>
</ol>
<h3 id="有没有其他解决方案"><a href="#有没有其他解决方案" class="headerlink" title="有没有其他解决方案"></a>有没有其他解决方案</h3><h2 id="dig-命令"><a href="#dig-命令" class="headerlink" title="dig 命令"></a>dig 命令</h2><h3 id="dig-domainname"><a href="#dig-domainname" class="headerlink" title="dig domainname"></a>dig domainname</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> ~ dig github.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; github.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 23033</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;github.com.			IN	A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">github.com.		17	IN	A	52.74.223.119  # github.com. 这个域名对应的一个 ip</span><br><span class="line"></span><br><span class="line">;; Query time: 14 msec</span><br><span class="line">;; SERVER: 61.139.2.69#53(61.139.2.69)</span><br><span class="line">;; WHEN: Thu Apr 23 19:53:17 CST 2020</span><br><span class="line">;; MSG SIZE  rcvd: 44</span><br></pre></td></tr></table></figure>

<h3 id="wireshark-抓包验证实际的网络架构"><a href="#wireshark-抓包验证实际的网络架构" class="headerlink" title="wireshark 抓包验证实际的网络架构"></a>wireshark 抓包验证实际的网络架构</h3><h4 id="TCP-IP-stack"><a href="#TCP-IP-stack" class="headerlink" title="TCP/IP stack"></a>TCP/IP stack</h4><img src="/2020/04/23/network-dns/tcp-ip-stack-dns.png" title="tcp-ip-stack">


<h3 id="dig-trace-domainname"><a href="#dig-trace-domainname" class="headerlink" title="dig +trace domainname"></a>dig +trace domainname</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">~ dig +trace github.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; +trace github.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">.			81219	IN	NS	k.root-servers.net.</span><br><span class="line">.			81219	IN	NS	e.root-servers.net.</span><br><span class="line">.			81219	IN	NS	b.root-servers.net.</span><br><span class="line">.			81219	IN	NS	a.root-servers.net.</span><br><span class="line">.			81219	IN	NS	m.root-servers.net.</span><br><span class="line">.			81219	IN	NS	l.root-servers.net.</span><br><span class="line">.			81219	IN	NS	d.root-servers.net.</span><br><span class="line">.			81219	IN	NS	f.root-servers.net.</span><br><span class="line">.			81219	IN	NS	g.root-servers.net.</span><br><span class="line">.			81219	IN	NS	h.root-servers.net.</span><br><span class="line">.			81219	IN	NS	j.root-servers.net.</span><br><span class="line">.			81219	IN	NS	c.root-servers.net.</span><br><span class="line">.			81219	IN	NS	i.root-servers.net.</span><br><span class="line">;; Received 228 bytes from 61.139.2.69#53(61.139.2.69) in 15 ms #local dns server，本地 DNS 拥有完整的 root server ip 列表。内置到本地 DNS 服务器。</span><br><span class="line"></span><br><span class="line">com.			172800	IN	NS	l.gtld-servers.net.  # 记录 com. 这个顶级域名的服务器，generic top level domain server</span><br><span class="line">com.			172800	IN	NS	b.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	c.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	d.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	e.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	f.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	g.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	a.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	h.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	i.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	j.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	k.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	m.gtld-servers.net.</span><br><span class="line">com.			86400	IN	DS	30909 8 2 E2D3C916F6DEEAC73294E8268FB5885044A833FC5459588F4A9184CF C41A5766</span><br><span class="line">com.			86400	IN	RRSIG	DS 8 1 86400 20200506050000 20200423040000 48903 . Enqd4bffSJHlv8mqHcAptS9+fHo3cg6vCIQgrOZ3aBfx2nG4CjS27iEG 6u6NsPfcKVrz7RoU2xDtDMNJOcMBJdJe/lGNeo14N69SM0/MV2Z8wZBD HRPd2Y8Z1nyc7EnDbkFzuWV5G6vafaQa4KTQpG6jGOPIQpYESNiinxfy 0QQWUJELvjSOideCPqQcug2P2Pln7BzWiqFSg6I8d1h44349LsXcbr5W zJwZQJKLoDd0ysyGl5Bq3UZgfWYvTJFmmZ/OwKYT4QQ4BE0MtbVwae8X 9yI6d9jENsz+eebEEtxLt6o/LNQb3PdNhUH1PC1pxfHiEiNyYUcvbJdf Flgntg==</span><br><span class="line">;; Received 1170 bytes from 192.203.230.10#53(e.root-servers.net) in 211 ms # 从 e.root-servers.net 这个 root server 查询到的 TLD namesever，也就是存储 com. 这个顶级域名的服务器。</span><br><span class="line"></span><br><span class="line">github.com.		172800	IN	NS	ns1.p16.dynect.net. # 记录 github.com. 这个域名的权威服务器</span><br><span class="line">github.com.		172800	IN	NS	ns3.p16.dynect.net.</span><br><span class="line">github.com.		172800	IN	NS	ns2.p16.dynect.net.</span><br><span class="line">github.com.		172800	IN	NS	ns4.p16.dynect.net.</span><br><span class="line">github.com.		172800	IN	NS	ns-520.awsdns-01.net.</span><br><span class="line">github.com.		172800	IN	NS	ns-421.awsdns-52.com.</span><br><span class="line">github.com.		172800	IN	NS	ns-1707.awsdns-21.co.uk.</span><br><span class="line">github.com.		172800	IN	NS	ns-1283.awsdns-32.org.</span><br><span class="line">CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN NSEC3 1 1 0 - CK0Q1GIN43N1ARRC9OSM6QPQR81H5M9A  NS SOA RRSIG DNSKEY NSEC3PARAM</span><br><span class="line">CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN RRSIG NSEC3 8 2 86400 20200427045033 20200420034033 39844 com. BDAWMm4AsSRfrBwOXhNN8ihw++J2UkhEk8A6LeSIz1llDs5kt0CcOqTM OK1txlQNr3N0k1RTBW/hkEZ1mxjIHF2GARt/hpO43ILPBVs/vhKAKCKh A96XJG+NzN0t/heB6mFNASKAcmVdfT5a0tVkmmzhGktDp5ECdZAIFRhZ 8y6jxsUhGP7ZiN1AfFBi1cWeSth5FW4Btpy9RffVKg5lIA==</span><br><span class="line">4KB4DFS71LEP8G8P8VT4CCUSQNL4CNCS.com. 86400 IN NSEC3 1 1 0 - 4KB4PTQQ5CTA7POCTGM7RUFC8B1RKTEU  NS DS RRSIG</span><br><span class="line">4KB4DFS71LEP8G8P8VT4CCUSQNL4CNCS.com. 86400 IN RRSIG NSEC3 8 2 86400 20200428061912 20200421050912 39844 com. PFN1p6XvR4SmD4ucRULmtYIMQkFf/ZrdEWz6bRVtcepYF6QwTC/VOVYM 7PV0tuTTdr1LqkUwQJ7mv23vtKnjFba2Cf7pBOTz9JuCHUC0Qml9cOc6 Cwjhx7haj6h0VEzS+oIY7l2p/af/B36iQCXASVN3Y6s/i+66iXIg905z GqFnAKOgR0R4KJx5KwHIzBkgxr/I/SyCd+HNw+2fr15X0w==</span><br><span class="line">;; Received 824 bytes from 192.26.92.30#53(c.gtld-servers.net) in 173 ms # 从 c.gtld-servers.net 这个 TLD nameserver 查询到存储 github.com. 这个域名的权威服务器。</span><br><span class="line"></span><br><span class="line">github.com.		60	IN	A	13.250.177.223 # 得到了 github.com. 这个域名的一个 ip</span><br><span class="line">github.com.		900	IN	NS	ns-1707.awsdns-21.co.uk.</span><br><span class="line">github.com.		900	IN	NS	ns3.p16.dynect.net.</span><br><span class="line">github.com.		900	IN	NS	ns2.p16.dynect.net.</span><br><span class="line">github.com.		900	IN	NS	ns-1283.awsdns-32.org.</span><br><span class="line">github.com.		900	IN	NS	ns-421.awsdns-52.com.</span><br><span class="line">github.com.		900	IN	NS	ns-520.awsdns-01.net.</span><br><span class="line">github.com.		900	IN	NS	ns4.p16.dynect.net.</span><br><span class="line">github.com.		900	IN	NS	ns1.p16.dynect.net.</span><br><span class="line">;; Received 275 bytes from 204.13.250.16#53(ns2.p16.dynect.net) in 198 ms 从 ns2.p16.dynect.net 这个权威服务器查询到的 github.com. 的 ip 是 13.250.177.223。至此，得到域名对应的 ip。</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="https://www.ruanyifeng.com/blog/2016/06/dns.html" target="_blank" rel="noopener">DNS 入门</a></li>
<li><a href="http://kilyos.ee.bilkent.edu.tr/~ee538/lecture1.pdf" target="_blank" rel="noopener">Introduction and Layered Network Architecture</a></li>
<li><a href="https://www.iana.org/domains/root/servers" target="_blank" rel="noopener">root servers ips</a></li>
<li><a href="https://root-servers.org/" target="_blank" rel="noopener">all-root-servers</a></li>
<li><a href="https://tools.ietf.org/html/rfc2929" target="_blank" rel="noopener">rfc-dns</a></li>
<li><a href="https://www.cloudflare.com/learning/dns/dns-server-types/" target="_blank" rel="noopener">dns-server-types</a></li>
<li><a href="https://www.cloudflare.com/learning/dns/what-is-dns/" target="_blank" rel="noopener">what is dns</a></li>
<li><a href="https://www.cloudflare.com/learning/dns/what-is-recursive-dns/" target="_blank" rel="noopener">what is recursive dns</a></li>
<li><a href="https://simpledns.plus/help/dns-record-types" target="_blank" rel="noopener">dns record types</a></li>
<li><a href="https://www.cs.cmu.edu/~pattis/15-1XX/common/handouts/ascii.html" target="_blank" rel="noopener">ascii</a></li>
<li><a href="https://www.cloudflare.com/learning/dns/glossary/dns-zone/" target="_blank" rel="noopener">dns-zone</a></li>
</ol>

      
    </div>
    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/images/wechar-subscriber.jpg" alt="stardustman wechat" style="width: 200px; max-width: 100%;">
    <div>业精于勤， 荒于嬉。行成于思，毁于随。</div>
</div>

      </div>
    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:</strong>
    stardustman
  </li>
  <li class="post-copyright-link">
    <strong>Post link:</strong>
    <a href="http://stardustman.github.io/2020/04/23/network-dns/" title="network-dns">http://stardustman.github.io/2020/04/23/network-dns/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice: </strong>
    All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.
  </li>
   
   



</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/network/" rel="tag"># network</a>
          
            <a href="/tags/dns/" rel="tag"># dns</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/04/14/algorithm-quick-sort/" rel="next" title="algorithm-quick-sort">
                <i class="fa fa-chevron-left"></i> algorithm-quick-sort
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/05/11/cache-replacement-policy-lru/" rel="prev" title="cache-replacement-policy-lru">
                cache-replacement-policy-lru <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div class="ds-thread" data-thread-key="2020/04/23/network-dns/" data-title="network-dns" data-url="http://stardustman.github.io/2020/04/23/network-dns/">
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">stardustman</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#三步走分析一下-DNS"><span class="nav-number">1.</span> <span class="nav-text">三步走分析一下 DNS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#解决什么问题"><span class="nav-number">1.1.</span> <span class="nav-text">解决什么问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#什么方式解决问题"><span class="nav-number">1.2.</span> <span class="nav-text">什么方式解决问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#top-level-domain"><span class="nav-number">1.2.1.</span> <span class="nav-text">top level domain</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#second-level-domain"><span class="nav-number">1.2.2.</span> <span class="nav-text">second level domain</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DNS-层级树"><span class="nav-number">1.2.3.</span> <span class="nav-text">DNS 层级树</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DNS-Zone"><span class="nav-number">1.2.4.</span> <span class="nav-text">DNS Zone</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#uncached-DNS-lookup"><span class="nav-number">1.2.5.</span> <span class="nav-text">uncached DNS lookup</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#有没有其他解决方案"><span class="nav-number">1.3.</span> <span class="nav-text">有没有其他解决方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dig-命令"><span class="nav-number">2.</span> <span class="nav-text">dig 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#dig-domainname"><span class="nav-number">2.1.</span> <span class="nav-text">dig domainname</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wireshark-抓包验证实际的网络架构"><span class="nav-number">2.2.</span> <span class="nav-text">wireshark 抓包验证实际的网络架构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP-IP-stack"><span class="nav-number">2.2.1.</span> <span class="nav-text">TCP/IP stack</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dig-trace-domainname"><span class="nav-number">2.3.</span> <span class="nav-text">dig +trace domainname</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">3.</span> <span class="nav-text">Reference</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">stardustman</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"your-duoshuo-shortname"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  


















  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <div id="gitalk-container"></div>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: '',
      clientSecret: '',
      repo: 'hexo-comments',
      owner: 'stardustman',
      admin: [''],
      id: location.pathname,
      distractionFreeMode: 'false'
    })
    gitalk.render('gitalk-container')
  </script>





  





  

  

  

  
  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
