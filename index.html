<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">






  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="stardustman" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="stardustman">
<meta property="og:url" content="http://stardustman.github.io/index.html">
<meta property="og:site_name" content="stardustman">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="stardustman">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://stardustman.github.io/">





  <title>stardustman</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">stardustman</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://stardustman.github.io/2019/10/16/x86-64-architecture/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="stardustman">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stardustman">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/16/x86-64-architecture/" itemprop="url">x86-64-architecture</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-16T13:59:24+08:00">
                2019-10-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/16/x86-64-architecture/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/10/16/x86-64-architecture/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>操作系统其实很大一部分面向 <code>CPU</code> 来编程的。一些 <code>OS</code> 的概念直接来源于 <code>CPU</code> 的术语，或者和 <code>CPU</code> 关联性非常大。要想彻底理解 <code>OS</code> ，无法绕过 <code>CPU</code>。因为 Intel 的 <code>X86</code>(Intel 80386 之后的一系列 CPU 称之为 X86 架构) 是业界的标准。掌握这个架构对于理解 <code>OS</code> 是非常必要的。因为 <code>X86</code> 系列的 <code>CPU</code> 向后兼容，所以本文使用 Intel 8086(16 bit) 和 Intel 80386(32 bit) 来试图理解 <code>X86</code> 架构。</p>
</blockquote>
<h2 id="Intel-8086"><a href="#Intel-8086" class="headerlink" title="Intel 8086"></a>Intel 8086</h2><h3 id="16-bit-processor"><a href="#16-bit-processor" class="headerlink" title="16 bit processor"></a>16 bit processor</h3><blockquote>
<p><code>16-bit</code> is a computer hardware device or software program capable of transferring 16 bits of data at a time. 一次传输 16 bits 的数据<br>For example, early computer processors (e.g., 8088 and 80286) were 16-bit processors, meaning they were capable of working with 16-bit binary numbers (decimal number up to 65,535). Anything larger and the computer would need to break the number into smaller pieces.</p>
</blockquote>
<h3 id="1M-的寻址空间带来的问题与解决方法"><a href="#1M-的寻址空间带来的问题与解决方法" class="headerlink" title="1M 的寻址空间带来的问题与解决方法"></a>1M 的寻址空间带来的问题与解决方法</h3><h4 id="Intel-8086-地址引脚"><a href="#Intel-8086-地址引脚" class="headerlink" title="Intel 8086 地址引脚"></a>Intel 8086 地址引脚</h4><img src="/2019/10/16/x86-64-architecture/intel8086_address.png" title="Intel 8086 寻址空间"> 

<blockquote>
<p>上图的 AD<sub>0</sub> ~ AD<sub>15</sub> 是复用(Multiplex)引脚<br>A<sub>16</sub> ~ A<sub>19</sub> 也是复用引脚</p>
</blockquote>
<ul>
<li>ALE(Address Latch Enable) = 1 是作为地址线 A<sub>0</sub>~A<sub>15</sub>(寻址) 再加上A<sub>16</sub> ~ A<sub>19</sub>.</li>
<li>ALE(Address Latch Enable) = 0 是作为数据线 D<sub>0</sub>~D<sub>15</sub>(传输 16 bit 数据)</li>
</ul>
<h4 id="物理地址生成"><a href="#物理地址生成" class="headerlink" title="物理地址生成"></a>物理地址生成</h4><blockquote>
<p>20 bit 来表示一个内存地址. 但是 Intel 8086 是一个 <code>16 bit</code> 的处理器(其实就是一次只能传输 16 bit 的数据). 怎样来表示 <code>20 bit</code> 的内存地址呢? 比如一个内存地址是: <code>0x18AC9</code>, 该怎样表示呢? 其实道理很简单, 既然没法一次传输 20 bit, 那就分两次好了. 最后用两个 <code>16 bit</code> 的数据来合成 <code>0x18AC9</code> 这个地址. 很显然要有生成 <code>0x18AC9</code> 这个地址的策略. 在 Intel 8086 中, 将 <code>0x18AC9</code> 拆分为 <code>0x1234</code>(segment address) 和 <code>0x6789</code>(offset address) 这两个 <code>16 bit</code> 的地址, 这就是所谓的逻辑地址(logical address). 怎样生成 <code>0x18AC9</code> 这个真实的物理地址呢? 也很简单使用一个 <code>20 bit</code> 的 <code>adder</code>(加法器). 0x18AC9 = 0x1234 * 16 + 0x6789</p>
</blockquote>
<img src="/2019/10/16/x86-64-architecture/intel8086_real_address_mode_translation.png" title="Intel 8086 Real Address Mode Translation"> 

<h4 id="Real-Address-Mode"><a href="#Real-Address-Mode" class="headerlink" title="Real Address Mode"></a>Real Address Mode</h4><blockquote>
<p>物理地址由两部分组成: segment address 和 offset address. 这两个地址不能直接使用, 是用来合成真正的物理地址的. 这两个地址称之为 <code>逻辑地址</code>. 16 * segment address + offset address 合成的地址称之为 <code>物理地址</code>, 也叫 <code>线性地址</code>(也就是从 0 ~ 2^20 -1 地址空间). Intel 8086 这种得到物理地址的机制就叫做 <code>real address mode</code>. 也就是所谓的 <code>实模式</code>.
PS: 多说一句, <code>实模式</code> 这个翻译有点坑, 翻译成 <code>实地址模式</code> 不就十分清楚了吗?</p>
</blockquote>
<h4 id="segmented-memory"><a href="#segmented-memory" class="headerlink" title="segmented memory"></a>segmented memory</h4><blockquote>
<p>physical address = 16 * segment address + offset address<br>offset address 是 16 bit, 决定了一个 segment 的范围是 64K. 将 1M 的寻址空间以 64K 为一个 segment 划分为多个 segment. 反过来说就是一个 segment 可以选择一个 64K 范围内的地址. 是的, <code>segment</code> 可以当作是一种 <code>selector</code>, 就像 <code>CSS</code> 里面的选择器.<br>那么这个 segment 存放在哪里呢? 放在专门的 <code>segment register</code> 里. </p>
</blockquote>
<h4 id="segment-registers"><a href="#segment-registers" class="headerlink" title="segment registers"></a>segment registers</h4><blockquote>
<p>Intel 8086 提供了 <code>Extra Segment</code>(ES), <code>Data Segment</code>(DS), <code>Stack Segment</code>(SS), <code>Code Segment</code>(CS) 这 4 个 段寄存器.</p>
</blockquote>
<h5 id="code-segment-CS-instruction-pointer-IP"><a href="#code-segment-CS-instruction-pointer-IP" class="headerlink" title="code segment(CS) + instruction pointer(IP)"></a>code segment(CS) + instruction pointer(IP)</h5><blockquote>
<p>code segment 存放 segment address, 这是个专门的代码段寄存器, 用来存放代码的地址.<br>instruction pointer 存放 offset address, 这个是专门的指令寄存器, 用来存放下一条指令的地址.<br>所以访问代码的 <code>物理地址 = 16 * CS + IP</code></p>
</blockquote>
<h5 id="stack-segment-SS-stack-pointer-SP"><a href="#stack-segment-SS-stack-pointer-SP" class="headerlink" title="stack segment(SS) + stack pointer(SP)"></a>stack segment(SS) + stack pointer(SP)</h5><blockquote>
<p>stack segment 存放 segment address, 这个是专门的栈帧段寄存器.<br>stack pointer 存放 offset address, 这个专门的记录栈帧的寄存器.<br>所以访问函数栈帧的 <code>物理地址 = 16 * SS + SP</code></p>
</blockquote>
<blockquote>
<p>注意: 如果令 SS = 0, 那么访问函数栈帧的 <code>物理地址 = SP</code>, 也就是只能访问 64K 的空间.<br>注意: real address mode 能够不受限制地访问 1M 的地址空间. 程序可以自由的访问 1M 的地址空间, 无法进行内存的保护, 这也是 <code>Intel 80386</code> 要解决的问题之一. </p>
</blockquote>
<p>#### </p>
<h3 id="general-purpose-register"><a href="#general-purpose-register" class="headerlink" title="general purpose register"></a>general purpose register</h3><h3 id="memory-mapping"><a href="#memory-mapping" class="headerlink" title="memory mapping"></a>memory mapping</h3><blockquote>
<p>已安装内存 8G(7.88G) 可用？？？原因在哪里呢？</p>
</blockquote>
<h2 id="Intel-80386"><a href="#Intel-80386" class="headerlink" title="Intel 80386"></a>Intel 80386</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="http://8086microprocessor4u.blogspot.com/2012/12/bus-interface-unit-biu.html" target="_blank" rel="noopener">bus interface unit</a></li>
<li><a href="http://8086microprocessor4u.blogspot.com/2015/04/the-execution-unit-eu.html" target="_blank" rel="noopener">execution unit</a></li>
<li><a href="https://www.tutorialspoint.com/microprocessor/microprocessor_8086_functional_units.htm" target="_blank" rel="noopener">8086 Functional Units</a></li>
<li><a href="https://www.csetutor.com/components-of-cpu-and-their-functions/" target="_blank" rel="noopener">components of cpu</a></li>
<li><a href="https://vdocuments.mx/8086-microprocessor-architecture-5584489b9c738.html" target="_blank" rel="noopener">8086-microprocessor-architecture</a></li>
<li><a href="https://www.academia.edu/40314276/8086_microprocessor20190911_87442_nxpkcz" target="_blank" rel="noopener">8086-microprocessor</a></li>
<li><a href="https://www.geeksforgeeks.org/memory-segmentation-8086-microprocessor/" target="_blank" rel="noopener">memory-segmentation-8086-microprocessor</a></li>
<li><a href="https://www.cs.usfca.edu/~cruse/cs630f06/" target="_blank" rel="noopener">Advanced Microcomputer Programming</a></li>
<li><a href="https://www.computerhope.com/jargon/num/16bit.htm" target="_blank" rel="noopener">16 bit processor mean?</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://stardustman.github.io/2019/09/19/select-poll-epoll/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="stardustman">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stardustman">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/19/select-poll-epoll/" itemprop="url">select_poll_epoll</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-19T14:43:18+08:00">
                2019-09-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/19/select-poll-epoll/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/09/19/select-poll-epoll/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>弄清楚 I/O Multiplexing 和 Linux 中 select, poll, epoll 之间的关系.</p>
</blockquote>
<h2 id="multiplexer"><a href="#multiplexer" class="headerlink" title="multiplexer"></a>multiplexer</h2><blockquote>
<p><code>Multiplexer</code> is a combinational circuit that has maximum of 2^n data inputs, <code>n</code> <code>selection lines</code> and <code>single output line</code>. One of these data inputs will be connected to the output based on the values of selection lines.<br>Since there are <code>n</code> selection lines, there will be 2^n possible combinations of zeros and ones. So, each combination will select only one data input. Multiplexer is also called as Mux.<br>聚合多个输入, 通过 selection lines 来选择一个输出. </p>
</blockquote>
<h3 id="4x1-Multiplexer-分析"><a href="#4x1-Multiplexer-分析" class="headerlink" title="4x1 Multiplexer 分析"></a>4x1 Multiplexer 分析</h3><blockquote>
<p>聚合 I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub> 这 4 个输入, 通过 S1 和 S0 来选择一个输出.</p>
</blockquote>
<h3 id="Block-diagram-of-4x1-Multiplexer"><a href="#Block-diagram-of-4x1-Multiplexer" class="headerlink" title="Block diagram of 4x1 Multiplexer"></a>Block diagram of 4x1 Multiplexer</h3><img src="/2019/09/19/select-poll-epoll/4x1_Multiplexer.png" title="4x1_Multiplexer">

<h3 id="Y-output-输出值的分析"><a href="#Y-output-输出值的分析" class="headerlink" title="Y(output) 输出值的分析"></a>Y<sub>(output)</sub> 输出值的分析</h3><h4 id="S1-0-S0-0-时-Y-的值由-I0-决定"><a href="#S1-0-S0-0-时-Y-的值由-I0-决定" class="headerlink" title="S1 = 0, S0 = 0 时 Y 的值由 I0 决定"></a>S<sub>1</sub> = 0, S<sub>0</sub> = 0 时 Y 的值由 I<sub>0</sub> 决定</h4><img src="/2019/09/19/select-poll-epoll/multiplexers_S1_S0_I0.png" title="multiplexers_S1_S0_I0">

<blockquote>
<p>S1 = 0, S0 = 0. 此时的 I1, I2, I3, 无论是 0 还是 1, 对应的 <code>and gate</code> 输出都是 0, 对最终输出 <code>Y</code> 没有影响. 此时 I0 的输入决定 <code>Y</code> 的值. 也就是 <code>Y</code> = I0.</p>
</blockquote>
<h4 id="S1-0-S0-1-时-Y-的值由-I1-决定"><a href="#S1-0-S0-1-时-Y-的值由-I1-决定" class="headerlink" title="S1 = 0, S0 = 1 时 Y 的值由 I1 决定"></a>S<sub>1</sub> = 0, S<sub>0</sub> = 1 时 Y 的值由 I<sub>1</sub> 决定</h4><img src="/2019/09/19/select-poll-epoll/multiplexers_S1_S0_I1.png" title="multiplexers_S1_S0_I1">

<blockquote>
<p>S1 = 0, S0 = 1. 此时的 I0, I2, I3, 无论是 0 还是 1, 对应的 <code>and gate</code> 输出都是 0, 对最终输出 <code>Y</code> 没有影响. 此时 I1 的输入决定 <code>Y</code> 的值. 也就是 <code>Y</code> = I1.</p>
</blockquote>
<h4 id="S1-1-S0-0-时-Y-的值由-I2-决定"><a href="#S1-1-S0-0-时-Y-的值由-I2-决定" class="headerlink" title="S1 = 1, S0 = 0 时 Y 的值由 I2 决定"></a>S<sub>1</sub> = 1, S<sub>0</sub> = 0 时 Y 的值由 I<sub>2</sub> 决定</h4><img src="/2019/09/19/select-poll-epoll/multiplexers_S1_S0_I2.png" title="multiplexers_S1_S0_I2">

<blockquote>
<p>S1 = 1, S0 = 0. 此时的 I0, I1, I3, 无论是 0 还是 1, 对应的 <code>and gate</code> 输出都是 0, 对最终输出 <code>Y</code> 没有影响. 此时 I2 的输入决定 <code>Y</code> 的值. 也就是 <code>Y</code> = I2.</p>
</blockquote>
<h4 id="S1-1-S1-0-时-Y-的值由-I3-决定"><a href="#S1-1-S1-0-时-Y-的值由-I3-决定" class="headerlink" title="S1 = 1, S1 = 0 时 Y 的值由 I3 决定"></a>S<sub>1</sub> = 1, S<sub>1</sub> = 0 时 Y 的值由 I<sub>3</sub> 决定</h4><img src="/2019/09/19/select-poll-epoll/multiplexers_S1_S0_I3.png" title="multiplexers_S1_S0_I3">

<blockquote>
<p>S1 = 1, S0 = 1. 此时的 I0, I1, I2, 无论是 0 还是 1, 对应的 <code>and gate</code> 输出都是 0, 对最终输出 <code>Y</code> 没有影响. 此时 I3 的输入决定 <code>Y</code> 的值. 也就是 <code>Y</code> = I3.</p>
</blockquote>
<h3 id="Truth-table-of-4x1-Multiplexer"><a href="#Truth-table-of-4x1-Multiplexer" class="headerlink" title="Truth table of 4x1 Multiplexer"></a>Truth table of 4x1 Multiplexer</h3><table>
<thead>
<tr>
<th>S1(高位)</th>
<th>S0(低位)</th>
<th>S1S0(值)</th>
<th>Y</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>I<sub>0</sub></td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
<td>I<sub>1</sub></td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>2</td>
<td>I<sub>2</sub></td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>3</td>
<td>I<sub>3</sub></td>
</tr>
</tbody></table>
<h3 id="Multiplexer-Mux"><a href="#Multiplexer-Mux" class="headerlink" title="Multiplexer (Mux)"></a>Multiplexer (Mux)</h3><blockquote>
<p>4x1 Multiplexer 相当于提供了一种映射, Y = I<sub>(S1S0)</sub>. 
通过组合S<sub>1</sub> 和 S<sub>0</sub> 的值, 可以直接得到 I<sub>S1S0</sub> 的值.也就是通过 4x1 Multiplexer 输出的 Y 值是 I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub> 之一.</p>
</blockquote>
<h2 id="I-O-Multiplexing"><a href="#I-O-Multiplexing" class="headerlink" title="I/O Multiplexing"></a>I/O Multiplexing</h2><blockquote>
<p>I/O multiplexing 这里面的 multiplexing 指的其实是在单个线程通过记录跟踪每一个 Sock(I/O 流)的状态.<br>select, poll, epoll 都是 I/O multiplexing的具体的实现, 之所以有这三个存在，其实是他们出现是有先后顺序的.</p>
</blockquote>
<h2 id="I-O-Multiplexing-和-Multiplexer"><a href="#I-O-Multiplexing-和-Multiplexer" class="headerlink" title="I/O Multiplexing 和 Multiplexer"></a>I/O Multiplexing 和 Multiplexer</h2><blockquote>
<p>I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub> 视为 4 个 I/O 流. 值为 1 时, 视为一个 I/O 流. 4x1 Multiplexer 作为硬件实现的 I/O multiplexing. 可以周期性的设置S<sub>1</sub> 和 S<sub>0</sub> 的值, 通过监测 Y 的输出, 得到 I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub> 的输入.</p>
</blockquote>
<img src="/2019/09/19/select-poll-epoll/multiplexers_S1_S0_I0.png" title="multiplexers_S1_S0_I0">

<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p>select 被实现以后, 很快就暴露出了很多问题.</p>
<ul>
<li>select 会修改传入的参数数组, 这个对于一个需要调用很多次的函数, 是非常不友好的.</li>
<li>select 如果任何一个 sock(I/O stream) 出现了数据, select 仅仅会返回, 但是并不会告诉你是那个 sock 上有数,于是你只能自己一个一个的找.<blockquote>
<p>相当于监测到 <code>Mutiplexer</code> 的 Y = 1, 但是不知道 I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub>哪一个的输入是 1. 也就是不告诉 S<sub>1</sub> 和 S<sub>0</sub>的值, 那就只好再去具体查看一次.<br>I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub>的值.</p>
</blockquote>
</li>
<li>select 只能监视 1024 个链接. 相当于实现了一个 1024x1 的 Mutiplexer. 只能有1024 个输入.</li>
<li>select 不是线程安全的.</li>
</ul>
<h3 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h3><blockquote>
<p>修复版的 select</p>
<ul>
<li>poll 去掉了 1024 个链接的限制</li>
</ul>
</blockquote>
<h3 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h3><p>epoll 可以说是 I/O 多路复用最新的一个实现, epoll 修复了 poll 和 select 绝大部分问题, 比如:</p>
<ul>
<li>epoll 现在是线程安全的。</li>
<li>epoll 现在不仅告诉你 sock 组里面数据，还会告诉你具体哪个 sock 有数据, 你不用自己去找了.<blockquote>
<p>相当于监测到  <code>Mutiplexer</code> 的 Y = 1, 且告知了此时的 S<sub>1</sub> 和 S<sub>0</sub> 的值, 通过组合就可以知道是哪一个具体的输入是 1 了.</p>
</blockquote>
</li>
</ul>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol>
<li><a href="https://www.tutorialspoint.com/digital_circuits/digital_circuits_multiplexers.htm" target="_blank" rel="noopener">circuits_multiplexers</a></li>
<li><a href="https://www.tutorialspoint.com/digital_circuits/digital_circuits_demultiplexers.htm" target="_blank" rel="noopener">circuits_demultiplexers</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/64138532" target="_blank" rel="noopener">epoll的本质</a></li>
<li><a href="https://www.zhihu.com/question/32163005" target="_blank" rel="noopener">I/O multiplexing</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://stardustman.github.io/2019/09/10/wireshark/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="stardustman">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stardustman">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/10/wireshark/" itemprop="url">wireshark</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-10T09:51:07+08:00">
                2019-09-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/10/wireshark/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/09/10/wireshark/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Wireshark-Windows-配置-SSL"><a href="#Wireshark-Windows-配置-SSL" class="headerlink" title="Wireshark Windows 配置 SSL"></a>Wireshark Windows 配置 SSL</h2><blockquote>
<p>Version 3.0.3</p>
</blockquote>
<h3 id="配置-SSLKEYLOGFILE-系统变量"><a href="#配置-SSLKEYLOGFILE-系统变量" class="headerlink" title="配置 SSLKEYLOGFILE 系统变量"></a>配置 SSLKEYLOGFILE 系统变量</h3><img src="/2019/09/10/wireshark/SSLKEYLOGFILE.png" title="系统变量 SSLKEYLOGFILE">

<h3 id="配置-Wireshark"><a href="#配置-Wireshark" class="headerlink" title="配置 Wireshark"></a>配置 Wireshark</h3><blockquote>
<p>编辑 -&gt; 首选项 -&gt; Protocols -&gt; TLS</p>
</blockquote>
<img src="/2019/09/10/wireshark/wireshark_tls_logfile.png" title="Wireshark 配置 TLS">

<h3 id="重启-Wireshark"><a href="#重启-Wireshark" class="headerlink" title="重启 Wireshark"></a>重启 Wireshark</h3><h2 id="过滤器查看"><a href="#过滤器查看" class="headerlink" title="过滤器查看"></a>过滤器查看</h2><blockquote>
<p>视图 -&gt; 内部 -&gt; 支持的协议</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://stardustman.github.io/2019/09/03/docker-practice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="stardustman">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stardustman">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/03/docker-practice/" itemprop="url">docker-practice</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-03T14:20:16+08:00">
                2019-09-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/03/docker-practice/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/09/03/docker-practice/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Centos7 Linux<br>运行的 Docker 容器是: mssql-node-docker-demo-app </p>
</blockquote>
<h2 id="docker-info"><a href="#docker-info" class="headerlink" title="docker info"></a>docker info</h2><img src="/2019/09/03/docker-practice/docker-info.png" title="docker info 得到的信息">

<h2 id="docker-inspect"><a href="#docker-inspect" class="headerlink" title="docker inspect"></a>docker inspect</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"Id"</span>: <span class="string">"405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655"</span>,</span><br><span class="line">        <span class="attr">"Created"</span>: <span class="string">"2019-08-01T02:57:14.067532309Z"</span>,</span><br><span class="line">        <span class="attr">"Path"</span>: <span class="string">"/bin/sh"</span>,</span><br><span class="line">        <span class="attr">"Args"</span>: [</span><br><span class="line">            <span class="string">"-c"</span>,</span><br><span class="line">            <span class="string">"/bin/bash ./entrypoint.sh"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"State"</span>: &#123;</span><br><span class="line">            <span class="attr">"Status"</span>: <span class="string">"running"</span>,</span><br><span class="line">            <span class="attr">"Running"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"Paused"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"Restarting"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"OOMKilled"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"Dead"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"Pid"</span>: <span class="number">12164</span>,</span><br><span class="line">            <span class="attr">"ExitCode"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"Error"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"StartedAt"</span>: <span class="string">"2019-08-22T06:08:43.334320939Z"</span>,</span><br><span class="line">            <span class="attr">"FinishedAt"</span>: <span class="string">"2019-08-21T09:25:32.130119566Z"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        "Image": "sha256:e600f86aa4e2aced43a193a28aa507651bfb77daa09ca8dbf286451a630cf27e", // node-web-app 的 docker 镜像 id</span><br><span class="line">        "ResolvConfPath": "/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/resolv.conf",</span><br><span class="line">        "HostnamePath": "/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/hostname",</span><br><span class="line">        "HostsPath": "/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/hosts",</span><br><span class="line">        "LogPath": "",</span><br><span class="line">        "Name": "/friendly_hamilton", // docker container 的名称</span><br><span class="line">        "RestartCount": 0,</span><br><span class="line">        "Driver": "overlay2", // storage driver</span><br><span class="line">        "MountLabel": "",</span><br><span class="line">        "ProcessLabel": "",</span><br><span class="line">        "AppArmorProfile": "",</span><br><span class="line">        "ExecIDs": null,</span><br><span class="line">        "HostConfig": &#123;</span><br><span class="line">            "Binds": null,</span><br><span class="line">            "ContainerIDFile": "",</span><br><span class="line">            "LogConfig": &#123;</span><br><span class="line">                "Type": "journald",</span><br><span class="line">                "Config": &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            "NetworkMode": "default",</span><br><span class="line">            "PortBindings": &#123;</span><br><span class="line">                "1433/tcp": [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"HostIp"</span>: <span class="string">""</span>,</span><br><span class="line">                        <span class="attr">"HostPort"</span>: <span class="string">"1433"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                "8080/tcp": [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"HostIp"</span>: <span class="string">""</span>,</span><br><span class="line">                        <span class="attr">"HostPort"</span>: <span class="string">"8080"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            "RestartPolicy": &#123;</span><br><span class="line">                "Name": "no",</span><br><span class="line">                "MaximumRetryCount": 0</span><br><span class="line">            &#125;,</span><br><span class="line">            "AutoRemove": false,</span><br><span class="line">            "VolumeDriver": "",</span><br><span class="line">            "VolumesFrom": null,</span><br><span class="line">            "CapAdd": null,</span><br><span class="line">            "CapDrop": null,</span><br><span class="line">            "Dns": [],</span><br><span class="line">            "DnsOptions": [],</span><br><span class="line">            "DnsSearch": [],</span><br><span class="line">            "ExtraHosts": null,</span><br><span class="line">            "GroupAdd": null,</span><br><span class="line">            "IpcMode": "",</span><br><span class="line">            "Cgroup": "",</span><br><span class="line">            "Links": null,</span><br><span class="line">            "OomScoreAdj": 0,</span><br><span class="line">            "PidMode": "",</span><br><span class="line">            "Privileged": false,</span><br><span class="line">            "PublishAllPorts": false,</span><br><span class="line">            "ReadonlyRootfs": false,</span><br><span class="line">            "SecurityOpt": null,</span><br><span class="line">            "UTSMode": "",</span><br><span class="line">            "UsernsMode": "",</span><br><span class="line">            "ShmSize": 67108864,</span><br><span class="line">            "Runtime": "docker-runc",</span><br><span class="line">            "ConsoleSize": [</span><br><span class="line">                0,</span><br><span class="line">                <span class="number">0</span></span><br><span class="line">            ],</span><br><span class="line">            "Isolation": "",</span><br><span class="line">            "CpuShares": 0,</span><br><span class="line">            "Memory": 0,</span><br><span class="line">            "NanoCpus": 0,</span><br><span class="line">            "CgroupParent": "",</span><br><span class="line">            "BlkioWeight": 0,</span><br><span class="line">            "BlkioWeightDevice": null,</span><br><span class="line">            "BlkioDeviceReadBps": null,</span><br><span class="line">            "BlkioDeviceWriteBps": null,</span><br><span class="line">            "BlkioDeviceReadIOps": null,</span><br><span class="line">            "BlkioDeviceWriteIOps": null,</span><br><span class="line">            "CpuPeriod": 0,</span><br><span class="line">            "CpuQuota": 0,</span><br><span class="line">            "CpuRealtimePeriod": 0,</span><br><span class="line">            "CpuRealtimeRuntime": 0,</span><br><span class="line">            "CpusetCpus": "",</span><br><span class="line">            "CpusetMems": "",</span><br><span class="line">            "Devices": [],</span><br><span class="line">            "DiskQuota": 0,</span><br><span class="line">            "KernelMemory": 0,</span><br><span class="line">            "MemoryReservation": 0,</span><br><span class="line">            "MemorySwap": 0,</span><br><span class="line">            "MemorySwappiness": -1,</span><br><span class="line">            "OomKillDisable": false,</span><br><span class="line">            "PidsLimit": 0,</span><br><span class="line">            "Ulimits": null,</span><br><span class="line">            "CpuCount": 0,</span><br><span class="line">            "CpuPercent": 0,</span><br><span class="line">            "IOMaximumIOps": 0,</span><br><span class="line">            "IOMaximumBandwidth": 0</span><br><span class="line">        &#125;,</span><br><span class="line">        "GraphDriver": &#123;</span><br><span class="line">            "Name": "overlay2",</span><br><span class="line">            "Data": &#123;</span><br><span class="line">                "LowerDir": "/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2-init/diff:/var/lib/docker/overlay2/83b7194d94d42c0ef8f78a2f4105cc7a7a215a8e885b695a933a8f8212db9cfa/diff:/var/lib/docker/overlay2/9549118d3883d39414fadf0dc17e654d1408878be3296b294711ee65ef336b98/diff:/var/lib/docker/overlay2/8e85764472e79d42f469dd3681883cd415e85098d6c42fb3dd239471212f87b3/diff:/var/lib/docker/overlay2/8dc8ec519bade76b07994adc690d1e6fcad408147835198a250b4c66c489a151/diff:/var/lib/docker/overlay2/b07d1c7463b2a4ff25f7800729381fdf5b036c12a065973b9d079580c3a50a5e/diff:/var/lib/docker/overlay2/60c9257cc9d8a7ac4b66d1c4cae5ff994471976f0a344f8ac1856a4fba7b290e/diff:/var/lib/docker/overlay2/2a00c5b47427e151e000ffe05de8121e956dbf15b0d356cfc9ad2754dc5554d5/diff:/var/lib/docker/overlay2/3495bcc2d508cbdad81b1f3eb49645fe0eb05caf0e99fbb6310d40fbdd8118a2/diff:/var/lib/docker/overlay2/9df322481c6f8b91b3583016634664e6ad991b8b846a9585385227a02b898770/diff:/var/lib/docker/overlay2/163747850da2115bac28b39ac6d2e08ca5c0e409fe6cae624155f8e61489aacd/diff:/var/lib/docker/overlay2/52405978404b67e0a67ba95cb12682d0e8a8ae781fd2b21dc2ab94197e97c38b/diff:/var/lib/docker/overlay2/c987c31253bca839eb789feb3e4fe7bc247b1e88dc88c67e2b4209fc26025fe8/diff:/var/lib/docker/overlay2/ed663d4b2fffda783f9b69e5eb7c139f34142e0e2d868460a3c1e1d925ec3e7e/diff:/var/lib/docker/overlay2/a0e3d07a65b7ee70d3869fa41418ecf71056b9ac0ba1182170621c83c77bba94/diff:/var/lib/docker/overlay2/aa4c66b37aae4e55a94aa60ac763a60851af34271ccb1a80f547e3d90e7ac2bf/diff:/var/lib/docker/overlay2/527b1a014d302c1fe835d778be6cd008de6741d290fbc0f2e64e3f25f7a7b8d0/diff",</span><br><span class="line">                "MergedDir": "/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/merged",</span><br><span class="line">                "UpperDir": "/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/diff",</span><br><span class="line">                "WorkDir": "/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/work"</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"Type"</span>: <span class="string">"volume"</span>,</span><br><span class="line">                <span class="attr">"Name"</span>: <span class="string">"7bc1a7ad23925077cf8463c2d7a21b0cafc7d91305d89504f85fa76c33138834"</span>,</span><br><span class="line">                "Source": "/var/lib/docker/volumes/7bc1a7ad23925077cf8463c2d7a21b0cafc7d91305d89504f85fa76c33138834/_data", // host 主机的被挂在的目录</span><br><span class="line">                "Destination": "/var/opt/mssql", // Volume 挂载点</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        "Config": &#123;</span><br><span class="line">            "Hostname": "405a378d6f88",</span><br><span class="line">            "Domainname": "",</span><br><span class="line">            "User": "",</span><br><span class="line">            "AttachStdin": false,</span><br><span class="line">            "AttachStdout": false,</span><br><span class="line">            "AttachStderr": false,</span><br><span class="line">            "ExposedPorts": &#123;</span><br><span class="line">                "1433/tcp": &#123;&#125;,</span><br><span class="line">                "8080/tcp": &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            "Tty": false,</span><br><span class="line">            "OpenStdin": false,</span><br><span class="line">            "StdinOnce": false,</span><br><span class="line">            "Env": [</span><br><span class="line">                "ACCEPT_EULA=Y",</span><br><span class="line">                "SA_PASSWORD=Yukon900",</span><br><span class="line">                <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">            ],</span><br><span class="line">            "Cmd": [</span><br><span class="line">                "/bin/sh",</span><br><span class="line">                "-c",</span><br><span class="line">                <span class="string">"/bin/bash ./entrypoint.sh"</span></span><br><span class="line">            ],</span><br><span class="line">            "ArgsEscaped": true,</span><br><span class="line">            "Image": "node-web-app",</span><br><span class="line">            "Volumes": &#123;</span><br><span class="line">                "/var/opt/mssql": &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            "WorkingDir": "/usr/src/app",</span><br><span class="line">            "Entrypoint": null,</span><br><span class="line">            "OnBuild": null,</span><br><span class="line">            "Labels": &#123;</span><br><span class="line">                "com.microsoft.product": "Microsoft SQL Server",</span><br><span class="line">                "com.microsoft.version": "14.0.3048.4",</span><br><span class="line">                "vendor": "Microsoft"</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "NetworkSettings": &#123;</span><br><span class="line">            "Bridge": "",</span><br><span class="line">            "SandboxID": "d21ee4834e9078042da65677d8db9717748eb7f86a6954c5e4eee29636159aa7",</span><br><span class="line">            "HairpinMode": false,</span><br><span class="line">            "LinkLocalIPv6Address": "",</span><br><span class="line">            "LinkLocalIPv6PrefixLen": 0,</span><br><span class="line">            "Ports": &#123;</span><br><span class="line">                "1433/tcp": [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"HostIp"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">                        <span class="attr">"HostPort"</span>: <span class="string">"1433"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                "8080/tcp": [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"HostIp"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">                        <span class="attr">"HostPort"</span>: <span class="string">"8080"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            "SandboxKey": "/var/run/docker/netns/d21ee4834e90",</span><br><span class="line">            "SecondaryIPAddresses": null,</span><br><span class="line">            "SecondaryIPv6Addresses": null,</span><br><span class="line">            "EndpointID": "46dac1ff81a297ede919100e0d06a743b845e34b802b54bca8cb8f02dcd33c85",</span><br><span class="line">            "Gateway": "172.17.0.1",</span><br><span class="line">            "GlobalIPv6Address": "",</span><br><span class="line">            "GlobalIPv6PrefixLen": 0,</span><br><span class="line">            "IPAddress": "172.17.0.2",</span><br><span class="line">            "IPPrefixLen": 16,</span><br><span class="line">            "IPv6Gateway": "",</span><br><span class="line">            "MacAddress": "02:42:ac:11:00:02",</span><br><span class="line">            "Networks": &#123;</span><br><span class="line">                "bridge": &#123;</span><br><span class="line">                    "IPAMConfig": null,</span><br><span class="line">                    "Links": null,</span><br><span class="line">                    "Aliases": null,</span><br><span class="line">                    "NetworkID": "a8af0599996912141c3f2ce4b0a2bcc48eea9164a35672aac6307333450acb6b", //a8af05999969 </span><br><span class="line">                    "EndpointID": "46dac1ff81a297ede919100e0d06a743b845e34b802b54bca8cb8f02dcd33c85",</span><br><span class="line">                    "Gateway": "172.17.0.1",</span><br><span class="line">                    "IPAddress": "172.17.0.2",</span><br><span class="line">                    "IPPrefixLen": 16,</span><br><span class="line">                    "IPv6Gateway": "",</span><br><span class="line">                    "GlobalIPv6Address": "",</span><br><span class="line">                    "GlobalIPv6PrefixLen": 0,</span><br><span class="line">                    "MacAddress": "02:42:ac:11:00:02" </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="docker-volume"><a href="#docker-volume" class="headerlink" title="docker volume"></a>docker volume</h2><h3 id="mount"><a href="#mount" class="headerlink" title="mount"></a>mount</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">"Mounts": [</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="attr">"Type"</span>: <span class="string">"volume"</span>,</span><br><span class="line">             <span class="attr">"Name"</span>: <span class="string">"7bc1a7ad23925077cf8463c2d7a21b0cafc7d91305d89504f85fa76c33138834"</span>,</span><br><span class="line">             "Source": "/var/lib/docker/volumes/7bc1a7ad23925077cf8463c2d7a21b0cafc7d91305d89504f85fa76c33138834/_data", // host 主机的被挂载的目录</span><br><span class="line">             "Destination": "/var/opt/mssql", // Volume 挂载点</span><br><span class="line">             "Driver": "local",</span><br><span class="line">             "Mode": "",</span><br><span class="line">             "RW": true,</span><br><span class="line">             "Propagation": ""</span><br><span class="line">         &#125;</span><br><span class="line">     ]</span><br></pre></td></tr></table></figure>

<h2 id="Local-Docker-container-网络"><a href="#Local-Docker-container-网络" class="headerlink" title="Local Docker container 网络"></a>Local Docker container 网络</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"ResolvConfPath"</span>: <span class="string">"/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/resolv.conf"</span>,</span><br><span class="line"><span class="attr">"HostnamePath"</span>: <span class="string">"/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/hostname"</span>,</span><br><span class="line"><span class="attr">"HostsPath"</span>: <span class="string">"/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/hosts"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2019/09/03/docker-practice/local-var-lib-docker-container.png" title="本地存储的容器的网络配置">

<h2 id="Container-网络配置"><a href="#Container-网络配置" class="headerlink" title="Container 网络配置"></a>Container 网络配置</h2><img src="/2019/09/03/docker-practice/container-etc.png" title="容器的网络配置">

<h2 id="Docker-Images-分层"><a href="#Docker-Images-分层" class="headerlink" title="Docker Images 分层"></a>Docker Images 分层</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"GraphDriver"</span>: &#123;</span><br><span class="line">            <span class="attr">"Name"</span>: <span class="string">"overlay2"</span>,</span><br><span class="line">            <span class="attr">"Data"</span>: &#123;</span><br><span class="line">                <span class="attr">"LowerDir"</span>: <span class="string">"/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2-init/diff:/var/lib/docker/overlay2/83b7194d94d42c0ef8f78a2f4105cc7a7a215a8e885b695a933a8f8212db9cfa/diff:/var/lib/docker/overlay2/9549118d3883d39414fadf0dc17e654d1408878be3296b294711ee65ef336b98/diff:/var/lib/docker/overlay2/8e85764472e79d42f469dd3681883cd415e85098d6c42fb3dd239471212f87b3/diff:/var/lib/docker/overlay2/8dc8ec519bade76b07994adc690d1e6fcad408147835198a250b4c66c489a151/diff:/var/lib/docker/overlay2/b07d1c7463b2a4ff25f7800729381fdf5b036c12a065973b9d079580c3a50a5e/diff:/var/lib/docker/overlay2/60c9257cc9d8a7ac4b66d1c4cae5ff994471976f0a344f8ac1856a4fba7b290e/diff:/var/lib/docker/overlay2/2a00c5b47427e151e000ffe05de8121e956dbf15b0d356cfc9ad2754dc5554d5/diff:/var/lib/docker/overlay2/3495bcc2d508cbdad81b1f3eb49645fe0eb05caf0e99fbb6310d40fbdd8118a2/diff:/var/lib/docker/overlay2/9df322481c6f8b91b3583016634664e6ad991b8b846a9585385227a02b898770/diff:/var/lib/docker/overlay2/163747850da2115bac28b39ac6d2e08ca5c0e409fe6cae624155f8e61489aacd/diff:/var/lib/docker/overlay2/52405978404b67e0a67ba95cb12682d0e8a8ae781fd2b21dc2ab94197e97c38b/diff:/var/lib/docker/overlay2/c987c31253bca839eb789feb3e4fe7bc247b1e88dc88c67e2b4209fc26025fe8/diff:/var/lib/docker/overlay2/ed663d4b2fffda783f9b69e5eb7c139f34142e0e2d868460a3c1e1d925ec3e7e/diff:/var/lib/docker/overlay2/a0e3d07a65b7ee70d3869fa41418ecf71056b9ac0ba1182170621c83c77bba94/diff:/var/lib/docker/overlay2/aa4c66b37aae4e55a94aa60ac763a60851af34271ccb1a80f547e3d90e7ac2bf/diff:/var/lib/docker/overlay2/527b1a014d302c1fe835d778be6cd008de6741d290fbc0f2e64e3f25f7a7b8d0/diff"</span>,</span><br><span class="line">                <span class="attr">"MergedDir"</span>: <span class="string">"/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/merged"</span>,</span><br><span class="line">                <span class="attr">"UpperDir"</span>: <span class="string">"/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/diff"</span>,</span><br><span class="line">                <span class="attr">"WorkDir"</span>: <span class="string">"/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/work"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MergedDir"><a href="#MergedDir" class="headerlink" title="MergedDir"></a>MergedDir</h3><blockquote>
<p>这个 MergedDir 层就是一个 Linux 镜像 </p>
</blockquote>
<img src="/2019/09/03/docker-practice/merged-dir.png" title="镜像 Merged 层">

















<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><p><a href="https://github.com/twright-msft/mssql-node-docker-demo-app/blob/master/Dockerfile" target="_blank" rel="noopener">mssql-node-docker-demo-app</a></p>
</li>
<li><p><a href="https://docs.docker.com/storage/storagedriver/" target="_blank" rel="noopener">storage driver</a></p>
</li>
<li><p><a href="https://medium.com/better-programming/about-var-run-docker-sock-3bfd276e12fd" target="_blank" rel="noopener">var-run-docker-sock</a></p>
</li>
<li><p><a href="https://blog.csdn.net/boling_cavalry/article/details/92846483" target="_blank" rel="noopener">docker 的 /var/run/docker.sock 参数</a></p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://stardustman.github.io/2019/07/22/hadoop-environment-setup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="stardustman">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stardustman">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/22/hadoop-environment-setup/" itemprop="url">hadoop-environment-setup</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-22T10:40:05+08:00">
                2019-07-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/22/hadoop-environment-setup/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/07/22/hadoop-environment-setup/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h1><ol>
<li>CentOS-7-x86_64-Minimal-1810</li>
<li>hadoop-3.2.0</li>
<li>jdk8</li>
<li>vmware 链接克隆 5 台虚拟机</li>
<li>192.168.126.133 s101</li>
<li>192.168.126.134 s102</li>
<li>192.168.126.135 s103</li>
<li>192.168.126.136 s104</li>
<li>192.168.126.137 s105</li>
</ol>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="centos7-minimal-配置静态-ip"><a href="#centos7-minimal-配置静态-ip" class="headerlink" title="centos7-minimal 配置静态 ip"></a>centos7-minimal 配置静态 ip</h3><ol>
<li>vim /etc/sysconfig/network-scripts/ifcfg-ens33</li>
<li>静态ip配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static #need</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=f5fd61b8-7255-4de9-ae68-5047e1586589</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">NM_CONTROLLED=no #need</span><br><span class="line">IPADDR=192.168.126.137 #need</span><br><span class="line">NETMASK=255.255.255.0 #need</span><br><span class="line">GATEWAY=192.168.126.2 #need</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h3><ol>
<li><p>vim /etc/profile 添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/soft/java8</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/jre/lib:$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>source /etc/profile</p>
</li>
<li><p>java -version</p>
</li>
</ol>
<h3 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h3><ol>
<li><p>vim /etc/profile 添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export HADOOP_HOME=/soft/hadoop-3.2.0</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin</span><br></pre></td></tr></table></figure>
</li>
<li><p>source /etc/profile</p>
</li>
<li><p>hadoop version<br>## </p>
</li>
</ol>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol>
<li><a href="http://www.mustbegeek.com/configure-static-ip-address-in-centos/" target="_blank" rel="noopener">centos7-static-ip-config</a></li>
<li><a href="https://www.liquidweb.com/kb/install-java-8-on-centos-7/" target="_blank" rel="noopener">centos7-openjdk-install</a></li>
<li><a href="https://blog.csdn.net/crxmai/article/details/49767673" target="_blank" rel="noopener">centos7-minimal-network-enable</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://stardustman.github.io/2019/07/17/clang-structure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="stardustman">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stardustman">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/17/clang-structure/" itemprop="url">clang-structure</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-17T10:48:46+08:00">
                2019-07-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/17/clang-structure/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/07/17/clang-structure/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="size-of-structure"><a href="#size-of-structure" class="headerlink" title="size of structure"></a>size of structure</h1><h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ol>
<li><a href="https://www.geeksforgeeks.org/flexible-array-members-structure-c/" target="_blank" rel="noopener">flexible-array-members-structure-c</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://stardustman.github.io/2019/07/06/asm-how-recursion-function-execute/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="stardustman">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stardustman">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/06/asm-how-recursion-function-execute/" itemprop="url">asm-how-recursion-function-execute</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-06T16:35:51+08:00">
                2019-07-06
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/06/asm-how-recursion-function-execute/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/07/06/asm-how-recursion-function-execute/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="斐波那契数列"><a href="#斐波那契数列" class="headerlink" title="斐波那契数列"></a>斐波那契数列</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><blockquote>
<p>第一个月初有一对刚诞生的兔子<br>第二个月之后(第三个月)它们可以生育<br>每月每对可生育的兔子会诞生下一对新兔子<br>兔子永不死<br>问第 n 月有多少对兔子?</p>
</blockquote>
<h2 id="图解"><a href="#图解" class="headerlink" title="图解"></a>图解</h2><blockquote>
<p>假设在n月有兔子总共 a 对, n+1 月总共有 b 对. 在 n+2 月必定总共有 a+b 对: 因为在 n+2 月的时候, 前一月(n+1月) 的 b 对兔子可以存留至第 n+2 月(在当月属于新诞生的兔子尚不能生育). 而新生育出的兔子对数等于所有在 n 月就已存在的 a 对.</p>
</blockquote>
<img src="/2019/07/06/asm-how-recursion-function-execute/fibonacci-sequence.png" title="fibonacci-sequence">

<h1 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h1><h2 id="C-代码"><a href="#C-代码" class="headerlink" title="C 代码"></a>C 代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">fib</span><span class="params">(<span class="keyword">long</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n &lt;= <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">return</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> result = <span class="number">0</span>;</span><br><span class="line">    result = fib(<span class="number">4</span>);</span><br><span class="line">    <span class="comment">//printf("%d\n",result);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Asm-代码"><a href="#Asm-代码" class="headerlink" title="Asm 代码"></a>Asm 代码</h2><h3 id="中间代码"><a href="#中间代码" class="headerlink" title="中间代码"></a>中间代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">fib(long):</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        pushq   %rbx</span><br><span class="line">        subq    $24, %rsp</span><br><span class="line">        movq    %rdi, -24(%rbp) // n</span><br><span class="line">        cmpq    $2, -24(%rbp)   // n - 2</span><br><span class="line">        jg      .L2 </span><br><span class="line">        movl    $1, %eax        // n &lt;= 2</span><br><span class="line">        jmp     .L3</span><br><span class="line">.L2:</span><br><span class="line">        movq    -24(%rbp), %rax // n</span><br><span class="line">        subq    $1, %rax // n - 1</span><br><span class="line">        movq    %rax, %rdi</span><br><span class="line">        call    fib(long)</span><br><span class="line"></span><br><span class="line">        movq    %rax, %rbx // </span><br><span class="line">        movq    -24(%rbp), %rax // n</span><br><span class="line">        subq    $2, %rax // n - 2</span><br><span class="line">        movq    %rax, %rdi</span><br><span class="line">        call    fib(long)</span><br><span class="line">        addq    %rbx, %rax</span><br><span class="line">.L3:</span><br><span class="line">        addq    $24, %rsp // 释放分配的栈空间</span><br><span class="line">        popq    %rbx</span><br><span class="line">        popq    %rbp</span><br><span class="line">        ret</span><br><span class="line">main:</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        subq    $16, %rsp</span><br><span class="line">        movl    $3, %edi  // n = 3</span><br><span class="line">        call    fib(long)</span><br><span class="line">        movq    %rax, -8(%rbp) // result = fib(3)</span><br><span class="line">        movl    $0, %eax</span><br><span class="line">        leave</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<img src="/2019/07/06/asm-how-recursion-function-execute/fib-label.png">
<h3 id="反编译可执行代码"><a href="#反编译可执行代码" class="headerlink" title="反编译可执行代码"></a>反编译可执行代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">fib(long):</span><br><span class="line">        push   %rbp</span><br><span class="line">        mov    %rsp,%rbp</span><br><span class="line">        push   %rbx</span><br><span class="line">        sub    $0x18,%rsp</span><br><span class="line">        mov    %rdi,-0x18(%rbp)</span><br><span class="line">        cmpq   $0x2,-0x18(%rbp)</span><br><span class="line">        jg     4004cd &lt;fib(long)+0x1b&gt; // 0x1b 是地址为 4004cd 这条指令之前的所有指令的字节数</span><br><span class="line">        mov    $0x1,%eax</span><br><span class="line">        jmp    4004f3 &lt;fib(long)+0x41&gt; // 0x41 是地址为 4004f3 这条指令之前的所有指令的字节数</span><br><span class="line">        mov    -0x18(%rbp),%rax</span><br><span class="line">        sub    $0x1,%rax</span><br><span class="line">        mov    %rax,%rdi</span><br><span class="line">        callq  4004b2 &lt;fib(long)&gt;</span><br><span class="line">        mov    %rax,%rbx</span><br><span class="line">        mov    -0x18(%rbp),%rax</span><br><span class="line">        sub    $0x2,%rax</span><br><span class="line">        mov    %rax,%rdi</span><br><span class="line">        callq  4004b2 &lt;fib(long)&gt;</span><br><span class="line">        add    %rbx,%rax</span><br><span class="line">        add    $0x18,%rsp</span><br><span class="line">        pop    %rbx</span><br><span class="line">        pop    %rbp</span><br><span class="line">        retq   </span><br><span class="line">main:</span><br><span class="line">        push   %rbp</span><br><span class="line">        mov    %rsp,%rbp</span><br><span class="line">        sub    $0x10,%rsp</span><br><span class="line">        movq   $0x0,-0x8(%rbp)</span><br><span class="line">        mov    $0x4,%edi</span><br><span class="line">        callq  4004b2 &lt;fib(long)&gt;</span><br><span class="line">        mov    %rax,-0x8(%rbp)</span><br><span class="line">        mov    $0x0,%eax</span><br><span class="line">        leaveq </span><br><span class="line">        retq   </span><br><span class="line">        nop</span><br></pre></td></tr></table></figure>

<img src="/2019/07/06/asm-how-recursion-function-execute/fib.png" title="fib">
<blockquote>
<p>fib(n)函数里调用 fib(n - 1) 和 fib(n - 2)视为两个和 fib(n) 完全不同的函数, 因为函数返回地址在汇编层面根本不一样.fib(n), fib(n - 1) 和 fib(n - 2) 的处理逻辑不一样, 只是之间有依赖而已. 也可以视为编译器级别的函数重载. 理解成三个不同的函数, 这个递归就很好理解了.</p>
</blockquote>
<h2 id="调用栈调用顺序分析"><a href="#调用栈调用顺序分析" class="headerlink" title="调用栈调用顺序分析"></a>调用栈调用顺序分析</h2><h3 id="调用栈图解分析"><a href="#调用栈图解分析" class="headerlink" title="调用栈图解分析"></a>调用栈图解分析</h3><img src="/2019/07/06/asm-how-recursion-function-execute/fib(4)-call-stack.png" title="fib(4)调用栈分析">
<h3 id="符合递归终止时调用栈执行顺序"><a href="#符合递归终止时调用栈执行顺序" class="headerlink" title="符合递归终止时调用栈执行顺序"></a>符合递归终止时调用栈执行顺序</h3><blockquote>
<p>fib(3) = fib(2) + fib(1), 就符合递归退出的条件.</p>
</blockquote>
<h4 id="代码执行顺序"><a href="#代码执行顺序" class="headerlink" title="代码执行顺序"></a>代码执行顺序</h4><img src="/2019/07/06/asm-how-recursion-function-execute/fib(3)-execute-sequence.png" title="第一次执行到fib(3)调用流程">

<h4 id="二叉树后序遍历的视角来分析"><a href="#二叉树后序遍历的视角来分析" class="headerlink" title="二叉树后序遍历的视角来分析"></a>二叉树后序遍历的视角来分析</h4><blockquote>
<p>递归终止条件:<br>fib(2) = 1 视为左叶子节点<br>fib(1) = 1 视为右叶子节点<br>fib(3) = fib(2) + fib(1) 视为父节点</p>
</blockquote>
<img src="/2019/07/06/asm-how-recursion-function-execute/fib(3)-execute-squence-treefy.png" title="符合递归退出代码执行流程">
<blockquote>
<p>fib(3) 调用 fib(2), 计算出参数 n = 2. 进入左叶子节点.<br>fib(2) 返回 fib(3), fib(2) 的返回值 rax = 1, 复制给 rbx.<br>fib(3) 调用 fib(1), 计算出参数 n = 1. 进入右叶子节点.<br>fib(1) 返回 fib(3), fib(1) 的返回值 rax = 1<br>fib(3) 计算 fib(3) = fib(2) + fib(1) = rbx + rax = 1 + 1 = 2</p>
</blockquote>
<h4 id="栈帧的创建和销毁-二叉树后序遍历"><a href="#栈帧的创建和销毁-二叉树后序遍历" class="headerlink" title="栈帧的创建和销毁-二叉树后序遍历"></a>栈帧的创建和销毁-二叉树后序遍历</h4><blockquote>
<p>fib(n) = fib(n-1) + fib(n-2)(n &gt; 2) 递归调用可以看作是栈帧按照二叉树按照后续遍历的顺序动态的创建和销毁.<br>着色方框为创建的栈帧<br>白色方框为销毁的栈帧或者还未创建的栈帧<br>方框由白色变为着色: 栈帧创建<br>方框由着色变为白色: 栈帧销毁</p>
</blockquote>
<img src="/2019/07/06/asm-how-recursion-function-execute/fib-dynamic-stack-frame.png" title="fib(5) 调用栈-栈帧的动态创建和销毁">
<blockquote>
<p>从图中可以看出假如 main 调用 fib(5), 会一直调用到 f(2) 才会终止. 则调用栈状态如图 0. 此时递归最大的栈深度是 4, 如果 n 值过大, 会很容易发生 Stack Overflow 这种错误. 比方说 fib(1000) 会一直创建到 fib(2) 这个栈帧, 递归才会开始返回.<br>fib(2) 返回 1 给 fib(3), fib(3) 保存这个返回值. f(2) 栈帧销毁. 如图 1.<br>fib(3) 调用 fib(2) 如图 2.<br>fib(2) 返回 1 给 fib(3), fib(3) 将 fib(2)返回值和 fib(1) 的返回值相加. 如图 3.<br>fib(3) 返回 fib(2)返回值和 fib(1) 的返回值相加的结果. 如图 4.</p>
</blockquote>
<h5 id="效率低原因分析"><a href="#效率低原因分析" class="headerlink" title="效率低原因分析"></a>效率低原因分析</h5><blockquote>
<p>计算的结果并没有保存. 每一次进入递归之后都是从基本的 fib(2) 和 fib(1) 向上返回. 中间伴随着大量的栈帧创建和销毁, 以及重复的函数计算.函数栈帧的创建和销毁是耗时的操作, 这可就很慢了.<br>fib(n) 开辟栈帧总数量可以表示为: sum(n) = 2^(n - 2) + 1 (n &gt;= 3).<br>时间复杂度是: O(2^n)</p>
</blockquote>
<h5 id="运行时间测试"><a href="#运行时间测试" class="headerlink" title="运行时间测试"></a>运行时间测试</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LENGTH 51</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">fib</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n &lt;= <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">return</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">clock_t</span> beginTime,endTime;</span><br><span class="line">    beginTime = clock();</span><br><span class="line">    result = fib(LENGTH - <span class="number">1</span>);</span><br><span class="line">    endTime = clock();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Running Time %f Seconds\n"</span>,(<span class="keyword">double</span>)(endTime - beginTime)/CLOCKS_PER_SEC);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">" %d :: %lu \n"</span>, LENGTH - <span class="number">1</span>, result);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>fib(n) 开辟栈帧总数量可以表示为: sum(n) = 2^(n - 2) + 1 (n &gt;= 3).<br>时间复杂度是: O(2^n)<br>fib(50) 开辟栈帧总量是: sum(50) = 2^(48) + 1<br>时间复杂度是: O(2 ^ 50)<br>计算 fib(50) 费了 65 秒左右</p>
</blockquote>
<h5 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h5><blockquote>
<p>用数组保存已经计算出来的 fib(n) 的结果. 修改计算逻辑, 如果 fib(n) 已经被计算, 直接使用, 不再进入递归计算.<br>这可不就是有拿空间换时间的感觉.</p>
</blockquote>
<h2 id="优化递归"><a href="#优化递归" class="headerlink" title="优化递归"></a>优化递归</h2><h3 id="空间换时间优化代码"><a href="#空间换时间优化代码" class="headerlink" title="空间换时间优化代码"></a>空间换时间优化代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> LENGTH 51</span></span><br><span class="line"><span class="comment">// 计算 fib(50)</span></span><br><span class="line"><span class="comment">// 全局的用来保存 fib(n)(n &gt; 2) 计算结果的数组.</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> result[LENGTH];</span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">fib</span><span class="params">(<span class="keyword">long</span> n)</span></span>&#123;</span><br><span class="line">    <span class="comment">// fib(n) 已经被计算, 那就直接返回.</span></span><br><span class="line">    <span class="keyword">if</span>(result[n] != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> result[n];</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">       保存 fib(n) 的计算结果</span><br><span class="line">       result[n] =  fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>);</span><br><span class="line">    &#125; </span><br><span class="line">   <span class="keyword">return</span> result[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">clock_t</span> beginTime,endTime;</span><br><span class="line">    <span class="comment">// 由于 1, 1, 2, 3, 5 ..... 都是大于 0 的结果, 全部初始化为 0, 相当于都没有计算结果.</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; LENGTH ; i++)&#123;</span><br><span class="line">        result[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// fib(1) 的计算结果为 1</span></span><br><span class="line">    result[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// fib(2) 的计算结果为 1</span></span><br><span class="line">    result[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    beginTime = clock();</span><br><span class="line">    fib(LENGTH - <span class="number">1</span>);</span><br><span class="line">    endTime = clock();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Running Time %f Seconds\n"</span>,(<span class="keyword">double</span>)(endTime - beginTime)/CLOCKS_PER_SEC);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; LENGTH; i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">" %i :: %lu \n"</span>, i, result[i]);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="优化递归函数栈帧"><a href="#优化递归函数栈帧" class="headerlink" title="优化递归函数栈帧"></a>优化递归函数栈帧</h3><img src="/2019/07/06/asm-how-recursion-function-execute/fib-optimize-stack-frame.png" title="fib(5)递归栈帧">
<blockquote>
<p>着色方框-开辟销毁的栈帧<br>白色方框-不用开辟的栈帧<br>优化后的 fib(n) 开辟栈帧总数量可以表示为: sum(n) = (n - 2)(n &gt;= 3).<br>时间复杂度是: O(n)<br>计算 fib(50) 开辟栈帧总数量是: sum(50) = 48<br>fib(50) = 3996334433<br>时间复杂度是 O(50), 结果几乎秒算.<br>unsigned long result[LENGTH];<br>拿空间换时间, 其实这句话有问题的, 拿出来空间, 计算逻辑也是要优化的. </p>
</blockquote>
<h3 id="尾递归优化"><a href="#尾递归优化" class="headerlink" title="尾递归优化"></a>尾递归优化</h3><h4 id="非优化递归"><a href="#非优化递归" class="headerlink" title="非优化递归"></a>非优化递归</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">fib</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n &lt;= <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">return</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里 fib(n-1) 和 fib(n-2) 与 fib(n) 其实根本不是同一个函数.<br>三者的逻辑其实不同, 但是函数之间有依赖.</p>
</blockquote>
<h4 id="优化递归-1"><a href="#优化递归-1" class="headerlink" title="优化递归"></a>优化递归</h4><blockquote>
<p>尾递归的实现, 往往需要改写递归函数, 确保最后一步只调用自身. 做到这一点的方法, 就是把所有用到的内部变量改写成函数的参数.<br>尾调用的概念非常简单, 一句话就能说清楚, 就是指某个函数的最后一步是调用另一个函数.</p>
</blockquote>
<h5 id="中间变量改成函数的参数"><a href="#中间变量改成函数的参数" class="headerlink" title="中间变量改成函数的参数"></a>中间变量改成函数的参数</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">fib</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> n, <span class="keyword">unsigned</span> <span class="keyword">long</span> prev, <span class="keyword">unsigned</span> <span class="keyword">long</span> sum )</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n &lt;= <span class="number">3</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fib(n<span class="number">-1</span>, sum , prev + sum); <span class="comment">// 尾调用</span></span><br><span class="line">&#125;</span><br><span class="line">&gt; 这里 fib(n<span class="number">-1</span>, sum , prev + sum) 的才是和 fib(<span class="keyword">unsigned</span> <span class="keyword">long</span> n, <span class="keyword">unsigned</span> <span class="keyword">long</span> prev, <span class="keyword">unsigned</span> <span class="keyword">long</span> sum ) 完全一样的函数.</span><br></pre></td></tr></table></figure>

<h5 id="包装一层"><a href="#包装一层" class="headerlink" title="包装一层"></a>包装一层</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span>   <span class="title">fibonacc</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( n &lt;= <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// 1 : fib(2)</span></span><br><span class="line">    <span class="comment">// 2 : fib(2) + fib(1) = fib(3)</span></span><br><span class="line">    <span class="keyword">return</span> fib(n, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>计算结果保存在参数里.</p>
</blockquote>
<h5 id="fib-n-汇编代码分析"><a href="#fib-n-汇编代码分析" class="headerlink" title="fib(n) 汇编代码分析"></a>fib(n) 汇编代码分析</h5><img src="/2019/07/06/asm-how-recursion-function-execute/fib-tail-recursion.png" title="fib(n) 尾递归汇编代码">
<blockquote>
<p>尾递归的 fib(n-1, sum , prev + sum) 是尾调用, 也就是函数执行完没有其他的操作了, 就直接返回了. 符合 n &lt;= 3 的条件, 汇编直接 jmp 到销毁栈帧的代码. 因为返回值在符合递归退出条件时, 已经被设置到 rax 里了.</p>
</blockquote>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><blockquote>
<p>用简单的一句话,递归就是调用函数本身. 这句话是相当不负责任的. 递归函数在汇编级别的调用自己, 尽管调用的是自己, 递归的函数名尽管相同, 但是函数返回地址是不相同的. 这也意味着其实逻辑其实完全可能不一样.<br>结合栈帧的创建和销毁, 就可以理解 Stack Overflow 这种错误.</p>
</blockquote>
<p>References</p>
<ol>
<li><a href="https://stackoverflow.com/questions/21440403/what-does-the-cmpq-instruction-do" target="_blank" rel="noopener">asm-cmpq</a></li>
<li><a href="https://www.aldeid.com/wiki/X86-assembly/Instructions/jg" target="_blank" rel="noopener">asm-jg</a></li>
<li><a href="http://faydoc.tripod.com/cpu/jg.htm" target="_blank" rel="noopener">asm-jp-table</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97" target="_blank" rel="noopener">斐波那契数列</a></li>
<li><a href="https://godbolt.org/" target="_blank" rel="noopener">asm-tool</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2015/04/tail-call.html" target="_blank" rel="noopener">尾调用(tail-call)之尾递归</a></li>
<li><a href="https://mp.weixin.qq.com/s/GncAsmZ1dZKyNMOwN5-sjw" target="_blank" rel="noopener">动态规划</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://stardustman.github.io/2019/06/25/asm-clang-concepts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="stardustman">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stardustman">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/25/asm-clang-concepts/" itemprop="url">asm-clang-concepts</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-06-25T16:57:59+08:00">
                2019-06-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/25/asm-clang-concepts/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/06/25/asm-clang-concepts/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>C 语言里的概念在 X86-64 汇编层面的分析. 汇编风格使用 AT&amp;T 风格. 编译器是 gcc-x86-64-9.1</p>
<h1 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h1><blockquote>
<p>A <code>pointer</code> is a programming language object that stores the memory address of another value located in computer memory.<br> A pointer references a location in memory, and obtaining the value stored at that location is known as dereferencing the pointer.</p>
</blockquote>
<h2 id="变量地址"><a href="#变量地址" class="headerlink" title="变量地址"></a>变量地址</h2><blockquote>
<p>The lea (load effective address) instruction is used to put a memory address into the destination.<br>leaq  -8(%rbp), %rdx<br>-8(%rbp)等价于 mem[R[rbp] -8]. 将 rbp - 8 的值(这个值就是内存地址)复制到 rdx.</p>
</blockquote>
<h2 id="寄存器间接寻址"><a href="#寄存器间接寻址" class="headerlink" title="寄存器间接寻址"></a>寄存器间接寻址</h2><blockquote>
<p>movq    (%rax), %rdx<br>将 rax 的值(X)指向的内存地址处的值复制到 rdx. 此时 rax 的值(X)就是指针, 所谓指针在汇编层面就是将一个内存地址放到寄存器, 利用寄存器间接寻址去获取这个地址的数值. 这就是 C 语言里指针的本质. </p>
</blockquote>
<h2 id="movq-operand-combinations"><a href="#movq-operand-combinations" class="headerlink" title="movq operand combinations"></a>movq operand combinations</h2><img src="/2019/06/25/asm-clang-concepts/address-modes.png" title="movq operand combinations">

<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><h3 id="swap"><a href="#swap" class="headerlink" title="swap"></a>swap</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> *pa, <span class="keyword">int</span> *pb)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = *pa; </span><br><span class="line">    *pa = *pb;</span><br><span class="line">    *pb = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">swap(int*, int*):</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        movq    %rdi, -24(%rbp) ; 将变量 a(10) 的地址(&amp;a)复制到 rbp - 24 地址处, 参数 pa</span><br><span class="line">        movq    %rsi, -32(%rbp) ; 将变量 b(100) 的地址(&amp;b)复制到 rbp - 32 地址处, 参数 pb </span><br><span class="line">        movq    -24(%rbp), %rax ; 将 rbp - 24 指向的内存地址的数值(也就是变量 a 的地址)复制到 rax</span><br><span class="line">        movl    (%rax), %eax    ; 将 rax 指向的内存地址的值 10(也就是变量 a) 复制到 eax, int a 4 Bytes 需要 32 bit 的 eax 即可.</span><br><span class="line">        movl    %eax, -4(%rbp)  ; 将 eax 的值 10 (也就是变量 a) 复制到 rbp - 4 指向的内存地址处, 完成 temp = *pa;</span><br><span class="line">        movq    -32(%rbp), %rax ; 将 rbp - 32 指向的内存地址的值(也就是变量 b 的地址) 的地址复制到 rax</span><br><span class="line">        movl    (%rax), %edx    ; 将 rax 的值指向的内存地址出的值 100(也就是变量 b) 复制到 edx, int b 4 Bytes 需要 32 bit 的 eax 即可.</span><br><span class="line">        movq    -24(%rbp), %rax ; 将 rbp - 24 指向的内存地址的值(也就是变量 a 的地址)复制到 rax</span><br><span class="line">        movl    %edx, (%rax)    ; 将 edx 的值 100 (也就是变量 b)复制到 rax 指向的地址处(也就是变量 a 的地址), 完成 *pa = *pb</span><br><span class="line">        movq    -32(%rbp), %rax ; 将 rbp - 32 指向的内存地址的值(也就是变量 b 的地址)复制到 rax</span><br><span class="line">        movl    -4(%rbp), %edx  ; 将 rbp - 4 指向的内存地址的值 10 复制到 edx</span><br><span class="line">        movl    %edx, (%rax)    ; 将 edx 的值 10 复制到 rax 指向的地址处(也就是变量 b 的地址), 完成 *pb = temp</span><br><span class="line">        nop</span><br><span class="line">        popq    %rbp</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">100</span>;</span><br><span class="line">    swap(&amp;a,&amp;b);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">        pushq   %rbp ; 保存调用者的 rbp</span><br><span class="line">        movq    %rsp, %rbp ; 开辟 main 函数的栈帧</span><br><span class="line">        subq    $16, %rsp  ; 分配 main 的栈空间 16 bytes</span><br><span class="line">        movl    $10, -4(%rbp) ; 将变量 a 复制到 rbp - 4 指向的地址处.(int a, 4 bytes)</span><br><span class="line">        movl    $100, -8(%rbp) ; 将变量 b 复制到 rbp - 8 指向的地址处.(int b, 4 bytes)</span><br><span class="line">        leaq    -8(%rbp), %rdx ; 将 rbp - 8 的值复制到 rdx 寄存器(int b 变量的地址)</span><br><span class="line">        leaq    -4(%rbp), %rax ; 将 rbp - 4 的值复制到 rax 寄存器(int a 变量的地址)</span><br><span class="line">        movq    %rdx, %rsi ; 复制 rdx(第二个参数: 变量 b 的地址) 到 rsi 寄存器</span><br><span class="line">        movq    %rax, %rdi ; 复制 rax(第一个参数: 变量 a 的地址) 到 rdi 寄存器</span><br><span class="line">        call    swap(int*, int*)</span><br><span class="line">        movl    $0, %eax</span><br><span class="line">        leave   ; 等价于 1. mov %rbp, %rsp(回收分配的栈空间) 2.pop %rbp(恢复 main 的 rbp)</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<img src="/2019/06/25/asm-clang-concepts/swap-c-asm.png" title="swap-c-asm">

<h3 id="栈帧分析"><a href="#栈帧分析" class="headerlink" title="栈帧分析"></a>栈帧分析</h3><img src="/2019/06/25/asm-clang-concepts/swap-pointer.png" title="main-swap-call-stack">

<blockquote>
<p>该图是 swap 执行完 int temp = *pa 后的状态.</p>
</blockquote>
<h3 id="函数返回值"><a href="#函数返回值" class="headerlink" title="函数返回值"></a>函数返回值</h3><blockquote>
<p>the return value for the function should be placed in rax if it is not already there.<br>返回值放在 rax 寄存器. 这是 x86-64 的约定. 架构设计决定只有 rax 一个寄存器存放返回值, 这也是高级语言返回值只能是一个的原因.<br>C 语言里返回的结构体, 其实也就是结构体第一个字节的地址, 还是一个值.<br>C 语言的函数返回值为 void, 在汇编层面也就是不用设置 rax.</p>
</blockquote>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><blockquote>
<p>指针本质就是寄存器间接寻址. 函数传参其实传的都是数值而已, 本质上都是数值的副本. </p>
</blockquote>
<h1 id="数据类型转化"><a href="#数据类型转化" class="headerlink" title="数据类型转化"></a>数据类型转化</h1><h2 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h2><h3 id="x86-64-registers"><a href="#x86-64-registers" class="headerlink" title="x86-64 registers"></a>x86-64 registers</h3><img src="/2019/06/25/asm-clang-concepts/x86-64-registers.png">

<h3 id="IA32-registers"><a href="#IA32-registers" class="headerlink" title="IA32 registers"></a>IA32 registers</h3><img src="/2019/06/25/asm-clang-concepts/IA32-registers.png">

<h3 id="代码分析-1"><a href="#代码分析-1" class="headerlink" title="代码分析"></a>代码分析</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testTypeConvert</span><span class="params">()</span></span>&#123;</span><br><span class="line">     <span class="keyword">unsigned</span> <span class="keyword">long</span> i64bit = <span class="number">1844674407370955199</span>;</span><br><span class="line">     <span class="keyword">unsigned</span> <span class="keyword">int</span> i32bit = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)i64bit;</span><br><span class="line">     <span class="keyword">unsigned</span> <span class="keyword">short</span> i16bit = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)i32bit;</span><br><span class="line">     <span class="keyword">unsigned</span> <span class="keyword">char</span> i8bit = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)i16bit;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"%ld\n"</span>,i64bit);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"%ld\n"</span>,i32bit);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,i16bit);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,i8bit);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">testTypeConvert():</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        movabsq $1844674407370955199, %rax ;‭00011001 10011001 10011001 10011001 10011001 10011001 10011001 10111111‬</span><br><span class="line">        movq    %rax, -8(%rbp)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movl    %eax, -12(%rbp) ; 10011001 10011001 10011001 10111111‬ (2576980415)</span><br><span class="line">        movl    -12(%rbp), %eax</span><br><span class="line">        movw    %ax, -14(%rbp) ; 10011001 10111111‬(39359)</span><br><span class="line">        movzwl  -14(%rbp), %eax ; 00000000 00000000 10011001 10111111‬ (zero extend)</span><br><span class="line">        movb    %al, -15(%rbp) ; 10111111‬(191)</span><br><span class="line">        nop</span><br><span class="line">        popq    %rbp</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<h3 id="结论-1"><a href="#结论-1" class="headerlink" title="结论"></a>结论</h3><p>int 类型的数据转化, 利用不同长度的寄存器. 比如 int 转 char 类型. 直接取 int 的最后 8 位. char 转 int ,对应的寄存器高位补上 3 个字节的 0.</p>
<h1 id="array"><a href="#array" class="headerlink" title="array"></a>array</h1><h2 id="C代码分析"><a href="#C代码分析" class="headerlink" title="C代码分析"></a>C代码分析</h2><h3 id="sumArray"><a href="#sumArray" class="headerlink" title="sumArray"></a>sumArray</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2</span>; </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">3</span>; </span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">sumArray</span><span class="params">(<span class="keyword">long</span> a[], <span class="keyword">long</span> length)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i &lt; length; i++)&#123;</span><br><span class="line">        sum += a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="sumMatrix"><a href="#sumMatrix" class="headerlink" title="sumMatrix"></a>sumMatrix</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sumMatrix</span><span class="params">(<span class="keyword">int</span> a[M][N])</span></span>&#123;</span><br><span class="line">     <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">for</span>(;i &lt; <span class="number">2</span>;i++)&#123;</span><br><span class="line">         <span class="keyword">for</span>(;j &lt; <span class="number">3</span>;j++)&#123;</span><br><span class="line">             sum += a[i][j];</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="main-1"><a href="#main-1" class="headerlink" title="main"></a>main</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> sum1 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">long</span> a[<span class="number">5</span>] = &#123;<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> matrix[<span class="number">2</span>][<span class="number">3</span>] = &#123;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,&#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    sum = sumArray(a, <span class="number">5</span>);</span><br><span class="line">    sum1 = sumMatrix(matrix);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Asm-代码分析"><a href="#Asm-代码分析" class="headerlink" title="Asm 代码分析"></a>Asm 代码分析</h2><h3 id="sumArray-1"><a href="#sumArray-1" class="headerlink" title="sumArray"></a>sumArray</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">sumArray(long*, long):</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        movq    %rdi, -24(%rbp) ; &amp;a[0]</span><br><span class="line">        movq    %rsi, -32(%rbp) ; length of a</span><br><span class="line">        movl    $0, -4(%rbp) ; sum</span><br><span class="line">        movl    $0, -8(%rbp) ; i</span><br><span class="line">.L3:</span><br><span class="line">        movl    -8(%rbp), %eax ; i</span><br><span class="line">        cltq</span><br><span class="line">        cmpq    %rax, -32(%rbp) ; cmpq i, length 其实也就是 i - length</span><br><span class="line">        jle     .L2</span><br><span class="line">        movl    -8(%rbp), %eax ; i</span><br><span class="line">        cltq</span><br><span class="line">        leaq    0(,%rax,8), %rdx ; rdx = 0 + 8 * i </span><br><span class="line">        movq    -24(%rbp), %rax  ; rax = &amp;a[0]</span><br><span class="line">        addq    %rdx, %rax       ; rax = &amp;a[0] + (0 + 8 * i), 地址增加 8 * i</span><br><span class="line">        movq    (%rax), %rax     ; rax = a[i]</span><br><span class="line">        movl    %eax, %edx       ; edx = a[i]</span><br><span class="line">        movl    -4(%rbp), %eax   ; eax = sum</span><br><span class="line">        addl    %edx, %eax       ; eax = a[i] + sum</span><br><span class="line">        movl    %eax, -4(%rbp)   </span><br><span class="line">        addl    $1, -8(%rbp)    ; i = i + 1</span><br><span class="line">        jmp     .L3</span><br><span class="line">.L2:</span><br><span class="line">        movl    -4(%rbp), %eax ; eax = sum</span><br><span class="line">        cltq</span><br><span class="line">        popq    %rbp</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过 a[i] 访问数组的方法, 与具体的数据类型有关<br>movl    -8(%rbp), %eax ; i<br>cltq    ; convert long(32 bit) to quad(64 bit)<br>leaq    0(,%rax,8), %rdx ; rdx = 0 + 8 * i , 比例寻址. 8 是比例因子,也就是数据类型的字节数,long 8 bytes.<br>movq    -24(%rbp), %rax  ; rax = &amp;a[0]<br>addq    %rdx, %rax       ; rax = &amp;a[0] + (0 + 8 * i), 地址增加 8 * i<br>movq    (%rax), %rax     ; rax = a[i]</p>
</blockquote>
<h3 id="Asm-sumMatrix"><a href="#Asm-sumMatrix" class="headerlink" title="Asm sumMatrix"></a>Asm sumMatrix</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">sumMatrix(int (*) [3]):</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        movq    %rdi, -24(%rbp) ; &amp;matrix[0][0]</span><br><span class="line">        movl    $0, -4(%rbp) ; sum = 0</span><br><span class="line">        movl    $0, -8(%rbp) ;i = 0</span><br><span class="line">        movl    $0, -12(%rbp);j = 0</span><br><span class="line">; 循环体开始</span><br><span class="line">.L9:</span><br><span class="line">        cmpl    $1, -8(%rbp) ; i - 1</span><br><span class="line">        jg      .L6 ; i - 1 &gt; 0 ;也就是 i = 2 时跳到 .L6, 退出循环. 否则进入内部循环.</span><br><span class="line">.L8:</span><br><span class="line">        cmpl    $2, -12(%rbp) ; cmpl 2, j</span><br><span class="line">        jg      .L7 ; j - 2 &gt; 0 ;也就是 j = 3 时,内部循环结束, 跳到 .L7. 改变 i, 进入下一轮循环</span><br><span class="line">        movl    -8(%rbp), %eax ; eax = i</span><br><span class="line">        movslq  %eax, %rdx ; rdx = i</span><br><span class="line">        movq    %rdx, %rax ; rax = i</span><br><span class="line">        addq    %rax, %rax ; rax = i + i</span><br><span class="line">        addq    %rdx, %rax ; rax = i + (i + i)</span><br><span class="line">        salq    $2, %rax ; rax = 2 * 2 * 3 * i rax 算术左移 2 位</span><br><span class="line">        movq    %rax, %rdx ; rdx = 12 * i</span><br><span class="line">        movq    -24(%rbp), %rax ; rax = &amp;matrix[0][0]</span><br><span class="line">        addq    %rax, %rdx ; rdx = &amp;matrix[0][0] + 12 * i</span><br><span class="line">        movl    -12(%rbp), %eax ; eax = j</span><br><span class="line">        cltq</span><br><span class="line">        movl    (%rdx,%rax,4), %eax ; 4 * rax + rdx = &amp;matrix[0][0] + 12 * i + 4 * j), 也就是 &amp;matrix[i][j]. eax = matrix[i][j]</span><br><span class="line">        addl    %eax, -4(%rbp) ; sum = sum + eax</span><br><span class="line">        addl    $1, -12(%rbp)  ; j = j + 1</span><br><span class="line">        jmp     .L8</span><br><span class="line">.L7:</span><br><span class="line">        addl    $1, -8(%rbp) ; i = i + 1</span><br><span class="line">        jmp     .L9</span><br><span class="line">.L6:</span><br><span class="line">        movl    -4(%rbp), %eax ; eax = sum</span><br><span class="line">        popq    %rbp</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<blockquote>
<p>int matrix[i][j]<br> movl    -8(%rbp), %eax // eax = i<br> movslq  %eax, %rdx // rdx = i<br> movq    %rdx, %rax ; rax = i<br> addq    %rax, %rax ; rax = i + i<br> addq    %rdx, %rax ; rax = i + (i + i)<br> salq    $2, %rax ; rax = 2 * 2 * 3 * i rax 算术左移 2 位<br> movq    %rax, %rdx ; rdx = 12 * i<br> movq    -24(%rbp), %rax ; rax = &amp;matrix[0][0]<br> addq    %rax, %rdx ; rdx = &amp;matrix[0][0] + 12 * i<br> movl    -12(%rbp), %eax ; eax = j<br> cltq<br> movl    (%rdx,%rax,4), %eax ; 4 * rax + rdx = 4 * j + &amp;matrix[0][0] + 12 * i ), 也就是 &amp;matrix[i][j]. eax = matrix[i][j]. sizeOf(int) = 4<br>在 main 中可知 matrix[0][0],matrix[0][1] … matrix[1][1],matrix[1][2]顺序排列<br>当 i = 0, j = 0 时 4 * 0 + &amp;matrix[0][0] + 12 * 0 = &amp;matrix[0][0]<br>当 i = 0, j = 1 时 4 * 1 + &amp;matrix[0][0] + 12 * 0 = &amp;matrix[0][1]<br>当 i = 1, j = 0 时 4 * 0 + &amp;matrix[0][0] + 12 * 1, 此时是 &amp;matrix[0][0] + 12,<br>二维数组每一行的字节总数是: 3(每一行 3 个 int) * 4(int 数据大小), 此时的地址是 &amp;matrix[1][0]<br>C 语言中二维数组作为函数参数传递时, 一定要给出列的数目, 不需要行数. 因为根据列数和数据类型的大小,就能算出下一行的第一个数据偏移起始位置. 偏移量 = 列数 * sizeOf(Data type)  </p>
</blockquote>
<h3 id="Asm-main"><a href="#Asm-main" class="headerlink" title="Asm main"></a>Asm main</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        subq    $96, %rsp ; 分配栈空间</span><br><span class="line">        movq    $0, -8(%rbp) ; sum</span><br><span class="line">        movl    $0, -12(%rbp) ; sum1</span><br><span class="line">        movq    $11, -64(%rbp) ; a[0]</span><br><span class="line">        movq    $22, -56(%rbp) ; a[1]</span><br><span class="line">        movq    $33, -48(%rbp) ; a[2]</span><br><span class="line">        movq    $44, -40(%rbp) ; a[3]</span><br><span class="line">        movq    $55, -32(%rbp) ; a[4]</span><br><span class="line">        movl    $1, -96(%rbp)  ; matrix[0][0]</span><br><span class="line">        movl    $2, -92(%rbp)  ; matrix[0][1]</span><br><span class="line">        movl    $3, -88(%rbp)  ; matrix[0][2]</span><br><span class="line">        movl    $4, -84(%rbp)  ; matrix[1][0]</span><br><span class="line">        movl    $5, -80(%rbp)  ; matrix[1][1]</span><br><span class="line">        movl    $6, -76(%rbp)  ; matrix[1][2]</span><br><span class="line">        ; call sumArray</span><br><span class="line">        leaq    -64(%rbp), %rax ; a[0] 的地址</span><br><span class="line"></span><br><span class="line">        movl    $5, %esi ; length of a, 第二个参数</span><br><span class="line">        movq    %rax, %rdi ; a[0] 的地址作为第一个参数</span><br><span class="line">        call    sumArray(long*, long)</span><br><span class="line">        movq    %rax, -8(%rbp) ; 返回值复制给 sum</span><br><span class="line">        ; call sumMatrix</span><br><span class="line">        leaq    -96(%rbp), %rax ; matrix[0][0] 的地址</span><br><span class="line"></span><br><span class="line">        movq    %rax, %rdi ; matrix[0][0] 的地址作为第一个参数</span><br><span class="line">        call    sumMatrix(int (*) [3])</span><br><span class="line">        movl    %eax, -12(%rbp) ; 返回值复制给 sum1</span><br><span class="line">        movl    $0, %eax</span><br><span class="line">        leave   </span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由 main 可以看出, 编译器对待数组 a , a 就是数组第一个元素的地址.</p>
</blockquote>
<h1 id="struct"><a href="#struct" class="headerlink" title="struct"></a>struct</h1><blockquote>
<p>A struct in the C programming language (and many derivatives) is a composite data type (or record) declaration that defines a physically grouped list of variables to be placed under one name in a block of memory, allowing the different variables to be accessed via a single pointer, or the struct declared name which returns the same address.</p>
</blockquote>
<h2 id="Code-Analysis"><a href="#Code-Analysis" class="headerlink" title="Code Analysis"></a>Code Analysis</h2><h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Student</span>&#123;</span></span><br><span class="line">    <span class="keyword">long</span> id;</span><br><span class="line">    <span class="keyword">long</span> score;</span><br><span class="line">    <span class="keyword">long</span> age;</span><br><span class="line"></span><br><span class="line">&#125; Student;</span><br><span class="line">; 结构体指针作为参数</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testStruct</span><span class="params">(Student* s)</span></span>&#123;</span><br><span class="line">    s-&gt;id = <span class="number">10</span>;</span><br><span class="line">    s-&gt;score = <span class="number">100</span>;</span><br><span class="line">    s-&gt;age = <span class="number">1000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; 返回结构体</span><br><span class="line"><span class="function">Student <span class="title">buildStruct</span><span class="params">(<span class="keyword">long</span> id, <span class="keyword">long</span> score, <span class="keyword">long</span> age)</span></span>&#123;</span><br><span class="line">    Student s;</span><br><span class="line">    s.id = id;</span><br><span class="line">    s.score = score;</span><br><span class="line">    s.age = age;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Student s ;</span><br><span class="line">    Student ss;</span><br><span class="line">    s.id = <span class="number">1</span>;</span><br><span class="line">    s.score = <span class="number">10</span>;</span><br><span class="line">    s.age = <span class="number">100</span>;</span><br><span class="line">    testStruct(&amp;s);</span><br><span class="line">    ss = buildStruct(<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Asm"><a href="#Asm" class="headerlink" title="Asm"></a>Asm</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">testStruct(Student*):</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        movq    %rdi, -8(%rbp) ; s 的地址</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movq    $10, (%rax) ; s-&gt;id = 10</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movq    $100, 8(%rax) ; s-&gt;score = 100</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movq    $1000, 16(%rax) ; s-&gt;age = 1000</span><br><span class="line">        nop</span><br><span class="line">        popq    %rbp</span><br><span class="line">        ret</span><br><span class="line">buildStruct(long, long, long):</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        movq    %rdi, -8(%rbp) ; main 中隐性变量 ss 的地址(rbp(main) - 96)</span><br><span class="line">        movq    %rsi, -16(%rbp) ; id</span><br><span class="line">        movq    %rdx, -24(%rbp) ; score</span><br><span class="line">        movq    %rcx, -32(%rbp) ; age</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movq    -16(%rbp), %rdx ; id</span><br><span class="line">        movq    %rdx, (%rax)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movq    -24(%rbp), %rdx  ; score</span><br><span class="line">        movq    %rdx, 8(%rax)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movq    -32(%rbp), %rdx ; age</span><br><span class="line">        movq    %rdx, 16(%rax) </span><br><span class="line">        nop</span><br><span class="line">        movq    -8(%rbp), %rax ; main 中隐性变量 ss 的地址</span><br><span class="line">        popq    %rbp</span><br><span class="line">        ret</span><br><span class="line">main:</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        subq    $96, %rsp ; 分配栈空间</span><br><span class="line">        movq    $1, -32(%rbp) ; id</span><br><span class="line">        movq    $10, -24(%rbp) ; score</span><br><span class="line">        movq    $100, -16(%rbp) ; age</span><br><span class="line">        leaq    -32(%rbp), %rax ; 结构体起始地址,也就是第一个字节的内存地址</span><br><span class="line">        movq    %rax, %rdi ; 这个就类似 Java 中的 this 指针了</span><br><span class="line">        call    testStruct(Student*)</span><br><span class="line"></span><br><span class="line">        leaq    -96(%rbp), %rax ; 隐性的变量 ss 起始地址</span><br><span class="line">        movl    $33, %ecx </span><br><span class="line">        movl    $22, %edx</span><br><span class="line">        movl    $11, %esi</span><br><span class="line">        movq    %rax, %rdi ; 隐形的参数, 像不像 Java 里的 this 啊. 编译器动的手脚.</span><br><span class="line">        call    buildStruct(long, long, long)</span><br><span class="line"></span><br><span class="line">        movq    -96(%rbp), %rax ; ss.id</span><br><span class="line">        movq    -88(%rbp), %rdx ; ss.score</span><br><span class="line">        movq    %rax, -64(%rbp) </span><br><span class="line">        movq    %rdx, -56(%rbp) </span><br><span class="line">        movq    -80(%rbp), %rax ; ss.age</span><br><span class="line">        movq    %rax, -48(%rbp)</span><br><span class="line">        movl    $0, %eax</span><br><span class="line">        leave</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<blockquote>
<p>结构体使用的是一块连续的内存地址. 结构体指针也就是结构体第一个字节的地址.</p>
</blockquote>
<h1 id="Variable-Shadowing"><a href="#Variable-Shadowing" class="headerlink" title="Variable Shadowing"></a>Variable Shadowing</h1><blockquote>
<p>代码块、块级变量</p>
</blockquote>
<h2 id="C-代码"><a href="#C-代码" class="headerlink" title="C 代码"></a>C 代码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_variable_shadow</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">        <span class="comment">// 代码块开始</span></span><br><span class="line">        &#123; </span><br><span class="line">            <span class="keyword">int</span> a = <span class="number">100</span>;</span><br><span class="line">            <span class="keyword">int</span> b = a + <span class="number">1000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 代码块结束</span></span><br><span class="line">    <span class="keyword">int</span> c = a + <span class="number">10000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="汇编代码"><a href="#汇编代码" class="headerlink" title="汇编代码"></a>汇编代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">test_variable_shadow():</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        movl    $10, -4(%rbp)   ; int a = 10</span><br><span class="line">        movl    $100, -8(%rbp)  ; int a = 100</span><br><span class="line">        movl    -8(%rbp), %eax</span><br><span class="line">        addl    $1000, %eax</span><br><span class="line">        movl    %eax, -12(%rbp) ; int b = a + 1000 代码块里的 a</span><br><span class="line">        movl    -4(%rbp), %eax</span><br><span class="line">        addl    $10000, %eax    </span><br><span class="line">        movl    %eax, -16(%rbp) ; int c = a + 10000</span><br><span class="line">        nop</span><br><span class="line">        popq    %rbp</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<img src="/2019/06/25/asm-clang-concepts/c-variable-shadow.png">

<h2 id="汇编代码分析"><a href="#汇编代码分析" class="headerlink" title="汇编代码分析"></a>汇编代码分析</h2><img src="/2019/06/25/asm-clang-concepts/variable_shadowing.png" title="块级变量隐藏">

<h1 id="references"><a href="#references" class="headerlink" title="references"></a>references</h1><ol>
<li><a href="https://en.wikipedia.org/wiki/Pointer_(computer_programming)" target="_blank" rel="noopener">pointer</a></li>
<li><a href="https://stackoverflow.com/questions/29790175/assembly-x86-leave-instruction/29790275" target="_blank" rel="noopener">lea instruction</a></li>
<li><a href="https://aaronbloomfield.github.io/pdr/book/x86-64bit-ccc-chapter.pdf" target="_blank" rel="noopener">x86 c call convention</a></li>
<li><a href="https://www.cs.auckland.ac.nz/references/macvax/op-codes/Instructions/movz.html" target="_blank" rel="noopener">opcode-movz</a></li>
<li><a href="http://faydoc.tripod.com/cpu/movsd.htm" target="_blank" rel="noopener">movsd</a></li>
<li><a href="https://www.geeksforgeeks.org/pass-2d-array-parameter-c/" target="_blank" rel="noopener">pass-2d-array-parameter-c</a></li>
<li><a href="https://en.wikipedia.org/wiki/Variable_shadowing" target="_blank" rel="noopener">Variable Shadowing</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://stardustman.github.io/2019/06/24/asm-how-x86-64-arguments-pass/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="stardustman">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stardustman">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/24/asm-how-x86-64-arguments-pass/" itemprop="url">asm-how-x86-64-arguments-pass</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-06-24T09:52:27+08:00">
                2019-06-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/24/asm-how-x86-64-arguments-pass/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/06/24/asm-how-x86-64-arguments-pass/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h3 id="x86-64-下函数参数传递-汇编层面分析"><a href="#x86-64-下函数参数传递-汇编层面分析" class="headerlink" title="x86-64 下函数参数传递, 汇编层面分析"></a>x86-64 下函数参数传递, 汇编层面分析</h3><blockquote>
<p>To pass parameters to the subroutine, we put up to six of them into registers (in order: rdi, rsi, rdx, rcx, r8, r9). If there are more than six parameters to the subroutine, then push the rest onto the stack in reverse order (i.e. last parameter first) – since the stack grows down, the first of the extra parameters (really the seventh parameter) parameter will be stored at the lowest address (this inversion of parameters was historically used to allow functions to be passed a variable number of parameters).</p>
</blockquote>
<h1 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h1><h2 id="C-main"><a href="#C-main" class="headerlink" title="C main"></a>C main</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    result = testArgs(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Asm-main"><a href="#Asm-main" class="headerlink" title="Asm main"></a>Asm main</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        subq    $16, %rsp</span><br><span class="line">        movl    $0, -4(%rbp) //result</span><br><span class="line">        pushq   $8 // 最后一个参数</span><br><span class="line">        pushq   $7 // 倒数第二个参数</span><br><span class="line">        movl    $6, %r9d // 第六个参数</span><br><span class="line">        movl    $5, %r8d // 第五个参数</span><br><span class="line">        movl    $4, %ecx // 第四个参数</span><br><span class="line">        movl    $3, %edx // 第三个参数</span><br><span class="line">        movl    $2, %esi // 第二个参数</span><br><span class="line">        movl    $1, %edi // 第一个参数</span><br><span class="line">        call    testArgs(long, long, long, long, long, long, long, long)</span><br><span class="line">        addq    $16, %rsp // 回收分配的栈空间</span><br><span class="line">        movl    %eax, -4(%rbp)</span><br><span class="line">        movl    $0, %eax</span><br><span class="line">        leave</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<h3 id="C-testArgs"><a href="#C-testArgs" class="headerlink" title="C testArgs"></a>C testArgs</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">testArgs</span><span class="params">(<span class="keyword">long</span> a1,<span class="keyword">long</span> a2,<span class="keyword">long</span> a3,<span class="keyword">long</span> a4,<span class="keyword">long</span> a5,<span class="keyword">long</span> a6,<span class="keyword">long</span> a7,<span class="keyword">long</span> a8)</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> sum = <span class="number">0</span>;</span><br><span class="line">    sum = a1 + a2 + a3 + a4 +a5 + a6 + a7 + a8;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Asm-testArgs"><a href="#Asm-testArgs" class="headerlink" title="Asm testArgs"></a>Asm testArgs</h3><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">testArgs(long, long, long, long, long, long, long, long):</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        <span class="keyword">movq</span>    %rsp, %rbp</span><br><span class="line">        <span class="keyword">movq</span>    %rdi, -<span class="number">24</span>(%rbp)</span><br><span class="line">        <span class="keyword">movq</span>    %rsi, -<span class="number">32</span>(%rbp)</span><br><span class="line">        <span class="keyword">movq</span>    %rdx, -<span class="number">40</span>(%rbp)</span><br><span class="line">        <span class="keyword">movq</span>    %rcx, -<span class="number">48</span>(%rbp)</span><br><span class="line">        <span class="keyword">movq</span>    %r8, -<span class="number">56</span>(%rbp)</span><br><span class="line">        <span class="keyword">movq</span>    %r9, -<span class="number">64</span>(%rbp)</span><br><span class="line">        <span class="keyword">movq</span>    <span class="number">$0</span>, -<span class="number">8</span>(%rbp) // sum</span><br><span class="line">        <span class="keyword">movq</span>    -<span class="number">24</span>(%rbp), %rdx // a1</span><br><span class="line">        <span class="keyword">movq</span>    -<span class="number">32</span>(%rbp), %rax // a2</span><br><span class="line">        addq    %rax, %rdx</span><br><span class="line">        <span class="keyword">movq</span>    -<span class="number">40</span>(%rbp), %rax // a3</span><br><span class="line">        addq    %rax, %rdx</span><br><span class="line">        <span class="keyword">movq</span>    -<span class="number">48</span>(%rbp), %rax // a4</span><br><span class="line">        addq    %rax, %rdx</span><br><span class="line">        <span class="keyword">movq</span>    -<span class="number">56</span>(%rbp), %rax // a5</span><br><span class="line">        addq    %rax, %rdx</span><br><span class="line">        <span class="keyword">movq</span>    -<span class="number">64</span>(%rbp), %rax // a6</span><br><span class="line">        addq    %rax, %rdx</span><br><span class="line">        <span class="keyword">movq</span>    <span class="number">16</span>(%rbp), %rax  // a7</span><br><span class="line">        addq    %rax, %rdx</span><br><span class="line">        <span class="keyword">movq</span>    <span class="number">24</span>(%rbp), %rax  // a8</span><br><span class="line">        addq    %rdx, %rax</span><br><span class="line">        <span class="keyword">movq</span>    %rax, -<span class="number">8</span>(%rbp)</span><br><span class="line">        <span class="keyword">movq</span>    -<span class="number">8</span>(%rbp), %rax</span><br><span class="line">        popq    %rbp</span><br><span class="line">        <span class="keyword">ret</span></span><br></pre></td></tr></table></figure>

<h2 id="栈帧分析"><a href="#栈帧分析" class="headerlink" title="栈帧分析"></a>栈帧分析</h2><img src="/2019/06/24/asm-how-x86-64-arguments-pass/x86-64-arguments-pass.png" title="x86-64-arguments-pass">

<blockquote>
<p>上图是执行完 testArgs 前两句汇编的栈帧状态图.<br>分析:<br>testArgs 中 movq    16(%rbp), %rax  // 将 rbp + 16 地址处的数值(a7)复制到 rax<br>rbp + 16 的原因是: 参数 a7 是 main 准备的, 属于 main 的栈帧. 16 Bytes 包括 8 Bytes 的 Return address 和 8 Bytes 的 main 的 rbp.</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://stardustman.github.io/2019/06/17/tools-for-me/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="stardustman">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="stardustman">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/17/tools-for-me/" itemprop="url">tools-for-me</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-06-17T18:37:10+08:00">
                2019-06-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/17/tools-for-me/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/06/17/tools-for-me/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="programming"><a href="#programming" class="headerlink" title="programming"></a>programming</h1><h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><ol>
<li><a href="https://github.com/deathmarine/Luyten" target="_blank" rel="noopener">decompiler-Luyten</a></li>
<li><a href="http://www.benf.org/other/cfr/" target="_blank" rel="noopener">decompiler-cfr</a></li>
<li><a href="https://bytecodeviewer.com/" target="_blank" rel="noopener">byte-code-viewer</a></li>
</ol>
<h2 id="assembly"><a href="#assembly" class="headerlink" title="assembly"></a>assembly</h2><ol>
<li><a href="https://godbolt.org/" target="_blank" rel="noopener">godbolt</a></li>
</ol>
<h2 id="json"><a href="#json" class="headerlink" title="json"></a>json</h2><ol>
<li><a href="https://c.runoob.com/front-end/53" target="_blank" rel="noopener">json-runoob</a></li>
<li><a href="https://www.json.cn/" target="_blank" rel="noopener">json-online</a></li>
</ol>
<h2 id="regexp"><a href="#regexp" class="headerlink" title="regexp"></a>regexp</h2><ol>
<li><a href="https://jex.im/regulex/#!flags=&re=%5E(a%7Cb)*%3F%24" target="_blank" rel="noopener">regexp-jex.im</a></li>
<li><a href="https://regexr.com/" target="_blank" rel="noopener">regexp-regexr</a></li>
<li><a href="https://regexper.com/" target="_blank" rel="noopener">regexp-regexper</a></li>
</ol>
<h2 id="hex"><a href="#hex" class="headerlink" title="hex"></a>hex</h2><ol>
<li><a href="http://tool.oschina.net/hexconvert/" target="_blank" rel="noopener">hex converter</a></li>
<li><a href="https://www.onlinehexeditor.com/" target="_blank" rel="noopener">hex editor</a></li>
</ol>
<h2 id="html"><a href="#html" class="headerlink" title="html"></a>html</h2><ol>
<li><a href="https://tool.lu/html/" target="_blank" rel="noopener">html beautify</a></li>
</ol>
<h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><ol>
<li><a href="http://www1.tc711.com/tool/BASE64.htm" target="_blank" rel="noopener">base64</a></li>
</ol>
<h2 id="code-format"><a href="#code-format" class="headerlink" title="code format"></a>code format</h2><ol>
<li><a href="http://tool.oschina.net/codeformat/xml" target="_blank" rel="noopener">code format</a></li>
<li><a href="http://tool.chinaz.com/Tools/urlencode.aspx" target="_blank" rel="noopener">url</a></li>
</ol>
<h2 id="unicode"><a href="#unicode" class="headerlink" title="unicode"></a>unicode</h2><ol>
<li><a href="https://www.ftrain.com/unicode/" target="_blank" rel="noopener">unicode for you</a></li>
</ol>
<h2 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h2><ol>
<li><a href="https://ohmyz.sh/" target="_blank" rel="noopener">oh-my-zsh</a></li>
</ol>
<h1 id="working"><a href="#working" class="headerlink" title="working"></a>working</h1><h2 id="pc"><a href="#pc" class="headerlink" title="pc"></a>pc</h2><ol>
<li><a href="https://www.snipaste.com/" target="_blank" rel="noopener">sinp &amp; paste</a></li>
<li><a href="https://mubu.com/" target="_blank" rel="noopener">mubu</a></li>
<li><a href="https://www.processon.com" target="_blank" rel="noopener">process on</a></li>
<li><a href="https://www.apowersoft.cn/free-online-screen-recorder" target="_blank" rel="noopener">screen-recorder</a></li>
</ol>
<h1 id="reinstall-os"><a href="#reinstall-os" class="headerlink" title="reinstall os"></a>reinstall os</h1><ol>
<li><a href="http://multibootusb.org/page_download/" target="_blank" rel="noopener">multibootusb</a></li>
<li><a href="https://www.pendrivelinux.com/universal-usb-installer-easy-as-1-2-3/" target="_blank" rel="noopener">universal usb installer</a></li>
</ol>
<h1 id="entertainment"><a href="#entertainment" class="headerlink" title="entertainment"></a>entertainment</h1><h2 id="video"><a href="#video" class="headerlink" title="video"></a>video</h2><h3 id="online"><a href="#online" class="headerlink" title="online"></a>online</h3><ol>
<li><a href="https://github.com/soimort/you-get" target="_blank" rel="noopener">downloader-you-get</a></li>
<li><a href="https://motrix.app/" target="_blank" rel="noopener">downloader-motrix</a></li>
</ol>
<h3 id="baidu"><a href="#baidu" class="headerlink" title="baidu"></a>baidu</h3><ol>
<li><a href="https://www.baiduwp.com/" target="_blank" rel="noopener">baiduwp</a></li>
<li><a href="http://pandownload.com/index.html" target="_blank" rel="noopener">pandownload</a></li>
<li><a href="https://xdown.org/" target="_blank" rel="noopener">Xdown</a></li>
</ol>
<h3 id="converter"><a href="#converter" class="headerlink" title="converter"></a>converter</h3><ol>
<li><a href="https://online-audio-converter.com/" target="_blank" rel="noopener">audio-converter</a></li>
</ol>
<h2 id="movie"><a href="#movie" class="headerlink" title="movie"></a>movie</h2><ol>
<li><a href="https://www.cupfox.com/" target="_blank" rel="noopener">cupfox</a></li>
<li><a href="http://www.bt177.tel/" target="_blank" rel="noopener">bt-177.tel</a></li>
<li><a href="http://www.yyetss.com/" target="_blank" rel="noopener">renren</a></li>
</ol>
<h2 id="picture"><a href="#picture" class="headerlink" title="picture"></a>picture</h2><ol>
<li><a href="http://waifu2x.udp.jp/" target="_blank" rel="noopener">waifu2x</a></li>
<li><a href="https://www.awanqi.com/" target="_blank" rel="noopener">papers-anwanqi</a></li>
<li><a href="http://ilovepapers.com/" target="_blank" rel="noopener">ilovepapers</a></li>
</ol>
<h2 id="file"><a href="#file" class="headerlink" title="file"></a>file</h2><ol>
<li><a href="https://www.ilovepdf.com" target="_blank" rel="noopener">ilovepdf</a></li>
<li><a href="https://html2pdf.com/" target="_blank" rel="noopener">html to pdf</a></li>
</ol>
<h2 id="typing"><a href="#typing" class="headerlink" title="typing"></a>typing</h2><ol>
<li><a href="https://dazi.kukuw.com/" target="_blank" rel="noopener">practice typing</a></li>
</ol>
<h1 id="job"><a href="#job" class="headerlink" title="job"></a>job</h1><h2 id="company"><a href="#company" class="headerlink" title="company"></a>company</h2><ol>
<li><a href="https://www.tianyancha.com/" target="_blank" rel="noopener">tianyancha</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">stardustman</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">stardustman</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"your-duoshuo-shortname"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






















  





  

  

  

  
  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
