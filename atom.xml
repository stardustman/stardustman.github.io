<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>stardustman</title>
  
  
  <link href="http://stardustman.github.io/atom.xml" rel="self"/>
  
  <link href="http://stardustman.github.io/"/>
  <updated>2020-06-27T02:08:31.352Z</updated>
  <id>http://stardustman.github.io/</id>
  
  <author>
    <name>stardustman</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>data-structure-btree</title>
    <link href="http://stardustman.github.io/2020/06/12/data-structure-btree/"/>
    <id>http://stardustman.github.io/2020/06/12/data-structure-btree/</id>
    <published>2020-06-12T06:11:02.000Z</published>
    <updated>2020-06-27T02:08:31.352Z</updated>
    
    <content type="html"><![CDATA[<h3 id="B-tree-特性"><a href="#B-tree-特性" class="headerlink" title="B-tree 特性"></a>B-tree 特性</h3><ol><li>所有的 leaves 都在同一层级。</li><li>B-Tree 被 minimum degree t 定义。t 依赖于 disk block size。</li><li>除了 root，其余节点必须至少有 t - 1 个 key。root 节点至少有 1 个 key。</li><li>所有的节点（包括 root）最多有 2t - 1 个 key。</li><li>某一个节点的子节点的个数 = 这个节点的 key 的个数 + 1。</li><li>一个节点的所有 key 从小到大排序。两个 key1 和 key2 之间的所有 child 都在 key1 和 key2 之间。</li><li>B-Tree 从 root 节点 grow(扩张) 和 shrink(收缩)。</li><li>search、insert、delete 时间复杂度是O(log n)。n 是 key 的总数。</li></ol><h3 id="t-3-为例来理解-B-tree"><a href="#t-3-为例来理解-B-tree" class="headerlink" title="t=3 为例来理解 B-tree"></a>t=3 为例来理解 B-tree</h3><ol><li>每一个节点(root 除外) 至少有 t - 1 = 2 个 key。</li><li>每一个节点最多有 2t - 1 = 5 个 key。节点 key 数量 = 5，称为节点满了。<br>问题来了，节点 key 个数大于 5 了咋办？拆分。什么时候来拆分呢？在向下遍历节点时发现满了，立即进行拆分。</li></ol><h4 id="B-Tree-insert-operation"><a href="#B-Tree-insert-operation" class="headerlink" title="B-Tree insert operation"></a>B-Tree insert operation</h4><h5 id="拆分已满节点"><a href="#拆分已满节点" class="headerlink" title="拆分已满节点"></a>拆分已满节点</h5><img src="/2020/06/12/data-structure-btree/btree-full-root-split.svg" class="" title="btree-拆分已满节点"><ol><li>如上图，节点1 已经满了，对此时的 root 节点进行拆分。</li><li>创建节点2，s 节点，作为新的 root 节点，同时设置 s.child[0] = root。</li><li>创建节点2，z 节点，将原来 root 节点一半的 key，复制到 z 节点。</li><li>将 z 节点设置为 s 节点的 child。s.child[1] = z。</li></ol><h5 id="拆分已满节点-有子节点"><a href="#拆分已满节点-有子节点" class="headerlink" title="拆分已满节点(有子节点)"></a>拆分已满节点(有子节点)</h5><img src="/2020/06/12/data-structure-btree/btree-full-root-split2.svg" class="" title="btree-拆分已满节点2"><p>B-Tree 是向上扩张的(grow)。可以看到所有的 key 都是在 leaf 节点插入的。节点的 key 值的数量一旦等于 2t - 1 = 5 时，就会对该节点进行拆分。所以这也是每一个节点(root 除外)至少有 t-1 = 2 个 key 的原因。</p><h4 id="B-Tree-delete-operation"><a href="#B-Tree-delete-operation" class="headerlink" title="B-Tree delete operation"></a>B-Tree delete operation</h4><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://www.cs.usfca.edu/~galles/visualization/BTree.html">BTree-visualization</a></li><li><a href="https://www.geeksforgeeks.org/introduction-of-b-tree-2/">BTree introduction</a></li><li><a href="https://www.geeksforgeeks.org/insert-operation-in-b-tree/">BTree insertion</a></li><li><a href="https://www.geeksforgeeks.org/delete-operation-in-b-tree/">BTree deletion</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;B-tree-特性&quot;&gt;&lt;a href=&quot;#B-tree-特性&quot; class=&quot;headerlink&quot; title=&quot;B-tree 特性&quot;&gt;&lt;/a&gt;B-tree 特性&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;所有的 leaves 都在同一层级。&lt;/li&gt;
&lt;li&gt;B-Tree 被</summary>
      
    
    
    
    
    <category term="data structure" scheme="http://stardustman.github.io/tags/data-structure/"/>
    
    <category term="BTree" scheme="http://stardustman.github.io/tags/BTree/"/>
    
  </entry>
  
  <entry>
    <title>asm-how-computer-startup</title>
    <link href="http://stardustman.github.io/2020/06/08/asm-how-computer-startup/"/>
    <id>http://stardustman.github.io/2020/06/08/asm-how-computer-startup/</id>
    <published>2020-06-08T00:09:12.000Z</published>
    <updated>2020-06-11T05:46:52.431Z</updated>
    
    <content type="html"><![CDATA[<p><code>x86</code> 架构计算机是如何启动的？</p><h2 id="16-bit-Processors-and-Segmentation-1978"><a href="#16-bit-Processors-and-Segmentation-1978" class="headerlink" title="16-bit Processors and Segmentation (1978)"></a>16-bit Processors and Segmentation (1978)</h2><blockquote><p>The IA-32 architecture family was preceded by <code>16-bit processors</code>, the 8086 and 8088. The 8086 has <code>16-bit registers</code> and a <code>16-bit external data bus</code>, with <code>20-bit addressing giving a 1-MByte address space</code>. The 8088 is similar to the 8086 except it has an 8-bit external data bus.<br>The 8086/8088 introduced <code>segmentation</code> to the IA-32 architecture. With segmentation, a <code>16-bit segment register</code> contains a pointer to <code>a memory segment of up to 64 KBytes</code>. Using <code>four</code> segment registers at a time, 8086/8088 processors are able to address up to 256 KBytes <code>without</code> switching between segments. The 20-bit addresses that can be formed using a segment register and an additional 16-bit pointer provide a total address range of 1 MByte.</p></blockquote><p>8086 是整个 intel 系列处理器的老祖宗。所有后续的一系列处理器都兼容 8086。唉，这就是路径依赖啊。这是一个 16-bit 的处理器。寄存器也是 16-bit 的。but 却能寻址 20-bit 的地址空间，也就是 1M 的内存。怎样在 16-bit 的处理器上实现呢？很简单，将 1M 的空间分成多个 64K 的 segment。那怎样用 16-bit 的寄存器表示 20-bit 的地址呢？也很简单，用 2 个 16-bit 的寄存器组合得来的(register1,register2)。那怎样组合的呢？<code>address = register1 &lt;&lt; 4 + register2</code>。将 register1 &lt;&lt; 4 和 register2 用一个 20-bit 的加法器就能得到内存地址。这种方式就是所谓的 <code>real address mode</code>。也即是拿到的是真正的内存地址。x86 架构的计算机启动时会先进入 real address mode。</p><h2 id="计算机启动前置知识"><a href="#计算机启动前置知识" class="headerlink" title="计算机启动前置知识"></a>计算机启动前置知识</h2><ol><li>CPU 工作方式是: 从<code>内存</code>中取指、执行。</li><li>内存是存储数据的地方，给出一个内存地址，可以得到该处的数据。</li><li>CPU 从内存哪里取指令，由 <code>instruction pointer</code> 这个寄存器的值决定。这个值不断 +1，或者跳转(jump) 到某处。real address mode 下由 CS:IP 组合决定。</li></ol><h2 id="BIOS"><a href="#BIOS" class="headerlink" title="BIOS"></a>BIOS</h2><h3 id="BIOS-是啥"><a href="#BIOS-是啥" class="headerlink" title="BIOS 是啥"></a>BIOS 是啥</h3><p><code>BIOS</code> 是啥呢？一个软件而已。不像我们平时在 PC 上使用如 <code>QQ</code> 等软件是安装在硬盘上的。BIOS 安装在 ROM 中。这个软件干啥的呢？帮助计算机启动，开机时检测整个机器的硬件。计算机启动需要运行软件，软件运行需要计算机先启动。咳咳，成了先有鸡还是先有蛋了，这怎么行？所以需要 BIOS 这个在硬件上的软件来帮助，破除这种依赖。</p><h3 id="BIOS-大小"><a href="#BIOS-大小" class="headerlink" title="BIOS 大小"></a>BIOS 大小</h3><p>通过 <code>dmidecode</code> 这个命令来查看。也就是读取 BIOS 的信息。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~<span class="comment"># dmidecode -t bios -q  # 方法一</span></span><br><span class="line">BIOS Information</span><br><span class="line">        Vendor: SeaBIOS</span><br><span class="line">        Version: 8c24b4c</span><br><span class="line">        Release Date: 04/01/2014</span><br><span class="line">        Address: 0xE8000</span><br><span class="line">        Runtime Size: 96 kB</span><br><span class="line">        ROM Size: 64 kB --- ROM Size，在此可以看到，BIOS 大小为 64K。</span><br><span class="line">        Characteristics:</span><br><span class="line">                BIOS characteristics not supported</span><br><span class="line">                Targeted content distribution is supported</span><br><span class="line">        BIOS Revision: 0.0</span><br><span class="line"></span><br><span class="line">root@aliyun:~<span class="comment"># cd /sys/class/dmi/id/  # 方法二</span></span><br><span class="line">root@aliyun:id<span class="comment"># ls</span></span><br><span class="line">bios_date          chassis_serial   modalias        product_serial   sys_vendor</span><br><span class="line">bios_vendor        chassis_type     power           product_uuid     uevent</span><br><span class="line">bios_version       chassis_vendor   product_family  product_version</span><br><span class="line">chassis_asset_tag  chassis_version  product_name    subsystem</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="x86-架构计算机启动流程"><a href="#x86-架构计算机启动流程" class="headerlink" title="x86 架构计算机启动流程"></a>x86 架构计算机启动流程</h2><img src="/2020/06/08/asm-how-computer-startup/real-address-mode-how-computer-startup.svg" class="" title="real address mode 1M 内存布局"><ol><li><p>如上图所示，当按下 <code>power on</code> 之后，此时的 CPU 处于 real address mode。由硬件负责将 <code>BIOS 64K</code> 的内容加载到 <code>0xF0000 到 0xFFFFF</code>(64K 内存)。并将 <code>CS(code segment) 置为 0xF000</code>，<code>IP(instruction pointer) 置为 0xFFF0</code>。组合起来的内存地址 <code>PC</code> 就是 0xFFFF0。</p></li><li><p>此时 CPU 从 <code>PC = 0xFFFF0</code> 处开始取指、执行。那么从 <code>0xFFFF0 到 0xFFFFF</code> 只有 16Bytes。空间太小了，能放啥呢？但是可以跳到其他地方去执行啊。不错，这里存放的有一条指令是 <code>jmp far f000:e05b</code>, 组合起来就是 <code>0xfe05b</code>。注意这个地址可是在 <code>0xF0000 到 0xFFFFF</code> 范围之内，也就是这条指令跳转到 <code>BIOS 内部的代码</code>去执行。从 0xFE05B 到 0xFFFF0 将近 8K 内存，代码不少。</p></li><li><p>此时 CPU 从 <code>PC = 0xfe05b</code> 开始取值、执行。具体干啥呢？就是执行所谓的开机自检。检查计算机硬件。同时去找启动扇区，那什么才是启动扇区呢？若 0 盘 0 道 1 扇区最后两个字节分别是 0x55,0xaa，那就是启动区。很像 java class 文件中的魔数，就是标记一下。同时将找到的启动扇区(512Bytes) 复制到内存 <code>0x7C00 到 0x7DFF</code>(512Bytes) 处。最后会将 <code>CS 置为 0x0000， IP 置为 0x7C00</code>，组合起来就是 <code>0x7C00</code>。</p></li><li><p>此时 CPU 从 <code>PC = 0x7C00</code> 开始取值、执行。具体干啥呢？这就是开发人员可以决定的了。在启动扇区上可以是加载 OS Kernel 的代码，硬盘分区，boot loader 等。</p></li></ol><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>1.<a href="http://dewkumar.blogspot.com/2012/01/what-is-org-origin-directive-in.html">x86-ORG</a><br>2. <a href="https://superuser.com/questions/806226/how-to-see-rom-size">how-to-see-rom-size</a><br>3. <a href="http://smilejay.com/2013/02/bios-info-dmidecode/">bios-info-dmidecode</a><br>4. <a href="https://en.wikipedia.org/wiki/System_Management_BIOS">system-management-bios</a><br>5. <a href="http://www.ruanyifeng.com/blog/2013/02/booting.html">计算机是如何启动的？</a><br>6. <a href="https://en.wikipedia.org/wiki/Master_boot_record">多种 MBR 组织方式</a><br>7. <a href="https://mp.weixin.qq.com/s/g6m_r28bvyyWIu1CAzxLdg">计算机是怎样启动的？</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;code&gt;x86&lt;/code&gt; 架构计算机是如何启动的？&lt;/p&gt;
&lt;h2 id=&quot;16-bit-Processors-and-Segmentation-1978&quot;&gt;&lt;a href=&quot;#16-bit-Processors-and-Segmentation-1978&quot; cla</summary>
      
    
    
    
    
    <category term="asm" scheme="http://stardustman.github.io/tags/asm/"/>
    
    <category term="x86" scheme="http://stardustman.github.io/tags/x86/"/>
    
  </entry>
  
  <entry>
    <title>data-structure-heap</title>
    <link href="http://stardustman.github.io/2020/05/18/data-structure-heap/"/>
    <id>http://stardustman.github.io/2020/05/18/data-structure-heap/</id>
    <published>2020-05-18T07:24:05.000Z</published>
    <updated>2020-05-28T03:59:33.170Z</updated>
    
    <content type="html"><![CDATA[<h3 id="线性-or-非线性"><a href="#线性-or-非线性" class="headerlink" title="线性 or 非线性"></a>线性 or 非线性</h3><p>数据结构可以分为两大类：线性结构和非线性结构。线性结构典型的就是数组和链表，非线性典型就是树了。复杂的数据结构基本上都是两者的组合。</p><h3 id="binary-heap"><a href="#binary-heap" class="headerlink" title="binary heap"></a>binary heap</h3><p>二叉堆本质上就是个完全二叉树。但是却用数组来表示。为啥呢？因为数组的下标之间有关系，可以表示二叉树节点之间的层级关系。因为是 <code>完全二叉树</code>，这就保证了一维展开就是一个下标连续的数组，数组通过下标操作起来相当简洁。堆顶(root)也就就是数组第一个元素 <code>array[0]</code>，是最小元素，就是小顶堆。反之，大顶堆。</p><h3 id="堆的自我调整"><a href="#堆的自我调整" class="headerlink" title="堆的自我调整"></a>堆的自我调整</h3><h4 id="插入节点"><a href="#插入节点" class="headerlink" title="插入节点"></a>插入节点</h4><p>新节点放在数组最后，然后对该节点进行上浮操作。</p><h4 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h4><p>删除堆顶元素，最后一个节点放在堆顶，对此时的堆顶进行下沉操作。</p><h4 id="构建二叉堆"><a href="#构建二叉堆" class="headerlink" title="构建二叉堆"></a>构建二叉堆</h4><p>所有的非叶子节点进行上浮操作。</p><h4 id="二叉堆自我调整图解"><a href="#二叉堆自我调整图解" class="headerlink" title="二叉堆自我调整图解"></a>二叉堆自我调整图解</h4><img src="/2020/05/18/data-structure-heap/binary-heap.svg" class="" title="二叉堆的自我调整"><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapOperator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自下而上，上浮</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">upAdjust</span><span class="params">(<span class="keyword">int</span> [] array)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 最后一个节点</span></span><br><span class="line">        <span class="keyword">int</span> childIndex = array.length - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 最后一个非叶子节点</span></span><br><span class="line">        <span class="keyword">int</span> parentIndex = (childIndex - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> temp = array[childIndex];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (childIndex &gt; <span class="number">0</span> &amp;&amp; temp &lt; array[parentIndex])&#123;</span><br><span class="line">            array[childIndex] = array[parentIndex];</span><br><span class="line">            childIndex = parentIndex;</span><br><span class="line">            parentIndex = (childIndex - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[childIndex] = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自上而下，下沉</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">downAdjust</span><span class="params">(<span class="keyword">int</span> [] array, <span class="keyword">int</span> parentIndex, <span class="keyword">int</span> length)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> temp = array[parentIndex];</span><br><span class="line">        <span class="keyword">int</span> childIndex = <span class="number">2</span> * parentIndex + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (childIndex &lt; length)&#123;</span><br><span class="line">            <span class="comment">// 有右节点，且右节点小于左节点</span></span><br><span class="line">            <span class="keyword">if</span> (childIndex + <span class="number">1</span> &lt; length &amp;&amp; array[childIndex] &gt; array[childIndex + <span class="number">1</span>])&#123;</span><br><span class="line">                childIndex++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(temp &lt;= array[childIndex])&#123;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            array[parentIndex] = array[childIndex];</span><br><span class="line">            parentIndex = childIndex;</span><br><span class="line">            childIndex = <span class="number">2</span> * parentIndex + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[parentIndex] = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">buildHeap</span><span class="params">(<span class="keyword">int</span>[] array)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (array.length - <span class="number">1</span>)/ <span class="number">2</span>; i &gt;= <span class="number">0</span> ; i--) &#123;</span><br><span class="line">            downAdjust(array, i, array.length - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(<span class="keyword">int</span> [] array)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 先构建一个小顶堆，得到一个最小值。</span></span><br><span class="line">        <span class="comment">// i 为 parentIndex，左右子节点分别是 2 * i + 1, 2 * i + 2</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (array.length - <span class="number">1</span> -<span class="number">2</span> ) / <span class="number">2</span>; i &gt;= <span class="number">0</span> ; i--) &#123;</span><br><span class="line">            downAdjust(array, i, array.length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 堆顶和目前堆的最后一个节点交换，重新构建堆。</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = array.length - <span class="number">1</span>; i &gt; <span class="number">0</span> ; i--) &#123;</span><br><span class="line">            <span class="keyword">int</span> temp = array[i];</span><br><span class="line">            array[i] = array[<span class="number">0</span>];</span><br><span class="line">            array[<span class="number">0</span>] = temp;</span><br><span class="line">            downAdjust(array, <span class="number">0</span> , i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> [] array = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">0</span>&#125;;</span><br><span class="line">        upAdjust(array);</span><br><span class="line">        System.out.println(Arrays.toString(array));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] array2 = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">7</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">6</span>&#125;;</span><br><span class="line">        buildHeap(array2);</span><br><span class="line">        System.out.println(Arrays.toString(array2));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] array3 = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">7</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">100</span>&#125;;</span><br><span class="line">        heapSort(array3);</span><br><span class="line">        System.out.println(Arrays.toString(array3));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="优先级队列"><a href="#优先级队列" class="headerlink" title="优先级队列"></a>优先级队列</h3><p>不要被队列二字带偏，优先级队列的重点在优先级上。比如线程有优先级，优先级大的先执行。运算符也是有优先级的。怎样来实现这种优先级呢？用 <code>堆</code> 就可以。这里使用小顶堆，堆顶就是最小值，这里带入优先级的概念，值越小优先级越大。那么，从堆顶拿出来的节点就是优先级最大的，剩余的节点重新构造成小顶堆，保证堆顶是最小值。</p><h4 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h4><p><code>大顶堆</code>实现优先队列。每次只取最大值，取出一个堆顶，剩余节点重新构建大顶堆。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PriorityQueue</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.array = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">32</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">enQueue</span><span class="params">(<span class="keyword">int</span> key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(size &gt;= array.length)&#123;</span><br><span class="line">            resize();</span><br><span class="line">        &#125;</span><br><span class="line">        array[size++] = key;</span><br><span class="line">        upAdjust();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">deQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> heapTop = array[<span class="number">0</span>];</span><br><span class="line">        array[<span class="number">0</span>] = array[--size];</span><br><span class="line">        downAdjust();</span><br><span class="line">        <span class="keyword">return</span> heapTop;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> doubleSize = size &lt;&lt; <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">this</span>.array = Arrays.copyOf(<span class="keyword">this</span>.array,doubleSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自下而上</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">upAdjust</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 拿到最后一个节点</span></span><br><span class="line">        <span class="keyword">int</span> childIndex = <span class="keyword">this</span>.size - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 最后一个非叶子节点</span></span><br><span class="line">        <span class="keyword">int</span> parentIndex = (childIndex - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> temp = array[childIndex];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (childIndex &gt; <span class="number">0</span> &amp;&amp; temp &gt; array[parentIndex])&#123;</span><br><span class="line">            array[childIndex] = array[parentIndex];</span><br><span class="line">            childIndex = parentIndex;</span><br><span class="line">            parentIndex = (childIndex - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[childIndex] = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自上而下</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">downAdjust</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> parentIndex = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> temp = array[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> childIndex = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (childIndex &lt; size)&#123;</span><br><span class="line">            <span class="comment">// 有右节点，且右节点大于左节点。拿到两个子节点的最大值。</span></span><br><span class="line">            <span class="keyword">if</span> (childIndex + <span class="number">1</span> &lt; size &amp;&amp; array[childIndex] &lt; array[childIndex + <span class="number">1</span>])&#123;</span><br><span class="line">                childIndex++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(temp &gt;= array[childIndex])&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            array[parentIndex] = array[childIndex];</span><br><span class="line">            parentIndex = childIndex;</span><br><span class="line">            childIndex = <span class="number">2</span> * parentIndex + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[parentIndex] = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        PriorityQueue priorityQueue = <span class="keyword">new</span> PriorityQueue();</span><br><span class="line">        priorityQueue.enQueue(<span class="number">30</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">100</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">50</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">300</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">130</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">430</span>);</span><br><span class="line">        System.out.println(priorityQueue.deQueue());</span><br><span class="line">        System.out.println(priorityQueue.deQueue());</span><br><span class="line">        System.out.println(priorityQueue.deQueue());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><ol><li><a href="https://visualgo.net/zh/heap">visual heap</a></li><li><a href="https://mp.weixin.qq.com/s/cq2EhVtOTzTVpNpLDXfeJg">binary heap</a></li><li><a href="https://mp.weixin.qq.com/s/8Bid1naBLtEjPoP-R4HkBg">heap sort</a></li><li><a href="https://mp.weixin.qq.com/s/4hXBw7sZ-NKs_asOQxS7gA">priority queue</a></li><li><a href="https://web.cecs.pdx.edu/~sheard/course/Cs163/Doc/FullvsComplete.html">full binary tree vs complete binary tree</a></li><li><a href="https://web.cecs.pdx.edu/~sheard/course/Cs163/Doc/HeapReview.html">heap review</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;线性-or-非线性&quot;&gt;&lt;a href=&quot;#线性-or-非线性&quot; class=&quot;headerlink&quot; title=&quot;线性 or 非线性&quot;&gt;&lt;/a&gt;线性 or 非线性&lt;/h3&gt;&lt;p&gt;数据结构可以分为两大类：线性结构和非线性结构。线性结构典型的就是数组和链表，非线性典</summary>
      
    
    
    
    
    <category term="data structure" scheme="http://stardustman.github.io/tags/data-structure/"/>
    
    <category term="binary heap" scheme="http://stardustman.github.io/tags/binary-heap/"/>
    
    <category term="priority queue" scheme="http://stardustman.github.io/tags/priority-queue/"/>
    
    <category term="heap sort" scheme="http://stardustman.github.io/tags/heap-sort/"/>
    
  </entry>
  
  <entry>
    <title>os-banker&#39;s-algorithm</title>
    <link href="http://stardustman.github.io/2020/05/13/os-banker-s-algorithm/"/>
    <id>http://stardustman.github.io/2020/05/13/os-banker-s-algorithm/</id>
    <published>2020-05-13T07:31:05.000Z</published>
    <updated>2020-05-13T11:53:27.954Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Banker’s-Algorithm"><a href="#Banker’s-Algorithm" class="headerlink" title="Banker’s Algorithm"></a>Banker’s Algorithm</h2><h3 id="银行家算法是什么"><a href="#银行家算法是什么" class="headerlink" title="银行家算法是什么"></a>银行家算法是什么</h3><p><code>银行家</code>主要就是通过放贷来赚钱的。那最重要的问题是啥？当然是把钱借给还得起的人咯。试想，银行把钱都借给了还不起的人，那银行就完蛋了。假设有一批人（多个进程）来借钱（将要申请资源），但是银行剩下的钱满足不了任何人，那就直接拒绝借贷。当然了，有一部分已经借出的钱回收之后（回收已经分配的资源），又可以满足一批人中某些人的借贷需求。依次类推，银行可以判定能不能按照某个顺序来给这批人放贷。类似的思路延伸到计算机世界，同理。操作系统给多个进程分配资源，<code>能不能找到一个顺序给这些进程分配资源，并逐渐回收资源？</code>从而满足多个进程的资源需求。采用银行家放贷和收贷的思路（这里排除利息，放多少贷，收多少钱。呵呵，哪有此种好事？）来分配和回收系统资源就是所谓的<code>银行家算法</code>。</p><h3 id="银行家算法解决什么问题"><a href="#银行家算法解决什么问题" class="headerlink" title="银行家算法解决什么问题"></a>银行家算法解决什么问题</h3><p><code>resource allocation and deadlock avoidance algorithm </code>。银行家算法用来进行资源分配和避免死锁。</p><h3 id="银行家算法怎样解决问题"><a href="#银行家算法怎样解决问题" class="headerlink" title="银行家算法怎样解决问题"></a>银行家算法怎样解决问题</h3><p>P0、P1、P2、P3、P4 5个进程，视为需要钱的 5 个人。<br>A、B、C 三种系统资源。分别视为是银行三种贵金属：金块、银块、铜块。</p><h4 id="allocation-table-已放贷表"><a href="#allocation-table-已放贷表" class="headerlink" title="allocation table 已放贷表"></a>allocation table 已放贷表</h4><p>每个人已经借的金银铜个数列表</p><table><thead><tr><th align="center"></th><th align="center">A</th><th align="center">B</th><th align="center">C</th></tr></thead><tbody><tr><td align="center">P0</td><td align="center">0</td><td align="center">1</td><td align="center">0</td></tr><tr><td align="center">P1</td><td align="center">2</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">P2</td><td align="center">3</td><td align="center">0</td><td align="center">2</td></tr><tr><td align="center">P3</td><td align="center">2</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">P4</td><td align="center">0</td><td align="center">0</td><td align="center">2</td></tr></tbody></table><h4 id="max-table-最大借贷表"><a href="#max-table-最大借贷表" class="headerlink" title="max table 最大借贷表"></a>max table 最大借贷表</h4><p>每个人需要金银铜最大个数列表</p><table><thead><tr><th align="center"></th><th align="center">A</th><th align="center">B</th><th align="center">C</th></tr></thead><tbody><tr><td align="center">P0</td><td align="center">7</td><td align="center">5</td><td align="center">3</td></tr><tr><td align="center">P1</td><td align="center">3</td><td align="center">2</td><td align="center">2</td></tr><tr><td align="center">P2</td><td align="center">9</td><td align="center">0</td><td align="center">2</td></tr><tr><td align="center">P3</td><td align="center">2</td><td align="center">2</td><td align="center">2</td></tr><tr><td align="center">P4</td><td align="center">4</td><td align="center">3</td><td align="center">3</td></tr></tbody></table><h4 id="need-table-还需放贷表"><a href="#need-table-还需放贷表" class="headerlink" title="need table 还需放贷表"></a>need table 还需放贷表</h4><p>每个人还需要的金银铜个数列表。由 max table - allocation table 得到。</p><table><thead><tr><th align="center"></th><th align="center">A</th><th align="center">B</th><th align="center">C</th></tr></thead><tbody><tr><td align="center">P0</td><td align="center">7</td><td align="center">4</td><td align="center">3</td></tr><tr><td align="center">P1</td><td align="center">1</td><td align="center">2</td><td align="center">2</td></tr><tr><td align="center">P2</td><td align="center">6</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">P3</td><td align="center">0</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">P4</td><td align="center">4</td><td align="center">3</td><td align="center">1</td></tr></tbody></table><h4 id="available-table-剩余资源表"><a href="#available-table-剩余资源表" class="headerlink" title="available table 剩余资源表"></a>available table 剩余资源表</h4><p>银行还剩下的金银铜个数。</p><table><thead><tr><th align="center">A</th><th align="center">B</th><th align="center">C</th></tr></thead><tbody><tr><td align="center">3</td><td align="center">3</td><td align="center">2</td></tr></tbody></table><h4 id="剩余系统资源分配顺序推演"><a href="#剩余系统资源分配顺序推演" class="headerlink" title="剩余系统资源分配顺序推演"></a>剩余系统资源分配顺序推演</h4><ol><li>拿着 available table （剩余资源表），到 need table（还需放贷表） 比对。若 available table 的 A B C 满足 need table 的某一行（也就是 available table 每一列都大于等于 need table 的某一行的每一列）。说明可以分配给这个进程，标记这一行。同时回收这一行对应的 allocation table 中已经分配的 A B C。更新 available table 的 A B C。以此类推，继续比对 need table 中其他未标记的行。若最后 need table 所有行都有标记，说明存在一个给 P0、P1、P2、P3、P4 进程分配资源的顺序。</li><li>拿着 available table 剩余资源表，不满足 need table 中任何一行。说明不存在一个给 P0、P1、P2、P3、P4 进程分配资源的顺序。系统有可能进入死锁。</li></ol><h4 id="银行家算法图解分析"><a href="#银行家算法图解分析" class="headerlink" title="银行家算法图解分析"></a>银行家算法图解分析</h4><img src="/2020/05/13/os-banker-s-algorithm/banks-algorithm.svg" class="" title="银行家算法"><p>存在的一个序列 P1 -&gt; P3 -&gt; P4 -&gt; P0 -&gt; P2</p><h3 id="有没有其他方法解决此问题"><a href="#有没有其他方法解决此问题" class="headerlink" title="有没有其他方法解决此问题"></a>有没有其他方法解决此问题</h3><h3 id="Banker’s-Algorithm-implemention"><a href="#Banker’s-Algorithm-implemention" class="headerlink" title="Banker’s Algorithm implemention"></a>Banker’s Algorithm implemention</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Banker&#x27;s Algorithm </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="comment">// P0, P1, P2, P3, P4 are the Process names here </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">int</span> n, m, i, j, k; </span><br><span class="line">    n = <span class="number">5</span>; <span class="comment">// Number of processes </span></span><br><span class="line">    m = <span class="number">3</span>; <span class="comment">// Number of resources </span></span><br><span class="line">    <span class="keyword">int</span> alloc[<span class="number">5</span>][<span class="number">3</span>] = &#123; &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span> &#125;, <span class="comment">// P0    // Allocation Matrix </span></span><br><span class="line">                        &#123; <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span> &#125;, <span class="comment">// P1 </span></span><br><span class="line">                        &#123; <span class="number">3</span>, <span class="number">0</span>, <span class="number">2</span> &#125;, <span class="comment">// P2 </span></span><br><span class="line">                        &#123; <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span> &#125;, <span class="comment">// P3 </span></span><br><span class="line">                        &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span> &#125; &#125;; <span class="comment">// P4 </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">int</span> max[<span class="number">5</span>][<span class="number">3</span>] = &#123; &#123; <span class="number">7</span>, <span class="number">5</span>, <span class="number">3</span> &#125;, <span class="comment">// P0    // MAX Matrix </span></span><br><span class="line">                      &#123; <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span> &#125;, <span class="comment">// P1 </span></span><br><span class="line">                      &#123; <span class="number">9</span>, <span class="number">0</span>, <span class="number">2</span> &#125;, <span class="comment">// P2 </span></span><br><span class="line">                      &#123; <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span> &#125;, <span class="comment">// P3 </span></span><br><span class="line">                      &#123; <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span> &#125; &#125;; <span class="comment">// P4 </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">int</span> avail[<span class="number">3</span>] = &#123; <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span> &#125;; <span class="comment">// Available Resources </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">int</span> finished[n], ans[n], index = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; n; k++) &#123; </span><br><span class="line">        finished[k] = <span class="number">0</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">int</span> need[n][m]; </span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123; </span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; m; j++) </span><br><span class="line">            <span class="comment">// 计算 need matrix</span></span><br><span class="line">            need[i][j] = max[i][j] - alloc[i][j]; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">int</span> y = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">5</span>; k++) &#123; </span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123; </span><br><span class="line">            <span class="keyword">if</span> (finished[i] == <span class="number">0</span>) &#123; </span><br><span class="line">  </span><br><span class="line">                <span class="keyword">int</span> flag = <span class="number">0</span>; </span><br><span class="line">                <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; m; j++) &#123; </span><br><span class="line">                    <span class="keyword">if</span> (need[i][j] &gt; avail[j])&#123; </span><br><span class="line">                        flag = <span class="number">1</span>; </span><br><span class="line">                         <span class="keyword">break</span>; </span><br><span class="line">                    &#125; </span><br><span class="line">                &#125; </span><br><span class="line">  </span><br><span class="line">                <span class="keyword">if</span> (flag == <span class="number">0</span>) &#123; </span><br><span class="line">                    ans[index++] = i; </span><br><span class="line">                    <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; m; y++) </span><br><span class="line">                        avail[y] += alloc[i][y]; </span><br><span class="line">                    finished[i] = <span class="number">1</span>; </span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">  </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Following is the SAFE Sequence\n&quot;</span>); </span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; P%d -&gt;&quot;</span>, ans[i]); </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; P%d&quot;</span>, ans[n - <span class="number">1</span>]); </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> (<span class="number">0</span>); </span><br><span class="line">  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://zh.wikipedia.org/wiki/%E9%93%B6%E8%A1%8C%E5%AE%B6%E7%AE%97%E6%B3%95">银行家算法-wiki</a></li><li><a href="https://www.geeksforgeeks.org/bankers-algorithm-in-operating-system-2/">bankers-algorithm</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Banker’s-Algorithm&quot;&gt;&lt;a href=&quot;#Banker’s-Algorithm&quot; class=&quot;headerlink&quot; title=&quot;Banker’s Algorithm&quot;&gt;&lt;/a&gt;Banker’s Algorithm&lt;/h2&gt;&lt;h3 id=&quot;银</summary>
      
    
    
    
    
    <category term="os" scheme="http://stardustman.github.io/tags/os/"/>
    
    <category term="dead lock" scheme="http://stardustman.github.io/tags/dead-lock/"/>
    
    <category term="recource allocation" scheme="http://stardustman.github.io/tags/recource-allocation/"/>
    
  </entry>
  
  <entry>
    <title>cache-replacement-policy-lru</title>
    <link href="http://stardustman.github.io/2020/05/11/cache-replacement-policy-lru/"/>
    <id>http://stardustman.github.io/2020/05/11/cache-replacement-policy-lru/</id>
    <published>2020-05-11T00:39:15.000Z</published>
    <updated>2020-05-11T03:13:30.435Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h2><h3 id="cache"><a href="#cache" class="headerlink" title="cache"></a>cache</h3><p>为啥要有 <code>Cache</code> 呢？根本原因是各种存储速度不匹配。或者为了加快某个过程，直接将多次转换的转换结果直接缓存起来，便于再次使用时直接绕开这些转换过程。典型的就是 <code>MMU</code> 的地址翻译过程，直接将<code>虚拟地址</code>多次转换的最后结果，也就是<code>物理地址</code>，直接缓存到 <code>TLB</code> 中，下次再次访问同一个虚拟地址，直接从虚拟地址拿到物理地址，绕开多次转换过程，这可不就提高了速度。<code>CPU</code> 的速度比 <code>Memory</code> 快得多，为了配上 <code>CPU</code> 超级快的速度，也就有了 <code>L1</code>，<code>L2</code>，<code>L3</code> cache。还有就是存储器层次结构，<em>速度快，容量小</em>的存储作为<em>速度慢，容量大</em>的上级缓存。</p><h3 id="cache-replacement"><a href="#cache-replacement" class="headerlink" title="cache replacement"></a>cache replacement</h3><p>为啥要有 <code>cache replacement</code> 呢？ 因为再大的存储容量也有限，总有使用完的时候，何况速度快的存储，容量本身就小。cache 使用完，再有需要缓存的东西，就需要从缓存中剔除一些，来存放新的内容。那问题就来了，缓存使用完，<em>该剔除哪些已经缓存的内容呢？</em> 这就是所谓的 <code>cache replacement policy</code>。从不同的角度，可以有不同的替换策略。</p><h3 id="least-recently-used"><a href="#least-recently-used" class="headerlink" title="least recently used"></a>least recently used</h3><p>本文来说明这个策略。我不想记忆定义。来通过一个实例来理解这个策略的思想。<br>磁盘要缓存到内存中的内容划分为相等的 page，称之为 <code>virtual page</code>，每一个 page 一个编号，称之为 page number。<br>同理，内存的容量也划分为和磁盘大小一致的 page，称之为 <code>page frame</code>。<br>以下为访问磁盘 page number 的顺序：<br>1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5<br>缓存大小为 3 个 page frame。组成一个<em>缓存 Queue</em></p><h4 id="virtual-page-存放规则"><a href="#virtual-page-存放规则" class="headerlink" title="virtual page 存放规则"></a>virtual page 存放规则</h4><h4 id="缓存队列没满"><a href="#缓存队列没满" class="headerlink" title="缓存队列没满"></a>缓存队列没满</h4><ol><li>virtual page 已在缓存队列中，将代表 virtual page 的队列节点移动到队首。</li><li>virtual page 不在缓存队列中，添加代表这个 virtual page 的队列节点到队首。</li></ol><h4 id="缓存队列已满"><a href="#缓存队列已满" class="headerlink" title="缓存队列已满"></a>缓存队列已满</h4><ol><li>virtual page 已在缓存队列中，将代表 virtual page 的队列节点移动到队首。</li><li> virtual page 不在缓存队列中，<em>移除队尾队列节点</em>，添加代表这个 virtual page 的队列节点到队首。</li></ol><h4 id="LRU-图解"><a href="#LRU-图解" class="headerlink" title="LRU 图解"></a>LRU 图解</h4><img src="/2020/05/11/cache-replacement-policy-lru/lru.svg" class="" title="least recently used"> <p>可以看到一直是对<code>缓存队列队首</code>操作。<br>1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5</p><ol><li>访问 page 1，缓存队列中没有，page 1 放到队首。</li><li>访问 page 2，缓存队列中没有，page 2 放到队首。</li><li>访问 page 3，缓存队列中没有，page 3 放到队首。</li><li>访问 page 4，缓存队列中没有，且缓存队列满了。移除队尾 page 1，page 4 放到队首。</li><li>访问 page 1，缓存队列中没有，且缓存队列满了。移除队尾 page 2，page 1 放到队首。</li><li>访问 page 2，缓存队列中没有，且缓存队列满了。移除队尾 page 3，page 2 放到队首。</li><li>访问 page 5，缓存队列中没有，且缓存队列满了。移除队尾 page 4，page 5 放到队首。</li><li>访问 page 1，缓存队列中有，page 1 移动到队首。</li><li>访问 page 2，缓存队列中有，page 2 移动到队首。</li><li>访问 page 3，缓存队列中没有，且缓存队列满了。移除队尾 page 5，page 3 放到队首。</li><li>访问 page 4，缓存队列中没有，且缓存队列满了。移除队尾 page 1，page 4 放到队首。</li><li>访问 page 5，缓存队列中没有，且缓存队列满了。移除队尾 page 2，page 5 放到队首。<br>最后缓存队列中存放的是 page 5，page 4，page 3。</li></ol><blockquote><p>由上可知从队首到队尾包含着一个信息就是，越接近队首，越是最近刚访问的 page。缓存背后的原理其实和<code>程序运行的局部性原理</code>有关。<br>通过上述操作，可以看到队列节点调整非常频繁，且队列节点之间有先后关系。这也决定了队列是个双端队列。<br>QNode 指针数组指向已经在缓存队列中的代表 page 的队列节点。</p></blockquote><h4 id="LRU-实现"><a href="#LRU-实现" class="headerlink" title="LRU 实现"></a>LRU 实现</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A C program to show implementation of LRU cache </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt; </span></span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// A Queue Node (Queue is implemented using Doubly Linked List) </span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">QNode</span> </span></span><br><span class="line"><span class="class">&#123;</span> </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">QNode</span> *<span class="title">prev</span>, *<span class="title">next</span>;</span> </span><br><span class="line">    <span class="keyword">unsigned</span> pageNumber;  <span class="comment">// the page number stored in this QNode </span></span><br><span class="line">&#125; QNode; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// A Queue (A FIFO collection of Queue Nodes) </span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Queue</span> </span></span><br><span class="line"><span class="class">&#123;</span> </span><br><span class="line">    <span class="keyword">unsigned</span> count;  <span class="comment">// Number of filled frames </span></span><br><span class="line">    <span class="keyword">unsigned</span> numberOfFrames; <span class="comment">// total number of frames </span></span><br><span class="line">    QNode *front, *rear; </span><br><span class="line">&#125; Queue; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// A hash (Collection of pointers to Queue Nodes) </span></span><br><span class="line"><span class="comment">// 怎样判定 page 是不是已经在 cache 中，用这个结构。</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Hash</span> </span></span><br><span class="line"><span class="class">&#123;</span> </span><br><span class="line">    <span class="keyword">int</span> capacity; <span class="comment">// how many pages can be there </span></span><br><span class="line">    QNode* *<span class="built_in">array</span>; <span class="comment">// an array of queue nodes pointer，QNode 指针数组下标作为 page number 直接索引得到 QNode，或者判定 QNode 存在与否。</span></span><br><span class="line">&#125; Hash; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// A utility function to create a new Queue Node. The queue Node </span></span><br><span class="line"><span class="comment">// will store the given &#x27;pageNumber&#x27; </span></span><br><span class="line"><span class="function">QNode* <span class="title">newQNode</span><span class="params">( <span class="keyword">unsigned</span> pageNumber )</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="comment">// Allocate memory and assign &#x27;pageNumber&#x27; </span></span><br><span class="line">    QNode* temp = (QNode *)<span class="built_in">malloc</span>( <span class="keyword">sizeof</span>( QNode ) ); </span><br><span class="line">    temp-&gt;pageNumber = pageNumber; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Initialize prev and next as NULL</span></span><br><span class="line">    temp-&gt;prev = temp-&gt;next = <span class="literal">NULL</span>; </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> temp; </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// A utility function to create an empty Queue. </span></span><br><span class="line"><span class="comment">// The queue can have at most &#x27;numberOfFrames&#x27; nodes </span></span><br><span class="line"><span class="function">Queue* <span class="title">createQueue</span><span class="params">( <span class="keyword">int</span> numberOfFrames )</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    Queue* <span class="built_in">queue</span> = (Queue *)<span class="built_in">malloc</span>( <span class="keyword">sizeof</span>( Queue ) ); </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// The queue is empty </span></span><br><span class="line">    <span class="built_in">queue</span>-&gt;count = <span class="number">0</span>; </span><br><span class="line">    <span class="built_in">queue</span>-&gt;front = <span class="built_in">queue</span>-&gt;rear = <span class="literal">NULL</span>; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Number of frames that can be stored in memory </span></span><br><span class="line">    <span class="built_in">queue</span>-&gt;numberOfFrames = numberOfFrames; </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">queue</span>; </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// A utility function to create an empty Hash of given capacity </span></span><br><span class="line"><span class="comment">// capacity 其实就是 page number 范围</span></span><br><span class="line"><span class="function">Hash* <span class="title">createHash</span><span class="params">( <span class="keyword">int</span> capacity )</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="comment">// Allocate memory for hash </span></span><br><span class="line">    Hash* hash = (Hash *) <span class="built_in">malloc</span>( <span class="keyword">sizeof</span>( Hash ) ); </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;====&gt;%d\n&quot;</span>, <span class="keyword">sizeof</span>(Hash));</span><br><span class="line">    hash-&gt;capacity = capacity; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Create an array of pointers for refering queue nodes </span></span><br><span class="line">    hash-&gt;<span class="built_in">array</span> = (QNode **) <span class="built_in">malloc</span>( hash-&gt;capacity * <span class="keyword">sizeof</span>( QNode* ) ); </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Initialize all hash entries as empty </span></span><br><span class="line">    <span class="keyword">int</span> i; </span><br><span class="line">    <span class="keyword">for</span>( i = <span class="number">0</span>; i &lt; hash-&gt;capacity; ++i ) </span><br><span class="line">        hash-&gt;<span class="built_in">array</span>[i] = <span class="literal">NULL</span>; </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> hash; </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// A function to check if there is slot available in memory </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">AreAllFramesFull</span><span class="params">( Queue* <span class="built_in">queue</span> )</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">queue</span>-&gt;count == <span class="built_in">queue</span>-&gt;numberOfFrames; </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// A utility function to check if queue is empty </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isQueueEmpty</span><span class="params">( Queue* <span class="built_in">queue</span> )</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">queue</span>-&gt;rear == <span class="literal">NULL</span>; </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// A utility function to delete a frame from queue </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deQueue</span><span class="params">( Queue* <span class="built_in">queue</span> )</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="comment">// 判断队列是不是空</span></span><br><span class="line">    <span class="keyword">if</span>( isQueueEmpty( <span class="built_in">queue</span> ) ) </span><br><span class="line">        <span class="keyword">return</span>; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// If this is the only node in list, then change front </span></span><br><span class="line">    <span class="comment">// 只有一个 node</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">queue</span>-&gt;front == <span class="built_in">queue</span>-&gt;rear) </span><br><span class="line">        <span class="built_in">queue</span>-&gt;front = <span class="literal">NULL</span>; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Change rear and remove the previous rear </span></span><br><span class="line">    QNode* temp = <span class="built_in">queue</span>-&gt;rear; </span><br><span class="line">    <span class="built_in">queue</span>-&gt;rear = <span class="built_in">queue</span>-&gt;rear-&gt;prev; </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">queue</span>-&gt;rear) </span><br><span class="line">        <span class="built_in">queue</span>-&gt;rear-&gt;next = <span class="literal">NULL</span>; </span><br><span class="line">  </span><br><span class="line">    <span class="built_in">free</span>( temp ); </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// decrement the number of full frames by 1 </span></span><br><span class="line">    <span class="built_in">queue</span>-&gt;count--; </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// A function to add a page with given &#x27;pageNumber&#x27; to both queue </span></span><br><span class="line"><span class="comment">// and hash </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Enqueue</span><span class="params">( Queue* <span class="built_in">queue</span>, Hash* hash, <span class="keyword">unsigned</span> pageNumber )</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="comment">// If all frames are full, remove the page at the rear </span></span><br><span class="line">    <span class="keyword">if</span> ( AreAllFramesFull ( <span class="built_in">queue</span> ) ) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="comment">// remove page from hash </span></span><br><span class="line">        <span class="comment">// 移除队尾 QNode</span></span><br><span class="line">        hash-&gt;<span class="built_in">array</span>[ <span class="built_in">queue</span>-&gt;rear-&gt;pageNumber ] = <span class="literal">NULL</span>; </span><br><span class="line">        deQueue( <span class="built_in">queue</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Create a new node with given page number, </span></span><br><span class="line">    <span class="comment">// And add the new node to the front of queue </span></span><br><span class="line">    QNode* temp = newQNode( pageNumber ); </span><br><span class="line">    temp-&gt;next = <span class="built_in">queue</span>-&gt;front; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// If queue is empty, change both front and rear pointers </span></span><br><span class="line">    <span class="keyword">if</span> ( isQueueEmpty( <span class="built_in">queue</span> ) ) </span><br><span class="line">        <span class="built_in">queue</span>-&gt;rear = <span class="built_in">queue</span>-&gt;front = temp; </span><br><span class="line">    <span class="keyword">else</span>  <span class="comment">// Else change the front </span></span><br><span class="line">    &#123; </span><br><span class="line">        <span class="comment">// 队首前一个 Node 是 temp</span></span><br><span class="line">        <span class="built_in">queue</span>-&gt;front-&gt;prev = temp;</span><br><span class="line">        <span class="comment">// 队首调整成 temp </span></span><br><span class="line">        <span class="built_in">queue</span>-&gt;front = temp; </span><br><span class="line">    &#125; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Add page entry to hash also </span></span><br><span class="line">    hash-&gt;<span class="built_in">array</span>[ pageNumber ] = temp; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// increment number of full frames </span></span><br><span class="line">    <span class="built_in">queue</span>-&gt;count++; </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// This function is called when a page with given &#x27;pageNumber&#x27; is referenced </span></span><br><span class="line"><span class="comment">// from cache (or memory). There are two cases: </span></span><br><span class="line"><span class="comment">// 1. Frame is not there in memory, we bring it in memory and add to the front </span></span><br><span class="line"><span class="comment">//    of queue </span></span><br><span class="line"><span class="comment">// 2. Frame is there in memory, we move the frame to front of queue </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReferencePage</span><span class="params">( Queue* <span class="built_in">queue</span>, Hash* hash, <span class="keyword">unsigned</span> pageNumber )</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    QNode* reqPage = hash-&gt;<span class="built_in">array</span>[ pageNumber ]; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// the page is not in cache, bring it </span></span><br><span class="line">    <span class="keyword">if</span> ( reqPage == <span class="literal">NULL</span> ) </span><br><span class="line">        Enqueue( <span class="built_in">queue</span>, hash, pageNumber ); </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// page is there and not at front, change pointer </span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (reqPage != <span class="built_in">queue</span>-&gt;front) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="comment">// Unlink rquested page from its current location </span></span><br><span class="line">        <span class="comment">// in queue. 把这个 Node 从队列上拿下来</span></span><br><span class="line">        reqPage-&gt;prev-&gt;next = reqPage-&gt;next; </span><br><span class="line">        <span class="comment">// 这个 Node 不是最后一个</span></span><br><span class="line">        <span class="keyword">if</span> (reqPage-&gt;next) </span><br><span class="line">           <span class="comment">// reqPage 的下一个 Node 的 prev 指向 reqPage 的前一个 Node</span></span><br><span class="line">           reqPage-&gt;next-&gt;prev = reqPage-&gt;prev; </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// If the requested page is rear, then change rear </span></span><br><span class="line">        <span class="comment">// as this node will be moved to front </span></span><br><span class="line">        <span class="comment">// reqPage 是队尾</span></span><br><span class="line">        <span class="keyword">if</span> (reqPage == <span class="built_in">queue</span>-&gt;rear) </span><br><span class="line">        &#123; </span><br><span class="line">           <span class="comment">// 更改队尾 Node</span></span><br><span class="line">           <span class="built_in">queue</span>-&gt;rear = reqPage-&gt;prev; </span><br><span class="line">           <span class="comment">// 队尾 Node 没有下一个 Node 了</span></span><br><span class="line">           <span class="built_in">queue</span>-&gt;rear-&gt;next = <span class="literal">NULL</span>; </span><br><span class="line">        &#125; </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// Put the requested page before current front </span></span><br><span class="line">        <span class="comment">// reqPage 成为新的队首 Node</span></span><br><span class="line">        reqPage-&gt;next = <span class="built_in">queue</span>-&gt;front; </span><br><span class="line">        reqPage-&gt;prev = <span class="literal">NULL</span>; </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// Change prev of current front </span></span><br><span class="line">        <span class="comment">// old 队首的 prev 变成 reqPage</span></span><br><span class="line">        reqPage-&gt;next-&gt;prev = reqPage; </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// Change front to the requested page </span></span><br><span class="line">        <span class="comment">// 队列的队首是 reqPage</span></span><br><span class="line">        <span class="built_in">queue</span>-&gt;front = reqPage; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Driver program to test above functions </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="comment">// 1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5</span></span><br><span class="line">    <span class="comment">// Let cache can hold 3 pages </span></span><br><span class="line">    Queue* q = createQueue( <span class="number">3</span> ); </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Let 6 different pages can be requested (pages to be </span></span><br><span class="line">    <span class="comment">// referenced are numbered from 0 to 5 </span></span><br><span class="line">    Hash* hash = createHash( <span class="number">6</span> ); </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Let us refer pages  1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5</span></span><br><span class="line">    ReferencePage( q, hash, <span class="number">1</span>); </span><br><span class="line">    ReferencePage( q, hash, <span class="number">2</span>); </span><br><span class="line">    ReferencePage( q, hash, <span class="number">3</span>); </span><br><span class="line">    ReferencePage( q, hash, <span class="number">4</span>); </span><br><span class="line">    ReferencePage( q, hash, <span class="number">1</span>); </span><br><span class="line">    ReferencePage( q, hash, <span class="number">2</span>);</span><br><span class="line">    ReferencePage( q, hash, <span class="number">5</span>); </span><br><span class="line">    ReferencePage( q, hash, <span class="number">1</span>); </span><br><span class="line">    ReferencePage( q, hash, <span class="number">2</span>); </span><br><span class="line">    ReferencePage( q, hash, <span class="number">3</span>); </span><br><span class="line">    ReferencePage( q, hash, <span class="number">4</span>); </span><br><span class="line">    ReferencePage( q, hash, <span class="number">5</span>); </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Let us print cache frames after the above referenced pages </span></span><br><span class="line">    <span class="built_in">printf</span> (<span class="string">&quot;%d &quot;</span>, q-&gt;front-&gt;pageNumber); </span><br><span class="line">    <span class="built_in">printf</span> (<span class="string">&quot;%d &quot;</span>, q-&gt;front-&gt;next-&gt;pageNumber); </span><br><span class="line">    <span class="built_in">printf</span> (<span class="string">&quot;%d &quot;</span>, q-&gt;front-&gt;next-&gt;next-&gt;pageNumber); </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://www.geeksforgeeks.org/lru-cache-implementation/">least recently used</a></li><li><a href="https://en.wikipedia.org/wiki/Cache_(computing)">cache wiki</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Cache&quot;&gt;&lt;a href=&quot;#Cache&quot; class=&quot;headerlink&quot; title=&quot;Cache&quot;&gt;&lt;/a&gt;Cache&lt;/h2&gt;&lt;h3 id=&quot;cache&quot;&gt;&lt;a href=&quot;#cache&quot; class=&quot;headerlink&quot; title=&quot;cac</summary>
      
    
    
    
    
    <category term="cache replacement" scheme="http://stardustman.github.io/tags/cache-replacement/"/>
    
    <category term="LRU" scheme="http://stardustman.github.io/tags/LRU/"/>
    
  </entry>
  
  <entry>
    <title>network-dns</title>
    <link href="http://stardustman.github.io/2020/04/23/network-dns/"/>
    <id>http://stardustman.github.io/2020/04/23/network-dns/</id>
    <published>2020-04-23T02:27:04.000Z</published>
    <updated>2020-05-10T11:53:44.152Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>怎样学习一个新的东西，也可以按照一定的套路的。这个东西解决什么问题？这个东西怎样解决问题？<br>还有没有其他方法？</p></blockquote><h2 id="三步走分析一下-DNS"><a href="#三步走分析一下-DNS" class="headerlink" title="三步走分析一下 DNS"></a>三步走分析一下 DNS</h2><h3 id="解决什么问题"><a href="#解决什么问题" class="headerlink" title="解决什么问题"></a>解决什么问题</h3><p>根据域名找到 IP。为啥要找到域名对应的 IP 呢？答案很简单，因为 <code>TCP/IP</code> 协议栈需要。<br>很常见的一个问题就是浏览器得到一个 web page 的流程是啥样的。</p><h3 id="什么方式解决问题"><a href="#什么方式解决问题" class="headerlink" title="什么方式解决问题"></a>什么方式解决问题</h3><p>怎样组织<code>域名(domain name)</code>？这是域名系统的首要问题。底层的组织架构，决定了域名解析的流程。有点经济基础决定上层建筑的意思。域名少的时候可以直接放在一个文件里。对，这个文件在类 unix 系统里就是 <code>/etc/hosts</code> 的文件。但是域名超级多怎么办？分类、组成层次结构。就像 Linux 的文件系统的组织方式一样。组织成一个树状结构。DNS 的查询问题，那就可以视为树的遍历问题。</p><h4 id="top-level-domain"><a href="#top-level-domain" class="headerlink" title="top level domain"></a>top level domain</h4><p><code>com</code>、<code>org</code>、 <code>cn</code> 等等就是所谓的<a href="http://data.iana.org/TLD/tlds-alpha-by-domain.txt">顶级域名</a>。也就是一级域名。那么问题就来了，这些顶级域名存放在哪呢？存放到 <a href="https://www.cloudflare.com/learning/dns/glossary/dns-root-server/">root server</a>。换一种理解方法就是，这些 root server 就是顶级域名的 metadata。这些 <a href="https://www.iana.org/domains/root/servers">root server IP</a> 是固定的。实现 DNS 这个功能的软件内置这些 root server 的 ip。这一点很重要。</p><h4 id="second-level-domain"><a href="#second-level-domain" class="headerlink" title="second level domain"></a>second level domain</h4><p>以 <code>www.google.com.</code> 为例 <code>google</code> 就是二级域名。其他的依此类推。</p><h4 id="DNS-层级树"><a href="#DNS-层级树" class="headerlink" title="DNS 层级树"></a>DNS 层级树</h4><img src="/2020/04/23/network-dns/dns-hierarchy.svg" class="" title="DNS 层级树"><blockquote><p>可以看到整个 DNS 的入口就是 root。也就是记录顶级域名在哪些服务器上的信息。这是 <code>root</code> 也就是不需要解析这些记录顶级域名的服务器。直接固定了这些 <a href="https://www.iana.org/domains/root/servers">root server 的 IP</a> 地址。实现 DNS 功能的软件，直接内置这些固定的 IP。DNS 查询第一步就是向这些 root server 查询顶级域名对应哪些 nameserver，也就是顶级域名对应的 IP。其实 DNS也就是个分布式层级数据库。注册域名也就是向数据库添加一条记录。但是不是免费注册的。</p></blockquote><h4 id="DNS-Zone"><a href="#DNS-Zone" class="headerlink" title="DNS Zone"></a>DNS Zone</h4><img src="/2020/04/23/network-dns/dns-zone.svg" class="" title="DNS Zone"><blockquote><p>可以看到整个 DNS 层级树，每一个节点对应一个 Zone。</p></blockquote><h4 id="uncached-DNS-lookup"><a href="#uncached-DNS-lookup" class="headerlink" title="uncached DNS lookup"></a>uncached DNS lookup</h4><img src="/2020/04/23/network-dns/network-dns.svg" class="" title="dns-look-up"><blockquote><p>图中 <code>OS stub resovler</code> 就是负责 DNS 解析的进程，发起 DNS 递归查询请求。<br><code>local dns server</code> 发起迭代查询，查询域名对应的 IP。之后返给 <code>OS stub resovler</code>。</p></blockquote><ol><li>这个进程向 <code>local dns server</code> 发起递归查询。也就是只需要等 <code>local dns server</code> 查询结果就行。</li><li><code>local dns server</code> 发起迭代查询。因为 <code>local dns server</code> 有所有 root server 的 IP，选择一个 IP，根据顶级域名属于哪一个 <code>TLD Zone</code>， 发起迭代查询。</li><li>可以查询得到记录这个顶级域名的 TLD server 有哪些，以及这些服务器的 IP。</li><li><code>local dns server</code> 选择一个 TLD server，发起迭代查询。</li><li>得到这个域名的权威服务器。</li><li>选择一个权威服务器，发起迭代查询，查询域名对应的 IP。</li><li><code>local dns server</code> 从权威服务器得到域名对应的 IP。</li><li>返还给 <code>OS stub resovler</code>。递归查询结束。</li></ol><h3 id="有没有其他解决方案"><a href="#有没有其他解决方案" class="headerlink" title="有没有其他解决方案"></a>有没有其他解决方案</h3><h2 id="dig-命令"><a href="#dig-命令" class="headerlink" title="dig 命令"></a>dig 命令</h2><h3 id="dig-domainname"><a href="#dig-domainname" class="headerlink" title="dig domainname"></a>dig domainname</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> ~ dig github.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; github.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 23033</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;github.com.INA</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">github.com.17INA52.74.223.119  # github.com. 这个域名对应的一个 ip</span><br><span class="line"></span><br><span class="line">;; Query time: 14 msec</span><br><span class="line">;; SERVER: 61.139.2.69#53(61.139.2.69)</span><br><span class="line">;; WHEN: Thu Apr 23 19:53:17 CST 2020</span><br><span class="line">;; MSG SIZE  rcvd: 44</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="wireshark-抓包验证实际的网络架构"><a href="#wireshark-抓包验证实际的网络架构" class="headerlink" title="wireshark 抓包验证实际的网络架构"></a>wireshark 抓包验证实际的网络架构</h3><h4 id="TCP-IP-stack"><a href="#TCP-IP-stack" class="headerlink" title="TCP/IP stack"></a>TCP/IP stack</h4><img src="/2020/04/23/network-dns/tcp-ip-stack-dns.png" class="" title="tcp-ip-stack"><h3 id="dig-trace-domainname"><a href="#dig-trace-domainname" class="headerlink" title="dig +trace domainname"></a>dig +trace domainname</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">~ dig +trace github.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; +trace github.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">.81219INNSk.root-servers.net.</span><br><span class="line">.81219INNSe.root-servers.net.</span><br><span class="line">.81219INNSb.root-servers.net.</span><br><span class="line">.81219INNSa.root-servers.net.</span><br><span class="line">.81219INNSm.root-servers.net.</span><br><span class="line">.81219INNSl.root-servers.net.</span><br><span class="line">.81219INNSd.root-servers.net.</span><br><span class="line">.81219INNSf.root-servers.net.</span><br><span class="line">.81219INNSg.root-servers.net.</span><br><span class="line">.81219INNSh.root-servers.net.</span><br><span class="line">.81219INNSj.root-servers.net.</span><br><span class="line">.81219INNSc.root-servers.net.</span><br><span class="line">.81219INNSi.root-servers.net.</span><br><span class="line">;; Received 228 bytes from 61.139.2.69#53(61.139.2.69) in 15 ms #local dns server，本地 DNS 拥有完整的 root server ip 列表。内置到本地 DNS 服务器。</span><br><span class="line"></span><br><span class="line">com.172800INNSl.gtld-servers.net.  # 记录 com. 这个顶级域名的服务器，generic top level domain server</span><br><span class="line">com.172800INNSb.gtld-servers.net.</span><br><span class="line">com.172800INNSc.gtld-servers.net.</span><br><span class="line">com.172800INNSd.gtld-servers.net.</span><br><span class="line">com.172800INNSe.gtld-servers.net.</span><br><span class="line">com.172800INNSf.gtld-servers.net.</span><br><span class="line">com.172800INNSg.gtld-servers.net.</span><br><span class="line">com.172800INNSa.gtld-servers.net.</span><br><span class="line">com.172800INNSh.gtld-servers.net.</span><br><span class="line">com.172800INNSi.gtld-servers.net.</span><br><span class="line">com.172800INNSj.gtld-servers.net.</span><br><span class="line">com.172800INNSk.gtld-servers.net.</span><br><span class="line">com.172800INNSm.gtld-servers.net.</span><br><span class="line">com.86400INDS30909 8 2 E2D3C916F6DEEAC73294E8268FB5885044A833FC5459588F4A9184CF C41A5766</span><br><span class="line">com.86400INRRSIGDS 8 1 86400 20200506050000 20200423040000 48903 . Enqd4bffSJHlv8mqHcAptS9+fHo3cg6vCIQgrOZ3aBfx2nG4CjS27iEG 6u6NsPfcKVrz7RoU2xDtDMNJOcMBJdJe&#x2F;lGNeo14N69SM0&#x2F;MV2Z8wZBD HRPd2Y8Z1nyc7EnDbkFzuWV5G6vafaQa4KTQpG6jGOPIQpYESNiinxfy 0QQWUJELvjSOideCPqQcug2P2Pln7BzWiqFSg6I8d1h44349LsXcbr5W zJwZQJKLoDd0ysyGl5Bq3UZgfWYvTJFmmZ&#x2F;OwKYT4QQ4BE0MtbVwae8X 9yI6d9jENsz+eebEEtxLt6o&#x2F;LNQb3PdNhUH1PC1pxfHiEiNyYUcvbJdf Flgntg&#x3D;&#x3D;</span><br><span class="line">;; Received 1170 bytes from 192.203.230.10#53(e.root-servers.net) in 211 ms # 从 e.root-servers.net 这个 root server 查询到的 TLD namesever，也就是存储 com. 这个顶级域名的服务器。</span><br><span class="line"></span><br><span class="line">github.com.172800INNSns1.p16.dynect.net. # 记录 github.com. 这个域名的权威服务器</span><br><span class="line">github.com.172800INNSns3.p16.dynect.net.</span><br><span class="line">github.com.172800INNSns2.p16.dynect.net.</span><br><span class="line">github.com.172800INNSns4.p16.dynect.net.</span><br><span class="line">github.com.172800INNSns-520.awsdns-01.net.</span><br><span class="line">github.com.172800INNSns-421.awsdns-52.com.</span><br><span class="line">github.com.172800INNSns-1707.awsdns-21.co.uk.</span><br><span class="line">github.com.172800INNSns-1283.awsdns-32.org.</span><br><span class="line">CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN NSEC3 1 1 0 - CK0Q1GIN43N1ARRC9OSM6QPQR81H5M9A  NS SOA RRSIG DNSKEY NSEC3PARAM</span><br><span class="line">CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN RRSIG NSEC3 8 2 86400 20200427045033 20200420034033 39844 com. BDAWMm4AsSRfrBwOXhNN8ihw++J2UkhEk8A6LeSIz1llDs5kt0CcOqTM OK1txlQNr3N0k1RTBW&#x2F;hkEZ1mxjIHF2GARt&#x2F;hpO43ILPBVs&#x2F;vhKAKCKh A96XJG+NzN0t&#x2F;heB6mFNASKAcmVdfT5a0tVkmmzhGktDp5ECdZAIFRhZ 8y6jxsUhGP7ZiN1AfFBi1cWeSth5FW4Btpy9RffVKg5lIA&#x3D;&#x3D;</span><br><span class="line">4KB4DFS71LEP8G8P8VT4CCUSQNL4CNCS.com. 86400 IN NSEC3 1 1 0 - 4KB4PTQQ5CTA7POCTGM7RUFC8B1RKTEU  NS DS RRSIG</span><br><span class="line">4KB4DFS71LEP8G8P8VT4CCUSQNL4CNCS.com. 86400 IN RRSIG NSEC3 8 2 86400 20200428061912 20200421050912 39844 com. PFN1p6XvR4SmD4ucRULmtYIMQkFf&#x2F;ZrdEWz6bRVtcepYF6QwTC&#x2F;VOVYM 7PV0tuTTdr1LqkUwQJ7mv23vtKnjFba2Cf7pBOTz9JuCHUC0Qml9cOc6 Cwjhx7haj6h0VEzS+oIY7l2p&#x2F;af&#x2F;B36iQCXASVN3Y6s&#x2F;i+66iXIg905z GqFnAKOgR0R4KJx5KwHIzBkgxr&#x2F;I&#x2F;SyCd+HNw+2fr15X0w&#x3D;&#x3D;</span><br><span class="line">;; Received 824 bytes from 192.26.92.30#53(c.gtld-servers.net) in 173 ms # 从 c.gtld-servers.net 这个 TLD nameserver 查询到存储 github.com. 这个域名的权威服务器。</span><br><span class="line"></span><br><span class="line">github.com.60INA13.250.177.223 # 得到了 github.com. 这个域名的一个 ip</span><br><span class="line">github.com.900INNSns-1707.awsdns-21.co.uk.</span><br><span class="line">github.com.900INNSns3.p16.dynect.net.</span><br><span class="line">github.com.900INNSns2.p16.dynect.net.</span><br><span class="line">github.com.900INNSns-1283.awsdns-32.org.</span><br><span class="line">github.com.900INNSns-421.awsdns-52.com.</span><br><span class="line">github.com.900INNSns-520.awsdns-01.net.</span><br><span class="line">github.com.900INNSns4.p16.dynect.net.</span><br><span class="line">github.com.900INNSns1.p16.dynect.net.</span><br><span class="line">;; Received 275 bytes from 204.13.250.16#53(ns2.p16.dynect.net) in 198 ms 从 ns2.p16.dynect.net 这个权威服务器查询到的 github.com. 的 ip 是 13.250.177.223。至此，得到域名对应的 ip。</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><a href="https://www.ruanyifeng.com/blog/2016/06/dns.html">DNS 入门</a></li><li><a href="http://kilyos.ee.bilkent.edu.tr/~ee538/lecture1.pdf">Introduction and Layered Network Architecture</a></li><li><a href="https://www.iana.org/domains/root/servers">root servers ips</a></li><li><a href="https://root-servers.org/">all-root-servers</a></li><li><a href="https://tools.ietf.org/html/rfc2929">rfc-dns</a></li><li><a href="https://www.cloudflare.com/learning/dns/dns-server-types/">dns-server-types</a></li><li><a href="https://www.cloudflare.com/learning/dns/what-is-dns/">what is dns</a></li><li><a href="https://www.cloudflare.com/learning/dns/what-is-recursive-dns/">what is recursive dns</a></li><li><a href="https://simpledns.plus/help/dns-record-types">dns record types</a></li><li><a href="https://www.cs.cmu.edu/~pattis/15-1XX/common/handouts/ascii.html">ascii</a></li><li><a href="https://www.cloudflare.com/learning/dns/glossary/dns-zone/">dns-zone</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;怎样学习一个新的东西，也可以按照一定的套路的。这个东西解决什么问题？这个东西怎样解决问题？&lt;br&gt;还有没有其他方法？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;三步走分析一下-DNS&quot;&gt;&lt;a href=&quot;#三步走分析一下-DNS&quot; cla</summary>
      
    
    
    
    
    <category term="network" scheme="http://stardustman.github.io/tags/network/"/>
    
    <category term="dns" scheme="http://stardustman.github.io/tags/dns/"/>
    
  </entry>
  
  <entry>
    <title>algorithm-quick-sort</title>
    <link href="http://stardustman.github.io/2020/04/14/algorithm-quick-sort/"/>
    <id>http://stardustman.github.io/2020/04/14/algorithm-quick-sort/</id>
    <published>2020-04-14T12:02:16.000Z</published>
    <updated>2020-05-10T11:53:44.142Z</updated>
    
    <content type="html"><![CDATA[<h2 id="quick-sort"><a href="#quick-sort" class="headerlink" title="quick sort"></a>quick sort</h2><h3 id="C-代码"><a href="#C-代码" class="headerlink" title="C 代码"></a>C 代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">partition</span><span class="params">(<span class="keyword">int</span>* <span class="built_in">array</span>, <span class="keyword">int</span> startIndex, <span class="keyword">int</span> endIndex)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left = startIndex;</span><br><span class="line">    <span class="keyword">int</span> right = endIndex;</span><br><span class="line">    <span class="keyword">int</span> pivot = <span class="built_in">array</span>[startIndex];</span><br><span class="line">    <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 第一个 while 循环，其实就是从两个方向遍历一次数组，根据 pivot 进行分割。</span></span><br><span class="line">    <span class="keyword">while</span> (left != right)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 第二个 while 循环， 找一个 array[right] &lt;= pivot，也就是找一个小于等于 pivot 的元素</span></span><br><span class="line">        <span class="keyword">while</span> (left &lt; right &amp;&amp; <span class="built_in">array</span>[right] &gt; pivot)</span><br><span class="line">        &#123;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第三个 while 循环， 找一个 array[left] &gt; pivot，也就是找一个大于等于 pivot 的元素。</span></span><br><span class="line">        <span class="keyword">while</span> (left &lt; right &amp;&amp; <span class="built_in">array</span>[left] &lt;= pivot)</span><br><span class="line">        &#123;</span><br><span class="line">            left++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 交换找到的两个元素</span></span><br><span class="line">        <span class="keyword">if</span>(left &lt; right) &#123;</span><br><span class="line">            temp = <span class="built_in">array</span>[left];</span><br><span class="line">            <span class="built_in">array</span>[left] = <span class="built_in">array</span>[right];</span><br><span class="line">            <span class="built_in">array</span>[right] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// pivot 归位, 左边都比 pivot 小， 右边都比 pivot 大</span></span><br><span class="line">   temp = <span class="built_in">array</span>[left];</span><br><span class="line">   <span class="built_in">array</span>[left] = pivot;</span><br><span class="line">   <span class="built_in">array</span>[startIndex] = temp;</span><br><span class="line">   <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span>* <span class="built_in">array</span>, <span class="keyword">int</span> startIndex, <span class="keyword">int</span> endIndex)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 只有一个元素，有序。直接返回</span></span><br><span class="line">    <span class="keyword">if</span>(startIndex &gt;= endIndex)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 一次 partition 有序一个元素。被 pivot 分割的两部分继续 quick sort</span></span><br><span class="line">    <span class="keyword">int</span> pivotIndex = partition(<span class="built_in">array</span>, startIndex, endIndex);</span><br><span class="line">    quickSort(<span class="built_in">array</span>, startIndex, pivotIndex - <span class="number">1</span>);</span><br><span class="line">    quickSort(<span class="built_in">array</span>, pivotIndex + <span class="number">1</span>, endIndex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">8</span>] = &#123;<span class="number">4</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    quickSort(<span class="built_in">array</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,<span class="built_in">array</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="汇编代码分析"><a href="#汇编代码分析" class="headerlink" title="汇编代码分析"></a>汇编代码分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br></pre></td><td class="code"><pre><span class="line">quickSort:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .init:</span><br><span class="line"></span><br><span class="line">0000000000000548 &lt;_init&gt;:</span><br><span class="line"> 548:48 83 ec 08          sub    $0x8,%rsp</span><br><span class="line"> 54c:48 8b 05 95 0a 20 00 mov    0x200a95(%rip),%rax        # 200fe8 &lt;__gmon_start__&gt;</span><br><span class="line"> 553:48 85 c0             test   %rax,%rax</span><br><span class="line"> 556:74 02                je     55a &lt;_init+0x12&gt;</span><br><span class="line"> 558:ff d0                callq  *%rax</span><br><span class="line"> 55a:48 83 c4 08          add    $0x8,%rsp</span><br><span class="line"> 55e:c3                   retq   </span><br><span class="line"></span><br><span class="line">Disassembly of section .plt:</span><br><span class="line"></span><br><span class="line">0000000000000560 &lt;.plt&gt;:</span><br><span class="line"> 560:ff 35 52 0a 20 00    pushq  0x200a52(%rip)        # 200fb8 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;</span><br><span class="line"> 566:ff 25 54 0a 20 00    jmpq   *0x200a54(%rip)        # 200fc0 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;</span><br><span class="line"> 56c:0f 1f 40 00          nopl   0x0(%rax)</span><br><span class="line"></span><br><span class="line">0000000000000570 &lt;__stack_chk_fail@plt&gt;:</span><br><span class="line"> 570:ff 25 52 0a 20 00    jmpq   *0x200a52(%rip)        # 200fc8 &lt;__stack_chk_fail@GLIBC_2.4&gt;</span><br><span class="line"> 576:68 00 00 00 00       pushq  $0x0</span><br><span class="line"> 57b:e9 e0 ff ff ff       jmpq   560 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">0000000000000580 &lt;printf@plt&gt;:</span><br><span class="line"> 580:ff 25 4a 0a 20 00    jmpq   *0x200a4a(%rip)        # 200fd0 &lt;printf@GLIBC_2.2.5&gt;</span><br><span class="line"> 586:68 01 00 00 00       pushq  $0x1</span><br><span class="line"> 58b:e9 d0 ff ff ff       jmpq   560 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">Disassembly of section .plt.got:</span><br><span class="line"></span><br><span class="line">0000000000000590 &lt;__cxa_finalize@plt&gt;:</span><br><span class="line"> 590:ff 25 62 0a 20 00    jmpq   *0x200a62(%rip)        # 200ff8 &lt;__cxa_finalize@GLIBC_2.2.5&gt;</span><br><span class="line"> 596:66 90                xchg   %ax,%ax</span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">00000000000005a0 &lt;_start&gt;:</span><br><span class="line"> 5a0:31 ed                xor    %ebp,%ebp ; ebp &#x3D; 0</span><br><span class="line"> 5a2:49 89 d1             mov    %rdx,%r9  ; r9 &#x3D; rdx</span><br><span class="line"> 5a5:5e                   pop    %rsi</span><br><span class="line"> 5a6:48 89 e2             mov    %rsp,%rdx ; rdx &#x3D; rsp</span><br><span class="line"> 5a9:48 83 e4 f0          and    $0xfffffffffffffff0,%rsp</span><br><span class="line"> 5ad:50                   push   %rax</span><br><span class="line"> 5ae:54                   push   %rsp</span><br><span class="line"> 5af:4c 8d 05 ca 03 00 00 lea    0x3ca(%rip),%r8        # 980 &lt;__libc_csu_fini&gt;</span><br><span class="line"> 5b6:48 8d 0d 53 03 00 00 lea    0x353(%rip),%rcx        # 910 &lt;__libc_csu_init&gt;</span><br><span class="line"> 5bd:48 8d 3d 9c 02 00 00 lea    0x29c(%rip),%rdi        # 860 &lt;main&gt;</span><br><span class="line"> 5c4:ff 15 16 0a 20 00    callq  *0x200a16(%rip)        # 200fe0 &lt;__libc_start_main@GLIBC_2.2.5&gt;</span><br><span class="line"> 5ca:f4                   hlt    </span><br><span class="line"> 5cb:0f 1f 44 00 00       nopl   0x0(%rax,%rax,1)</span><br><span class="line"></span><br><span class="line">00000000000005d0 &lt;deregister_tm_clones&gt;:</span><br><span class="line"> 5d0:48 8d 3d 39 0a 20 00 lea    0x200a39(%rip),%rdi        # 201010 &lt;__TMC_END__&gt;</span><br><span class="line"> 5d7:55                   push   %rbp</span><br><span class="line"> 5d8:48 8d 05 31 0a 20 00 lea    0x200a31(%rip),%rax        # 201010 &lt;__TMC_END__&gt;</span><br><span class="line"> 5df:48 39 f8             cmp    %rdi,%rax</span><br><span class="line"> 5e2:48 89 e5             mov    %rsp,%rbp</span><br><span class="line"> 5e5:74 19                je     600 &lt;deregister_tm_clones+0x30&gt;</span><br><span class="line"> 5e7:48 8b 05 ea 09 20 00 mov    0x2009ea(%rip),%rax        # 200fd8 &lt;_ITM_deregisterTMCloneTable&gt;</span><br><span class="line"> 5ee:48 85 c0             test   %rax,%rax</span><br><span class="line"> 5f1:74 0d                je     600 &lt;deregister_tm_clones+0x30&gt;</span><br><span class="line"> 5f3:5d                   pop    %rbp</span><br><span class="line"> 5f4:ff e0                jmpq   *%rax</span><br><span class="line"> 5f6:66 2e 0f 1f 84 00 00 nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> 5fd:00 00 00 </span><br><span class="line"> 600:5d                   pop    %rbp</span><br><span class="line"> 601:c3                   retq   </span><br><span class="line"> 602:0f 1f 40 00          nopl   0x0(%rax)</span><br><span class="line"> 606:66 2e 0f 1f 84 00 00 nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> 60d:00 00 00 </span><br><span class="line"></span><br><span class="line">0000000000000610 &lt;register_tm_clones&gt;:</span><br><span class="line"> 610:48 8d 3d f9 09 20 00 lea    0x2009f9(%rip),%rdi        # 201010 &lt;__TMC_END__&gt;</span><br><span class="line"> 617:48 8d 35 f2 09 20 00 lea    0x2009f2(%rip),%rsi        # 201010 &lt;__TMC_END__&gt;</span><br><span class="line"> 61e:55                   push   %rbp</span><br><span class="line"> 61f:48 29 fe             sub    %rdi,%rsi</span><br><span class="line"> 622:48 89 e5             mov    %rsp,%rbp</span><br><span class="line"> 625:48 c1 fe 03          sar    $0x3,%rsi</span><br><span class="line"> 629:48 89 f0             mov    %rsi,%rax</span><br><span class="line"> 62c:48 c1 e8 3f          shr    $0x3f,%rax</span><br><span class="line"> 630:48 01 c6             add    %rax,%rsi</span><br><span class="line"> 633:48 d1 fe             sar    %rsi</span><br><span class="line"> 636:74 18                je     650 &lt;register_tm_clones+0x40&gt;</span><br><span class="line"> 638:48 8b 05 b1 09 20 00 mov    0x2009b1(%rip),%rax        # 200ff0 &lt;_ITM_registerTMCloneTable&gt;</span><br><span class="line"> 63f:48 85 c0             test   %rax,%rax</span><br><span class="line"> 642:74 0c                je     650 &lt;register_tm_clones+0x40&gt;</span><br><span class="line"> 644:5d                   pop    %rbp</span><br><span class="line"> 645:ff e0                jmpq   *%rax</span><br><span class="line"> 647:66 0f 1f 84 00 00 00 nopw   0x0(%rax,%rax,1)</span><br><span class="line"> 64e:00 00 </span><br><span class="line"> 650:5d                   pop    %rbp</span><br><span class="line"> 651:c3                   retq   </span><br><span class="line"> 652:0f 1f 40 00          nopl   0x0(%rax)</span><br><span class="line"> 656:66 2e 0f 1f 84 00 00 nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> 65d:00 00 00 </span><br><span class="line"></span><br><span class="line">0000000000000660 &lt;__do_global_dtors_aux&gt;:</span><br><span class="line"> 660:80 3d a9 09 20 00 00 cmpb   $0x0,0x2009a9(%rip)        # 201010 &lt;__TMC_END__&gt;</span><br><span class="line"> 667:75 2f                jne    698 &lt;__do_global_dtors_aux+0x38&gt;</span><br><span class="line"> 669:48 83 3d 87 09 20 00 cmpq   $0x0,0x200987(%rip)        # 200ff8 &lt;__cxa_finalize@GLIBC_2.2.5&gt;</span><br><span class="line"> 670:00 </span><br><span class="line"> 671:55                   push   %rbp</span><br><span class="line"> 672:48 89 e5             mov    %rsp,%rbp</span><br><span class="line"> 675:74 0c                je     683 &lt;__do_global_dtors_aux+0x23&gt;</span><br><span class="line"> 677:48 8b 3d 8a 09 20 00 mov    0x20098a(%rip),%rdi        # 201008 &lt;__dso_handle&gt;</span><br><span class="line"> 67e:e8 0d ff ff ff       callq  590 &lt;__cxa_finalize@plt&gt;</span><br><span class="line"> 683:e8 48 ff ff ff       callq  5d0 &lt;deregister_tm_clones&gt;</span><br><span class="line"> 688:c6 05 81 09 20 00 01 movb   $0x1,0x200981(%rip)        # 201010 &lt;__TMC_END__&gt;</span><br><span class="line"> 68f:5d                   pop    %rbp</span><br><span class="line"> 690:c3                   retq   </span><br><span class="line"> 691:0f 1f 80 00 00 00 00 nopl   0x0(%rax)</span><br><span class="line"> 698:f3 c3                repz retq </span><br><span class="line"> 69a:66 0f 1f 44 00 00    nopw   0x0(%rax,%rax,1)</span><br><span class="line"></span><br><span class="line">00000000000006a0 &lt;frame_dummy&gt;:</span><br><span class="line"> 6a0:55                   push   %rbp</span><br><span class="line"> 6a1:48 89 e5             mov    %rsp,%rbp</span><br><span class="line"> 6a4:5d                   pop    %rbp</span><br><span class="line"> 6a5:e9 66 ff ff ff       jmpq   610 &lt;register_tm_clones&gt;</span><br><span class="line"></span><br><span class="line">00000000000006aa &lt;partition&gt;:</span><br><span class="line"> 6aa:55                   push   %rbp</span><br><span class="line"> 6ab:48 89 e5             mov    %rsp,%rbp</span><br><span class="line"> 6ae:48 89 7d e8          mov    %rdi,-0x18(%rbp) ; &amp;array[0]</span><br><span class="line"> 6b2:89 75 e4             mov    %esi,-0x1c(%rbp) ; startIndex</span><br><span class="line"> 6b5:89 55 e0             mov    %edx,-0x20(%rbp) ; endIndex</span><br><span class="line"> 6b8:8b 45 e4             mov    -0x1c(%rbp),%eax ; eax &#x3D; startIndex</span><br><span class="line"> 6bb:89 45 f0             mov    %eax,-0x10(%rbp) ; left &#x3D; startIndex</span><br><span class="line"> 6be:8b 45 e0             mov    -0x20(%rbp),%eax ; eax &#x3D; endIndex</span><br><span class="line"> 6c1:89 45 f4             mov    %eax,-0xc(%rbp)  ; right &#x3D; endIndex</span><br><span class="line"> 6c4:8b 45 e4             mov    -0x1c(%rbp),%eax ; eax &#x3D; startIndex</span><br><span class="line"> 6c7:48 98                cltq                    </span><br><span class="line"> 6c9:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * startIndex</span><br><span class="line"> 6d0:00 </span><br><span class="line"> 6d1:48 8b 45 e8          mov    -0x18(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 6d5:48 01 d0             add    %rdx,%rax        ; rax &#x3D; &amp;array[0] + 4 * startIndex</span><br><span class="line"> 6d8:8b 00                mov    (%rax),%eax      ; eax &#x3D; array[startIndex]</span><br><span class="line"> 6da:89 45 f8             mov    %eax,-0x8(%rbp)  ; pivot &#x3D; array[startIndex]</span><br><span class="line"> 6dd:c7 45 fc 00 00 00 00 movl   $0x0,-0x4(%rbp)  ; temp &#x3D; 0;</span><br><span class="line"> 6e4:e9 b7 00 00 00       jmpq   7a0 &lt;partition+0xf6&gt; ; 跳转到 while(left !&#x3D; right) 判断 left !&#x3D; right</span><br><span class="line"></span><br><span class="line">; 第二个 while 循环的循环体</span><br><span class="line"> 6e9:83 6d f4 01          subl   $0x1,-0xc(%rbp)  ; right &#x3D; right - 1</span><br><span class="line"></span><br><span class="line">; while(left !&#x3D; right) 的循环体</span><br><span class="line"> 6ed:8b 45 f0             mov    -0x10(%rbp),%eax ; eax &#x3D; left</span><br><span class="line"> 6f0:3b 45 f4             cmp    -0xc(%rbp),%eax  ; cmp right,left</span><br><span class="line"> 6f3:7d 21                jge    716 &lt;partition+0x6c&gt; ; left &gt;&#x3D; right，第二个 while 循环不满足，进入判断第三个 while 循环</span><br><span class="line"> 6f5:8b 45 f4             mov    -0xc(%rbp),%eax  ; eax &#x3D; right 能执行到这，说明 left &lt; right</span><br><span class="line"> 6f8:48 98                cltq                    ; convert eax to rax</span><br><span class="line"> 6fa:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx; rdx &#x3D; 4 * right</span><br><span class="line"> 701:00 </span><br><span class="line"> 702:48 8b 45 e8          mov    -0x18(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 706:48 01 d0             add    %rdx,%rax        ; rax &#x3D; &amp;array[0] + 4 * right</span><br><span class="line"> 709:8b 00                mov    (%rax),%eax      ; eax &#x3D; array[right]</span><br><span class="line"> 70b:39 45 f8             cmp    %eax,-0x8(%rbp)  ; cmp array[right],pivot</span><br><span class="line"> 70e:7c d9                jl     6e9 &lt;partition+0x3f&gt; ; pivot &lt; array[right] 执行跳转，执行循环体。</span><br><span class="line"> 710:eb 04                jmp    716 &lt;partition+0x6c&gt; ; </span><br><span class="line"></span><br><span class="line">; 第三个 while 循环的循环体</span><br><span class="line"> 712:83 45 f0 01          addl   $0x1,-0x10(%rbp) ; left &#x3D; left + 1</span><br><span class="line"> </span><br><span class="line"> ; 第三个 while 循环</span><br><span class="line"> 716:8b 45 f0             mov    -0x10(%rbp),%eax ; eax &#x3D; left</span><br><span class="line"> 719:3b 45 f4             cmp    -0xc(%rbp),%eax  ; cmp,right,left</span><br><span class="line"> 71c:7d 1b                jge    739 &lt;partition+0x8f&gt; ; left &gt;&#x3D; right，第三个 while 循环 条件 1 不满足，短路。进入 if 语句。</span><br><span class="line"> 71e:8b 45 f0             mov    -0x10(%rbp),%eax ; eax &#x3D; left</span><br><span class="line"> 721:48 98                cltq   </span><br><span class="line"> 723:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * left</span><br><span class="line"> 72a:00 </span><br><span class="line"> 72b:48 8b 45 e8          mov    -0x18(%rbp),%rax  ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 72f:48 01 d0             add    %rdx,%rax         ; rax &#x3D; &amp;array[0] + 4 * left</span><br><span class="line"> 732:8b 00                mov    (%rax),%eax       ; eax &#x3D; array[left]</span><br><span class="line"> 734:39 45 f8             cmp    %eax,-0x8(%rbp)   ; cmp,array[left],pivot</span><br><span class="line"> 737:7d d9                jge    712 &lt;partition+0x68&gt; ; pivot &gt;&#x3D; array[left]，第三个 while 循环 条件 2 满足。执行循环体。</span><br><span class="line"></span><br><span class="line"> ; if 代码块开始</span><br><span class="line"> 739:8b 45 f0             mov    -0x10(%rbp),%eax  ; eax &#x3D; left</span><br><span class="line"> 73c:3b 45 f4             cmp    -0xc(%rbp),%eax   ; cmp right,left</span><br><span class="line"> 73f:7d 5f                jge    7a0 &lt;partition+0xf6&gt; ; left &gt;&#x3D; right 进入下一轮循环</span><br><span class="line"> 741:8b 45 f0             mov    -0x10(%rbp),%eax  ; eax &#x3D; left</span><br><span class="line"> 744:48 98                cltq   </span><br><span class="line"> 746:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * left</span><br><span class="line"> 74d:00 </span><br><span class="line"> 74e:48 8b 45 e8          mov    -0x18(%rbp),%rax  ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 752:48 01 d0             add    %rdx,%rax         ; rax &#x3D; &amp;array[0] + 4 * left</span><br><span class="line"> 755:8b 00                mov    (%rax),%eax       ; eax &#x3D; array[left]</span><br><span class="line"> 757:89 45 fc             mov    %eax,-0x4(%rbp)   ; temp &#x3D; array[left]</span><br><span class="line"> 75a:8b 45 f4             mov    -0xc(%rbp),%eax   ; eax &#x3D; right</span><br><span class="line"> 75d:48 98                cltq   </span><br><span class="line"> 75f:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * right</span><br><span class="line"> 766:00 </span><br><span class="line"> 767:48 8b 45 e8          mov    -0x18(%rbp),%rax  ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 76b:48 01 d0             add    %rdx,%rax         ; rax &#x3D; &amp;array[0] + 4 * right</span><br><span class="line"> 76e:8b 55 f0             mov    -0x10(%rbp),%edx  ; edx &#x3D; left</span><br><span class="line"> 771:48 63 d2             movslq %edx,%rdx         ; </span><br><span class="line"> 774:48 8d 0c 95 00 00 00 lea    0x0(,%rdx,4),%rcx ; rcx &#x3D; 4 * left</span><br><span class="line"> 77b:00 </span><br><span class="line"> 77c:48 8b 55 e8          mov    -0x18(%rbp),%rdx  ; rdx &#x3D; &amp;array[0]</span><br><span class="line"> 780:48 01 ca             add    %rcx,%rdx         ; rdx &#x3D; &amp;array[0] + 4 * left</span><br><span class="line"> 783:8b 00                mov    (%rax),%eax       ; eax &#x3D; array[right]</span><br><span class="line"> 785:89 02                mov    %eax,(%rdx)       ; array[left] &#x3D; array[right]</span><br><span class="line"> 787:8b 45 f4             mov    -0xc(%rbp),%eax   ; eax &#x3D; right</span><br><span class="line"> 78a:48 98                cltq   </span><br><span class="line"> 78c:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * right</span><br><span class="line"> 793:00 </span><br><span class="line"> 794:48 8b 45 e8          mov    -0x18(%rbp),%rax  ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 798:48 01 c2             add    %rax,%rdx         ; rdx &#x3D; &amp;array[0] + 4 * right</span><br><span class="line"> 79b:8b 45 fc             mov    -0x4(%rbp),%eax   ; eax &#x3D; temp;</span><br><span class="line"> 79e:89 02                mov    %eax,(%rdx)       ; array[right] &#x3D; temp</span><br><span class="line"> ; if 代码块结束</span><br><span class="line"></span><br><span class="line">; while(left !&#x3D; right) 进入循环的条件判断</span><br><span class="line"> 7a0:8b 45 f0             mov    -0x10(%rbp),%eax ; eax &#x3D; left</span><br><span class="line"> 7a3:3b 45 f4             cmp    -0xc(%rbp),%eax  ; cpm right, left</span><br><span class="line"> 7a6:0f 85 41 ff ff ff    jne    6ed &lt;partition+0x43&gt; ; left !&#x3D; right 满足循环条件进入循环体</span><br><span class="line"></span><br><span class="line"> 7ac:8b 45 f0             mov    -0x10(%rbp),%eax ; eax &#x3D; left  不满足循环条件 left !&#x3D; right，此时循环结束。</span><br><span class="line"> </span><br><span class="line"> ; pivot 归位</span><br><span class="line"> 7af:48 98                cltq   </span><br><span class="line"> 7b1:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * left</span><br><span class="line"> 7b8:00 </span><br><span class="line"> 7b9:48 8b 45 e8          mov    -0x18(%rbp),%rax  ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 7bd:48 01 d0             add    %rdx,%rax         ; rax &#x3D; &amp;array[0] + 4 * left</span><br><span class="line"> 7c0:8b 00                mov    (%rax),%eax       ; eax &#x3D; array[left]</span><br><span class="line"> 7c2:89 45 fc             mov    %eax,-0x4(%rbp)   ; temp &#x3D; array[left]</span><br><span class="line"> 7c5:8b 45 f0             mov    -0x10(%rbp),%eax  ; eax &#x3D; left</span><br><span class="line"> 7c8:48 98                cltq   </span><br><span class="line"> 7ca:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * left</span><br><span class="line"> 7d1:00 </span><br><span class="line"> 7d2:48 8b 45 e8          mov    -0x18(%rbp),%rax  ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 7d6:48 01 c2             add    %rax,%rdx         ; rdx &#x3D; &amp;array[0] + 4 * left</span><br><span class="line"> 7d9:8b 45 f8             mov    -0x8(%rbp),%eax   ; eax &#x3D; pivot</span><br><span class="line"> 7dc:89 02                mov    %eax,(%rdx)       ; array[left] &#x3D; pivot</span><br><span class="line"> 7de:8b 45 e4             mov    -0x1c(%rbp),%eax  ; eax &#x3D; startIndex</span><br><span class="line"> 7e1:48 98                cltq   </span><br><span class="line"> 7e3:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * startIndex</span><br><span class="line"> 7ea:00 </span><br><span class="line"> 7eb:48 8b 45 e8          mov    -0x18(%rbp),%rax  ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 7ef:48 01 c2             add    %rax,%rdx         ; rdx &#x3D; &amp;array[0] + 4 * startIndex</span><br><span class="line"> 7f2:8b 45 fc             mov    -0x4(%rbp),%eax   ; eax &#x3D; temp</span><br><span class="line"> 7f5:89 02                mov    %eax,(%rdx)       ; array[startIndex] &#x3D; temp</span><br><span class="line"> 7f7:8b 45 f0             mov    -0x10(%rbp),%eax  ; eax &#x3D; left 返回值</span><br><span class="line"> 7fa:5d                   pop    %rbp              ; pop 调用者的 rbp</span><br><span class="line"> 7fb:c3                   retq                     ; 1. pop %rip 2.jmp %rip</span><br><span class="line"></span><br><span class="line">00000000000007fc &lt;quickSort&gt;:</span><br><span class="line"> 7fc:55                   push   %rbp</span><br><span class="line"> 7fd:48 89 e5             mov    %rsp,%rbp</span><br><span class="line"> 800:48 83 ec 20          sub    $0x20,%rsp ;分配 32Bytes 空间</span><br><span class="line"> 804:48 89 7d e8          mov    %rdi,-0x18(%rbp)  ; &amp;array[0]</span><br><span class="line"> 808:89 75 e4             mov    %esi,-0x1c(%rbp)  ; startIndex</span><br><span class="line"> 80b:89 55 e0             mov    %edx,-0x20(%rbp)  ; endIndex</span><br><span class="line"> 80e:8b 45 e4             mov    -0x1c(%rbp),%eax  ; eax &#x3D; startIndex</span><br><span class="line"> 811:3b 45 e0             cmp    -0x20(%rbp),%eax  ; cmp endIndex,startIndex</span><br><span class="line"> 814:7d 47                jge    85d &lt;quickSort+0x61&gt; ; startIndex &gt;&#x3D; endIndex 不满足条件，销毁栈帧，结束调用。</span><br><span class="line"> 816:8b 55 e0             mov    -0x20(%rbp),%edx  ; edx &#x3D; endIndex   第三个参数 能执行到这，说明 startIndex &lt; endIndex</span><br><span class="line"> 819:8b 4d e4             mov    -0x1c(%rbp),%ecx  ; ecx &#x3D; startIndex</span><br><span class="line"> 81c:48 8b 45 e8          mov    -0x18(%rbp),%rax  ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 820:89 ce                mov    %ecx,%esi         ; esi &#x3D; startIndex 第二个参数</span><br><span class="line"> 822:48 89 c7             mov    %rax,%rdi         ; rdi &#x3D; &amp;array[0]  第一个参数</span><br><span class="line"> 825:e8 80 fe ff ff       callq  6aa &lt;partition&gt;</span><br><span class="line"></span><br><span class="line"> 82a:89 45 fc             mov    %eax,-0x4(%rbp)   ; pivotIndex &#x3D; eax partition 的返回值在 eax 里</span><br><span class="line"> 82d:8b 45 fc             mov    -0x4(%rbp),%eax   ; eax &#x3D; pivotIndex</span><br><span class="line"> 830:8d 50 ff             lea    -0x1(%rax),%edx   ; edx &#x3D; pivotIndex - 1 第三个参数</span><br><span class="line"> 833:8b 4d e4             mov    -0x1c(%rbp),%ecx  ; ecx &#x3D; startIndex</span><br><span class="line"> 836:48 8b 45 e8          mov    -0x18(%rbp),%rax  ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 83a:89 ce                mov    %ecx,%esi         ; esi &#x3D; startIndex     第二个参数</span><br><span class="line"> 83c:48 89 c7             mov    %rax,%rdi         ; rdi &#x3D; &amp;array[0]      第一个参数</span><br><span class="line"> 83f:e8 b8 ff ff ff       callq  7fc &lt;quickSort&gt;   ; quickSort(array, startIndex, pivotIndex - 1)</span><br><span class="line"></span><br><span class="line"> 844:8b 45 fc             mov    -0x4(%rbp),%eax   ; eax &#x3D; pivotIndex</span><br><span class="line"> 847:8d 48 01             lea    0x1(%rax),%ecx    ; ecx &#x3D; pivotIndex + 1</span><br><span class="line"> 84a:8b 55 e0             mov    -0x20(%rbp),%edx  ; edx &#x3D; endIndex       第三个参数</span><br><span class="line"> 84d:48 8b 45 e8          mov    -0x18(%rbp),%rax  ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 851:89 ce                mov    %ecx,%esi         ; esi &#x3D; pivotIndex + 1 第二个参数</span><br><span class="line"> 853:48 89 c7             mov    %rax,%rdi         ; rdi &#x3D; &amp;array[0]      第一个参数</span><br><span class="line"> 856:e8 a1 ff ff ff       callq  7fc &lt;quickSort&gt;   ; quickSort(array, pivotIndex + 1, endIndex)</span><br><span class="line"></span><br><span class="line"> 85b:eb 01                jmp    85e &lt;quickSort+0x62&gt;</span><br><span class="line"></span><br><span class="line"> 85d:90                   nop</span><br><span class="line"> 85e:c9                   leaveq </span><br><span class="line"> 85f:c3                   retq   </span><br><span class="line"></span><br><span class="line">0000000000000860 &lt;main&gt;:</span><br><span class="line"> 860:55                   push   %rbp</span><br><span class="line"> 861:48 89 e5             mov    %rsp,%rbp</span><br><span class="line"> 864:48 83 ec 40          sub    $0x40,%rsp ; 分配 64Bytes 空间。 </span><br><span class="line"> 868:64 48 8b 04 25 28 00 mov    %fs:0x28,%rax</span><br><span class="line"> 86f:00 00 </span><br><span class="line"> 871:48 89 45 f8          mov    %rax,-0x8(%rbp)</span><br><span class="line"> 875:31 c0                xor    %eax,%eax</span><br><span class="line"> 877:c7 45 d0 04 00 00 00 movl   $0x4,-0x30(%rbp) ; array[0] &#x3D; 4</span><br><span class="line"> 87e:c7 45 d4 07 00 00 00 movl   $0x7,-0x2c(%rbp) ; array[1] &#x3D; 7</span><br><span class="line"> 885:c7 45 d8 06 00 00 00 movl   $0x6,-0x28(%rbp) ; array[2] &#x3D; 6</span><br><span class="line"> 88c:c7 45 dc 05 00 00 00 movl   $0x5,-0x24(%rbp) ; array[3] &#x3D; 5</span><br><span class="line"> 893:c7 45 e0 03 00 00 00 movl   $0x3,-0x20(%rbp) ; array[4] &#x3D; 3</span><br><span class="line"> 89a:c7 45 e4 02 00 00 00 movl   $0x2,-0x1c(%rbp) ; array[5] &#x3D; 2</span><br><span class="line"> 8a1:c7 45 e8 08 00 00 00 movl   $0x8,-0x18(%rbp) ; array[6] &#x3D; 8</span><br><span class="line"> 8a8:c7 45 ec 01 00 00 00 movl   $0x1,-0x14(%rbp) ; array[7] &#x3D; 1</span><br><span class="line"> 8af:48 8d 45 d0          lea    -0x30(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 8b3:ba 07 00 00 00       mov    $0x7,%edx ; edx &#x3D; endIndex &#x3D; 7</span><br><span class="line"> 8b8:be 00 00 00 00       mov    $0x0,%esi ; esi &#x3D; startIndex &#x3D; 0</span><br><span class="line"> 8bd:48 89 c7             mov    %rax,%rdi ; rdi &#x3D; rax &#x3D; &amp;array[0]</span><br><span class="line"> 8c0:e8 37 ff ff ff       callq  7fc &lt;quickSort&gt;</span><br><span class="line"> 8c5:c7 45 cc 00 00 00 00 movl   $0x0,-0x34(%rbp) ; i &#x3D; 0</span><br><span class="line"> 8cc:eb 20                jmp    8ee &lt;main+0x8e&gt;</span><br><span class="line"> 8ce:8b 45 cc             mov    -0x34(%rbp),%eax</span><br><span class="line"> 8d1:48 98                cltq   </span><br><span class="line"> 8d3:8b 44 85 d0          mov    -0x30(%rbp,%rax,4),%eax</span><br><span class="line"> 8d7:89 c6                mov    %eax,%esi</span><br><span class="line"> 8d9:48 8d 3d b4 00 00 00 lea    0xb4(%rip),%rdi        # 994 &lt;_IO_stdin_used+0x4&gt;</span><br><span class="line"> 8e0:b8 00 00 00 00       mov    $0x0,%eax</span><br><span class="line"> 8e5:e8 96 fc ff ff       callq  580 &lt;printf@plt&gt;</span><br><span class="line"> 8ea:83 45 cc 01          addl   $0x1,-0x34(%rbp)</span><br><span class="line"> 8ee:83 7d cc 07          cmpl   $0x7,-0x34(%rbp)</span><br><span class="line"> 8f2:7e da                jle    8ce &lt;main+0x6e&gt;</span><br><span class="line"> 8f4:b8 00 00 00 00       mov    $0x0,%eax</span><br><span class="line"> 8f9:48 8b 4d f8          mov    -0x8(%rbp),%rcx</span><br><span class="line"> 8fd:64 48 33 0c 25 28 00 xor    %fs:0x28,%rcx</span><br><span class="line"> 904:00 00 </span><br><span class="line"> 906:74 05                je     90d &lt;main+0xad&gt;</span><br><span class="line"> 908:e8 63 fc ff ff       callq  570 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line"> 90d:c9                   leaveq </span><br><span class="line"> 90e:c3                   retq   </span><br><span class="line"> 90f:90                   nop</span><br><span class="line"></span><br><span class="line">0000000000000910 &lt;__libc_csu_init&gt;:</span><br><span class="line"> 910:41 57                push   %r15</span><br><span class="line"> 912:41 56                push   %r14</span><br><span class="line"> 914:49 89 d7             mov    %rdx,%r15</span><br><span class="line"> 917:41 55                push   %r13</span><br><span class="line"> 919:41 54                push   %r12</span><br><span class="line"> 91b:4c 8d 25 8e 04 20 00 lea    0x20048e(%rip),%r12        # 200db0 &lt;__frame_dummy_init_array_entry&gt;</span><br><span class="line"> 922:55                   push   %rbp</span><br><span class="line"> 923:48 8d 2d 8e 04 20 00 lea    0x20048e(%rip),%rbp        # 200db8 &lt;__init_array_end&gt;</span><br><span class="line"> 92a:53                   push   %rbx</span><br><span class="line"> 92b:41 89 fd             mov    %edi,%r13d</span><br><span class="line"> 92e:49 89 f6             mov    %rsi,%r14</span><br><span class="line"> 931:4c 29 e5             sub    %r12,%rbp</span><br><span class="line"> 934:48 83 ec 08          sub    $0x8,%rsp</span><br><span class="line"> 938:48 c1 fd 03          sar    $0x3,%rbp</span><br><span class="line"> 93c:e8 07 fc ff ff       callq  548 &lt;_init&gt;</span><br><span class="line"> 941:48 85 ed             test   %rbp,%rbp</span><br><span class="line"> 944:74 20                je     966 &lt;__libc_csu_init+0x56&gt;</span><br><span class="line"> 946:31 db                xor    %ebx,%ebx</span><br><span class="line"> 948:0f 1f 84 00 00 00 00 nopl   0x0(%rax,%rax,1)</span><br><span class="line"> 94f:00 </span><br><span class="line"> 950:4c 89 fa             mov    %r15,%rdx</span><br><span class="line"> 953:4c 89 f6             mov    %r14,%rsi</span><br><span class="line"> 956:44 89 ef             mov    %r13d,%edi</span><br><span class="line"> 959:41 ff 14 dc          callq  *(%r12,%rbx,8)</span><br><span class="line"> 95d:48 83 c3 01          add    $0x1,%rbx</span><br><span class="line"> 961:48 39 dd             cmp    %rbx,%rbp</span><br><span class="line"> 964:75 ea                jne    950 &lt;__libc_csu_init+0x40&gt;</span><br><span class="line"> 966:48 83 c4 08          add    $0x8,%rsp</span><br><span class="line"> 96a:5b                   pop    %rbx</span><br><span class="line"> 96b:5d                   pop    %rbp</span><br><span class="line"> 96c:41 5c                pop    %r12</span><br><span class="line"> 96e:41 5d                pop    %r13</span><br><span class="line"> 970:41 5e                pop    %r14</span><br><span class="line"> 972:41 5f                pop    %r15</span><br><span class="line"> 974:c3                   retq   </span><br><span class="line"> 975:90                   nop</span><br><span class="line"> 976:66 2e 0f 1f 84 00 00 nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> 97d:00 00 00 </span><br><span class="line"></span><br><span class="line">0000000000000980 &lt;__libc_csu_fini&gt;:</span><br><span class="line"> 980:f3 c3                repz retq </span><br><span class="line"></span><br><span class="line">Disassembly of section .fini:</span><br><span class="line"></span><br><span class="line">0000000000000984 &lt;_fini&gt;:</span><br><span class="line"> 984:48 83 ec 08          sub    $0x8,%rsp</span><br><span class="line"> 988:48 83 c4 08          add    $0x8,%rsp</span><br><span class="line"> 98c:c3                   retq   </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="partition-分析"><a href="#partition-分析" class="headerlink" title="partition 分析"></a>partition 分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Before:: [4, 7, 6, 5, 3, 2, 8, 1]</span><br><span class="line">第 1 次 partition [3, 1, 2, 4, 5, 6, 8, 7]  returned index is: 3</span><br><span class="line">第 2 次 partition [2, 1, 3, 4, 5, 6, 8, 7]  returned index is: 2</span><br><span class="line">第 3 次 partition [1, 2, 3, 4, 5, 6, 8, 7]  returned index is: 1</span><br><span class="line">第 4 次 partition [1, 2, 3, 4, 5, 6, 8, 7]  returned index is: 4</span><br><span class="line">第 5 次 partition [1, 2, 3, 4, 5, 6, 8, 7]  returned index is: 5</span><br><span class="line">第 6 次 partition [1, 2, 3, 4, 5, 6, 7, 8]  returned index is: 7</span><br><span class="line"> After:: [1, 2, 3, 4, 5, 6, 7, 8]</span><br></pre></td></tr></table></figure><h4 id="partition-逻辑图解"><a href="#partition-逻辑图解" class="headerlink" title="partition 逻辑图解"></a>partition 逻辑图解</h4><img src="/2020/04/14/algorithm-quick-sort/quick-sort-partition-flow-chart.svg" class="" title="quick-sort-partition-flow-chart"><h3 id="系统调用-strace-分析"><a href="#系统调用-strace-分析" class="headerlink" title="系统调用 strace 分析"></a>系统调用 strace 分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~# strace -Ti .&#x2F;quickSort </span><br><span class="line">[00007f2ee3f68e37] execve(&quot;.&#x2F;quickSort&quot;, [&quot;.&#x2F;quickSort&quot;], 0x7ffffe4dc528 &#x2F;* 27 vars *&#x2F;) &#x3D; 0 &lt;0.000122&gt;</span><br><span class="line">[00007f0045366ec9] brk(NULL)            &#x3D; 0x55e15d32b000 &lt;0.000006&gt;</span><br><span class="line">[00007f004535a7de] access(&quot;&#x2F;etc&#x2F;ld.so.nohwcap&quot;, F_OK) &#x3D; -1 ENOENT (No such file or directory) &lt;0.000010&gt;</span><br><span class="line">[00007f0045367e27] access(&quot;&#x2F;etc&#x2F;ld.so.preload&quot;, R_OK) &#x3D; -1 ENOENT (No such file or directory) &lt;0.000007&gt;</span><br><span class="line">[00007f0045367cdd] openat(AT_FDCWD, &quot;&#x2F;etc&#x2F;ld.so.cache&quot;, O_RDONLY|O_CLOEXEC) &#x3D; 3 &lt;0.000008&gt;</span><br><span class="line">[00007f0045367c43] fstat(3, &#123;st_mode&#x3D;S_IFREG|0644, st_size&#x3D;39490, ...&#125;) &#x3D; 0 &lt;0.000006&gt;</span><br><span class="line">[00007f0045367f43] mmap(NULL, 39490, PROT_READ, MAP_PRIVATE, 3, 0) &#x3D; 0x7f0045568000 &lt;0.000009&gt;</span><br><span class="line">[00007f0045367ed7] close(3)             &#x3D; 0 &lt;0.000005&gt;</span><br><span class="line">[00007f0045363139] access(&quot;&#x2F;etc&#x2F;ld.so.nohwcap&quot;, F_OK) &#x3D; -1 ENOENT (No such file or directory) &lt;0.000008&gt;</span><br><span class="line">[00007f0045367cdd] openat(AT_FDCWD, &quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;, O_RDONLY|O_CLOEXEC) &#x3D; 3 &lt;0.000012&gt;</span><br><span class="line">[00007f0045367da4] read(3, &quot;\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\260\34\2\0\0\0\0\0&quot;..., 832) &#x3D; 832 &lt;0.000007&gt;</span><br><span class="line">[00007f0045367c43] fstat(3, &#123;st_mode&#x3D;S_IFREG|0755, st_size&#x3D;2030544, ...&#125;) &#x3D; 0 &lt;0.000006&gt;</span><br><span class="line">[00007f0045367f43] mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) &#x3D; 0x7f0045566000 &lt;0.000007&gt;</span><br><span class="line">[00007f0045367f43] mmap(NULL, 4131552, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) &#x3D; 0x7f0044f5a000 &lt;0.000008&gt;</span><br><span class="line">[00007f0045367ff7] mprotect(0x7f0045141000, 2097152, PROT_NONE) &#x3D; 0 &lt;0.000012&gt;</span><br><span class="line">[00007f0045367f43] mmap(0x7f0045341000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1e7000) &#x3D; 0x7f0045341000 &lt;0.000011&gt;</span><br><span class="line">[00007f0045367f43] mmap(0x7f0045347000, 15072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) &#x3D; 0x7f0045347000 &lt;0.000008&gt;</span><br><span class="line">[00007f0045367ed7] close(3)             &#x3D; 0 &lt;0.000007&gt;</span><br><span class="line">[00007f004534c024] arch_prctl(ARCH_SET_FS, 0x7f00455674c0) &#x3D; 0 &lt;0.000006&gt;</span><br><span class="line">[00007f0045367ff7] mprotect(0x7f0045341000, 16384, PROT_READ) &#x3D; 0 &lt;0.000009&gt;</span><br><span class="line">[00007f0045367ff7] mprotect(0x55e15d271000, 4096, PROT_READ) &#x3D; 0 &lt;0.000008&gt;</span><br><span class="line">[00007f0045367ff7] mprotect(0x7f0045572000, 4096, PROT_READ) &#x3D; 0 &lt;0.000011&gt;</span><br><span class="line">[00007f0045367fd7] munmap(0x7f0045568000, 39490) &#x3D; 0 &lt;0.000015&gt;</span><br><span class="line">[00007f00450697c3] fstat(1, &#123;st_mode&#x3D;S_IFCHR|0600, st_rdev&#x3D;makedev(136, 0), ...&#125;) &#x3D; 0 &lt;0.000006&gt;</span><br><span class="line">[00007f00450704b9] brk(NULL)            &#x3D; 0x55e15d32b000 &lt;0.000006&gt;</span><br><span class="line">[00007f00450704b9] brk(0x55e15d34c000)  &#x3D; 0x55e15d34c000 &lt;0.000007&gt;</span><br><span class="line">[00007f004506a154] write(1, &quot;1 2 3 4 5 6 7 8 &quot;, 161 2 3 4 5 6 7 8 ) &#x3D; 16 &lt;0.000024&gt;</span><br><span class="line">[00007f004503ee06] exit_group(0)        &#x3D; ?</span><br><span class="line">[????????????????] +++ exited with 0 +++</span><br></pre></td></tr></table></figure><h3 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h3><ol><li><a href="http://man7.org/linux/man-pages/man2/execve.2.html">system-call-execve</a></li><li><a href="http://man7.org/linux/man-pages/man2/brk.2.html">system-call-brk</a></li><li><a href="http://man7.org/linux/man-pages/man2/access.2.html">system-call-access</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;quick-sort&quot;&gt;&lt;a href=&quot;#quick-sort&quot; class=&quot;headerlink&quot; title=&quot;quick sort&quot;&gt;&lt;/a&gt;quick sort&lt;/h2&gt;&lt;h3 id=&quot;C-代码&quot;&gt;&lt;a href=&quot;#C-代码&quot; class=&quot;head</summary>
      
    
    
    
    
    <category term="algorithm,sort" scheme="http://stardustman.github.io/tags/algorithm-sort/"/>
    
  </entry>
  
  <entry>
    <title>algorithm-merge-sort</title>
    <link href="http://stardustman.github.io/2020/04/10/algorithm-merge-sort/"/>
    <id>http://stardustman.github.io/2020/04/10/algorithm-merge-sort/</id>
    <published>2020-04-10T12:07:39.000Z</published>
    <updated>2020-05-10T11:53:44.132Z</updated>
    
    <content type="html"><![CDATA[<h2 id="merge-sort"><a href="#merge-sort" class="headerlink" title="merge sort"></a>merge sort</h2><h3 id="merge-sort-C-code"><a href="#merge-sort-C-code" class="headerlink" title="merge sort C code"></a>merge sort C code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span>* <span class="built_in">array</span>, <span class="keyword">int</span> start, <span class="keyword">int</span> mid, <span class="keyword">int</span> end)</span></span>&#123;</span><br><span class="line">    <span class="comment">// start = 0</span></span><br><span class="line">    <span class="comment">// mid = 3</span></span><br><span class="line">    <span class="comment">// end = 7</span></span><br><span class="line">    <span class="keyword">int</span> tempArrayLength = end - start + <span class="number">1</span>; <span class="comment">// 8</span></span><br><span class="line">    <span class="keyword">int</span> tempArray[tempArrayLength]; <span class="comment">// tempArray[8]</span></span><br><span class="line">    <span class="keyword">int</span> p1 = start; <span class="comment">// 0</span></span><br><span class="line">    <span class="keyword">int</span> p2 = mid + <span class="number">1</span>; <span class="comment">// 4</span></span><br><span class="line">    <span class="keyword">int</span> p = <span class="number">0</span>;</span><br><span class="line">       <span class="comment">// 比较两个小集合，依次放入大集合, 第一个 while 循环</span></span><br><span class="line">        <span class="keyword">while</span> (p1 &lt;= mid &amp;&amp; p2 &lt;= end)&#123; p1 &lt;=<span class="number">3</span> &amp;&amp; p2 &lt;=<span class="number">7</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">array</span>[p1] &lt;= <span class="built_in">array</span>[p2])&#123; <span class="comment">// 7 &lt;= 5 XXX</span></span><br><span class="line">                tempArray[p++] = <span class="built_in">array</span>[p1++];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                tempArray[p++] = <span class="built_in">array</span>[p2++]; <span class="comment">// tempArray[0] = 5</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 左侧集合还有剩余，依次放入大集合， 第二个 while 循环</span></span><br><span class="line">        <span class="keyword">while</span> (p1 &lt;= mid)&#123; <span class="comment">// 2 &lt;= 2 </span></span><br><span class="line">            tempArray[p++] = <span class="built_in">array</span>[p1++]; tempArray[<span class="number">1</span>] = <span class="number">7</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 右侧集合还有剩余，依次放入大集合，第三个 while 循环</span></span><br><span class="line">        <span class="keyword">while</span> (p2 &lt;= end)&#123; <span class="comment">// 4 &lt;= 3 XXX</span></span><br><span class="line">            tempArray[p++] = <span class="built_in">array</span>[p2++]; <span class="comment">// tempArray[1] = 9</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 大集合复制到原来的数组，for 循环</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tempArrayLength; i++) &#123;</span><br><span class="line">            <span class="built_in">array</span>[i + start] = tempArray[i]; <span class="comment">//  3,9,5,7</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="keyword">int</span>* <span class="built_in">array</span>, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(start &lt; end)&#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (start + end) / <span class="number">2</span>;</span><br><span class="line">        mergeSort(<span class="built_in">array</span>, start, mid); <span class="comment">// mergeSort_L(array, start, mid);</span></span><br><span class="line">        mergeSort(<span class="built_in">array</span>, mid+<span class="number">1</span>, end); <span class="comment">// mergeSort_R(array, mid+1, end);</span></span><br><span class="line">        merge(<span class="built_in">array</span>, start, mid, end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">     <span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">8</span>] = &#123;<span class="number">9</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">10</span>&#125;;</span><br><span class="line">     mergeSort(<span class="built_in">array</span>, <span class="number">0</span> , <span class="number">7</span>);</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="built_in">printf</span>(<span class="string">&quot;%d#&quot;</span>,<span class="built_in">array</span>[i]);</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="x64-汇编代码分析"><a href="#x64-汇编代码分析" class="headerlink" title="x64 汇编代码分析"></a>x64 汇编代码分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br></pre></td><td class="code"><pre><span class="line">mergesort:     file format elf64-x86-64 ; 64bits 汇编代码</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .init:</span><br><span class="line"></span><br><span class="line">0000000000000548 &lt;_init&gt;:</span><br><span class="line"> 548:48 83 ec 08          sub    $0x8,%rsp</span><br><span class="line"> 54c:48 8b 05 95 0a 20 00 mov    0x200a95(%rip),%rax        # 200fe8 &lt;__gmon_start__&gt;</span><br><span class="line"> 553:48 85 c0             test   %rax,%rax</span><br><span class="line"> 556:74 02                je     55a &lt;_init+0x12&gt;</span><br><span class="line"> 558:ff d0                callq  *%rax</span><br><span class="line"> 55a:48 83 c4 08          add    $0x8,%rsp</span><br><span class="line"> 55e:c3                   retq   </span><br><span class="line"></span><br><span class="line">Disassembly of section .plt:</span><br><span class="line"></span><br><span class="line">0000000000000560 &lt;.plt&gt;:</span><br><span class="line"> 560:ff 35 52 0a 20 00    pushq  0x200a52(%rip)        # 200fb8 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;</span><br><span class="line"> 566:ff 25 54 0a 20 00    jmpq   *0x200a54(%rip)        # 200fc0 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;</span><br><span class="line"> 56c:0f 1f 40 00          nopl   0x0(%rax)</span><br><span class="line"></span><br><span class="line">0000000000000570 &lt;__stack_chk_fail@plt&gt;:</span><br><span class="line"> 570:ff 25 52 0a 20 00    jmpq   *0x200a52(%rip)        # 200fc8 &lt;__stack_chk_fail@GLIBC_2.4&gt;</span><br><span class="line"> 576:68 00 00 00 00       pushq  $0x0</span><br><span class="line"> 57b:e9 e0 ff ff ff       jmpq   560 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">0000000000000580 &lt;printf@plt&gt;:</span><br><span class="line"> 580:ff 25 4a 0a 20 00    jmpq   *0x200a4a(%rip)        # 200fd0 &lt;printf@GLIBC_2.2.5&gt;</span><br><span class="line"> 586:68 01 00 00 00       pushq  $0x1</span><br><span class="line"> 58b:e9 d0 ff ff ff       jmpq   560 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">Disassembly of section .plt.got:</span><br><span class="line"></span><br><span class="line">0000000000000590 &lt;__cxa_finalize@plt&gt;:</span><br><span class="line"> 590:ff 25 62 0a 20 00    jmpq   *0x200a62(%rip)        # 200ff8 &lt;__cxa_finalize@GLIBC_2.2.5&gt;</span><br><span class="line"> 596:66 90                xchg   %ax,%ax</span><br><span class="line"></span><br><span class="line">Disassembly of section .text: ; 代码区</span><br><span class="line"></span><br><span class="line">00000000000005a0 &lt;_start&gt;:</span><br><span class="line"> 5a0:31 ed                xor    %ebp,%ebp ; ebp &#x3D; 0</span><br><span class="line"> 5a2:49 89 d1             mov    %rdx,%r9 </span><br><span class="line"> 5a5:5e                   pop    %rsi</span><br><span class="line"> 5a6:48 89 e2             mov    %rsp,%rdx</span><br><span class="line"> 5a9:48 83 e4 f0          and    $0xfffffffffffffff0,%rsp</span><br><span class="line"> 5ad:50                   push   %rax</span><br><span class="line"> 5ae:54                   push   %rsp</span><br><span class="line"> 5af:4c 8d 05 aa 04 00 00 lea    0x4aa(%rip),%r8        # a60 &lt;__libc_csu_fini&gt;</span><br><span class="line"> 5b6:48 8d 0d 33 04 00 00 lea    0x433(%rip),%rcx        # 9f0 &lt;__libc_csu_init&gt;</span><br><span class="line"> 5bd:48 8d 3d 79 03 00 00 lea    0x379(%rip),%rdi        # 93d &lt;main&gt;</span><br><span class="line"> 5c4:ff 15 16 0a 20 00    callq  *0x200a16(%rip)        # 200fe0 &lt;__libc_start_main@GLIBC_2.2.5&gt;</span><br><span class="line"> 5ca:f4                   hlt    </span><br><span class="line"> 5cb:0f 1f 44 00 00       nopl   0x0(%rax,%rax,1)</span><br><span class="line"></span><br><span class="line">00000000000005d0 &lt;deregister_tm_clones&gt;:</span><br><span class="line"> 5d0:48 8d 3d 39 0a 20 00 lea    0x200a39(%rip),%rdi        # 201010 &lt;__TMC_END__&gt;</span><br><span class="line"> 5d7:55                   push   %rbp</span><br><span class="line"> 5d8:48 8d 05 31 0a 20 00 lea    0x200a31(%rip),%rax        # 201010 &lt;__TMC_END__&gt;</span><br><span class="line"> 5df:48 39 f8             cmp    %rdi,%rax</span><br><span class="line"> 5e2:48 89 e5             mov    %rsp,%rbp</span><br><span class="line"> 5e5:74 19                je     600 &lt;deregister_tm_clones+0x30&gt;</span><br><span class="line"> 5e7:48 8b 05 ea 09 20 00 mov    0x2009ea(%rip),%rax        # 200fd8 &lt;_ITM_deregisterTMCloneTable&gt;</span><br><span class="line"> 5ee:48 85 c0             test   %rax,%rax</span><br><span class="line"> 5f1:74 0d                je     600 &lt;deregister_tm_clones+0x30&gt;</span><br><span class="line"> 5f3:5d                   pop    %rbp</span><br><span class="line"> 5f4:ff e0                jmpq   *%rax</span><br><span class="line"> 5f6:66 2e 0f 1f 84 00 00 nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> 5fd:00 00 00 </span><br><span class="line"> 600:5d                   pop    %rbp</span><br><span class="line"> 601:c3                   retq   </span><br><span class="line"> 602:0f 1f 40 00          nopl   0x0(%rax)</span><br><span class="line"> 606:66 2e 0f 1f 84 00 00 nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> 60d:00 00 00 </span><br><span class="line"></span><br><span class="line">0000000000000610 &lt;register_tm_clones&gt;:</span><br><span class="line"> 610:48 8d 3d f9 09 20 00 lea    0x2009f9(%rip),%rdi        # 201010 &lt;__TMC_END__&gt;</span><br><span class="line"> 617:48 8d 35 f2 09 20 00 lea    0x2009f2(%rip),%rsi        # 201010 &lt;__TMC_END__&gt;</span><br><span class="line"> 61e:55                   push   %rbp</span><br><span class="line"> 61f:48 29 fe             sub    %rdi,%rsi</span><br><span class="line"> 622:48 89 e5             mov    %rsp,%rbp</span><br><span class="line"> 625:48 c1 fe 03          sar    $0x3,%rsi</span><br><span class="line"> 629:48 89 f0             mov    %rsi,%rax</span><br><span class="line"> 62c:48 c1 e8 3f          shr    $0x3f,%rax</span><br><span class="line"> 630:48 01 c6             add    %rax,%rsi</span><br><span class="line"> 633:48 d1 fe             sar    %rsi</span><br><span class="line"> 636:74 18                je     650 &lt;register_tm_clones+0x40&gt;</span><br><span class="line"> 638:48 8b 05 b1 09 20 00 mov    0x2009b1(%rip),%rax        # 200ff0 &lt;_ITM_registerTMCloneTable&gt;</span><br><span class="line"> 63f:48 85 c0             test   %rax,%rax</span><br><span class="line"> 642:74 0c                je     650 &lt;register_tm_clones+0x40&gt;</span><br><span class="line"> 644:5d                   pop    %rbp</span><br><span class="line"> 645:ff e0                jmpq   *%rax</span><br><span class="line"> 647:66 0f 1f 84 00 00 00 nopw   0x0(%rax,%rax,1)</span><br><span class="line"> 64e:00 00 </span><br><span class="line"> 650:5d                   pop    %rbp</span><br><span class="line"> 651:c3                   retq   </span><br><span class="line"> 652:0f 1f 40 00          nopl   0x0(%rax)</span><br><span class="line"> 656:66 2e 0f 1f 84 00 00 nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> 65d:00 00 00 </span><br><span class="line"></span><br><span class="line">0000000000000660 &lt;__do_global_dtors_aux&gt;:</span><br><span class="line"> 660:80 3d a9 09 20 00 00 cmpb   $0x0,0x2009a9(%rip)        # 201010 &lt;__TMC_END__&gt;</span><br><span class="line"> 667:75 2f                jne    698 &lt;__do_global_dtors_aux+0x38&gt;</span><br><span class="line"> 669:48 83 3d 87 09 20 00 cmpq   $0x0,0x200987(%rip)        # 200ff8 &lt;__cxa_finalize@GLIBC_2.2.5&gt;</span><br><span class="line"> 670:00 </span><br><span class="line"> 671:55                   push   %rbp</span><br><span class="line"> 672:48 89 e5             mov    %rsp,%rbp</span><br><span class="line"> 675:74 0c                je     683 &lt;__do_global_dtors_aux+0x23&gt;</span><br><span class="line"> 677:48 8b 3d 8a 09 20 00 mov    0x20098a(%rip),%rdi        # 201008 &lt;__dso_handle&gt;</span><br><span class="line"> 67e:e8 0d ff ff ff       callq  590 &lt;__cxa_finalize@plt&gt;</span><br><span class="line"> 683:e8 48 ff ff ff       callq  5d0 &lt;deregister_tm_clones&gt;</span><br><span class="line"> 688:c6 05 81 09 20 00 01 movb   $0x1,0x200981(%rip)        # 201010 &lt;__TMC_END__&gt;</span><br><span class="line"> 68f:5d                   pop    %rbp</span><br><span class="line"> 690:c3                   retq   </span><br><span class="line"> 691:0f 1f 80 00 00 00 00 nopl   0x0(%rax)</span><br><span class="line"> 698:f3 c3                repz retq </span><br><span class="line"> 69a:66 0f 1f 44 00 00    nopw   0x0(%rax,%rax,1)</span><br><span class="line"></span><br><span class="line">00000000000006a0 &lt;frame_dummy&gt;:</span><br><span class="line"> 6a0:55                   push   %rbp</span><br><span class="line"> 6a1:48 89 e5             mov    %rsp,%rbp</span><br><span class="line"> 6a4:5d                   pop    %rbp</span><br><span class="line"> 6a5:e9 66 ff ff ff       jmpq   610 &lt;register_tm_clones&gt;</span><br><span class="line"></span><br><span class="line">00000000000006aa &lt;merge&gt;:</span><br><span class="line"> 6aa:55                   push   %rbp</span><br><span class="line"> 6ab:48 89 e5             mov    %rsp,%rbp ; rbp &#x3D; rsp</span><br><span class="line"> 6ae:48 83 ec 50          sub    $0x50,%rsp ; rsp &#x3D; rsp - 0x50 开辟栈帧</span><br><span class="line"> 6b2:48 89 7d c8          mov    %rdi,-0x38(%rbp) ; 第一个参数 &amp;array[0]</span><br><span class="line"> 6b6:89 75 c4             mov    %esi,-0x3c(%rbp) ; 第二个参数 start</span><br><span class="line"> 6b9:89 55 c0             mov    %edx,-0x40(%rbp) ; 第三个参数 mid</span><br><span class="line"> 6bc:89 4d bc             mov    %ecx,-0x44(%rbp) ; 第四个参数 end</span><br><span class="line"> 6bf:64 48 8b 04 25 28 00 mov    %fs:0x28,%rax ; 哨兵值判定栈帧是否出了问题。</span><br><span class="line"> 6c6:00 00 </span><br><span class="line"> 6c8:48 89 45 f8          mov    %rax,-0x8(%rbp) ; 哨兵值</span><br><span class="line"> 6cc:31 c0                xor    %eax,%eax ; eax &#x3D; 0</span><br><span class="line"> 6ce:48 89 e0             mov    %rsp,%rax ; rax &#x3D; rsp</span><br><span class="line"> 6d1:48 89 c6             mov    %rax,%rsi ; rsi &#x3D; rax &#x3D; rsp 记录这个 rsp 的值</span><br><span class="line"> 6d4:8b 45 bc             mov    -0x44(%rbp),%eax ; eax &#x3D; end</span><br><span class="line"> 6d7:2b 45 c4             sub    -0x3c(%rbp),%eax ; eax &#x3D; end - start</span><br><span class="line"> 6da:83 c0 01             add    $0x1,%eax ; tempArrayLength &#x3D; eax &#x3D; (end - start) + 1</span><br><span class="line"> 6dd:89 45 e4             mov    %eax,-0x1c(%rbp) ; tempArrayLength &#x3D; (end - start) + 1 复制到 rbp - 0x1c 内存处</span><br><span class="line"> 6e0:8b 45 e4             mov    -0x1c(%rbp),%eax ; eax &#x3D; tempArrayLength</span><br><span class="line"> 6e3:48 63 d0             movslq %eax,%rdx ; rdx &#x3D; tempArrayLength, cltq 32bit 扩展为 64bit</span><br><span class="line"> 6e6:48 83 ea 01          sub    $0x1,%rdx ; rdx &#x3D; (tempArrayLength) - 1 &#x3D; end - start</span><br><span class="line"> 6ea:48 89 55 e8          mov    %rdx,-0x18(%rbp) ; end - start 复制到 rbp - 0x18 内存地址处</span><br><span class="line"> 6ee:48 63 d0             movslq %eax,%rdx ; rdx &#x3D; (end - start) + 1 ? tempArrayLength</span><br><span class="line"> 6f1:49 89 d2             mov    %rdx,%r10 ; r10 &#x3D; (end - start) + 1</span><br><span class="line"> 6f4:41 bb 00 00 00 00    mov    $0x0,%r11d ; r11d &#x3D; 0</span><br><span class="line"> 6fa:48 63 d0             movslq %eax,%rdx ; rdx &#x3D; (end - start) + 1 ? tempArrayLength</span><br><span class="line"> 6fd:49 89 d0             mov    %rdx,%r8 ; r8 &#x3D; (end - start) + 1 ? tempArrayLength</span><br><span class="line"> 700:41 b9 00 00 00 00    mov    $0x0,%r9d ; r9d &#x3D; 0</span><br><span class="line"> 706:48 98                cltq   ; 相当于 movslq %eax,%rax.</span><br><span class="line"> 708:48 c1 e0 02          shl    $0x2,%rax ; rax &#x3D; ((end - start) + 1) * 4</span><br><span class="line"> 70c:48 8d 50 03          lea    0x3(%rax),%rdx ; rdx &#x3D; 4 * ((end - start) + 1) + 3 </span><br><span class="line"> 710:b8 10 00 00 00       mov    $0x10,%eax ; eax &#x3D; 16</span><br><span class="line"> 715:48 83 e8 01          sub    $0x1,%rax ; rax &#x3D; 16 - 1 &#x3D; 15</span><br><span class="line"> 719:48 01 d0             add    %rdx,%rax ; rax &#x3D; rax + rdx &#x3D; 15 + 4 * ((end - start) + 1) + 3 &#x3D; 4 * (end - start) + 22</span><br><span class="line"> 71c:bf 10 00 00 00       mov    $0x10,%edi ; edi &#x3D; 16</span><br><span class="line"> 721:ba 00 00 00 00       mov    $0x0,%edx ; edx &#x3D; 0</span><br><span class="line"> 726:48 f7 f7             div    %rdi ; (rdx(high-32bit):rax(low-32bit))&#x2F;rdi , quotient(商) in %rax, remainder(余数) in %rdx</span><br><span class="line"> 729:48 6b c0 10          imul   $0x10,%rax,%rax ; rax &#x3D; rax * 16</span><br><span class="line"> 72d:48 29 c4             sub    %rax,%rsp ; rsp &#x3D; rsp - rax 分配空间</span><br><span class="line"> 730:48 89 e0             mov    %rsp,%rax ; rax &#x3D; rsp</span><br><span class="line"> 733:48 83 c0 03          add    $0x3,%rax ; rax &#x3D; rsp + 3</span><br><span class="line"> 737:48 c1 e8 02          shr    $0x2,%rax ; rax &#x3D; (rsp + 3) &gt;&gt; 2</span><br><span class="line"> 73b:48 c1 e0 02          shl    $0x2,%rax ; rax &#x3D; ((rsp + 3) &gt;&gt; 2) &lt;&lt;2</span><br><span class="line"> 73f:48 89 45 f0          mov    %rax,-0x10(%rbp) ;</span><br><span class="line"> 743:8b 45 c4             mov    -0x3c(%rbp),%eax ; eax &#x3D; start</span><br><span class="line"> 746:89 45 dc             mov    %eax,-0x24(%rbp) ; start 复制到 rbp - 0x24(p1) 处</span><br><span class="line"> 749:8b 45 c0             mov    -0x40(%rbp),%eax ; eax &#x3D; mid</span><br><span class="line"> 74c:83 c0 01             add    $0x1,%eax ; eax &#x3D; mid + 1</span><br><span class="line"> 74f:89 45 d8             mov    %eax,-0x28(%rbp) ; mid + 1 复制到 rbp - 0x28(p2) 处</span><br><span class="line"> 752:c7 45 d4 00 00 00 00 movl   $0x0,-0x2c(%rbp) ; 0 复制到 rbp - 0x2c(p) 处</span><br><span class="line"> 759:e9 90 00 00 00       jmpq   7ee &lt;merge+0x144&gt; ; 无条件跳转, 0x144 表示要跳转出也就是 7ee 距离 merge(6aa) 之间的所有指令字节数是 0x144。。。。。。</span><br><span class="line"></span><br><span class="line"> ; if(array[p1] &lt;&#x3D; array[p2]) 的判定</span><br><span class="line"> 75e:8b 45 dc             mov    -0x24(%rbp),%eax ; rax &#x3D; p1</span><br><span class="line"> 761:48 98                cltq   </span><br><span class="line"> 763:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * p1 + 0</span><br><span class="line"> 76a:00 </span><br><span class="line"> 76b:48 8b 45 c8          mov    -0x38(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 76f:48 01 d0             add    %rdx,%rax ; rax &#x3D; &amp;array[0] + 4 * p1 &#x3D; &amp;array[p1] </span><br><span class="line"> 772:8b 10                mov    (%rax),%edx ; edx &#x3D; array[p1]</span><br><span class="line"> 774:8b 45 d8             mov    -0x28(%rbp),%eax ; eax &#x3D; p2</span><br><span class="line"> 777:48 98                cltq   </span><br><span class="line"> 779:48 8d 0c 85 00 00 00 lea    0x0(,%rax,4),%rcx ; rcx &#x3D; 4 * rax &#x3D; 4 * p2</span><br><span class="line"> 780:00 </span><br><span class="line"> 781:48 8b 45 c8          mov    -0x38(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 785:48 01 c8             add    %rcx,%rax ; rax &#x3D; &amp;array[0] + 4 * p2 &#x3D; &amp;array[p2]</span><br><span class="line"> 788:8b 00                mov    (%rax),%eax ; eax &#x3D; array[p2]</span><br><span class="line"> 78a:39 c2                cmp    %eax,%edx ; cmp array[p2],array[p1]</span><br><span class="line"> 78c:7f 31                jg     7bf &lt;merge+0x115&gt; ; array[p1] &gt; array[p2] 跳到 else</span><br><span class="line"> 78e:8b 45 dc             mov    -0x24(%rbp),%eax ; eax &#x3D; p1</span><br><span class="line"> 791:8d 50 01             lea    0x1(%rax),%edx ; edx &#x3D; p1 + 1</span><br><span class="line"> 794:89 55 dc             mov    %edx,-0x24(%rbp) ; p1 &#x3D; p1 + 1</span><br><span class="line"> 797:48 98                cltq   </span><br><span class="line"> 799:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * p1</span><br><span class="line"> 7a0:00 </span><br><span class="line"> 7a1:48 8b 45 c8          mov    -0x38(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 7a5:48 8d 0c 02          lea    (%rdx,%rax,1),%rcx ; rcx &#x3D; &amp;array[0] + 4 * p1 &#x3D; &amp;array[p1]</span><br><span class="line"> 7a9:8b 45 d4             mov    -0x2c(%rbp),%eax ; eax &#x3D; p</span><br><span class="line"> 7ac:8d 50 01             lea    0x1(%rax),%edx ; edx &#x3D; p + 1</span><br><span class="line"> 7af:89 55 d4             mov    %edx,-0x2c(%rbp) ; p &#x3D; p + 1</span><br><span class="line"> 7b2:8b 09                mov    (%rcx),%ecx ; ecx &#x3D; array[p1]</span><br><span class="line"> 7b4:48 8b 55 f0          mov    -0x10(%rbp),%rdx ;rdx &#x3D; &amp;tempArray[0]</span><br><span class="line"> 7b8:48 98                cltq   </span><br><span class="line"> 7ba:89 0c 82             mov    %ecx,(%rdx,%rax,4) ; tempArray[p] &#x3D; array[p1]</span><br><span class="line"> 7bd:eb 2f                jmp    7ee &lt;merge+0x144&gt; ; 开启下一轮判定&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line"> 7bf:8b 45 d8             mov    -0x28(%rbp),%eax ; eax &#x3D; p2 $$$ begin else array[p1] &gt; array[p2]</span><br><span class="line"> 7c2:8d 50 01             lea    0x1(%rax),%edx ; edx &#x3D; p2 + 1</span><br><span class="line"> 7c5:89 55 d8             mov    %edx,-0x28(%rbp) ; p2 &#x3D; p2 + 1</span><br><span class="line"> 7c8:48 98                cltq   </span><br><span class="line"> 7ca:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * p2</span><br><span class="line"> 7d1:00 </span><br><span class="line"> 7d2:48 8b 45 c8          mov    -0x38(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 7d6:48 8d 0c 02          lea    (%rdx,%rax,1),%rcx ; rcx &#x3D; rdx + 1 * rax &#x3D; &amp;array[0] + 4 * p2 &#x3D; &amp;array[p2] </span><br><span class="line"> 7da:8b 45 d4             mov    -0x2c(%rbp),%eax ; eax &#x3D; p</span><br><span class="line"> 7dd:8d 50 01             lea    0x1(%rax),%edx ; edx &#x3D; p + 1</span><br><span class="line"> 7e0:89 55 d4             mov    %edx,-0x2c(%rbp) ; p &#x3D; p + 1</span><br><span class="line"> 7e3:8b 09                mov    (%rcx),%ecx ; ecx &#x3D; array[p2]</span><br><span class="line"> 7e5:48 8b 55 f0          mov    -0x10(%rbp),%rdx ; rdx &#x3D; &amp;tempArray[0] , 临时数组地址</span><br><span class="line"> 7e9:48 98                cltq   </span><br><span class="line"> 7eb:89 0c 82             mov    %ecx,(%rdx,%rax,4) ; tempArray[p] &#x3D; array[p2] $$$$$ end else</span><br><span class="line"> 7ee:8b 45 dc             mov    -0x24(%rbp),%eax ; eax &#x3D; p1  下一轮判定&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line"> 7f1:3b 45 c0             cmp    -0x40(%rbp),%eax ; cmp mid,p1</span><br><span class="line"> 7f4:7f 3d                jg     833 &lt;merge+0x189&gt; ;   p1 &gt; mid 跳出去 </span><br><span class="line"> 7f6:8b 45 d8             mov    -0x28(%rbp),%eax ; eax &#x3D; p2 此时 p1 &lt;&#x3D; mid, 判定 p2 &lt;&#x3D; end 吗？</span><br><span class="line"> 7f9:3b 45 bc             cmp    -0x44(%rbp),%eax ; cmp end,p2</span><br><span class="line"> 7fc:0f 8e 5c ff ff ff    jle    75e &lt;merge+0xb4&gt; ; 此时 p1 &lt;&#x3D; mid,p2 &lt;&#x3D; end，进入 if。 </span><br><span class="line"> 802:eb 2f                jmp    833 &lt;merge+0x189&gt;; 不满足第一个 while 循环，进入第二个 while 循环</span><br><span class="line"></span><br><span class="line">; p1 &lt;&#x3D; mid 循环体开始</span><br><span class="line"> 804:8b 45 dc             mov    -0x24(%rbp),%eax ; eax &#x3D; p1 </span><br><span class="line"> 807:8d 50 01             lea    0x1(%rax),%edx ; edx &#x3D; p1 + 1</span><br><span class="line"> 80a:89 55 dc             mov    %edx,-0x24(%rbp) ; p1 &#x3D; p1 + 1 ####</span><br><span class="line"> 80d:48 98                cltq   ; movslq %eax,%rax</span><br><span class="line"> 80f:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * p1</span><br><span class="line"> 816:00 </span><br><span class="line"> 817:48 8b 45 c8          mov    -0x38(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 81b:48 8d 0c 02          lea    (%rdx,%rax,1),%rcx ; rcx &#x3D; &amp;array[p1]</span><br><span class="line"> 81f:8b 45 d4             mov    -0x2c(%rbp),%eax ; eax &#x3D; p</span><br><span class="line"> 822:8d 50 01             lea    0x1(%rax),%edx ; edx &#x3D; p + 1</span><br><span class="line"> 825:89 55 d4             mov    %edx,-0x2c(%rbp) ; p &#x3D; p + 1 </span><br><span class="line"> 828:8b 09                mov    (%rcx),%ecx ; ecx &#x3D; array[p1]</span><br><span class="line"> 82a:48 8b 55 f0          mov    -0x10(%rbp),%rdx ; rdx &#x3D; &amp;tempArray[0] </span><br><span class="line"> 82e:48 98                cltq   </span><br><span class="line"> 830:89 0c 82             mov    %ecx,(%rdx,%rax,4) ; tempArray[p] &#x3D; array[p1]</span><br><span class="line"></span><br><span class="line">; 第二个 while 循环 也就是 while(p1 &lt;&#x3D; mid)</span><br><span class="line"> 833:8b 45 dc             mov    -0x24(%rbp),%eax ; eax &#x3D; p1  </span><br><span class="line"> 836:3b 45 c0             cmp    -0x40(%rbp),%eax ; cmp mid, p1 判定 p1 &lt;&#x3D; mid 吗？</span><br><span class="line"> 839:7e c9                jle    804 &lt;merge+0x15a&gt; ;  p1 &lt;&#x3D; mid</span><br><span class="line">; p1 &lt;&#x3D; mid 循环体结束</span><br><span class="line"></span><br><span class="line"> 83b:eb 2f                jmp    86c &lt;merge+0x1c2&gt; ; 第二个 while 循环的 p1 &lt;&#x3D; mid不满足， 短路。直接进入第三个while(p2 &lt;&#x3D; end) </span><br><span class="line"></span><br><span class="line">; p2 &lt;&#x3D; end 的循环体开始</span><br><span class="line"> 83d:8b 45 d8             mov    -0x28(%rbp),%eax ; eax &#x3D; p2</span><br><span class="line"> 840:8d 50 01             lea    0x1(%rax),%edx ; edx &#x3D; p2 + 1</span><br><span class="line"> 843:89 55 d8             mov    %edx,-0x28(%rbp) ; p &#x3D; p2 + 1</span><br><span class="line"> 846:48 98                cltq   </span><br><span class="line"> 848:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * p2</span><br><span class="line"> 84f:00 </span><br><span class="line"> 850:48 8b 45 c8          mov    -0x38(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 854:48 8d 0c 02          lea    (%rdx,%rax,1),%rcx ; rcx &#x3D; &amp;array[0] + 4 * p2 &#x3D; &amp;array[p2]</span><br><span class="line"> 858:8b 45 d4             mov    -0x2c(%rbp),%eax ; eax &#x3D; p</span><br><span class="line"> 85b:8d 50 01             lea    0x1(%rax),%edx ; eax &#x3D; p + 1</span><br><span class="line"> 85e:89 55 d4             mov    %edx,-0x2c(%rbp) ; p &#x3D; p + 1</span><br><span class="line"> 861:8b 09                mov    (%rcx),%ecx ; ecx &#x3D; array[p2]</span><br><span class="line"> 863:48 8b 55 f0          mov    -0x10(%rbp),%rdx ;rdx &#x3D; &amp;tempArray[0]</span><br><span class="line"> 867:48 98                cltq   </span><br><span class="line"> 869:89 0c 82             mov    %ecx,(%rdx,%rax,4) ; tempArray[p] &#x3D; array[p2]</span><br><span class="line"></span><br><span class="line"> ; 第三个 while 循环</span><br><span class="line"> 86c:8b 45 d8             mov    -0x28(%rbp),%eax ; eax &#x3D; p2 开始判定 p2 &lt;&#x3D; end 吗？</span><br><span class="line"> 86f:3b 45 bc             cmp    -0x44(%rbp),%eax ; cmp end, p2</span><br><span class="line"> 872:7e c9                jle    83d &lt;merge+0x193&gt; ; 满足 p2 &lt;&#x3D; end，第三个 while 循环</span><br><span class="line"></span><br><span class="line"> ; p2 &gt; end</span><br><span class="line"> 874:c7 45 e0 00 00 00 00 movl   $0x0,-0x20(%rbp) ; 此时 p2 &gt; end 了。i &#x3D; 0</span><br><span class="line"> 87b:eb 2d                jmp    8aa &lt;merge+0x200&gt;  ; 直接跳到 for 循环</span><br><span class="line"></span><br><span class="line">; for(int i &#x3D; 0; i &lt; tempArrayLength; i++) 开始</span><br><span class="line"> 87d:8b 55 e0             mov    -0x20(%rbp),%edx ; edx &#x3D; i</span><br><span class="line"> 880:8b 45 c4             mov    -0x3c(%rbp),%eax ; eax &#x3D; start</span><br><span class="line"> 883:01 d0                add    %edx,%eax ; eax &#x3D; start + i</span><br><span class="line"> 885:48 98                cltq   </span><br><span class="line"> 887:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx ; rdx &#x3D; 4 * (start + i)</span><br><span class="line"> 88e:00 </span><br><span class="line"> 88f:48 8b 45 c8          mov    -0x38(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 893:48 8d 0c 02          lea    (%rdx,%rax,1),%rcx ; rcx &#x3D; array[start + i] </span><br><span class="line"> 897:48 8b 45 f0          mov    -0x10(%rbp),%rax ; rax &#x3D; &amp;tempArray[0]</span><br><span class="line"> 89b:8b 55 e0             mov    -0x20(%rbp),%edx ; edx &#x3D; i</span><br><span class="line"> 89e:48 63 d2             movslq %edx,%rdx</span><br><span class="line"> 8a1:8b 04 90             mov    (%rax,%rdx,4),%eax ; eax &#x3D; tempArray[i]</span><br><span class="line"> 8a4:89 01                mov    %eax,(%rcx) ; array[start + i] &#x3D; tempArray[i];</span><br><span class="line"> 8a6:83 45 e0 01          addl   $0x1,-0x20(%rbp) ; i &#x3D; i + 1</span><br><span class="line"> ; 判定 i &lt; tempArrayLength 吗？</span><br><span class="line"> 8aa:8b 45 e0             mov    -0x20(%rbp),%eax ; eax &#x3D; i </span><br><span class="line"> 8ad:3b 45 e4             cmp    -0x1c(%rbp),%eax ; cmp tempArrayLength, i</span><br><span class="line"> 8b0:7c cb                jl     87d &lt;merge+0x1d3&gt; ; i &lt; tempArrayLength</span><br><span class="line">; for(int i &#x3D; 0; i &lt; tempArrayLength; i++) 结束</span><br><span class="line"></span><br><span class="line">; 此时 i &gt;&#x3D; tempArrayLength 了。</span><br><span class="line"> 8b2:48 89 f4             mov    %rsi,%rsp ; rsp &#x3D; rsi(记录的 rsp 的值) i &gt;&#x3D; tempArrayLength</span><br><span class="line"> 8b5:90                   nop</span><br><span class="line"> 8b6:48 8b 45 f8          mov    -0x8(%rbp),%rax ; rax &#x3D; %fs:0x28</span><br><span class="line"> 8ba:64 48 33 04 25 28 00 xor    %fs:0x28,%rax ;The OF and CF flags are cleared; the SF, ZF, and PF flags are set according to the result. The state of the AF flag is undefined.</span><br><span class="line"> 8c1:00 00 </span><br><span class="line"> 8c3:74 05                je     8ca &lt;merge+0x220&gt; ; ZF &#x3D; 0 说明栈帧没出问题，退出函数。</span><br><span class="line"> 8c5:e8 a6 fc ff ff       callq  570 &lt;__stack_chk_fail@plt&gt; ; 能执行到这说明栈帧出问题了。。。</span><br><span class="line"></span><br><span class="line"> 8ca:c9                   leaveq </span><br><span class="line"> 8cb:c3                   retq   </span><br><span class="line"></span><br><span class="line">00000000000008cc &lt;mergeSort&gt;:</span><br><span class="line"> 8cc:55                   push   %rbp</span><br><span class="line"> 8cd:48 89 e5             mov    %rsp,%rbp ; rbp &#x3D; rsp</span><br><span class="line"> 8d0:48 83 ec 20          sub    $0x20,%rsp ; rsp &#x3D; rsp - 0x20</span><br><span class="line"> 8d4:48 89 7d e8          mov    %rdi,-0x18(%rbp) ;&amp;array[0] 复制到 rbp - 0x18 地址处</span><br><span class="line"> 8d8:89 75 e4             mov    %esi,-0x1c(%rbp) ;第二个参数 (start) 复制到 rbp -0x1c 地址处</span><br><span class="line"> 8db:89 55 e0             mov    %edx,-0x20(%rbp) ;第三个参数 (end) 复制到 rbp -0x20 地址处</span><br><span class="line"> 8de:8b 45 e4             mov    -0x1c(%rbp),%eax ;eax &#x3D; start</span><br><span class="line"> 8e1:3b 45 e0             cmp    -0x20(%rbp),%eax ;cmp end,start </span><br><span class="line"> 8e4:7d 54                jge    93a &lt;mergeSort+0x6e&gt; ; start &gt;&#x3D; end，直接退出函数。</span><br><span class="line"> 8e6:8b 55 e4             mov    -0x1c(%rbp),%edx ; edx &#x3D; start 此时 start &lt; end </span><br><span class="line"> 8e9:8b 45 e0             mov    -0x20(%rbp),%eax ; eax &#x3D; end</span><br><span class="line"> 8ec:01 d0                add    %edx,%eax ; eax &#x3D; start + end</span><br><span class="line"> 8ee:89 c2                mov    %eax,%edx ; edx &#x3D; start + end</span><br><span class="line"> 8f0:c1 ea 1f             shr    $0x1f,%edx ; edx &#x3D; edx &gt;&gt; 31 (start + end)&#x2F;pow(2,31) 相当于是 0 了😂</span><br><span class="line"> 8f3:01 d0                add    %edx,%eax ; eax &#x3D; (start + end) + 0</span><br><span class="line"> 8f5:d1 f8                sar    %eax ; eax &#x3D; (start + end) &#x2F; 2 算术右移一位，最高位补上 eax 的符号位</span><br><span class="line"> 8f7:89 45 fc             mov    %eax,-0x4(%rbp) ; mid &#x3D; (start + end) &#x2F; 2 复制到 rbp - 0x4 内存地址处</span><br><span class="line"> 8fa:8b 55 fc             mov    -0x4(%rbp),%edx ; edx &#x3D; mid(start + end) &#x2F; 2 也就是准备第三个参数 mid</span><br><span class="line"> 8fd:8b 4d e4             mov    -0x1c(%rbp),%ecx ; ecx &#x3D; start</span><br><span class="line"> 900:48 8b 45 e8          mov    -0x18(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 904:89 ce                mov    %ecx,%esi ; esi &#x3D; start ; 第二个参数</span><br><span class="line"> 906:48 89 c7             mov    %rax,%rdi ; rdi &#x3D; &amp;array[0] ; 第一个参数</span><br><span class="line"> 909:e8 be ff ff ff       callq  8cc &lt;mergeSort&gt; ; 调用 mergeSort 左侧 mergeSort</span><br><span class="line"></span><br><span class="line"> 90e:8b 45 fc             mov    -0x4(%rbp),%eax ; eax &#x3D; mid &#x3D; (start + end) &#x2F; 2</span><br><span class="line"> 911:8d 48 01             lea    0x1(%rax),%ecx  ; mid &#x3D; mid + 1 </span><br><span class="line"> 914:8b 55 e0             mov    -0x20(%rbp),%edx ; edx &#x3D; end 第三个参数</span><br><span class="line"> 917:48 8b 45 e8          mov    -0x18(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 91b:89 ce                mov    %ecx,%esi ; esi &#x3D; mid 第二个参数</span><br><span class="line"> 91d:48 89 c7             mov    %rax,%rdi ; rdi &#x3D; &amp;array[0] 第一个参数</span><br><span class="line"> 920:e8 a7 ff ff ff       callq  8cc &lt;mergeSort&gt; ; 调用 mergeSort 右侧 mergeSort</span><br><span class="line"></span><br><span class="line"> 925:8b 4d e0             mov    -0x20(%rbp),%ecx ; ecx &#x3D; end ; 第四个参数</span><br><span class="line"> 928:8b 55 fc             mov    -0x4(%rbp),%edx ; edx &#x3D; mid &#x3D; (start + end) &#x2F; 2 第三个参数</span><br><span class="line"> 92b:8b 75 e4             mov    -0x1c(%rbp),%esi ; esi &#x3D; start ; 第二个参数</span><br><span class="line"> 92e:48 8b 45 e8          mov    -0x18(%rbp),%rax ; rax &#x3D; &amp;array[0] </span><br><span class="line"> 932:48 89 c7             mov    %rax,%rdi ; rdi &#x3D; rax  ; 第一个参数</span><br><span class="line"> 935:e8 70 fd ff ff       callq  6aa &lt;merge&gt; ; 调用 merge 开始 merge</span><br><span class="line"></span><br><span class="line"> 93a:90                   nop ; 从此处销毁栈帧</span><br><span class="line"> 93b:c9                   leaveq &#x2F;&#x2F; 销毁栈帧，相当于 rsp &#x3D; rbp，pop rbp</span><br><span class="line"> 93c:c3                   retq   </span><br><span class="line"></span><br><span class="line">000000000000093d &lt;main&gt;:</span><br><span class="line"> 93d:55                   push   %rbp</span><br><span class="line"> 93e:48 89 e5             mov    %rsp,%rbp</span><br><span class="line"> 941:48 83 ec 40          sub    $0x40,%rsp</span><br><span class="line"> 945:64 48 8b 04 25 28 00 mov    %fs:0x28,%rax</span><br><span class="line"> 94c:00 00 </span><br><span class="line"> 94e:48 89 45 f8          mov    %rax,-0x8(%rbp)</span><br><span class="line"> 952:31 c0                xor    %eax,%eax</span><br><span class="line"> 954:c7 45 d0 09 00 00 00 movl   $0x9,-0x30(%rbp) ; 0x9 复制到 rbp - 0x30 地址处。array[0] &#x3D; 0x9</span><br><span class="line"> 95b:c7 45 d4 03 00 00 00 movl   $0x3,-0x2c(%rbp) ; 0x3 复制到 rbp - 0x2c 地址处。array[1] &#x3D; 0x3</span><br><span class="line"> 962:c7 45 d8 07 00 00 00 movl   $0x7,-0x28(%rbp) ; 0x7 复制到 rbp - 0x28 地址处。array[2] &#x3D; 0x7</span><br><span class="line"> 969:c7 45 dc 05 00 00 00 movl   $0x5,-0x24(%rbp) ; 0x5 复制到 rbp - 0x24 地址处。array[3] &#x3D; 0x5</span><br><span class="line"> 970:c7 45 e0 08 00 00 00 movl   $0x8,-0x20(%rbp) ; 0x8 复制到 rbp - 0x20 地址处。array[4] &#x3D; 0x8</span><br><span class="line"> 977:c7 45 e4 06 00 00 00 movl   $0x6,-0x1c(%rbp) ; 0x6 复制到 rbp - 0x1c 地址处。array[5] &#x3D; 0x6</span><br><span class="line"> 97e:c7 45 e8 04 00 00 00 movl   $0x4,-0x18(%rbp) ; 0x4 复制到 rbp - 0x28 地址处。array[6] &#x3D; 0x4</span><br><span class="line"> 985:c7 45 ec 0a 00 00 00 movl   $0xa,-0x14(%rbp) ; 0xa 复制到 rbp - 0x14 地址处。array[7] &#x3D; 0xa</span><br><span class="line"> 98c:48 8d 45 d0          lea    -0x30(%rbp),%rax ; rax &#x3D; &amp;array[0]</span><br><span class="line"> 990:ba 07 00 00 00       mov    $0x7,%edx ; 第三个参数 7</span><br><span class="line"> 995:be 00 00 00 00       mov    $0x0,%esi ; 第二个参数 0</span><br><span class="line"> 99a:48 89 c7             mov    %rax,%rdi ; 第一个参数 &amp;array[0]</span><br><span class="line"> 99d:e8 2a ff ff ff       callq  8cc &lt;mergeSort&gt; ; 调用 mergeSort，地址偏移是 0x8cc</span><br><span class="line"> 9a2:c7 45 cc 00 00 00 00 movl   $0x0,-0x34(%rbp)</span><br><span class="line"> 9a9:eb 20                jmp    9cb &lt;main+0x8e&gt;</span><br><span class="line"> 9ab:8b 45 cc             mov    -0x34(%rbp),%eax</span><br><span class="line"> 9ae:48 98                cltq   </span><br><span class="line"> 9b0:8b 44 85 d0          mov    -0x30(%rbp,%rax,4),%eax</span><br><span class="line"> 9b4:89 c6                mov    %eax,%esi</span><br><span class="line"> 9b6:48 8d 3d b7 00 00 00 lea    0xb7(%rip),%rdi        # a74 &lt;_IO_stdin_used+0x4&gt;</span><br><span class="line"> 9bd:b8 00 00 00 00       mov    $0x0,%eax</span><br><span class="line"> 9c2:e8 b9 fb ff ff       callq  580 &lt;printf@plt&gt;</span><br><span class="line"> 9c7:83 45 cc 01          addl   $0x1,-0x34(%rbp)</span><br><span class="line"> 9cb:83 7d cc 07          cmpl   $0x7,-0x34(%rbp)</span><br><span class="line"> 9cf:7e da                jle    9ab &lt;main+0x6e&gt;</span><br><span class="line"> 9d1:b8 00 00 00 00       mov    $0x0,%eax</span><br><span class="line"> 9d6:48 8b 4d f8          mov    -0x8(%rbp),%rcx</span><br><span class="line"> 9da:64 48 33 0c 25 28 00 xor    %fs:0x28,%rcx</span><br><span class="line"> 9e1:00 00 </span><br><span class="line"> 9e3:74 05                je     9ea &lt;main+0xad&gt;</span><br><span class="line"> 9e5:e8 86 fb ff ff       callq  570 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line"> 9ea:c9                   leaveq </span><br><span class="line"> 9eb:c3                   retq   </span><br><span class="line"> 9ec:0f 1f 40 00          nopl   0x0(%rax)</span><br><span class="line"></span><br><span class="line">00000000000009f0 &lt;__libc_csu_init&gt;:</span><br><span class="line"> 9f0:41 57                push   %r15</span><br><span class="line"> 9f2:41 56                push   %r14</span><br><span class="line"> 9f4:49 89 d7             mov    %rdx,%r15</span><br><span class="line"> 9f7:41 55                push   %r13</span><br><span class="line"> 9f9:41 54                push   %r12</span><br><span class="line"> 9fb:4c 8d 25 ae 03 20 00 lea    0x2003ae(%rip),%r12        # 200db0 &lt;__frame_dummy_init_array_entry&gt;</span><br><span class="line"> a02:55                   push   %rbp</span><br><span class="line"> a03:48 8d 2d ae 03 20 00 lea    0x2003ae(%rip),%rbp        # 200db8 &lt;__init_array_end&gt;</span><br><span class="line"> a0a:53                   push   %rbx</span><br><span class="line"> a0b:41 89 fd             mov    %edi,%r13d</span><br><span class="line"> a0e:49 89 f6             mov    %rsi,%r14</span><br><span class="line"> a11:4c 29 e5             sub    %r12,%rbp</span><br><span class="line"> a14:48 83 ec 08          sub    $0x8,%rsp</span><br><span class="line"> a18:48 c1 fd 03          sar    $0x3,%rbp</span><br><span class="line"> a1c:e8 27 fb ff ff       callq  548 &lt;_init&gt;</span><br><span class="line"> a21:48 85 ed             test   %rbp,%rbp</span><br><span class="line"> a24:74 20                je     a46 &lt;__libc_csu_init+0x56&gt;</span><br><span class="line"> a26:31 db                xor    %ebx,%ebx</span><br><span class="line"> a28:0f 1f 84 00 00 00 00 nopl   0x0(%rax,%rax,1)</span><br><span class="line"> a2f:00 </span><br><span class="line"> a30:4c 89 fa             mov    %r15,%rdx</span><br><span class="line"> a33:4c 89 f6             mov    %r14,%rsi</span><br><span class="line"> a36:44 89 ef             mov    %r13d,%edi</span><br><span class="line"> a39:41 ff 14 dc          callq  *(%r12,%rbx,8)</span><br><span class="line"> a3d:48 83 c3 01          add    $0x1,%rbx</span><br><span class="line"> a41:48 39 dd             cmp    %rbx,%rbp</span><br><span class="line"> a44:75 ea                jne    a30 &lt;__libc_csu_init+0x40&gt;</span><br><span class="line"> a46:48 83 c4 08          add    $0x8,%rsp</span><br><span class="line"> a4a:5b                   pop    %rbx</span><br><span class="line"> a4b:5d                   pop    %rbp</span><br><span class="line"> a4c:41 5c                pop    %r12</span><br><span class="line"> a4e:41 5d                pop    %r13</span><br><span class="line"> a50:41 5e                pop    %r14</span><br><span class="line"> a52:41 5f                pop    %r15</span><br><span class="line"> a54:c3                   retq   </span><br><span class="line"> a55:90                   nop</span><br><span class="line"> a56:66 2e 0f 1f 84 00 00 nopw   %cs:0x0(%rax,%rax,1)</span><br><span class="line"> a5d:00 00 00 </span><br><span class="line"></span><br><span class="line">0000000000000a60 &lt;__libc_csu_fini&gt;:</span><br><span class="line"> a60:f3 c3                repz retq </span><br><span class="line"></span><br><span class="line">Disassembly of section .fini:</span><br><span class="line"></span><br><span class="line">0000000000000a64 &lt;_fini&gt;:</span><br><span class="line"> a64:48 83 ec 08          sub    $0x8,%rsp</span><br><span class="line"> a68:48 83 c4 08          add    $0x8,%rsp</span><br><span class="line"> a6c:c3                   retq   </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="栈帧调用图解分析"><a href="#栈帧调用图解分析" class="headerlink" title="栈帧调用图解分析"></a>栈帧调用图解分析</h3><img src="/2020/04/10/algorithm-merge-sort/merge-sort-stack-frame-analysis.svg" class="" title="merge-sort-stack-frame-analysis"><blockquote><p>栈帧图分析<br>mergeSort_L 对应的是左半侧的 merge。mid 为红色<br>mergeSort_R 对应的是右半侧的 merge。mid 为蓝色<br>merge 对应的是最下层的浅绿色，绿色，深绿色</p></blockquote><h3 id="array-归并顺序图解分析"><a href="#array-归并顺序图解分析" class="headerlink" title="array 归并顺序图解分析"></a>array 归并顺序图解分析</h3><img src="/2020/04/10/algorithm-merge-sort/merge-sort-analysis.svg" class="" title="merge-sort-analysis"><blockquote><p>可以看到对于 array 来说，确实是一半一半 <code>merge</code> 的, 这就是分治。</p></blockquote><h3 id="strace-分析"><a href="#strace-分析" class="headerlink" title="strace 分析"></a>strace 分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~# strace .&#x2F;mergesort </span><br><span class="line">execve(&quot;.&#x2F;mergesort&quot;, [&quot;.&#x2F;mergesort&quot;], 0x7fff5d5bf0c0 &#x2F;* 27 vars *&#x2F;) &#x3D; 0</span><br><span class="line">brk(NULL)                               &#x3D; 0x5583b9756000</span><br><span class="line">access(&quot;&#x2F;etc&#x2F;ld.so.nohwcap&quot;, F_OK)      &#x3D; -1 ENOENT (No such file or directory)</span><br><span class="line">access(&quot;&#x2F;etc&#x2F;ld.so.preload&quot;, R_OK)      &#x3D; -1 ENOENT (No such file or directory)</span><br><span class="line">openat(AT_FDCWD, &quot;&#x2F;etc&#x2F;ld.so.cache&quot;, O_RDONLY|O_CLOEXEC) &#x3D; 3</span><br><span class="line">fstat(3, &#123;st_mode&#x3D;S_IFREG|0644, st_size&#x3D;39490, ...&#125;) &#x3D; 0</span><br><span class="line">mmap(NULL, 39490, PROT_READ, MAP_PRIVATE, 3, 0) &#x3D; 0x7f4ed0097000</span><br><span class="line">close(3)                                &#x3D; 0</span><br><span class="line">access(&quot;&#x2F;etc&#x2F;ld.so.nohwcap&quot;, F_OK)      &#x3D; -1 ENOENT (No such file or directory)</span><br><span class="line">openat(AT_FDCWD, &quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6&quot;, O_RDONLY|O_CLOEXEC) &#x3D; 3</span><br><span class="line">read(3, &quot;\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\260\34\2\0\0\0\0\0&quot;..., 832) &#x3D; 832</span><br><span class="line">fstat(3, &#123;st_mode&#x3D;S_IFREG|0755, st_size&#x3D;2030544, ...&#125;) &#x3D; 0</span><br><span class="line">mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) &#x3D; 0x7f4ed0095000</span><br><span class="line">mmap(NULL, 4131552, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) &#x3D; 0x7f4ecfa89000</span><br><span class="line">mprotect(0x7f4ecfc70000, 2097152, PROT_NONE) &#x3D; 0</span><br><span class="line">mmap(0x7f4ecfe70000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1e7000) &#x3D; 0x7f4ecfe70000</span><br><span class="line">mmap(0x7f4ecfe76000, 15072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) &#x3D; 0x7f4ecfe76000</span><br><span class="line">close(3)                                &#x3D; 0</span><br><span class="line">arch_prctl(ARCH_SET_FS, 0x7f4ed00964c0) &#x3D; 0</span><br><span class="line">mprotect(0x7f4ecfe70000, 16384, PROT_READ) &#x3D; 0</span><br><span class="line">mprotect(0x5583b9675000, 4096, PROT_READ) &#x3D; 0</span><br><span class="line">mprotect(0x7f4ed00a1000, 4096, PROT_READ) &#x3D; 0</span><br><span class="line">munmap(0x7f4ed0097000, 39490)           &#x3D; 0</span><br><span class="line">fstat(1, &#123;st_mode&#x3D;S_IFCHR|0600, st_rdev&#x3D;makedev(136, 0), ...&#125;) &#x3D; 0</span><br><span class="line">brk(NULL)                               &#x3D; 0x5583b9756000</span><br><span class="line">brk(0x5583b9777000)                     &#x3D; 0x5583b9777000</span><br><span class="line">write(1, &quot;3 4 5 6 7 8 9 10 &quot;, 173 4 5 6 7 8 9 10 )       &#x3D; 17</span><br><span class="line">exit_group(0)                           &#x3D; ?</span><br><span class="line">+++ exited with 0 +++</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><ol><li><a href="https://stackoverflow.com/questions/10325713/why-does-this-memory-address-fs0x28-fs0x28-have-a-random-value">why-does-this-memory-address-fs0x28-fs0x28-have-a-random-value</a></li><li><a href="https://stackoverflow.com/questions/1345670/stack-smashing-detected">stack-smashing</a></li><li><a href="https://www.aldeid.com/wiki/X86-assembly/Instructions/jge">jge</a></li><li><a href="https://www.aldeid.com/wiki/X86-assembly/Instructions/cmp">cmp</a></li><li><a href="https://www.cs.yale.edu/flint/cs421/papers/x86-asm/asm.html">assembly-guide</a></li><li><a href="http://www.c-jump.com/CIS77/ASM/Flags/F77_0160_sar_instruction.htm">Shift Arithmetic Right</a></li><li><a href="https://stackoverflow.com/questions/29790175/assembly-x86-leave-instruction/29790275">x86-asm-leave</a></li><li><a href="https://web.stanford.edu/class/archive/cs/cs107/cs107.1166/guide_x86-64.html">x86-instructions-guide</a></li><li><a href="https://www.lri.fr/~filliatr/ens/compil/x86-64.pdf">Notes on x86-64 programming</a></li><li><a href="https://www.felixcloutier.com/x86/imul">x86-multiply</a></li><li><a href="https://cs.brown.edu/courses/cs033/docs/guides/x64_cheatsheet.pdf">x64_cheatsheet</a></li><li><a href="https://web.stanford.edu/class/archive/cs/cs107/cs107.1196/lectures/">CS107 Spring 2019</a></li><li><a href="https://web.stanford.edu/class/archive/cs/cs107/cs107.1196/lectures/12/Lecture12.pdf">CS107, Lecture 12 Assembly: Arithmetic, Logic and Condition Codes</a></li><li><a href="https://riptutorial.com/x86/example/6976/flags-register">x86-flags</a></li><li><a href="https://c9x.me/x86/html/file_module_x86_id_330.html">xor</a></li><li><a href="https://cs.nyu.edu/courses/fall11/CSCI-GA.2130-001/x64-intro.pdf">x64-into</a></li><li><a href="https://mp.weixin.qq.com/s/885uGVhlffWAxjgIEW-TiA">归并排序</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;merge-sort&quot;&gt;&lt;a href=&quot;#merge-sort&quot; class=&quot;headerlink&quot; title=&quot;merge sort&quot;&gt;&lt;/a&gt;merge sort&lt;/h2&gt;&lt;h3 id=&quot;merge-sort-C-code&quot;&gt;&lt;a href=&quot;#merg</summary>
      
    
    
    
    
    <category term="algorithm" scheme="http://stardustman.github.io/tags/algorithm/"/>
    
    <category term="sort" scheme="http://stardustman.github.io/tags/sort/"/>
    
  </entry>
  
  <entry>
    <title>three-easy-pieces-4-process</title>
    <link href="http://stardustman.github.io/2020/01/14/three-easy-pieces-4-process/"/>
    <id>http://stardustman.github.io/2020/01/14/three-easy-pieces-4-process/</id>
    <published>2020-01-14T02:06:38.000Z</published>
    <updated>2020-01-14T12:27:59.945Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>我们知道一个计算机 <code>CPU</code> 数量有限, 但是却可以同时跑数量远远多于 <code>CPU</code> 数量的程序. 其实这就是 <code>virtualizing</code>. 怎样进行 <code>CPU</code> 虚拟化呢? 通过抽象出 <code>process</code> 这个基本概念, 也就是 <code>running program</code>. 一个没有运行的程序, 也就是磁盘上的一堆指令集和一些数据. 通过 <code>time sharing</code> 让一个 <code>process stop</code>, 然后去 <code>run</code> 另外一个 <code>process</code>. 重复这个 <code>context switch</code> 过程, 可以让多个程序同时运行, 这就是在<code>virtualizing CPU</code>.<br><code>mechanisms</code> are low-level methods or protocols that implements a needed piece of functionality. 类似于 java 中的接口, 就是我要提供什么功能. 比如 <code>OS</code> 中的进程的 <code>context switch</code>这个机制.<br><code>policies</code> are algorithms for making some kind of decision within the OS.类似 java 中实现类, 怎么实现这个接口定义的方法. 比如 <code>OS</code> 中的进程调度策略就是为了实现进程 <code>context switch</code>.<br><code>mechanisms</code> 和 <code>policies</code> 分离, 和 java 中接口和实现非常相似. 实际上这也是软件设计的原则. <code>OS</code> 本身也是软件.</p></blockquote><h2 id="physical-organization-of-a-modern-system"><a href="#physical-organization-of-a-modern-system" class="headerlink" title="physical organization of a modern system"></a>physical organization of a modern system</h2><img src="/2020/01/14/three-easy-pieces-4-process/physical-organization-of-a-modern-system.png" class="" title="现代计算机系统物理架构"><h2 id="the-abstracttion-a-process"><a href="#the-abstracttion-a-process" class="headerlink" title="the abstracttion: a process"></a>the abstracttion: a process</h2><h3 id="address-space"><a href="#address-space" class="headerlink" title="address space"></a>address space</h3><p>存放程序的 <code>instructions</code> 和 <code>data</code>.</p><h3 id="program-counter"><a href="#program-counter" class="headerlink" title="program counter"></a>program counter</h3><p>程序寄存器, 为了实现 <code>process</code> 的 <code>stop</code> 和 <code>run</code>, 需要知道执行到哪一条指令了.</p><h3 id="stack-pointer"><a href="#stack-pointer" class="headerlink" title="stack pointer"></a>stack pointer</h3><p>function parameters, local variables, return addresses</p><h3 id="io"><a href="#io" class="headerlink" title="io"></a>io</h3><p>进程默认打开 <code>stdin(0)</code>, <code>stdout(1)</code>, <code>stderr(2)</code> 这三个 <code>file descriptor</code>.</p><h2 id="process-API"><a href="#process-API" class="headerlink" title="process API"></a>process API</h2><h3 id="create"><a href="#create" class="headerlink" title="create"></a>create</h3><h3 id="destroy"><a href="#destroy" class="headerlink" title="destroy"></a>destroy</h3><p>kill a process or halt it</p><h3 id="wait"><a href="#wait" class="headerlink" title="wait"></a>wait</h3><h3 id="miscellaneous-control"><a href="#miscellaneous-control" class="headerlink" title="miscellaneous control"></a>miscellaneous control</h3><p><em>suspend</em> process, stop it from running for a while<br><em>resume</em> process, contine it running</p><h3 id="status"><a href="#status" class="headerlink" title="status"></a>status</h3><h2 id="process-creation-a-little-detail"><a href="#process-creation-a-little-detail" class="headerlink" title="process creation: a little detail"></a>process creation: a little detail</h2><img src="/2020/01/14/three-easy-pieces-4-process/loading-from-program-to-process.png" class=""><p>把程序从磁盘加载到内存. 问题来了:</p><ol><li>是要全部加载到内存吗? (eagerly)</li><li>还是部分加载到内存? (lazy, paging)</li><li>抑或内存根本不够存放整个程序? (swapping)</li><li>启动程序的必要代码和数据加载了吗? (一系列 run-time 设置)</li><li>分配供函数执行的 run-time stack(or just stack). 在 C 语言中, 用来存放 <code>function parameters</code>, <code>local variables</code>, <code>return addresses</code>, 想一想 <code>main</code> 的函数参数 <code>argc</code>,<code>argv</code>, 应该就是 <code>OS</code> 初始化的.</li><li>分配/回收 heap. (malloc 和 free).</li><li>set up related I/O </li><li>execute program, 跳到 entry point, 也就是 main().</li></ol><img src="/2020/01/14/three-easy-pieces-4-process/load-process.svg" class="" title="程序加载执行流程"><h2 id="process-states"><a href="#process-states" class="headerlink" title="process states"></a>process states</h2><p>简单来说, 分为 3 种状态:</p><ol><li>running</li></ol><p><strong>a process is running on a processor, which means it is executing instructions</strong></p><ol start="2"><li>ready</li></ol><p><strong>a process is ready to run but for some reason the OS has chosen not run it at this given moment</strong></p><ol start="3"><li>blocked</li></ol><p><strong>a process has performmed some kind of operation that makes it not ready to run until some other event takes place. A common example: when a process initiates an I/O request to a disk, it becomes blocked and thus some other process can use the processor</strong></p><img src="/2020/01/14/three-easy-pieces-4-process/process-state-transition.png" class="" title="进程状态转换"><h2 id="data-structures"><a href="#data-structures" class="headerlink" title="data structures"></a>data structures</h2><blockquote><p>以下是 xv6 这个 <code>MIT</code> 教学 <code>OS</code> 的 <a href="https://github.com/stardustman/xv6-public/blob/master/proc.h">proc.h</a> </p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Per-CPU state</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cpu</span> &#123;</span></span><br><span class="line">  uchar apicid;                <span class="comment">// Local APIC ID </span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">context</span> *<span class="title">scheduler</span>;</span>   <span class="comment">// swtch() here to enter scheduler</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">taskstate</span> <span class="title">ts</span>;</span>         <span class="comment">// Used by x86 to find stack for interrupt</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">segdesc</span> <span class="title">gdt</span>[<span class="title">NSEGS</span>];</span>   <span class="comment">// x86 global descriptor table , 拿着 GDT 使用内存</span></span><br><span class="line">  <span class="keyword">volatile</span> uint started;       <span class="comment">// Has the CPU started?</span></span><br><span class="line">  <span class="keyword">int</span> ncli;                    <span class="comment">// Depth of pushcli nesting.</span></span><br><span class="line">  <span class="keyword">int</span> intena;                  <span class="comment">// Were interrupts enabled before pushcli?</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">proc</span> *<span class="title">proc</span>;</span>           <span class="comment">// The process running on this cpu or null</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="class"><span class="keyword">struct</span> <span class="title">cpu</span> <span class="title">cpus</span>[<span class="title">NCPU</span>];</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> ncpu;</span><br><span class="line"></span><br><span class="line"><span class="comment">//PAGEBREAK: 17</span></span><br><span class="line"><span class="comment">// Saved registers for kernel context switches.</span></span><br><span class="line"><span class="comment">// Don&#x27;t need to save all the segment registers (%cs, etc),</span></span><br><span class="line"><span class="comment">// because they are constant across kernel contexts.</span></span><br><span class="line"><span class="comment">// Don&#x27;t need to save %eax, %ecx, %edx, because the</span></span><br><span class="line"><span class="comment">// x86 convention is that the caller has saved them.</span></span><br><span class="line"><span class="comment">// Contexts are stored at the bottom of the stack they</span></span><br><span class="line"><span class="comment">// describe; the stack pointer is the address of the context.</span></span><br><span class="line"><span class="comment">// The layout of the context matches the layout of the stack in swtch.S</span></span><br><span class="line"><span class="comment">// at the &quot;Switch stacks&quot; comment. Switch doesn&#x27;t save eip explicitly,</span></span><br><span class="line"><span class="comment">// but it is on the stack and allocproc() manipulates it.</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">context</span> &#123;</span></span><br><span class="line">  uint edi;</span><br><span class="line">  uint esi;</span><br><span class="line">  uint ebx;</span><br><span class="line">  uint ebp;</span><br><span class="line">  uint eip;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">procstate</span> &#123;</span> UNUSED, EMBRYO, SLEEPING, RUNNABLE, RUNNING, ZOMBIE &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Per-process state</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">proc</span> &#123;</span></span><br><span class="line">  uint sz;                     <span class="comment">// Size of process memory (bytes) 分配的内存大小</span></span><br><span class="line">  <span class="keyword">pde_t</span>* pgdir;                <span class="comment">// Page table  页表</span></span><br><span class="line">  <span class="keyword">char</span> *kstack;                <span class="comment">// Bottom of kernel stack for this process</span></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">procstate</span> <span class="title">state</span>;</span>        <span class="comment">// Process state 进程状态</span></span><br><span class="line">  <span class="keyword">int</span> pid;                     <span class="comment">// Process ID</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">proc</span> *<span class="title">parent</span>;</span>         <span class="comment">// Parent process 父进程</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">trapframe</span> *<span class="title">tf</span>;</span>        <span class="comment">// Trap frame for current syscall</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">context</span> *<span class="title">context</span>;</span>     <span class="comment">// swtch() here to run process</span></span><br><span class="line">  <span class="keyword">void</span> *chan;                  <span class="comment">// If non-zero, sleeping on chan</span></span><br><span class="line">  <span class="keyword">int</span> killed;                  <span class="comment">// If non-zero, have been killed</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">file</span> *<span class="title">ofile</span>[<span class="title">NOFILE</span>];</span>  <span class="comment">// Open files</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">inode</span> *<span class="title">cwd</span>;</span>           <span class="comment">// Current directory</span></span><br><span class="line">  <span class="keyword">char</span> name[<span class="number">16</span>];               <span class="comment">// Process name (debugging)</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Process memory is laid out contiguously, low addresses first:</span></span><br><span class="line"><span class="comment">//   text</span></span><br><span class="line"><span class="comment">//   original data and bss</span></span><br><span class="line"><span class="comment">//   fixed-size stack</span></span><br><span class="line"><span class="comment">//   expandable heap</span></span><br></pre></td></tr></table></figure><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>low-level(mechanisms) 实现进程功能<br>high-level(policies)  调度策略<br>机制和策略合在一起, 实现 CPU 的虚拟化</p><h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><ol><li><p><a href="https://mp.weixin.qq.com/s/USb5e2Zoc0LRgRShRpTYfg">linux process</a></p></li><li><p><a href="http://pages.cs.wisc.edu/~remzi/OSTEP/Homework/homework.html">three easy pieces</a></p></li><li><p><a href="https://www.computerhope.com/jargon/f/file-descriptor.htm">file descriptor</a></p></li><li><p><a href="https://github.com/stardustman/xv6-public/blob/master/proc.h">xv6-proc</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/26464793">中断</a></p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;我们知道一个计算机 &lt;code&gt;CPU&lt;/code&gt; 数量有限, 但是却可以同时跑数量远远多于 &lt;code&gt;CPU&lt;/code&gt; 数量的程序. 其实这就是 &lt;code&gt;virtualizing&lt;/code&gt;. 怎样进行 &lt;code&gt;CPU&lt;/cod</summary>
      
    
    
    
    
    <category term="os" scheme="http://stardustman.github.io/tags/os/"/>
    
    <category term="three easy pieces" scheme="http://stardustman.github.io/tags/three-easy-pieces/"/>
    
  </entry>
  
  <entry>
    <title>master-git</title>
    <link href="http://stardustman.github.io/2019/12/28/master-git/"/>
    <id>http://stardustman.github.io/2019/12/28/master-git/</id>
    <published>2019-12-28T05:15:29.000Z</published>
    <updated>2020-05-10T11:53:44.142Z</updated>
    
    <content type="html"><![CDATA[<h2 id="git-init"><a href="#git-init" class="headerlink" title="git init"></a>git init</h2><blockquote><p>Create an empty Git repository or reinitialize an existing one<br>也即是向 <code>working directory</code> 里添加 <code>.git</code> 文件夹</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">.git&#x2F;</span><br><span class="line">├── branches # git 分支</span><br><span class="line">├── config   # git 配置</span><br><span class="line">├── description</span><br><span class="line">├── HEAD     # HEAD 指针, 指向当前分支最新的 commit</span><br><span class="line">├── hooks</span><br><span class="line">│   ├── applypatch-msg.sample</span><br><span class="line">│   ├── commit-msg.sample</span><br><span class="line">│   ├── fsmonitor-watchman.sample</span><br><span class="line">│   ├── post-update.sample</span><br><span class="line">│   ├── pre-applypatch.sample</span><br><span class="line">│   ├── pre-commit.sample</span><br><span class="line">│   ├── prepare-commit-msg.sample</span><br><span class="line">│   ├── pre-push.sample</span><br><span class="line">│   ├── pre-rebase.sample</span><br><span class="line">│   ├── pre-receive.sample</span><br><span class="line">│   └── update.sample</span><br><span class="line">├── info</span><br><span class="line">│   └── exclude</span><br><span class="line">├── objects   # 存放不同种类的 git 对象，实现版本管理的关键 </span><br><span class="line">│   ├── info</span><br><span class="line">│   └── pack</span><br><span class="line">└── refs</span><br><span class="line">    ├── heads </span><br><span class="line">    └── tags  # git 标签</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="第一次-git-add-git-commit"><a href="#第一次-git-add-git-commit" class="headerlink" title="第一次 git add | git commit"></a>第一次 git add | git commit</h2><h3 id="git-add"><a href="#git-add" class="headerlink" title="git add"></a>git add</h3><blockquote><p>Add file contents to the index<br>添加文件内容到 <code>index</code> 区</p></blockquote><ol><li><p>添加两个文件 <code>file1</code> 和 <code>file2</code>, 文件内容分别是 <code>111</code> 和 <code>222</code></p></li><li><p>git add file_name</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add file1</span><br></pre></td></tr></table></figure></li><li><p>tree .git/objects 查看添加的 git object</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br></pre></td></tr></table></figure><blockquote><p>对 file1 文件内容也就是 <code>111</code> 和一些其他的信息做 <code>SHA-1</code> 运算得出 <code>58c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</code> 这个 <code>40</code> 位 <code>16 进制</code>的值. </p></blockquote></li><li><p>git cat-file 查看 objects 相关信息</p></li></ol><p><strong>查看 object 类型</strong> </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git cat-file -t 58c9bd</span><br><span class="line">blob</span><br></pre></td></tr></table></figure><p><strong>查看 object 大小</strong> </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git cat-file -s 58c9bd</span><br><span class="line">4</span><br></pre></td></tr></table></figure><p><strong>查看 object 内容</strong> </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git cat-file -p 58c9bd</span><br><span class="line">111</span><br></pre></td></tr></table></figure><ol start="5"><li>对文件内容为 <code>222</code> 的 <code>file2</code> 进行步骤 2 ~ 4.</li></ol><p>查看 .git/objects 如下:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.git/objects/</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c <span class="comment"># file1:blob</span></span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c <span class="comment"># file2:blob</span></span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br></pre></td></tr></table></figure><h3 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a>git commit</h3><blockquote><p>Stores the current contents of the index in a new commit along with a log message from the user describing the changes.<br>A <em>commit</em> in a git repository records a <em>snapshot of all the files</em> in your directory.</p></blockquote><h4 id="执行-git-commit-m-“add-file1-and-file2”"><a href="#执行-git-commit-m-“add-file1-and-file2”" class="headerlink" title="执行 git commit -m “add file1 and file2”"></a>执行 git commit -m “add file1 and file2”</h4><h4 id="查看-git-objects-的变化"><a href="#查看-git-objects-的变化" class="headerlink" title="查看 .git/objects 的变化"></a>查看 .git/objects 的变化</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">tree .git/objects</span><br><span class="line">.git/objects/</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c <span class="comment"># file1:blob</span></span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5 <span class="comment"># 1:commit</span></span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c <span class="comment"># file2:blob</span></span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0 <span class="comment"># 1:tree</span></span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br></pre></td></tr></table></figure><h3 id="查看-HEAD"><a href="#查看-HEAD" class="headerlink" title="查看 HEAD"></a>查看 HEAD</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~/blog<span class="comment"># cat .git/HEAD</span></span><br><span class="line">ref: refs/heads/master <span class="comment"># 目前在 master 分支上</span></span><br><span class="line">root@aliyun:~/blog<span class="comment"># cat .git/refs/heads/master</span></span><br><span class="line">73622e96d5b5389d63dd74e3c40db9d4c4296ff5 <span class="comment"># 1:commit </span></span><br></pre></td></tr></table></figure><h2 id="第二次-git-add-git-commit"><a href="#第二次-git-add-git-commit" class="headerlink" title="第二次 git add | git commit"></a>第二次 git add | git commit</h2><blockquote><p>修改 <code>file1</code> 的文件内容为 <code>333</code></p></blockquote><h3 id="git-add-file1"><a href="#git-add-file1" class="headerlink" title="git add file1"></a>git add file1</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~/blog<span class="comment"># git add file1</span></span><br><span class="line">root@aliyun:~/blog<span class="comment"># tree .git/objects/</span></span><br><span class="line">.git/objects/</span><br><span class="line">├── 55</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550 <span class="comment"># file1_modify: blob</span></span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br></pre></td></tr></table></figure><h3 id="git-commit-m-“modify-file1”"><a href="#git-commit-m-“modify-file1”" class="headerlink" title="git commit -m “modify file1”"></a>git commit -m “modify file1”</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~/blog<span class="comment"># git commit -m &quot;modify file1&quot;</span></span><br><span class="line">[master 558e28c] modify file1</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">root@aliyun:~/blog<span class="comment"># tree .git/objects/</span></span><br><span class="line">.git/objects/</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e <span class="comment"># 2:commit</span></span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550 <span class="comment"># file1_modify: blob</span></span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560 <span class="comment"># 2:tree</span></span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br></pre></td></tr></table></figure><h3 id="查看-HEAD-1"><a href="#查看-HEAD-1" class="headerlink" title="查看 HEAD"></a>查看 HEAD</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~/blog<span class="comment"># cat .git/HEAD</span></span><br><span class="line">ref: refs/heads/master</span><br><span class="line">root@aliyun:~/blog<span class="comment"># cat .git/refs/heads/master</span></span><br><span class="line">558e28c67089eea9bdfbfd748d32baa8f2ce944e <span class="comment"># 指向了第二次 commit 的 hash 值</span></span><br></pre></td></tr></table></figure><h3 id="git-add-git-commit-实质"><a href="#git-add-git-commit-实质" class="headerlink" title="git add | git commit 实质"></a>git add | git commit 实质</h3><p>git add: 向 <code>.git/objects</code> 添加类型是 <code>blob</code> 的文件<br>git commit: 向 <code>.git/objects</code> 添加类型是 <code>tree</code> 和 <code>commit</code> 的文件</p><h2 id="git-branch"><a href="#git-branch" class="headerlink" title="git branch"></a>git branch</h2><blockquote><p> List, create, or delete branches<br> Branches in Git are incredibly lightweight as well. They are simply pointers to a specific commit – nothing more. 仅仅是添加了一个指向特定 commit 的指针。<br>a branch essentially says “I want to include the work of this commit and all parent commits.” 一个分支就是我想要这个 commit 以及这个 commit 的所有 <code>parent commits</code></p></blockquote><h3 id="创建一个-new-branch-的分支"><a href="#创建一个-new-branch-的分支" class="headerlink" title="创建一个 new-branch 的分支"></a>创建一个 <code>new-branch</code> 的分支</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~/blog<span class="comment"># git branch new-branch</span></span><br><span class="line">root@aliyun:~/blog<span class="comment"># tree .git/</span></span><br><span class="line">.git/</span><br><span class="line">├── branches</span><br><span class="line">├── COMMIT_EDITMSG</span><br><span class="line">├── config</span><br><span class="line">├── description</span><br><span class="line">├── HEAD</span><br><span class="line">├── hooks</span><br><span class="line">│   ├── applypatch-msg.sample</span><br><span class="line">│   ├── commit-msg.sample</span><br><span class="line">│   ├── fsmonitor-watchman.sample</span><br><span class="line">│   ├── post-update.sample</span><br><span class="line">│   ├── pre-applypatch.sample</span><br><span class="line">│   ├── pre-commit.sample</span><br><span class="line">│   ├── prepare-commit-msg.sample</span><br><span class="line">│   ├── pre-push.sample</span><br><span class="line">│   ├── pre-rebase.sample</span><br><span class="line">│   ├── pre-receive.sample</span><br><span class="line">│   └── update.sample</span><br><span class="line">├── index</span><br><span class="line">├── info</span><br><span class="line">│   └── exclude</span><br><span class="line">├── logs</span><br><span class="line">│   ├── HEAD</span><br><span class="line">│   └── refs</span><br><span class="line">│       └── heads</span><br><span class="line">│           ├── master</span><br><span class="line">│           └── new-branch <span class="comment"># git branch new-branch 添加的分支日志</span></span><br><span class="line">├── objects</span><br><span class="line">│   ├── 55</span><br><span class="line">│   │   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   │   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">│   ├── 58</span><br><span class="line">│   │   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">│   ├── 61</span><br><span class="line">│   │   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">│   ├── 73</span><br><span class="line">│   │   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">│   ├── c2</span><br><span class="line">│   │   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">│   ├── d9</span><br><span class="line">│   │   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">│   ├── info</span><br><span class="line">│   └── pack</span><br><span class="line">└── refs</span><br><span class="line">    ├── heads</span><br><span class="line">    │   ├── master</span><br><span class="line">    │   └── new-branch <span class="comment"># git branch new-branch 添加的 refs</span></span><br><span class="line">    └── tags</span><br><span class="line"></span><br><span class="line">18 directories, 29 files</span><br></pre></td></tr></table></figure><h3 id="git-branch-list-查看分支"><a href="#git-branch-list-查看分支" class="headerlink" title="git branch - -list 查看分支"></a>git branch - -list 查看分支</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~/blog<span class="comment"># git branch --list</span></span><br><span class="line">* master <span class="comment"># * 表示当前所在分支</span></span><br><span class="line">  new-branch <span class="comment"># 新创建的 new-branch 分支</span></span><br></pre></td></tr></table></figure><h3 id="git-checkout-new-branch-切换分支"><a href="#git-checkout-new-branch-切换分支" class="headerlink" title="git checkout new-branch 切换分支"></a>git checkout new-branch 切换分支</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~/blog<span class="comment"># git checkout new-branch</span></span><br><span class="line">Switched to branch <span class="string">&#x27;new-branch&#x27;</span></span><br><span class="line">root@aliyun:~/blog<span class="comment"># git branch --list</span></span><br><span class="line">  master</span><br><span class="line">* new-branch</span><br></pre></td></tr></table></figure><p>创建分支 <code>new-branch</code>, 并切换到 <code>new-branch</code> 分支.</p><ol><li>git branch new-branch</li><li>git checkout new-branch<br>可以简化为:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b new-branch</span><br></pre></td></tr></table></figure></li></ol><h3 id="查看-HEAD-2"><a href="#查看-HEAD-2" class="headerlink" title="查看 HEAD"></a>查看 HEAD</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~/blog<span class="comment"># cat .git/HEAD</span></span><br><span class="line">ref: refs/heads/new-branch</span><br><span class="line">root@aliyun:~/blog<span class="comment"># cat .git/refs/heads/new-branch</span></span><br><span class="line">558e28c67089eea9bdfbfd748d32baa8f2ce944e <span class="comment"># 指向了第二次 commit 的 hash值</span></span><br></pre></td></tr></table></figure><p>由此可知 git branch new-branch 创建一个分支,实际上做了两件事情:</p><ol><li>添加 .git/logs/refs/heads/new-branch 记录该分支的 <code>log</code></li><li>添加 .git/refs/heads/new-branch 指向最新的 <code>commit</code><br>这也就是 <code>git</code> 创建新的分支如此快的原因. </li></ol><h2 id="第三次-git-add-git-commit"><a href="#第三次-git-add-git-commit" class="headerlink" title="第三次 git add | git commit"></a>第三次 git add | git commit</h2><p>切换到 <code>new-branch</code> 分支, 新建一个 <code>file3</code> 的文件, 内容是 <code>new-branch-file3</code></p><h3 id="git-add-file3"><a href="#git-add-file3" class="headerlink" title="git add file3"></a>git add file3</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~/blog<span class="comment"># git add file3</span></span><br><span class="line">root@aliyun:~/blog<span class="comment"># tree .git/objects/</span></span><br><span class="line">.git/objects/</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a <span class="comment"># file3</span></span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">9 directories, 8 files</span><br><span class="line">root@aliyun:~/blog<span class="comment"># git cat-file -t 2e79</span></span><br><span class="line">blob</span><br><span class="line">root@aliyun:~/blog<span class="comment"># git cat-file -p 2e79</span></span><br><span class="line">new-branch-file3</span><br><span class="line">root@aliyun:~/blog<span class="comment"># git cat-file -s 2e79</span></span><br><span class="line">17</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="git-commit-m-“file3-on-new-branch”"><a href="#git-commit-m-“file3-on-new-branch”" class="headerlink" title="git commit -m “file3 on new-branch”"></a>git commit -m “file3 on new-branch”</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~/blog<span class="comment"># git commit -m &quot;add file3 on new-branch&quot;</span></span><br><span class="line">[new-branch ce907fa] add file3 on new-branch</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 file3</span><br><span class="line">root@aliyun:~/blog<span class="comment"># tree .git/objects/</span></span><br><span class="line">.git/objects/</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3 <span class="comment"># new-branch:tree</span></span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44 <span class="comment"># new-branch:commit</span></span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">11 directories, 10 files</span><br><span class="line">root@aliyun:~/blog<span class="comment"># git cat-file -t b721</span></span><br><span class="line">tree</span><br><span class="line">root@aliyun:~/blog<span class="comment"># git cat-file -p b721 # 全量的快照(snapshot)</span></span><br><span class="line">100644 blob 55bd0ac4c42e46cd751eb7405e12a35e61425550    file1</span><br><span class="line">100644 blob c200906efd24ec5e783bee7f23b5d7c941b0c12c    file2</span><br><span class="line">100644 blob 2e799a48d8c045b814c3862af40dea98bdde790a    file3</span><br><span class="line">root@aliyun:~/blog<span class="comment"># git cat-file -s b721</span></span><br><span class="line">99</span><br><span class="line">root@aliyun:~/blog<span class="comment"># git cat-file -t ce90</span></span><br><span class="line">commit</span><br><span class="line">root@aliyun:~/blog<span class="comment"># git cat-file -p ce90</span></span><br><span class="line">tree b72118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">parent 558e28c67089eea9bdfbfd748d32baa8f2ce944e <span class="comment"># 上一次 commit </span></span><br><span class="line">author root &lt;root@aliyun&gt; 1578039532 +0800</span><br><span class="line">committer root &lt;root@aliyun&gt; 1578039532 +0800</span><br><span class="line"></span><br><span class="line">add file3 on new-branch <span class="comment"># commit message</span></span><br><span class="line">root@aliyun:~/blog<span class="comment"># git cat-file -s ce90</span></span><br><span class="line">208</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="查看-HEAD-3"><a href="#查看-HEAD-3" class="headerlink" title="查看 HEAD"></a>查看 HEAD</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~/blog<span class="comment"># cat .git/HEAD</span></span><br><span class="line">ref: refs/heads/new-branch <span class="comment"># 当前在 new-branch 分支上</span></span><br><span class="line">root@aliyun:~/blog<span class="comment"># cat .git/refs/heads/new-branch</span></span><br><span class="line">ce907fabd08138058b05428d7cac017507b33c44 <span class="comment"># new-branch 分支最新的提交</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="切换到-master-分支查看-HEAD"><a href="#切换到-master-分支查看-HEAD" class="headerlink" title="切换到 master 分支查看 HEAD"></a>切换到 master 分支查看 HEAD</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~/blog<span class="comment"># git checkout master</span></span><br><span class="line">Switched to branch <span class="string">&#x27;master&#x27;</span></span><br><span class="line">root@aliyun:~/blog<span class="comment"># cat .git/HEAD</span></span><br><span class="line">ref: refs/heads/master <span class="comment"># 当前在 master 分支</span></span><br><span class="line">root@aliyun:~/blog<span class="comment"># cat .git/refs/heads/master</span></span><br><span class="line">558e28c67089eea9bdfbfd748d32baa8f2ce944e <span class="comment"># master 分支最新的提交</span></span><br></pre></td></tr></table></figure><p>查看 <code>master</code> 和 <code>new-branch</code> 两个分支可知, 每一分支对应的 <code>HEAD</code> 和 <code>.git/refs/heads/branch_name</code> 记录的 <code>commit</code> 不同. 这就是 git 分支的实现.</p><h2 id="git-add-git-commit-git-branch-图解"><a href="#git-add-git-commit-git-branch-图解" class="headerlink" title="git add | git commit | git branch 图解"></a>git add | git commit | git branch 图解</h2><img src="/2019/12/28/master-git/git.svg" class="" title="git"><h2 id="Fast-forward-Merge"><a href="#Fast-forward-Merge" class="headerlink" title="Fast-forward Merge"></a>Fast-forward Merge</h2><blockquote><p>两次 git add 和 git commit 之后，创建 <code>new-branch</code> ，在 <code>new-branch</code> 进行了修改。<br>但是 <code>master</code> 分支没有做任何更改。也就是 <code>master</code> 此时分支落后了 <code>new-branch</code> 分支。<br><code>new-branch</code> 分支的修改 <code>master</code> 分支怎样看到呢？可以进行所谓的 <code>Fast-forward merge</code>。</p></blockquote><h3 id="切换到-master-分支"><a href="#切换到-master-分支" class="headerlink" title="切换到 master 分支"></a>切换到 master 分支</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~&#x2F;blog# git checkout master  # 切换到 master 分支</span><br><span class="line">Switched to branch &#39;master&#39;</span><br><span class="line">root@aliyun:~&#x2F;blog# cat .git&#x2F;refs&#x2F;heads&#x2F;master # master 分支仍然指向第二次的 commit。</span><br><span class="line">558e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">root@aliyun:~&#x2F;blog# tree .git&#x2F;objects&#x2F; # 查看 objects 对象。</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">11 directories, 10 files</span><br></pre></td></tr></table></figure><h3 id="合并-new-branch-分支到-master-分支"><a href="#合并-new-branch-分支到-master-分支" class="headerlink" title="合并 new-branch 分支到 master 分支"></a>合并 new-branch 分支到 master 分支</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~&#x2F;blog# git merge new-branch # 合并 new-branch 分支</span><br><span class="line">Updating 558e28c..ce907fa ### 更新 558e 这个object</span><br><span class="line">Fast-forward # fast-forward</span><br><span class="line"> file3 | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 file3</span><br><span class="line">root@aliyun:~&#x2F;blog# ls</span><br><span class="line">file1  file2  file3</span><br><span class="line">root@aliyun:~&#x2F;blog# tree .git&#x2F;objects&#x2F; # 查看 objects 对象。并没增加任何 object</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">11 directories, 10 files</span><br><span class="line">root@aliyun:~&#x2F;blog# cat .git&#x2F;refs&#x2F;heads&#x2F;master </span><br><span class="line">ce907fabd08138058b05428d7cac017507b33c44 # 更新了 master 指向，指向了 new-branch 的 commit。</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Fast-Forward-图解"><a href="#Fast-Forward-图解" class="headerlink" title="Fast-Forward 图解"></a>Fast-Forward 图解</h3><img src="/2019/12/28/master-git/fast-forward-merge.svg" class="" title="git fast forward"><h2 id="删除-master-分支上的-file1-文件，然后提交"><a href="#删除-master-分支上的-file1-文件，然后提交" class="headerlink" title="删除 master 分支上的 file1 文件，然后提交"></a>删除 master 分支上的 file1 文件，然后提交</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~# cp -r blog blog-delete # 复制一份，在 master 分支上删除 file1</span><br><span class="line">root@aliyun:~# cd blog-delete&#x2F;</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# ls</span><br><span class="line">file1  file2  file3</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# tree .git&#x2F;objects&#x2F; # 删除前的 git objects</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">11 directories, 10 files</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# rm file1 # 删除file1</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git status</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add&#x2F;rm &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">deleted:    file1</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and&#x2F;or &quot;git commit -a&quot;)</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git add file1 # 修改添加到 working tree</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# tree .git&#x2F;objects&#x2F; # 注意，此时的并没有删除或者增加 git objects</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">11 directories, 10 files</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">deleted:    file1</span><br><span class="line"></span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git commit -m &quot;delete file1 on master&quot; # 提交这个修改到 repository</span><br><span class="line">[master f24e8b6] delete file1 on master</span><br><span class="line"> 1 file changed, 1 deletion(-)</span><br><span class="line"> delete mode 100644 file1</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# tree .git&#x2F;objects&#x2F; # 查看此时的 git objects</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c # blob:file1 仍然在 git objects 中</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── ba</span><br><span class="line">│   └── 61ba35d824408f8135ec77b7efdcdfc0281fba  # 新添加一个 tree</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── f2</span><br><span class="line">│   └── 4e8b6fb771347156b615c795f7fd886dc49088 # 新添加一个 commit</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">13 directories, 12 files</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -s ba61 # ba61 的大小,zlib compressed data</span><br><span class="line">66</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -t ba61 # ba61 的类型</span><br><span class="line">tree</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -p ba61</span><br><span class="line">100644 blob c200906efd24ec5e783bee7f23b5d7c941b0c12cfile2 # master 分支剩下的 file2</span><br><span class="line">100644 blob 2e799a48d8c045b814c3862af40dea98bdde790afile3 # master 分支剩下的 file3</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -s f24e</span><br><span class="line">207</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -t f24e # 新加的 commit object</span><br><span class="line">commit</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -p f24e</span><br><span class="line">tree ba61ba35d824408f8135ec77b7efdcdfc0281fba # 新加的 tree object</span><br><span class="line">parent ce907fabd08138058b05428d7cac017507b33c44 # delete file1 之前的 commit object</span><br><span class="line">author root &lt;root@aliyun&gt; 1586307459 +0800</span><br><span class="line">committer root &lt;root@aliyun&gt; 1586307459 +0800</span><br><span class="line"></span><br><span class="line">delete file1 on master</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# cat .git&#x2F;refs&#x2F;heads&#x2F;master # master 分支指向了新的 commit</span><br><span class="line">f24e8b6fb771347156b615c795f7fd886dc49088</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# cat .git&#x2F;logs&#x2F;refs&#x2F;heads&#x2F;</span><br><span class="line">master      new-branch  </span><br><span class="line">root@aliyun:~&#x2F;blog-delete# cat .git&#x2F;logs&#x2F;refs&#x2F;heads&#x2F;master # 查看 master 分支的提交日志</span><br><span class="line">0000000000000000000000000000000000000000 73622e96d5b5389d63dd74e3c40db9d4c4296ff5 root &lt;root@aliyun&gt; 1578027036 +0800commit (initial): add file1 and file2</span><br><span class="line">73622e96d5b5389d63dd74e3c40db9d4c4296ff5 558e28c67089eea9bdfbfd748d32baa8f2ce944e root &lt;root@aliyun&gt; 1578036269 +0800commit: modify file1</span><br><span class="line">558e28c67089eea9bdfbfd748d32baa8f2ce944e ce907fabd08138058b05428d7cac017507b33c44 root &lt;root@aliyun&gt; 1586241477 +0800merge new-branch: Fast-forward</span><br><span class="line">ce907fabd08138058b05428d7cac017507b33c44 f24e8b6fb771347156b615c795f7fd886dc49088 root &lt;root@aliyun&gt; 1586307459 +0800commit: delete file1 on master</span><br></pre></td></tr></table></figure><h3 id="master-分支删除-file1-图解"><a href="#master-分支删除-file1-图解" class="headerlink" title="master 分支删除 file1 图解"></a>master 分支删除 file1 图解</h3><img src="/2019/12/28/master-git/git-delete-a-file-and-commit.svg" class="" title="delete file1 on master"><h4 id="master-分支删除-file1-图解分析"><a href="#master-分支删除-file1-图解分析" class="headerlink" title="master 分支删除 file1 图解分析"></a>master 分支删除 file1 图解分析</h4><p>master 分支 git 中删除一个文件的实质是：</p><ol><li>生成一个 <code>tree object ba61ba</code>，指向剩下的每一个文件的最新的 blob object。<code>blob c20090    file2</code> 和 <code>blob 2e799a    file3</code></li><li>生成一个 <code>commit f24e8b</code> 节点，指向本次提交的上一个 <code>commit object(ce907f)</code> 和这次提交生成的 <code>tree object(ba61ba)</code>。</li><li>移动 <code>master</code> 和 <code>HEAD</code> 的指向，指向本次提交的 <code>commit object f24e8b</code>。</li><li>在 master 的 <code>.git/logs/refs/heads/master</code> 分支添加本次提交的 git log。</li><li>删除 file1，但是 git object 下 file1 的 <code>blob(58c9bd)</code> 并没有删除。这也意味着可以恢复 file1。</li><li>其他分支同理。</li></ol><h2 id="合并分支-combine-work"><a href="#合并分支-combine-work" class="headerlink" title="合并分支(combine work)"></a>合并分支(combine work)</h2><h3 id="使用-git-merge"><a href="#使用-git-merge" class="headerlink" title="使用 git merge"></a>使用 git merge</h3><blockquote><p>Merging in Git <strong>creates a special commit</strong> that has <strong>two unique parents</strong>. A commit with two parents essentially means “I want to include all the work from this parent over here and this one over here, and the set of all their parents.”</p></blockquote><h4 id="new-branch-分支添加-file4"><a href="#new-branch-分支添加-file4" class="headerlink" title="new-branch 分支添加 file4"></a>new-branch 分支添加 file4</h4><h5 id="new-branch-分支添加-file4-步骤"><a href="#new-branch-分支添加-file4-步骤" class="headerlink" title="new-branch 分支添加 file4 步骤"></a>new-branch 分支添加 file4 步骤</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~# cd blog-delete</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# ls</span><br><span class="line">file2  file3</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git branch --list  # 查看分支</span><br><span class="line">* master</span><br><span class="line">  new-branch</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git checkout new-branch  # 切换到 new-branch</span><br><span class="line">Switched to branch &#39;new-branch&#39;</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# ls</span><br><span class="line">file1  file2  file3</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# echo 444 &gt; file4 # 创建 file4</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git status</span><br><span class="line">On branch new-branch</span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line"></span><br><span class="line">file4</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# tree .git&#x2F;objects&#x2F;</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── ba</span><br><span class="line">│   └── 61ba35d824408f8135ec77b7efdcdfc0281fba</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── f2</span><br><span class="line">│   └── 4e8b6fb771347156b615c795f7fd886dc49088</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">13 directories, 12 files</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git add file4 # 添加 file4</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# tree .git&#x2F;objects&#x2F;</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 1e</span><br><span class="line">│   └── 6fd033863540bfb9eadf22019a6b4b3de7d07a # blob:file4</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── ba</span><br><span class="line">│   └── 61ba35d824408f8135ec77b7efdcdfc0281fba</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── f2</span><br><span class="line">│   └── 4e8b6fb771347156b615c795f7fd886dc49088</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">14 directories, 13 files</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git commit -m &quot;add file4 on new-branch&quot;</span><br><span class="line">[new-branch c9918ce] add file4 on new-branch</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 file4</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# tree .git&#x2F;objects&#x2F;</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 09</span><br><span class="line">│   └── 77e7b9e8643eaa75b679d7e82b048723e9f491 # 4:tree</span><br><span class="line">├── 1e</span><br><span class="line">│   └── 6fd033863540bfb9eadf22019a6b4b3de7d07a # blob:file4</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── ba</span><br><span class="line">│   └── 61ba35d824408f8135ec77b7efdcdfc0281fba</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── c9</span><br><span class="line">│   └── 918cea80e46648c4e98da5b1c4b072f0794795</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44 # 4:commit</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── f2</span><br><span class="line">│   └── 4e8b6fb771347156b615c795f7fd886dc49088</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">16 directories, 15 files</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -s 0977 # 新加的 tree object</span><br><span class="line">132</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -t 0977</span><br><span class="line">tree</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -p 0977 # new-branch 分支上所有文件的 snapshot</span><br><span class="line">100644 blob 55bd0ac4c42e46cd751eb7405e12a35e61425550file1</span><br><span class="line">100644 blob c200906efd24ec5e783bee7f23b5d7c941b0c12cfile2</span><br><span class="line">100644 blob 2e799a48d8c045b814c3862af40dea98bdde790afile3</span><br><span class="line">100644 blob 1e6fd033863540bfb9eadf22019a6b4b3de7d07afile4</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -s 1e6f # new-branch 分支新加的 file4</span><br><span class="line">4</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -t 1e6f </span><br><span class="line">blob</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -p 1e6f</span><br><span class="line">444</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -s c991 # 新的 commit object</span><br><span class="line">208</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -t c991</span><br><span class="line">commit</span><br><span class="line">root@aliyun:~&#x2F;blog-delete# git cat-file -p c991</span><br><span class="line">tree 0977e7b9e8643eaa75b679d7e82b048723e9f491 # 本次生成的 tree object</span><br><span class="line">parent ce907fabd08138058b05428d7cac017507b33c44 # 上一次 commit</span><br><span class="line">author root &lt;root@aliyun&gt; 1586330993 +0800</span><br><span class="line">committer root &lt;root@aliyun&gt; 1586330993 +0800</span><br><span class="line"></span><br><span class="line">add file4 on new-branch # git commit-m 的信息</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-new-branch-file4# git checkout master # 切换到 master</span><br><span class="line">Switched to branch &#39;master&#39;</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-new-branch-file4# ls # 查看 master 分支的文件</span><br><span class="line">file2  file3</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-new-branch-file4# tree .git&#x2F;objects&#x2F; # 在 master 分支查看 objects</span><br><span class="line">.git&#x2F;objects&#x2F; # 和在 new-branch 分支上看到的一样</span><br><span class="line">├── 09</span><br><span class="line">│   └── 77e7b9e8643eaa75b679d7e82b048723e9f491</span><br><span class="line">├── 1e</span><br><span class="line">│   └── 6fd033863540bfb9eadf22019a6b4b3de7d07a</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── ba</span><br><span class="line">│   └── 61ba35d824408f8135ec77b7efdcdfc0281fba</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── c9</span><br><span class="line">│   └── 918cea80e46648c4e98da5b1c4b072f0794795</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── f2</span><br><span class="line">│   └── 4e8b6fb771347156b615c795f7fd886dc49088</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">16 directories, 15 files </span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="new-branch-分支添加-file4-图解"><a href="#new-branch-分支添加-file4-图解" class="headerlink" title="new-branch 分支添加 file4 图解"></a>new-branch 分支添加 file4 图解</h5><img src="/2019/12/28/master-git/new-branch-add-file4.svg" class="" title="new-branch-add-file4"><h4 id="master-分支添加-file5"><a href="#master-分支添加-file5" class="headerlink" title="master 分支添加 file5"></a>master 分支添加 file5</h4><h5 id="master-分支添加-file5-步骤"><a href="#master-分支添加-file5-步骤" class="headerlink" title="master 分支添加 file5 步骤"></a>master 分支添加 file5 步骤</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~# cp -r blog-delete blog-delete-master-file5 # 复制一份</span><br><span class="line">root@aliyun:~# cd blog-delete-master-file5&#x2F;</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# ls</span><br><span class="line">file1  file2  file3  file4</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git branch --list </span><br><span class="line">  master</span><br><span class="line">* new-branch</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git checkout master # 切换到 master</span><br><span class="line">Switched to branch &#39;master&#39;</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# echo 555 &gt; file5 创建 file5</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# tree .git&#x2F;objects&#x2F;</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 09</span><br><span class="line">│   └── 77e7b9e8643eaa75b679d7e82b048723e9f491</span><br><span class="line">├── 1e</span><br><span class="line">│   └── 6fd033863540bfb9eadf22019a6b4b3de7d07a</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── ba</span><br><span class="line">│   └── 61ba35d824408f8135ec77b7efdcdfc0281fba</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── c9</span><br><span class="line">│   └── 918cea80e46648c4e98da5b1c4b072f0794795</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── f2</span><br><span class="line">│   └── 4e8b6fb771347156b615c795f7fd886dc49088</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">16 directories, 15 files</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git add file5 </span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# tree .git&#x2F;objects&#x2F;</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 09</span><br><span class="line">│   └── 77e7b9e8643eaa75b679d7e82b048723e9f491</span><br><span class="line">├── 1e</span><br><span class="line">│   └── 6fd033863540bfb9eadf22019a6b4b3de7d07a</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 37</span><br><span class="line">│   └── 49383ded246790596d2f39db4dd8b71f525bbc</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── ba</span><br><span class="line">│   └── 61ba35d824408f8135ec77b7efdcdfc0281fba</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── c9</span><br><span class="line">│   └── 918cea80e46648c4e98da5b1c4b072f0794795</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── f2</span><br><span class="line">│   └── 4e8b6fb771347156b615c795f7fd886dc49088</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">17 directories, 16 files</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git commit -m &quot;add file5 on master&quot;</span><br><span class="line">[master 3de903f] add file5 on master</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 file5</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# tree .git&#x2F;objects&#x2F;</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 09</span><br><span class="line">│   └── 77e7b9e8643eaa75b679d7e82b048723e9f491</span><br><span class="line">├── 1e</span><br><span class="line">│   └── 6fd033863540bfb9eadf22019a6b4b3de7d07a</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 37</span><br><span class="line">│   └── 49383ded246790596d2f39db4dd8b71f525bbc # blob:file5</span><br><span class="line">├── 3d</span><br><span class="line">│   └── e903f0c523d57b4880be68bacb1eaa1195ebac #5:commit</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── ba</span><br><span class="line">│   └── 61ba35d824408f8135ec77b7efdcdfc0281fba</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── c9</span><br><span class="line">│   └── 918cea80e46648c4e98da5b1c4b072f0794795</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── f2</span><br><span class="line">│   └── 4e8b6fb771347156b615c795f7fd886dc49088</span><br><span class="line">├── f5</span><br><span class="line">│   └── 4ecef60b4376ae5531032cbeaade01184da4fa # 5:tree</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">19 directories, 18 files</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git cat-file -t 3de90 # 本次的 commit object</span><br><span class="line">commit</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git cat-file -s 3de90</span><br><span class="line">204</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git cat-file -p 3de90</span><br><span class="line">tree f54ecef60b4376ae5531032cbeaade01184da4fa</span><br><span class="line">parent f24e8b6fb771347156b615c795f7fd886dc49088</span><br><span class="line">author root &lt;root@aliyun&gt; 1586340888 +0800</span><br><span class="line">committer root &lt;root@aliyun&gt; 1586340888 +0800</span><br><span class="line"></span><br><span class="line">add file5 on master</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git cat-file -t f54ece # 本次的 tree objet</span><br><span class="line">tree</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git cat-file -s f54ece</span><br><span class="line">99</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git cat-file -p f54ece</span><br><span class="line">100644 blob c200906efd24ec5e783bee7f23b5d7c941b0c12cfile2 # master 分支上的 file2</span><br><span class="line">100644 blob 2e799a48d8c045b814c3862af40dea98bdde790afile3 # master 分支上的 file3</span><br><span class="line">100644 blob 3749383ded246790596d2f39db4dd8b71f525bbcfile5 # master 分支上的 file5</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git cat-file -t 374938 # file5</span><br><span class="line">blob</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git cat-file -s 374938</span><br><span class="line">4</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-master-file5# git cat-file -p 374938</span><br><span class="line">555</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="master-分支添加-file5-图解"><a href="#master-分支添加-file5-图解" class="headerlink" title="master 分支添加 file5 图解"></a>master 分支添加 file5 图解</h5><img src="/2019/12/28/master-git/git-master-add-file5.svg" class="" title="master-add-file5"><h4 id="master-分支合并到-new-branch-分支"><a href="#master-分支合并到-new-branch-分支" class="headerlink" title="master 分支合并到 new-branch 分支"></a>master 分支合并到 new-branch 分支</h4><h5 id="master-分支合并到-new-branch-分支步骤"><a href="#master-分支合并到-new-branch-分支步骤" class="headerlink" title="master 分支合并到 new-branch 分支步骤"></a>master 分支合并到 new-branch 分支步骤</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun:~# cp -r blog-delete-master-file5&#x2F; blog-delete-file4-file5-merge</span><br><span class="line">root@aliyun:~# cd blog-delete-file4-file5-merge&#x2F;</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# git branch --list</span><br><span class="line">* master</span><br><span class="line">  new-branch</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# tree .git&#x2F;objects&#x2F;</span><br><span class="line">09&#x2F;   1e&#x2F;   2e&#x2F;   37&#x2F;   3d&#x2F;   55&#x2F;   58&#x2F;   61&#x2F;   73&#x2F;   b7&#x2F;   ba&#x2F;   c2&#x2F;   c9&#x2F;   ce&#x2F;   d9&#x2F;   f2&#x2F;   f5&#x2F;   info&#x2F; pack&#x2F; </span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# tree .git&#x2F;objects&#x2F;</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 09</span><br><span class="line">│   └── 77e7b9e8643eaa75b679d7e82b048723e9f491</span><br><span class="line">├── 1e</span><br><span class="line">│   └── 6fd033863540bfb9eadf22019a6b4b3de7d07a</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 37</span><br><span class="line">│   └── 49383ded246790596d2f39db4dd8b71f525bbc</span><br><span class="line">├── 3d</span><br><span class="line">│   └── e903f0c523d57b4880be68bacb1eaa1195ebac</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── ba</span><br><span class="line">│   └── 61ba35d824408f8135ec77b7efdcdfc0281fba</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── c9</span><br><span class="line">│   └── 918cea80e46648c4e98da5b1c4b072f0794795</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── f2</span><br><span class="line">│   └── 4e8b6fb771347156b615c795f7fd886dc49088</span><br><span class="line">├── f5</span><br><span class="line">│   └── 4ecef60b4376ae5531032cbeaade01184da4fa</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">19 directories, 18 files</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# git checkout new-branch # 切换到 new-branch</span><br><span class="line">Switched to branch &#39;new-branch&#39;</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# git merge master # 把 master 分支合并到当前分支，也就是 new-branch 分支</span><br><span class="line">Removing file1 # master 分支上删除了 file1，new-branch 分支合并时也会删掉。</span><br><span class="line">Merge made by the &#39;recursive&#39; strategy.</span><br><span class="line"> file1 | 1 -</span><br><span class="line"> file5 | 1 +</span><br><span class="line"> 2 files changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line"> delete mode 100644 file1</span><br><span class="line"> create mode 100644 file5</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# tree .git&#x2F;objects&#x2F;</span><br><span class="line">.git&#x2F;objects&#x2F;</span><br><span class="line">├── 09</span><br><span class="line">│   └── 77e7b9e8643eaa75b679d7e82b048723e9f491</span><br><span class="line">├── 1e</span><br><span class="line">│   └── 6fd033863540bfb9eadf22019a6b4b3de7d07a</span><br><span class="line">├── 2e</span><br><span class="line">│   └── 799a48d8c045b814c3862af40dea98bdde790a</span><br><span class="line">├── 37</span><br><span class="line">│   └── 49383ded246790596d2f39db4dd8b71f525bbc</span><br><span class="line">├── 3d</span><br><span class="line">│   └── e903f0c523d57b4880be68bacb1eaa1195ebac</span><br><span class="line">├── 4f</span><br><span class="line">│   └── ed41461bcfd7157b71d757b2fe70e3d7317f94 # 6:tree 合并生成的 tree object</span><br><span class="line">├── 55</span><br><span class="line">│   ├── 8e28c67089eea9bdfbfd748d32baa8f2ce944e</span><br><span class="line">│   └── bd0ac4c42e46cd751eb7405e12a35e61425550</span><br><span class="line">├── 58</span><br><span class="line">│   └── c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c</span><br><span class="line">├── 61</span><br><span class="line">│   └── 74c3edb1e8dc4f1692b69fd43c8c6af85ce560</span><br><span class="line">├── 73</span><br><span class="line">│   └── 622e96d5b5389d63dd74e3c40db9d4c4296ff5</span><br><span class="line">├── b7</span><br><span class="line">│   └── 2118da210e8e3f4127cfc16cc819eff58e42e3</span><br><span class="line">├── ba</span><br><span class="line">│   └── 61ba35d824408f8135ec77b7efdcdfc0281fba</span><br><span class="line">├── c2</span><br><span class="line">│   └── 00906efd24ec5e783bee7f23b5d7c941b0c12c</span><br><span class="line">├── c9</span><br><span class="line">│   └── 918cea80e46648c4e98da5b1c4b072f0794795</span><br><span class="line">├── ce</span><br><span class="line">│   └── 907fabd08138058b05428d7cac017507b33c44</span><br><span class="line">├── d9</span><br><span class="line">│   └── 64f468f776fac72a049a884ae24e7dbb838fd0</span><br><span class="line">├── f2</span><br><span class="line">│   └── 4e8b6fb771347156b615c795f7fd886dc49088</span><br><span class="line">├── f5</span><br><span class="line">│   └── 4ecef60b4376ae5531032cbeaade01184da4fa</span><br><span class="line">├── fc</span><br><span class="line">│   └── 094b5b4e7a0f4028c5735d95f844b1aea1a9b6 # 6:commit 合并生成的 commit object</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">21 directories, 20 files</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# git cat-file -s 4fed41</span><br><span class="line">132</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# git cat-file -t 4fed41</span><br><span class="line">tree</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# git cat-file -p 4fed41</span><br><span class="line">100644 blob c200906efd24ec5e783bee7f23b5d7c941b0c12cfile2 </span><br><span class="line">100644 blob 2e799a48d8c045b814c3862af40dea98bdde790afile3</span><br><span class="line">100644 blob 1e6fd033863540bfb9eadf22019a6b4b3de7d07afile4</span><br><span class="line">100644 blob 3749383ded246790596d2f39db4dd8b71f525bbcfile5</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# git cat-file -s fc094b # 本次合并生成的 commit object</span><br><span class="line">270</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# git cat-file -t fc094b</span><br><span class="line">commit</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# git cat-file -p fc094b</span><br><span class="line">tree 4fed41461bcfd7157b71d757b2fe70e3d7317f94 # 本次合并时两个分支的 snapshot</span><br><span class="line">parent c9918cea80e46648c4e98da5b1c4b072f0794795 # new branch 分支合并时最新的 commit</span><br><span class="line">parent 3de903f0c523d57b4880be68bacb1eaa1195ebac # master 分支合并时最新的 commit</span><br><span class="line">author root &lt;root@aliyun&gt; 1586344983 +0800</span><br><span class="line">committer root &lt;root@aliyun&gt; 1586344983 +0800</span><br><span class="line"></span><br><span class="line">Merge branch &#39;master&#39; into new-branch</span><br><span class="line"></span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# cat .git&#x2F;refs&#x2F;heads&#x2F;new-branch # new branch 已经指向了新生成的 commit 节点</span><br><span class="line">fc094b5b4e7a0f4028c5735d95f844b1aea1a9b6</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# cat .git&#x2F;refs&#x2F;heads&#x2F;master # master 分支没有发生改变</span><br><span class="line">3de903f0c523d57b4880be68bacb1eaa1195ebac</span><br><span class="line">root@aliyun:~&#x2F;blog-delete-file4-file5-merge# cat .git&#x2F;logs&#x2F;refs&#x2F;heads&#x2F;new-branch  # new branch 分支 log</span><br><span class="line">0000000000000000000000000000000000000000 558e28c67089eea9bdfbfd748d32baa8f2ce944e root &lt;root@aliyun&gt; 1578037705 +0800branch: Created from master</span><br><span class="line">558e28c67089eea9bdfbfd748d32baa8f2ce944e ce907fabd08138058b05428d7cac017507b33c44 root &lt;root@aliyun&gt; 1578039532 +0800commit: add file3 on new-branch</span><br><span class="line">ce907fabd08138058b05428d7cac017507b33c44 c9918cea80e46648c4e98da5b1c4b072f0794795 root &lt;root@aliyun&gt; 1586330993 +0800commit: add file4 on new-branch</span><br><span class="line">c9918cea80e46648c4e98da5b1c4b072f0794795 fc094b5b4e7a0f4028c5735d95f844b1aea1a9b6 root &lt;root@aliyun&gt; 1586344983 +0800merge master: Merge made by the &#39;recursive&#39; strategy. # 本次 merge 的 log</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="master-分支合并到-new-branch-图解"><a href="#master-分支合并到-new-branch-图解" class="headerlink" title="master 分支合并到 new-branch 图解"></a>master 分支合并到 new-branch 图解</h5><img src="/2019/12/28/master-git/git-merge-master.svg" class="" title="git-merge-master"><p>master 分支合并到 new-branch 分支实质：</p><ol><li>生成一个新的 <code>tree object 4f1d41</code> 指向 <code>master</code> 分支和 <code>new-branch</code> 分支共有的<code>文件 blob</code>。</li><li>生成一个新的 <code>commit object fc094b</code> 指向新生成的 <code>tree object 4f1d41</code>以及合并前的 master 分支的 commit<br>和 new-branch 分支的 commit。</li><li><code>.git/refs/heads/new-branch</code>指向新生成的 <code>commit object fc094b</code>。</li><li><code>.git/logs/refs/heads/new-branch</code> 添加本次 merge 的 log。</li><li><code>.git/refs/heads/master</code> master 分支的指向并没有发生改变。</li></ol><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><a href="https://www.lzane.com/slide/git-under-the-hood/index.html#/">git-under-the-hood</a></li><li><a href="https://www.bilibili.com/video/av77252063">Bilibili-git-under-the-hood</a></li><li><a href="https://zh.wikipedia.org/wiki/SHA-1">SHA-1</a></li><li><a href="https://learngitbranching.js.org/">git-branch</a></li><li><a href="http://marklodato.github.io/visual-git-guide/index-en.html">visual-git-reference</a></li><li><a href="https://dev.to/lydiahallie/cs-visualized-useful-git-commands-37p1">visualized-useful-git-commands</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;git-init&quot;&gt;&lt;a href=&quot;#git-init&quot; class=&quot;headerlink&quot; title=&quot;git init&quot;&gt;&lt;/a&gt;git init&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Create an empty Git repository or</summary>
      
    
    
    
    
    <category term="git" scheme="http://stardustman.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>katacoda-what-is-a-container</title>
    <link href="http://stardustman.github.io/2019/12/24/katacoda-what-is-a-container/"/>
    <id>http://stardustman.github.io/2019/12/24/katacoda-what-is-a-container/</id>
    <published>2019-12-24T05:02:03.000Z</published>
    <updated>2019-12-25T06:43:50.671Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Processes"><a href="#Processes" class="headerlink" title="Processes"></a>Processes</h2><blockquote><p>Containers are just normal Linux Processes with additional configuration applied.</p></blockquote><p>容器只是应用了附加配置的普通 Linux 进程。</p><h3 id="redis-container"><a href="#redis-container" class="headerlink" title="redis container"></a>redis container</h3><h4 id="lanch-redis-server-process"><a href="#lanch-redis-server-process" class="headerlink" title="lanch redis-server process"></a>lanch redis-server process</h4><blockquote><p>Usage:  docker run [OPTIONS] IMAGE [COMMAND] [ARG…]<br>docker run –help<br>-d, –detach   Run container in background and print container ID<br>–name string  Assign a name to the container</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name=db redis:alpine</span><br></pre></td></tr></table></figure><p>在后台启动一个 <code>container name</code> 是 <code>db</code> 的容器, 并打印容器的 <code>ID</code></p><blockquote><p>Unable to find image ‘redis:alpine’ locally<br>alpine: Pulling from library/redis<br>63bc94deeb28: Pull complete<br>828e397560e3: Pull complete<br>5902d88df6c2: Pull complete<br>157b2c953c6d: Pull complete<br>b5212c16b59d: Pull complete<br>5f8f01031701: Pull complete<br>Digest: sha256:613ab7e1c0175cae18b69c291512e5e8f1129175f6617ff2126b7ac9a1e5c550<br>Status: Downloaded newer image for redis:alpine<br>0a5ceea3df52e200d45772c4507b20d7c95a97dcd3939cb33a8d5bc1b842e334</p></blockquote><h4 id="检验"><a href="#检验" class="headerlink" title="检验"></a>检验</h4><h5 id="pidof-lt-process-name-gt"><a href="#pidof-lt-process-name-gt" class="headerlink" title="pidof &lt;process-name&gt;"></a>pidof &lt;process-name&gt;</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pidof redis-server</span><br></pre></td></tr></table></figure><h5 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep redis-server</span><br></pre></td></tr></table></figure><h5 id="docker-top"><a href="#docker-top" class="headerlink" title="docker top "></a>docker top <container-name></h5><blockquote><p>docker top can help us identify information about the process including the PID (Process ID) and PPID (Parent Process ID)</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top db</span><br></pre></td></tr></table></figure><h5 id="pstree"><a href="#pstree" class="headerlink" title="pstree"></a>pstree</h5><blockquote><p>pstree will list all of the sub processes</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstree -c -p -A $(pgrep dockerd)</span><br></pre></td></tr></table></figure><h2 id="Process-Directory"><a href="#Process-Directory" class="headerlink" title="Process Directory"></a>Process Directory</h2><blockquote><p>Linux is just a series of magic files and contents, this makes it fun to explore and navigate to see what is happening under the covers, and in some cases, change the contents to see the results. The configuration for each process is defined within the /proc directory. If you know the process ID, then you can identify the configuration directory.</p></blockquote><p>每一个 <code>process</code> 的配置都定义在 <code>/proc</code> 文件夹下. 如果知道 <code>process ID</code>, 就能找到该进程的配置文件夹</p><h3 id="redis-server-进程的配置"><a href="#redis-server-进程的配置" class="headerlink" title="redis-server 进程的配置"></a>redis-server 进程的配置</h3><h4 id="找到-redis-server-的-pid"><a href="#找到-redis-server-的-pid" class="headerlink" title="找到 redis-server 的 pid"></a>找到 redis-server 的 pid</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DBPID=$(pgrep redis-server)</span><br><span class="line"><span class="built_in">echo</span> Redis is <span class="variable">$DBPID</span></span><br><span class="line">ls /proc</span><br></pre></td></tr></table></figure><h4 id="查看-redis-server-进程的环境变量"><a href="#查看-redis-server-进程的环境变量" class="headerlink" title="查看 redis-server 进程的环境变量"></a>查看 redis-server 进程的环境变量</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /proc/<span class="variable">$DBPID</span></span><br><span class="line">cat /proc/<span class="variable">$DBPID</span>/environ</span><br></pre></td></tr></table></figure><p>结果如下:</p><blockquote><p>HOSTNAME=f3b9624ce46cSHLVL=2REDIS_DOWNLOAD_SHA=<br>61db74eabf6801f057fd24b590232f2f337d422280fd19486<br>eca03be87d3a82bHOME=/home/redisPATH=/usr/local/sb<br>in:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br>REDIS_DOWNLOAD_URL=<a href="http://download.redis.io/releases/redis-5.0.7.tar.gzREDIS_VERSION=5.0.7PWD=/data">http://download.redis.io/releases/redis-5.0.7.tar.gzREDIS_VERSION=5.0.7PWD=/data</a></p></blockquote><p>解析查看:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;HOSTNAME=5fba1658e4ceSHLVL=2REDIS_DOWNLOAD_SHA=61db74eabf6801f057fd24b590232f2f337d422280fd19486eca03be87d3a82bHOME=/home/redisPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binREDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-5.0.7.tar.gzREDIS_VERSION=5.0.7PWD=/data&#x27;</span>.match(<span class="regexp">/[A-Z]+=[^A-Z]*/g</span>) <span class="comment">// regexp 解析查看 key=value</span></span><br></pre></td></tr></table></figure><h4 id="docker-容器里执行-env-命令"><a href="#docker-容器里执行-env-命令" class="headerlink" title="docker 容器里执行 env 命令"></a>docker 容器里执行 env 命令</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it db env</span><br></pre></td></tr></table></figure><p><code>env</code> 内容如下:</p><blockquote><p>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br>HOSTNAME=f3b9624ce46c<br>TERM=xterm<br>REDIS_VERSION=5.0.7<br>REDIS_DOWNLOAD_URL=<a href="http://download.redis.io/releases/redis-5.0.7.tar.gz">http://download.redis.io/releases/redis-5.0.7.tar.gz</a><br>REDIS_DOWNLOAD_SHA=61db74eabf6801f057fd24b590232f2f337d422280fd19486eca03be87d3a82b<br>HOME=/root</p></blockquote><h2 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h2><blockquote><p>One of the fundamental parts of a container is namespaces. The concept of namespaces is to limit what processes can see and access certain parts of the system, such as other network interfaces or processes<br>When a container is started, the container runtime, such as Docker, will create new namespaces to sandbox the process. By running a process in it’s own Pid namespace, it will look like it’s the only process on the system.</p></blockquote><ul><li>Mount (mnt)</li><li>Process (pid)</li><li>Network (net)</li><li>Interprocess Communication (ipc)</li><li>UTS (hostnames) aka unix time-sharing system</li><li>User ID (user)</li><li>Control group (cgroup)</li></ul><h3 id="lanched-“contained”-processes"><a href="#lanched-“contained”-processes" class="headerlink" title="lanched “contained” processes"></a>lanched “contained” processes</h3><blockquote><p>Without using a runtime such as Docker, a process can still operate within it’s own namespace. One tool to help is unshare.</p></blockquote><p>不用 <code>docker</code> 这个 <code>runtime</code>, 也可以用 <code>unshare</code> 这个工具来创建一个拥有自己的 <code>namespace</code> 的进程.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unshare --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><blockquote><p>Run a program with some namespaces unshared from the parent.</p></blockquote><p>运行一个程序, 不共享父进程的某些 namespaces</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unshare --fork --pid --mount-proc bash</span><br><span class="line">ps</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h3 id="namespace-是啥"><a href="#namespace-是啥" class="headerlink" title="namespace 是啥"></a>namespace 是啥</h3><blockquote><p>Namespaces are inode locations on disk. this allows for processes to shared/reused the same namespace, allowing them to view and interact.</p></blockquote><p><code>namespace</code> 是硬盘上的 <code>inode</code>. 这允许 <code>processes</code> 共享/复用相同的 <code>namespace</code>, 允许进程之间可以互相看得到, 互相交流.</p><h4 id="查看-redis-server-的所有-namespace"><a href="#查看-redis-server-的所有-namespace" class="headerlink" title="查看 redis-server 的所有 namespace"></a>查看 redis-server 的所有 namespace</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -liha /proc/<span class="variable">$DBPID</span>/ns</span><br></pre></td></tr></table></figure><h4 id="attach-process-to-existing-NameSpaces"><a href="#attach-process-to-existing-NameSpaces" class="headerlink" title="attach process to existing NameSpaces"></a>attach process to existing NameSpaces</h4><blockquote><p><code>nsenter</code> run a program with namespaces of other processes.</p></blockquote><p>在其他进程的 <code>namespace</code> 中运行一个程序</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">nsenter --help</span><br><span class="line">nsenter [options] [&lt;program&gt; [&lt;argument&gt;...]]</span><br><span class="line"> Options:</span><br><span class="line"> -a, --all              enter all namespaces</span><br><span class="line"> -t, --target &lt;pid&gt;     target process to get namespaces from</span><br><span class="line"> -m, --mount[=&lt;file&gt;]   enter mount namespace</span><br><span class="line"> -u, --uts[=&lt;file&gt;]     enter UTS namespace (hostname etc)</span><br><span class="line"> -i, --ipc[=&lt;file&gt;]     enter System V IPC namespace</span><br><span class="line"> -n, --net[=&lt;file&gt;]     enter network namespace</span><br><span class="line"> -p, --pid[=&lt;file&gt;]     enter pid namespace</span><br><span class="line"> -C, --cgroup[=&lt;file&gt;]  enter cgroup namespace</span><br><span class="line"> -U, --user[=&lt;file&gt;]    enter user namespace</span><br><span class="line"> -S, --setuid &lt;uid&gt;     set uid in entered namespace</span><br><span class="line"> -G, --setgid &lt;gid&gt;     set gid in entered namespace</span><br><span class="line">     --preserve-credentials do not touch uids or gids</span><br><span class="line"> -r, --root[=&lt;dir&gt;]     set the root directory</span><br><span class="line"> -w, --wd[=&lt;dir&gt;]       set the working directory</span><br><span class="line"> -F, --no-fork          do not fork before exec&#x27;ing &lt;program&gt;</span><br><span class="line"> -Z, --follow-context   set SELinux context according to --target PID</span><br></pre></td></tr></table></figure> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nsenter --target <span class="variable">$DBPID</span> --mount --uts --ipc --net --pid ps aux</span><br></pre></td></tr></table></figure><p>在 <code>redis-server</code> 的 <code>mount</code>, <code>uts</code>, <code>ipc</code>, <code>net</code>, <code>pid</code> 这些命名空间里执行 <code>ps</code> 命令</p><h4 id="share-namespaces-of-redis-server"><a href="#share-namespaces-of-redis-server" class="headerlink" title="share namespaces of redis-server"></a>share namespaces of redis-server</h4><blockquote><p>With Docker, these namespaces can be shared using the syntax container:&lt;container-name&gt;. For example, the command below will connect nginx to the DB namespace</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name=web --net=container:db nginx:alpine</span><br></pre></td></tr></table></figure><p>启动 <code>nginx</code> 的容器. 共享 <code>redis-server</code> 的 <code>net</code> namespace</p><ul><li>查看 <code>nginx</code> 容器的 <code>net</code> 的 namespace</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -lha /proc/<span class="variable">$WEBPID</span>/ns/ | grep net</span><br></pre></td></tr></table></figure><blockquote><p>dr-x–x–x 2 systemd-network systemd-journal 0 Dec 24 13:40 .<br>dr-xr-xr-x 9 systemd-network systemd-journal 0 Dec 24 13:40 ..<br>lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 cgroup -&gt; cgroup:[4026531835]<br>lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 ipc -&gt; ipc:[4026532225]<br>lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 mnt -&gt; mnt:[4026532223]<br>lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 net -&gt; net:[4026532160] – 注意这个是共享的 redis-server 的 net 命名空间<br>lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 pid -&gt; pid:[4026532226]<br>lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 user -&gt; user:[4026531837]<br>lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 uts -&gt; uts:[4026532224]</p></blockquote><ul><li>查看 <code>redis-server</code> 容器的 <code>net</code> 命名空间</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -lha /proc/<span class="variable">$DBPID</span>/ns/ | grep net</span><br></pre></td></tr></table></figure><blockquote><p>lrwxrwxrwx 1 999 packer 0 Dec 24 13:39 net -&gt; net:[4026532160]</p></blockquote><h2 id="CGroups"><a href="#CGroups" class="headerlink" title="CGroups"></a>CGroups</h2><blockquote><p>CGroups limit the amount of resources a process can consume. These cgroups are values defined in particular files within the /proc directory.<br>CGroups 用来限制一个进程可以使用的资源的量. cgroups 的值被定义在 /proc 文件夹下的特定文件里.</p></blockquote><h3 id="查看-redis-server-的-CGroups"><a href="#查看-redis-server-的-CGroups" class="headerlink" title="查看 redis-server 的 CGroups"></a>查看 redis-server 的 CGroups</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/<span class="variable">$DBPID</span>/cgroup</span><br></pre></td></tr></table></figure><ul><li>得到 redis-server 的容器 ID</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DBID=$(docker ps --no-trunc | grep <span class="string">&#x27;db&#x27;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>查看 redis-server 的 cpu stats 和 usages</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/fs/cgroup/cpu,cpuacct/docker/<span class="variable">$DBID</span>/cpuacct.stat</span><br></pre></td></tr></table></figure><ul><li>查看 redis-server 的 cpu shares</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/fs/cgroup/cpu,cpuacct/docker/<span class="variable">$DBID</span>/cpu.shares</span><br></pre></td></tr></table></figure><ul><li>查看所有容器的 memory 的 docker cgroups 配置</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /sys/fs/cgroup/memory/docker</span><br></pre></td></tr></table></figure><h3 id="查看所有的-CGroups"><a href="#查看所有的-CGroups" class="headerlink" title="查看所有的 CGroups"></a>查看所有的 CGroups</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /sys/fs/cgroup</span><br></pre></td></tr></table></figure><h3 id="配置-cgroups"><a href="#配置-cgroups" class="headerlink" title="配置 cgroups"></a>配置 cgroups</h3><blockquote><p>用 cgroups 配置 内存, memory quotes 存放在 memory.limit_in_bytes<br>这个文件</p></blockquote><ul><li>容器默认没有内存限制</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats db --no-strem ; 只查看一条信息 </span><br></pre></td></tr></table></figure><ul><li>限制 db 这个容器的内存使用</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 8000000 &gt; /sys/fs/cgroup/memory/docker/<span class="variable">$DBID</span>/memory.limit_in_bytes</span><br></pre></td></tr></table></figure><h2 id="Seccomp-限制可以使用的-syscall"><a href="#Seccomp-限制可以使用的-syscall" class="headerlink" title="Seccomp 限制可以使用的 syscall"></a>Seccomp 限制可以使用的 syscall</h2><blockquote><p>When assigned to a process it means the process will be limited to a subset of the ability system calls. If it attempts to call a blocked system call is will recieve the error “Operation Not Allowed”. <a href="https://github.com/moby/moby/blob/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/profiles/seccomp/default.json">容器默认可以使用的 syscall</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/<span class="variable">$DBPID</span>/status</span><br><span class="line">cat /proc/<span class="variable">$DBPID</span>/status | grep Seccomp</span><br></pre></td></tr></table></figure><blockquote><p>The flag meaning are: 0: disabled 1: strict 2: filtering</p></blockquote><h2 id="Capabilities"><a href="#Capabilities" class="headerlink" title="Capabilities"></a>Capabilities</h2><blockquote><p>Capabilities are groupings about what a process or user has permission to do. These Capabilities might cover multiple system calls or actions, such as changing the system time or hostname.</p></blockquote><ul><li>查看 redis-server 的 Capabilities</li></ul><blockquote><p>The status file also containers the Capabilities flag. A process can drop as many Capabilities as possible to ensure it’s secure.</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/<span class="variable">$DBPID</span>/status | grep ^Cap</span><br></pre></td></tr></table></figure><p>结果如下:</p><blockquote><p>CapInh: 00000000a80425fb<br>CapPrm: 0000000000000000<br>CapEff: 0000000000000000<br>CapBnd: 00000000a80425fb<br>CapAmb: 0000000000000000</p></blockquote><ul><li>解析 redis-server 的 flags</li></ul><blockquote><p>The flags are stored as a bitmask that can be decoded with capsh</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">capsh --decode=00000000a80425fb</span><br></pre></td></tr></table></figure><p>解析结果如下:</p><blockquote><p>0x00000000a80425fb=cap_chown,cap_dac_override,cap_fowner,<br>cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,<br>cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,<br>cap_audit_write,cap_setfcap</p></blockquote><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><p><a href="https://www.katacoda.com/courses/container-runtimes/what-is-a-container">what is a container</a></p></li><li><p><a href="http://www.ruanyifeng.com/blog/2018/11/awk.html">awk</a></p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Processes&quot;&gt;&lt;a href=&quot;#Processes&quot; class=&quot;headerlink&quot; title=&quot;Processes&quot;&gt;&lt;/a&gt;Processes&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Containers are just normal Li</summary>
      
    
    
    
    
    <category term="docker" scheme="http://stardustman.github.io/tags/docker/"/>
    
    <category term="container" scheme="http://stardustman.github.io/tags/container/"/>
    
  </entry>
  
  <entry>
    <title>tomcat-http-cookie</title>
    <link href="http://stardustman.github.io/2019/11/29/tomcat-http-cookie/"/>
    <id>http://stardustman.github.io/2019/11/29/tomcat-http-cookie/</id>
    <published>2019-11-29T06:29:51.000Z</published>
    <updated>2019-11-29T06:54:39.397Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> javax.servlet.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.security.AccessController;</span><br><span class="line"><span class="keyword">import</span> java.security.PrivilegedAction;</span><br><span class="line"><span class="keyword">import</span> java.text.MessageFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.BitSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a cookie, a small amount of information sent by a servlet to a Web</span></span><br><span class="line"><span class="comment"> * browser, saved by the browser, and later sent back to the server.</span></span><br><span class="line"><span class="comment"> * 创建一个 cookie， servlet 发给浏览器的一个小信息，被浏览器保存。之后再发送给服务器。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  A cookie&#x27;s value can uniquely identify a client, so cookies are commonly used for</span></span><br><span class="line"><span class="comment"> * session management.</span></span><br><span class="line"><span class="comment"> * 一个 cookie 的值可以单独的标记出一个客户端，所以 cookies 一般被用来 session 管理。因为</span></span><br><span class="line"><span class="comment"> * http 是一个 stateless 的协议。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * A cookie has a name, a single value, and optional attributes such as a</span></span><br><span class="line"><span class="comment"> * comment, path and domain qualifiers, a maximum age, and a version number.</span></span><br><span class="line"><span class="comment"> * 一个 cookie 有一个 name，一个单独的 value，还有一些可选的属性，比如 注释，路径，域标记</span></span><br><span class="line"><span class="comment"> * 最大存活时间和一个版本号。</span></span><br><span class="line"><span class="comment"> * document.cookie 可以得到 httponly = false 的 cookie</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Some Web browsers have bugs in how they handle the optional attributes, so</span></span><br><span class="line"><span class="comment"> * use them sparingly to improve the interoperability of your servlets.</span></span><br><span class="line"><span class="comment"> * 一些 web browsers 在处怎样处理可选的属性有 bugs。提高 servlets 的互操作性，请慎用。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * The servlet sends cookies to the browser by using the</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> HttpServletResponse#addCookie&#125; method, which adds fields to HTTP</span></span><br><span class="line"><span class="comment"> * response headers to send cookies to the browser, one at a time. The browser</span></span><br><span class="line"><span class="comment"> * is expected to support 20 cookies for each Web server, 300 cookies total, and</span></span><br><span class="line"><span class="comment"> * may limit cookie size to 4 KB each.</span></span><br><span class="line"><span class="comment"> * servlet 用 HttpServletResponse#addCookie 向 http 的相应头添加 field, 之后发送给浏览器.</span></span><br><span class="line"><span class="comment"> * 浏览器支持每一个 web server 保存 20 个 cookie. 每一个 cookie 的 size 可能被限制为 4 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * The browser returns cookies to the servlet by adding fields to HTTP request</span></span><br><span class="line"><span class="comment"> * headers. </span></span><br><span class="line"><span class="comment"> * 浏览器通过向 http 请求头添加 cookies 的方式返回给服务器. </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Cookies can be retrieved from a request by using the</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> HttpServletRequest#getCookies&#125; method. Several cookies might have the</span></span><br><span class="line"><span class="comment"> * same name but different path attributes.</span></span><br><span class="line"><span class="comment"> * 服务器通过 HttpServletRequest#getCookies 从请求中提取 cookies.</span></span><br><span class="line"><span class="comment"> * 一些 cookie 可能有相同的 name 但是有不同的 path attribute.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Cookies affect the caching of the Web pages that use them. HTTP 1.0 does not</span></span><br><span class="line"><span class="comment"> * cache pages that use cookies created with this class. This class does not</span></span><br><span class="line"><span class="comment"> * support the cache control defined with HTTP 1.1.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * This class supports both the RFC 2109 and the RFC 6265 specifications.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * By default, cookies are created using RFC 6265.</span></span><br><span class="line"><span class="comment"> * 默认的, cookie 生成方式采用 RFC 6265. 本质所有的 Cookie 都是按规范生成的.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cookie</span> <span class="keyword">implements</span> <span class="title">Cloneable</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 校验 Cookie name</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> CookieNameValidator validation;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">boolean</span> strictServletCompliance; <span class="comment">// 严格的 servlet</span></span><br><span class="line">        <span class="keyword">boolean</span> strictNaming;</span><br><span class="line">        <span class="keyword">boolean</span> allowSlash;</span><br><span class="line">        String propStrictNaming;</span><br><span class="line">        String propFwdSlashIsSeparator;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (System.getSecurityManager() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            strictServletCompliance = Boolean.getBoolean(</span><br><span class="line">                    <span class="string">&quot;org.apache.catalina.STRICT_SERVLET_COMPLIANCE&quot;</span>);</span><br><span class="line">            propStrictNaming = System.getProperty(</span><br><span class="line">                    <span class="string">&quot;org.apache.tomcat.util.http.ServerCookie.STRICT_NAMING&quot;</span>);</span><br><span class="line">            propFwdSlashIsSeparator = System.getProperty(</span><br><span class="line">                    <span class="string">&quot;org.apache.tomcat.util.http.ServerCookie.FWD_SLASH_IS_SEPARATOR&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            strictServletCompliance = AccessController.doPrivileged(</span><br><span class="line">                    <span class="keyword">new</span> PrivilegedAction&lt;Boolean&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> Boolean <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> Boolean.valueOf(System.getProperty(</span><br><span class="line">                                    <span class="string">&quot;org.apache.catalina.STRICT_SERVLET_COMPLIANCE&quot;</span>));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ).booleanValue();</span><br><span class="line">            propStrictNaming = AccessController.doPrivileged(</span><br><span class="line">                    <span class="keyword">new</span> PrivilegedAction&lt;String&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> String <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> System.getProperty(</span><br><span class="line">                                    <span class="string">&quot;org.apache.tomcat.util.http.ServerCookie.STRICT_NAMING&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line">            propFwdSlashIsSeparator = AccessController.doPrivileged(</span><br><span class="line">                    <span class="keyword">new</span> PrivilegedAction&lt;String&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> String <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> System.getProperty(</span><br><span class="line">                                    <span class="string">&quot;org.apache.tomcat.util.http.ServerCookie.FWD_SLASH_IS_SEPARATOR&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (propStrictNaming == <span class="keyword">null</span>) &#123;</span><br><span class="line">            strictNaming = strictServletCompliance;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            strictNaming = Boolean.parseBoolean(propStrictNaming);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (propFwdSlashIsSeparator == <span class="keyword">null</span>) &#123;</span><br><span class="line">            allowSlash = !strictServletCompliance;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            allowSlash = !Boolean.parseBoolean(propFwdSlashIsSeparator);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (strictNaming) &#123;</span><br><span class="line">            validation = <span class="keyword">new</span> RFC2109Validator(allowSlash);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            validation = <span class="keyword">new</span> RFC6265Validator();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name; <span class="comment">// cookie name 一旦创建不能被修改</span></span><br><span class="line">    <span class="keyword">private</span> String value; <span class="comment">// cookie value</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> version = <span class="number">0</span>; <span class="comment">// ;Version=1 ... means RFC 2109 style</span></span><br><span class="line">                             <span class="comment">// 默认的是 RFC 6265</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Attributes encoded in the header&#x27;s cookie fields.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">private</span> String comment; <span class="comment">// ;Comment=VALUE ... describes cookie&#x27;s use</span></span><br><span class="line">    <span class="keyword">private</span> String domain; <span class="comment">// ;Domain=VALUE ... domain that sees cookie 可以看到 cookie 的 domain</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxAge = -<span class="number">1</span>; <span class="comment">// ;Max-Age=VALUE ... cookies auto-expire </span></span><br><span class="line">    <span class="keyword">private</span> String path; <span class="comment">// ;Path=VALUE ... URLs that see the cookie 可以看到 cookie 的 urls</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> secure; <span class="comment">// ;Secure ... e.g. use SSL 启用 ssl</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> httpOnly; <span class="comment">// Not in cookie specs, but supported by browsers 不在 cookie 规范里, 但是被浏览器支持</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a cookie with a specified name and value.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * The name must conform to RFC 2109. cookie name 必须遵循 RFC 2109. 没办法,规范就是牛啊</span></span><br><span class="line"><span class="comment">     * That means it can contain only ASCII</span></span><br><span class="line"><span class="comment">     * alphanumeric characters and cannot contain commas, semicolons, or white</span></span><br><span class="line"><span class="comment">     * space or begin with a $ character. The cookie&#x27;s name cannot be changed</span></span><br><span class="line"><span class="comment">     * after creation.</span></span><br><span class="line"><span class="comment">     * 这意味着 cookie name 只能包含 ASCII 的字母, 数字, 不能包括逗号, 分号, 空格, 或者以</span></span><br><span class="line"><span class="comment">     * $ 开头. cookie name 一旦创建不能被修改.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * The value can be anything the server chooses to send. Its value is</span></span><br><span class="line"><span class="comment">     * probably of interest only to the server. The cookie&#x27;s value can be</span></span><br><span class="line"><span class="comment">     * changed after creation with the &lt;code&gt;setValue&lt;/code&gt; method.</span></span><br><span class="line"><span class="comment">     * server 可以通过 cookie value 发送任何东西.  </span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * By default, cookies are created according to the Netscape cookie</span></span><br><span class="line"><span class="comment">     * specification. The version can be changed with the</span></span><br><span class="line"><span class="comment">     * &lt;code&gt;setVersion&lt;/code&gt; method.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     *            a &lt;code&gt;String&lt;/code&gt; specifying the name of the cookie</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     *            a &lt;code&gt;String&lt;/code&gt; specifying the value of the cookie</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException</span></span><br><span class="line"><span class="comment">     *             if the cookie name contains illegal characters (for example,</span></span><br><span class="line"><span class="comment">     *             a comma, space, or semicolon) or it is one of the tokens</span></span><br><span class="line"><span class="comment">     *             reserved for use by the cookie protocol</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setValue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setVersion</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Cookie</span><span class="params">(String name, String value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 首先进行 cookie name 的校验</span></span><br><span class="line">        validation.validate(name);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Specifies a comment that describes a cookie&#x27;s purpose. </span></span><br><span class="line"><span class="comment">     * 描述这个 cookie 的目的</span></span><br><span class="line"><span class="comment">     * The comment is useful if the browser presents the cookie to the user. Comments are not</span></span><br><span class="line"><span class="comment">     * supported by Netscape Version 0 cookies.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> purpose</span></span><br><span class="line"><span class="comment">     *            a &lt;code&gt;String&lt;/code&gt; specifying the comment to display to the</span></span><br><span class="line"><span class="comment">     *            user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getComment</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setComment</span><span class="params">(String purpose)</span> </span>&#123;</span><br><span class="line">        comment = purpose;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the comment describing the purpose of this cookie, or</span></span><br><span class="line"><span class="comment">     * &lt;code&gt;null&lt;/code&gt; if the cookie has no comment.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a &lt;code&gt;String&lt;/code&gt; containing the comment, or</span></span><br><span class="line"><span class="comment">     *         &lt;code&gt;null&lt;/code&gt; if none</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setComment</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getComment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> comment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Specifies the domain within which this cookie should be presented.</span></span><br><span class="line"><span class="comment">     * 指定这个 cookie 可以出现在那个 domain</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * The form of the domain name is specified by RFC 2109. A domain name</span></span><br><span class="line"><span class="comment">     * begins with a dot (&lt;code&gt;.foo.com&lt;/code&gt;) and means that the cookie is</span></span><br><span class="line"><span class="comment">     * visible to servers in a specified Domain Name System (DNS) zone (for</span></span><br><span class="line"><span class="comment">     * example, &lt;code&gt;www.foo.com&lt;/code&gt;, but not &lt;code&gt;a.b.foo.com&lt;/code&gt;). By</span></span><br><span class="line"><span class="comment">     * default, cookies are only returned to the server that sent them.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * domain name 的形式说明在 RFC 2109. domain name 以 dot 开头, 这意味着在一个特定的</span></span><br><span class="line"><span class="comment">     * DNS 这个 cookie 是可见的. 默认的, 那个服务器发送的 cookie 返回给哪个服务器.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pattern</span></span><br><span class="line"><span class="comment">     *            a &lt;code&gt;String&lt;/code&gt; containing the domain name within which</span></span><br><span class="line"><span class="comment">     *            this cookie is visible; form is according to RFC 2109</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getDomain</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDomain</span><span class="params">(String pattern)</span> </span>&#123;</span><br><span class="line">        domain = pattern.toLowerCase(Locale.ENGLISH); <span class="comment">// IE allegedly needs this</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the domain name set for this cookie. The form of the domain name</span></span><br><span class="line"><span class="comment">     * is set by RFC 2109.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a &lt;code&gt;String&lt;/code&gt; containing the domain name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setDomain</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDomain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> domain;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets the maximum age of the cookie in seconds.</span></span><br><span class="line"><span class="comment">     * cookie 最大存活的秒数</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * A positive value indicates that the cookie will expire after that many</span></span><br><span class="line"><span class="comment">     * seconds have passed. Note that the value is the &lt;i&gt;maximum&lt;/i&gt; age when</span></span><br><span class="line"><span class="comment">     * the cookie will expire, not the cookie&#x27;s current age.</span></span><br><span class="line"><span class="comment">     * 一个正数表明 cookie 将在 maximun age 秒数后过期.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * A negative value means that the cookie is not stored persistently and</span></span><br><span class="line"><span class="comment">     * will be deleted when the Web browser exits. A zero value causes the</span></span><br><span class="line"><span class="comment">     * cookie to be deleted.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 一个负数表示 cookie 不会被永久存储, 浏览器退出时将被删除.</span></span><br><span class="line"><span class="comment">     * 0  删除这个 cookie</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expiry</span></span><br><span class="line"><span class="comment">     *            an integer specifying the maximum age of the cookie in</span></span><br><span class="line"><span class="comment">     *            seconds; if negative, means the cookie is not stored; if zero,</span></span><br><span class="line"><span class="comment">     *            deletes the cookie</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getMaxAge</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMaxAge</span><span class="params">(<span class="keyword">int</span> expiry)</span> </span>&#123;</span><br><span class="line">        maxAge = expiry;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the maximum age of the cookie, specified in seconds, By default,</span></span><br><span class="line"><span class="comment">     * &lt;code&gt;-1&lt;/code&gt; indicating the cookie will persist until browser</span></span><br><span class="line"><span class="comment">     * shutdown.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> an integer specifying the maximum age of the cookie in seconds; if</span></span><br><span class="line"><span class="comment">     *         negative, means the cookie persists until browser shutdown</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setMaxAge</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMaxAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> maxAge;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Specifies a path for the cookie to which the client should return the</span></span><br><span class="line"><span class="comment">     * cookie.</span></span><br><span class="line"><span class="comment">     * 指定一个 path, 表示哪一个 client 应该把这个 cookie 返还给服务器.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * The cookie is visible to all the pages in the directory you specify, and</span></span><br><span class="line"><span class="comment">     * all the pages in that directory&#x27;s subdirectories. A cookie&#x27;s path must</span></span><br><span class="line"><span class="comment">     * include the servlet that set the cookie, for example, &lt;i&gt;/catalog&lt;/i&gt;,</span></span><br><span class="line"><span class="comment">     * which makes the cookie visible to all directories on the server under</span></span><br><span class="line"><span class="comment">     * &lt;i&gt;/catalog&lt;/i&gt;.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Consult RFC 2109 (available on the Internet) for more information on</span></span><br><span class="line"><span class="comment">     * setting path names for cookies.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uri</span></span><br><span class="line"><span class="comment">     *            a &lt;code&gt;String&lt;/code&gt; specifying a path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getPath</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPath</span><span class="params">(String uri)</span> </span>&#123;</span><br><span class="line">        path = uri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the path on the server to which the browser returns this cookie.</span></span><br><span class="line"><span class="comment">     * The cookie is visible to all subpaths on the server.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a &lt;code&gt;String&lt;/code&gt; specifying a path that contains a servlet</span></span><br><span class="line"><span class="comment">     *         name, for example, &lt;i&gt;/catalog&lt;/i&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setPath</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Indicates to the browser whether the cookie should only be sent using a</span></span><br><span class="line"><span class="comment">     * secure protocol, such as HTTPS or SSL.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * The default value is &lt;code&gt;false&lt;/code&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> flag</span></span><br><span class="line"><span class="comment">     *            if &lt;code&gt;true&lt;/code&gt;, sends the cookie from the browser to the</span></span><br><span class="line"><span class="comment">     *            server only when using a secure protocol; if</span></span><br><span class="line"><span class="comment">     *            &lt;code&gt;false&lt;/code&gt;, sent on any protocol</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getSecure</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSecure</span><span class="params">(<span class="keyword">boolean</span> flag)</span> </span>&#123;</span><br><span class="line">        secure = flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns &lt;code&gt;true&lt;/code&gt; if the browser is sending cookies only over a</span></span><br><span class="line"><span class="comment">     * secure protocol, or &lt;code&gt;false&lt;/code&gt; if the browser can send cookies</span></span><br><span class="line"><span class="comment">     * using any protocol.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if the browser uses a secure protocol;</span></span><br><span class="line"><span class="comment">     *         otherwise, &lt;code&gt;true&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setSecure</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getSecure</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> secure;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the name of the cookie. The name cannot be changed after</span></span><br><span class="line"><span class="comment">     * creation.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a &lt;code&gt;String&lt;/code&gt; specifying the cookie&#x27;s name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Assigns a new value to a cookie after the cookie is created. If you use a</span></span><br><span class="line"><span class="comment">     * binary value, you may want to use BASE64 encoding.</span></span><br><span class="line"><span class="comment">     * cookie 被创建后, 给 value 指定一个值. 如果使用二进制的值, 采用 BASE64 的编码方式.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * With Version 0 cookies, values should not contain white space, brackets,</span></span><br><span class="line"><span class="comment">     * parentheses, equals signs, commas, double quotes, slashes, question</span></span><br><span class="line"><span class="comment">     * marks, at signs, colons, and semicolons. Empty values may not behave the</span></span><br><span class="line"><span class="comment">     * same way on all browsers.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newValue</span></span><br><span class="line"><span class="comment">     *            a &lt;code&gt;String&lt;/code&gt; specifying the new value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getValue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> Cookie</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(String newValue)</span> </span>&#123;</span><br><span class="line">        value = newValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value of the cookie.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a &lt;code&gt;String&lt;/code&gt; containing the cookie&#x27;s present value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setValue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> Cookie</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the version of the protocol this cookie complies with. Version 1</span></span><br><span class="line"><span class="comment">     * complies with RFC 2109, and version 0 complies with the original cookie</span></span><br><span class="line"><span class="comment">     * specification drafted by Netscape. Cookies provided by a browser use and</span></span><br><span class="line"><span class="comment">     * identify the browser&#x27;s cookie version.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 0 if the cookie complies with the original Netscape specification;</span></span><br><span class="line"><span class="comment">     *         1 if the cookie complies with RFC 2109  被 RFC 6265 淘汰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setVersion</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> version;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets the version of the cookie protocol this cookie complies with.</span></span><br><span class="line"><span class="comment">     * Version 0 complies with the original Netscape cookie specification.</span></span><br><span class="line"><span class="comment">     * version 0 遵守原始的 netscape cookie 说明</span></span><br><span class="line"><span class="comment">     * Version 1 complies with RFC 2109.</span></span><br><span class="line"><span class="comment">     * version 1 遵守 RFC 2109 规范</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Since RFC 2109 is still somewhat new, consider version 1 as experimental;</span></span><br><span class="line"><span class="comment">     * do not use it yet on production sites.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v</span></span><br><span class="line"><span class="comment">     *            0 if the cookie should comply with the original Netscape</span></span><br><span class="line"><span class="comment">     *            specification; 1 if the cookie should comply with RFC 2109</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getVersion</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setVersion</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        version = v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Overrides the standard &lt;code&gt;java.lang.Object.clone&lt;/code&gt; method to</span></span><br><span class="line"><span class="comment">     * return a copy of this cookie.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.clone();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets the flag that controls if this cookie will be hidden from scripts on</span></span><br><span class="line"><span class="comment">     * the client side.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * true 不能被 js document.cookie 操作</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpOnly  The new value of the flag</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> Servlet 3.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHttpOnly</span><span class="params">(<span class="keyword">boolean</span> httpOnly)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.httpOnly = httpOnly;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets the flag that controls if this cookie will be hidden from scripts on</span></span><br><span class="line"><span class="comment">     * the client side.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  &lt;code&gt;true&lt;/code&gt; if the cookie is hidden from scripts, else</span></span><br><span class="line"><span class="comment">     *          &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> Servlet 3.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isHttpOnly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> httpOnly;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CookieNameValidator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拿到 properties 文件的方法 ResourceBundle</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LSTRING_FILE = <span class="string">&quot;javax.servlet.http.LocalStrings&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> ResourceBundle lStrings = ResourceBundle.getBundle(LSTRING_FILE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> BitSet allowed;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">CookieNameValidator</span><span class="params">(String separators)</span> </span>&#123;</span><br><span class="line">        allowed = <span class="keyword">new</span> BitSet(<span class="number">128</span>);</span><br><span class="line">        allowed.set(<span class="number">0x20</span>, <span class="number">0x7f</span>); <span class="comment">// any CHAR except CTLs or separators</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; separators.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> ch = separators.charAt(i);</span><br><span class="line">            allowed.clear(ch);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">validate</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// cookie name 不允许为 null 或者长度为 0</span></span><br><span class="line">        <span class="keyword">if</span> (name == <span class="keyword">null</span> || name.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(lStrings.getString(<span class="string">&quot;err.cookie_name_blank&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!isToken(name)) &#123;</span><br><span class="line">            String errMsg = lStrings.getString(<span class="string">&quot;err.cookie_name_is_token&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(MessageFormat.format(errMsg, name));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isToken</span><span class="params">(String possibleToken)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = possibleToken.length();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = possibleToken.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (!allowed.get(c)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RFC6265Validator</span> <span class="keyword">extends</span> <span class="title">CookieNameValidator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String RFC2616_SEPARATORS = <span class="string">&quot;()&lt;&gt;@,;:\\\&quot;/[]?=&#123;&#125; \t&quot;</span>;</span><br><span class="line"></span><br><span class="line">    RFC6265Validator() &#123;</span><br><span class="line">        <span class="keyword">super</span>(RFC2616_SEPARATORS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RFC2109Validator</span> <span class="keyword">extends</span> <span class="title">RFC6265Validator</span> </span>&#123;</span><br><span class="line">    RFC2109Validator(<span class="keyword">boolean</span> allowSlash) &#123;</span><br><span class="line">        <span class="comment">// special treatment to allow for FWD_SLASH_IS_SEPARATOR property</span></span><br><span class="line">        <span class="keyword">if</span> (allowSlash) &#123;</span><br><span class="line">            allowed.set(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">validate</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.validate(name);</span><br><span class="line">        <span class="comment">// cookie name 不允许 $ 开头</span></span><br><span class="line">        <span class="keyword">if</span> (name.charAt(<span class="number">0</span>) == <span class="string">&#x27;$&#x27;</span>) &#123;</span><br><span class="line">            String errMsg = lStrings.getString(<span class="string">&quot;err.cookie_name_is_token&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(MessageFormat.format(errMsg, name));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=</summary>
      
    
    
    
    
    <category term="tomcat" scheme="http://stardustman.github.io/tags/tomcat/"/>
    
    <category term="http" scheme="http://stardustman.github.io/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>katacoda-what-is-a-container-image</title>
    <link href="http://stardustman.github.io/2019/11/26/katacoda-what-is-a-container-image/"/>
    <id>http://stardustman.github.io/2019/11/26/katacoda-what-is-a-container-image/</id>
    <published>2019-11-26T12:12:23.000Z</published>
    <updated>2020-05-13T07:21:41.111Z</updated>
    
    <content type="html"><![CDATA[<h2 id="container-image"><a href="#container-image" class="headerlink" title="container image"></a>container image</h2><blockquote><p>A container image is a tar file containing tar files. Each of the tar file is a layer. Once all tar files have been extract into the same location then you have the container’s filesystem.<br><code>container image</code> 是一个 <code>tar</code> 文件. 每一个 <code>tar</code> 文件就是一个 layer</p></blockquote><h3 id="docker-pull-拉取一个镜像"><a href="#docker-pull-拉取一个镜像" class="headerlink" title="docker pull 拉取一个镜像"></a>docker pull 拉取一个镜像</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis:3.2.11-alpine</span><br></pre></td></tr></table></figure><blockquote><p>3.2.11-alpine: Pulling from library/redis<br>ff3a5c916c92: Pull complete<br>aae70a2e6027: Pull complete<br>87c655da471c: Pull complete<br>bc3141806bdc: Pull complete<br>53616fb426d9: Pull complete<br>9791c5883c6a: Pull complete<br>Digest: sha256:ebf1948b84dcaaa0f8a2849cce6f2548edb8862e2829e3e7d9e4cd5a324fb3b7<br>Status: Downloaded newer image for redis:3.2.11-alpine</p></blockquote><blockquote><p>可以看到 redis:3.2.11-alpine 这个 image 拉取了 <em>ff3a5c916c92</em>,<br><em>aae70a2e6027</em>, <em>87c655da471c</em>, <em>bc3141806bdc</em>, <em>53616fb426d9</em>, <em>9791c5883c6a</em> 共 6 次.</p></blockquote><h3 id="docker-save-验证-image-分层"><a href="#docker-save-验证-image-分层" class="headerlink" title="docker save 验证 image 分层"></a>docker save 验证 image 分层</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker save --<span class="built_in">help</span></span><br><span class="line">Usage:  docker save [OPTIONS] IMAGE [IMAGE...]</span><br><span class="line">Save one or more images to a tar archive (streamed to STDOUT by default)</span><br><span class="line">Options:</span><br><span class="line">  -o, --output string   Write to a file, instead of STDOUT</span><br></pre></td></tr></table></figure><h4 id="验证-redis-3-2-11-alpine-分层"><a href="#验证-redis-3-2-11-alpine-分层" class="headerlink" title="验证 redis:3.2.11-alpine 分层"></a>验证 redis:3.2.11-alpine 分层</h4><h5 id="docker-save-保存-image-为-tar-文件"><a href="#docker-save-保存-image-为-tar-文件" class="headerlink" title="docker save 保存 image 为 tar 文件"></a>docker save 保存 image 为 tar 文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker  save  redis:3.2.11-alpine &gt; redis.tar</span><br></pre></td></tr></table></figure><h5 id="解压-tar-文件"><a href="#解压-tar-文件" class="headerlink" title="解压 tar 文件"></a>解压 tar 文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf redis.tar</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">tree</span><br><span class="line">.</span><br><span class="line">├── 46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557</span><br><span class="line">│   ├── json // 这一 layer 的配置文件</span><br><span class="line">│   ├── layer.tar</span><br><span class="line">│   └── VERSION</span><br><span class="line">├── 498654318d0999ce36c7b90901ed8bd8cb63d86837cb101ea1ec9bb092f44e59</span><br><span class="line">│   ├── json // 这一 layer 的配置文件</span><br><span class="line">│   ├── layer.tar</span><br><span class="line">│   └── VERSION</span><br><span class="line">├── ad01e7adb4e23f63a0a1a1d258c165d852768fb2e4cc2d9d5e71698e9672093c</span><br><span class="line">│   ├── json // 这一 layer 的配置文件</span><br><span class="line">│   ├── layer.tar</span><br><span class="line">│   └── VERSION</span><br><span class="line">├── ca0b6709748d024a67c502558ea88dc8a1f8a858d380f5ddafa1504126a3b018.json // 这个 `image` 的配置文件</span><br><span class="line">├── da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c</span><br><span class="line">│   ├── json // 这一 layer 的配置文件</span><br><span class="line">│   ├── layer.tar</span><br><span class="line">│   └── VERSION</span><br><span class="line">├── db1a23fc1daa8135a1c6c695f7b416a0ac0eb1d8ca873928385a3edaba6ac9a3</span><br><span class="line">│   ├── json // 这一 layer 的配置文件</span><br><span class="line">│   ├── layer.tar</span><br><span class="line">│   └── VERSION</span><br><span class="line">├── f07352aa34c241692cae1ce60ade187857d0bffa3a31390867038d46b1e7739c</span><br><span class="line">│   ├── json // 这一 layer 的配置文件</span><br><span class="line">│   ├── layer.tar</span><br><span class="line">│   └── VERSION</span><br><span class="line">├── manifest.json</span><br><span class="line">├── redis.tar // docker save 的 tar 文件</span><br><span class="line">└── repositories</span><br></pre></td></tr></table></figure><h5 id="查看解压后的-tar-文件"><a href="#查看解压后的-tar-文件" class="headerlink" title="查看解压后的 tar 文件"></a>查看解压后的 tar 文件</h5><blockquote><p>ls<br>46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557<br>498654318d0999ce36c7b90901ed8bd8cb63d86837cb101ea1ec9bb092f44e59<br>ad01e7adb4e23f63a0a1a1d258c165d852768fb2e4cc2d9d5e71698e9672093c<br>ca0b6709748d024a67c502558ea88dc8a1f8a858d380f5ddafa1504126a3b018.json<br>da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c<br>db1a23fc1daa8135a1c6c695f7b416a0ac0eb1d8ca873928385a3edaba6ac9a3<br>f07352aa34c241692cae1ce60ade187857d0bffa3a31390867038d46b1e7739c<br>manifest.json<br>repositories</p></blockquote><h5 id="查看-manifest-json"><a href="#查看-manifest-json" class="headerlink" title="查看 manifest.json"></a>查看 manifest.json</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;Config&quot;</span>:<span class="string">&quot;ca0b6709748d024a67c502558ea88dc8a1f8a858d380f5ddafa1504126a3b018.json&quot;</span>, <span class="comment">// 整个 image 的配置文件</span></span><br><span class="line">        <span class="attr">&quot;RepoTags&quot;</span>:[</span><br><span class="line">            <span class="string">&quot;redis:3.2.11-alpine&quot;</span> <span class="comment">// image 的 tag</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;Layers&quot;</span>:[</span><br><span class="line">            <span class="string">&quot;498654318d0999ce36c7b90901ed8bd8cb63d86837cb101ea1ec9bb092f44e59/layer.tar&quot;</span>, <span class="comment">// 1</span></span><br><span class="line">            <span class="string">&quot;ad01e7adb4e23f63a0a1a1d258c165d852768fb2e4cc2d9d5e71698e9672093c/layer.tar&quot;</span>, <span class="comment">// 2</span></span><br><span class="line">            <span class="string">&quot;da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c/layer.tar&quot;</span>, <span class="comment">// 3</span></span><br><span class="line">            <span class="string">&quot;db1a23fc1daa8135a1c6c695f7b416a0ac0eb1d8ca873928385a3edaba6ac9a3/layer.tar&quot;</span>, <span class="comment">// 4</span></span><br><span class="line">            <span class="string">&quot;f07352aa34c241692cae1ce60ade187857d0bffa3a31390867038d46b1e7739c/layer.tar&quot;</span>, <span class="comment">// 5</span></span><br><span class="line">            <span class="string">&quot;46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557/layer.tar&quot;</span>  <span class="comment">// 6</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><blockquote><p>由上可知, <code>redis:3.2.11-alpine</code> 这个 <code>image</code> 有 6 个 <code>*layer.tar</code> 组成. 每一个 layer.tar 对应 image 一层.</p></blockquote><h5 id="查看-repositories"><a href="#查看-repositories" class="headerlink" title="查看 repositories"></a>查看 repositories</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat repositories</span><br></pre></td></tr></table></figure><p>结果如下:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;redis&quot;</span>:&#123;<span class="attr">&quot;3.2.11-alpine&quot;</span>:<span class="string">&quot;46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="创建一个空的-image"><a href="#创建一个空的-image" class="headerlink" title="创建一个空的 image"></a>创建一个空的 image</h3><blockquote><p>build an image from scratch</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker import --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><blockquote><p>Usage:  docker import [OPTIONS] file|URL|- [REPOSITORY[:TAG]]<br>Import the contents from a tarball to create a filesystem image<br>Options:<br>  -c, –change list      Apply Dockerfile instruction to the created image<br>  -m, –message string   Set commit message for imported image</p></blockquote><ol><li><p>使用 docker import 生成一个空镜像</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar cv --files-from /dev/null | docker import - empty</span><br></pre></td></tr></table></figure><p>生成的 <strong>empty</strong> 空镜像 ID 如下:<br>sha256:8880ab5b7953a69e0a9252cbeeb537f0667ec10d3f849289117f8434802c0c49</p></li><li><p>查看生成的镜像</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure></li></ol><h3 id="Creating-Image-without-Dockerfile"><a href="#Creating-Image-without-Dockerfile" class="headerlink" title="Creating Image without Dockerfile"></a>Creating Image without Dockerfile</h3><ol><li>得到 <code>BusyBox rootfs</code> </li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -LO https://raw.githubusercontent.com/moby/moby/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/contrib/mkimage/busybox-static &amp;&amp; chmod +x busybox-static</span><br></pre></td></tr></table></figure><ol start="2"><li><p>执行 ./busybox-static busybox</p></li><li><p>ls -lha busybox</p></li><li><p>向 busybox 添加一个版本信息</p></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> KatacodaPrivateBuild &gt; busybox/release</span><br></pre></td></tr></table></figure><ol start="5"><li>用 busybox 这个文件夹生成一个 image</li></ol><blockquote><p>the directory can be converted into a tar and automatically imported into Docker as an image.</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -C busybox -c . | docker import - busybox</span><br></pre></td></tr></table></figure><ol start="6"><li>启动一个容器并查看 release 信息</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run busybox cat /release</span><br></pre></td></tr></table></figure><h3 id="busy-static-shell-脚本分析"><a href="#busy-static-shell-脚本分析" class="headerlink" title="busy-static shell 脚本分析"></a>busy-static shell 脚本分析</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="built_in">set</span> -e <span class="comment">#  Exit immediately if a command exits with a non-zero status.</span></span><br><span class="line"></span><br><span class="line">rootfsDir=<span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="comment"># $1 是第一个参数</span></span><br><span class="line"><span class="built_in">shift</span> <span class="comment"># 相当于 shift 1, 也就是把第一个参数丢掉, 后面的都前进一步</span></span><br><span class="line"></span><br><span class="line">busybox=<span class="string">&quot;<span class="subst">$(which busybox 2&gt;/dev/null || true)</span>&quot;</span> <span class="comment"># 拿到 busybox 的路径</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$busybox</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&amp;2 <span class="string">&#x27;error: busybox: not found&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&amp;2 <span class="string">&#x27;  install it with your distribution &quot;busybox-static&quot; package&#x27;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> ! ldd <span class="string">&quot;<span class="variable">$busybox</span>&quot;</span> 2&gt;&amp;1 | grep -q <span class="string">&#x27;not a dynamic executable&#x27;</span>; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&amp;2 <span class="string">&quot;error: &#x27;<span class="variable">$busybox</span>&#x27; appears to be a dynamic executable&quot;</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&amp;2 <span class="string">&#x27;  you should install your distribution &quot;busybox-static&quot; package instead&#x27;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">mkdir -p <span class="string">&quot;<span class="variable">$rootfsDir</span>/bin&quot;</span> <span class="comment"># 创建 $rootfsDir/bin</span></span><br><span class="line">rm -f <span class="string">&quot;<span class="variable">$rootfsDir</span>/bin/busybox&quot;</span> <span class="comment"># just in case</span></span><br><span class="line">cp <span class="string">&quot;<span class="variable">$busybox</span>&quot;</span> <span class="string">&quot;<span class="variable">$rootfsDir</span>/bin/busybox&quot;</span></span><br><span class="line"></span><br><span class="line">(</span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$rootfsDir</span>&quot;</span></span><br><span class="line"></span><br><span class="line">IFS=$<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">modules=( $(bin/busybox --list-modules) ) <span class="comment"># 得到 busybox 所有的模块</span></span><br><span class="line"><span class="built_in">unset</span> IFS</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> module <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;modules[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">mkdir -p <span class="string">&quot;<span class="subst">$(dirname <span class="string">&quot;<span class="variable">$module</span>&quot;</span>)</span>&quot;</span></span><br><span class="line">        <span class="comment"># ln target linkname</span></span><br><span class="line">ln -sf /bin/busybox <span class="string">&quot;<span class="variable">$module</span>&quot;</span> <span class="comment"># 强制创建符号链接</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://raw.githubusercontent.com/moby/moby/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/contrib/mkimage/busybox-static">busybox-static</a></li><li><a href="http://jm.taobao.org/2016/05/12/introduction-to-docker/">docker-intro</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;container-image&quot;&gt;&lt;a href=&quot;#container-image&quot; class=&quot;headerlink&quot; title=&quot;container image&quot;&gt;&lt;/a&gt;container image&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;A con</summary>
      
    
    
    
    
    <category term="docker" scheme="http://stardustman.github.io/tags/docker/"/>
    
    <category term="images" scheme="http://stardustman.github.io/tags/images/"/>
    
  </entry>
  
  <entry>
    <title>bloomfilter</title>
    <link href="http://stardustman.github.io/2019/11/22/bloomfilter/"/>
    <id>http://stardustman.github.io/2019/11/22/bloomfilter/</id>
    <published>2019-11-22T01:05:04.000Z</published>
    <updated>2019-12-25T03:09:39.375Z</updated>
    
    <content type="html"><![CDATA[<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><p><a href="https://www.jasondavies.com/bloomfilter/">bloom filter</a></p></li><li><p><a href="https://llimllib.github.io/bloomfilter-tutorial/">bloom filter</a></p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;References&quot;&gt;&lt;a href=&quot;#References&quot; class=&quot;headerlink&quot; title=&quot;References&quot;&gt;&lt;/a&gt;References&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://www.jasondav</summary>
      
    
    
    
    
    <category term="data structure" scheme="http://stardustman.github.io/tags/data-structure/"/>
    
  </entry>
  
  <entry>
    <title>x86-64-architecture</title>
    <link href="http://stardustman.github.io/2019/10/16/x86-64-architecture/"/>
    <id>http://stardustman.github.io/2019/10/16/x86-64-architecture/</id>
    <published>2019-10-16T05:59:24.000Z</published>
    <updated>2019-12-27T01:47:37.175Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>操作系统其实很大一部分面向 <code>CPU</code> 来编程的。一些 <code>OS</code> 的概念直接来源于 <code>CPU</code> 的术语，或者和 <code>CPU</code> 关联性非常大。要想彻底理解 <code>OS</code> ，无法绕过 <code>CPU</code>。因为 Intel 的 <code>X86</code>(Intel 80386 之后的一系列 CPU 称之为 X86 架构) 是业界的标准。掌握这个架构对于理解 <code>OS</code> 是非常必要的。因为 <code>X86</code> 系列的 <code>CPU</code> 向后兼容，所以本文使用 Intel 8086(16 bit) 和 Intel 80386(32 bit) 来试图理解 <code>X86</code> 架构。</p></blockquote><h2 id="Intel-8086"><a href="#Intel-8086" class="headerlink" title="Intel 8086"></a>Intel 8086</h2><h3 id="16-bit-processor"><a href="#16-bit-processor" class="headerlink" title="16 bit processor"></a>16 bit processor</h3><blockquote><p><code>16-bit</code> is a computer hardware device or software program capable of transferring 16 bits of data at a time. 一次传输 16 bits 的数据<br>For example, early computer processors (e.g., 8088 and 80286) were 16-bit processors, meaning they were capable of working with 16-bit binary numbers (decimal number up to 65,535). Anything larger and the computer would need to break the number into smaller pieces.</p></blockquote><h3 id="1M-的寻址空间带来的问题与解决方法"><a href="#1M-的寻址空间带来的问题与解决方法" class="headerlink" title="1M 的寻址空间带来的问题与解决方法"></a>1M 的寻址空间带来的问题与解决方法</h3><h4 id="Intel-8086-地址引脚"><a href="#Intel-8086-地址引脚" class="headerlink" title="Intel 8086 地址引脚"></a>Intel 8086 地址引脚</h4><img src="/2019/10/16/x86-64-architecture/intel8086_address.png" class="" title="Intel 8086 寻址空间"> <blockquote><p>上图的 AD<sub>0</sub> ~ AD<sub>15</sub> 是复用(Multiplex)引脚<br>A<sub>16</sub> ~ A<sub>19</sub> 也是复用引脚</p></blockquote><ul><li>ALE(Address Latch Enable) = 1 是作为地址线 A<sub>0</sub>~A<sub>15</sub>(寻址) 再加上A<sub>16</sub> ~ A<sub>19</sub>.</li><li>ALE(Address Latch Enable) = 0 是作为数据线 D<sub>0</sub>~D<sub>15</sub>(传输 16 bit 数据)</li></ul><h4 id="物理地址生成"><a href="#物理地址生成" class="headerlink" title="物理地址生成"></a>物理地址生成</h4><blockquote><p>20 bit 来表示一个内存地址. 但是 Intel 8086 是一个 <code>16 bit</code> 的处理器(其实就是一次只能传输 16 bit 的数据). 怎样来表示 <code>20 bit</code> 的内存地址呢? 比如一个内存地址是: <code>0x18AC9</code>, 该怎样表示呢? 其实道理很简单, 既然没法一次传输 20 bit, 那就分两次好了. 最后用两个 <code>16 bit</code> 的数据来合成 <code>0x18AC9</code> 这个地址. 很显然要有生成 <code>0x18AC9</code> 这个地址的策略. 在 Intel 8086 中, 将 <code>0x18AC9</code> 拆分为 <code>0x1234</code>(segment address) 和 <code>0x6789</code>(offset address) 这两个 <code>16 bit</code> 的地址, 这就是所谓的逻辑地址(logical address). 怎样生成 <code>0x18AC9</code> 这个真实的物理地址呢? 也很简单使用一个 <code>20 bit</code> 的 <code>adder</code>(加法器). 0x18AC9 = 0x1234 * 16 + 0x6789</p></blockquote><img src="/2019/10/16/x86-64-architecture/intel8086_real_address_mode_translation.png" class="" title="Intel 8086 Real Address Mode Translation"> <h4 id="Real-Address-Mode"><a href="#Real-Address-Mode" class="headerlink" title="Real Address Mode"></a>Real Address Mode</h4><blockquote><p>物理地址由两部分组成: segment address 和 offset address. 这两个地址不能直接使用, 是用来合成真正的物理地址的. 这两个地址称之为 <code>逻辑地址</code>. 16 * segment address + offset address 合成的地址称之为 <code>物理地址</code>, 也叫 <code>线性地址</code>(也就是从 0 ~ 2^20 -1 地址空间). Intel 8086 这种得到物理地址的机制就叫做 <code>real address mode</code>. 也就是所谓的 <code>实模式</code>.<br>PS: 多说一句, <code>实模式</code> 这个翻译有点坑, 翻译成 <code>实地址模式</code> 不就十分清楚了吗?</p></blockquote><h4 id="segmented-memory"><a href="#segmented-memory" class="headerlink" title="segmented memory"></a>segmented memory</h4><blockquote><p>physical address = 16 * segment address + offset address<br>offset address 是 16 bit, 决定了一个 segment 的范围是 64K. 将 1M 的寻址空间以 64K 为一个 segment 划分为多个 segment. 反过来说就是一个 segment 可以选择一个 64K 范围内的地址. 是的, <code>segment</code> 可以当作是一种 <code>selector</code>, 就像 <code>CSS</code> 里面的选择器.<br>那么这个 segment 存放在哪里呢? 放在专门的 <code>segment register</code> 里. </p></blockquote><h4 id="segment-registers"><a href="#segment-registers" class="headerlink" title="segment registers"></a>segment registers</h4><blockquote><p>Intel 8086 提供了 <code>Extra Segment</code>(ES), <code>Data Segment</code>(DS), <code>Stack Segment</code>(SS), <code>Code Segment</code>(CS) 这 4 个 段寄存器.</p></blockquote><h5 id="code-segment-CS-instruction-pointer-IP"><a href="#code-segment-CS-instruction-pointer-IP" class="headerlink" title="code segment(CS) + instruction pointer(IP)"></a>code segment(CS) + instruction pointer(IP)</h5><blockquote><p>code segment 存放 segment address, 这是个专门的代码段寄存器, 用来存放代码的地址.<br>instruction pointer 存放 offset address, 这个是专门的指令寄存器, 用来存放下一条指令的地址.<br>所以访问代码的 <code>物理地址 = 16 * CS + IP</code></p></blockquote><h5 id="stack-segment-SS-stack-pointer-SP"><a href="#stack-segment-SS-stack-pointer-SP" class="headerlink" title="stack segment(SS) + stack pointer(SP)"></a>stack segment(SS) + stack pointer(SP)</h5><blockquote><p>stack segment 存放 segment address, 这个是专门的栈帧段寄存器.<br>stack pointer 存放 offset address, 这个专门的记录栈顶的寄存器.<br>所以访问函数栈帧的 <code>物理地址 = 16 * SS + SP</code></p></blockquote><blockquote><p>注意: 如果令 SS = 0, 那么访问函数栈帧的 <code>物理地址 = SP</code>, 也就是只能访问 64K 的空间.<br>注意: real address mode 能够不受限制地访问 1M 的地址空间. 程序可以自由的访问 1M 的地址空间, 无法进行内存的保护, 这也是 <code>Intel 80386</code> 要解决的问题之一. </p></blockquote><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h3 id="general-purpose-register"><a href="#general-purpose-register" class="headerlink" title="general purpose register"></a>general purpose register</h3><h3 id="memory-mapping"><a href="#memory-mapping" class="headerlink" title="memory mapping"></a>memory mapping</h3><blockquote><p>已安装内存 8G(7.88G) 可用？？？原因在哪里呢？</p></blockquote><h2 id="Intel-80386"><a href="#Intel-80386" class="headerlink" title="Intel 80386"></a>Intel 80386</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><a href="http://8086microprocessor4u.blogspot.com/2012/12/bus-interface-unit-biu.html">bus interface unit</a></li><li><a href="http://8086microprocessor4u.blogspot.com/2015/04/the-execution-unit-eu.html">execution unit</a></li><li><a href="https://www.tutorialspoint.com/microprocessor/microprocessor_8086_functional_units.htm">8086 Functional Units</a></li><li><a href="https://www.csetutor.com/components-of-cpu-and-their-functions/">components of cpu</a></li><li><a href="https://vdocuments.mx/8086-microprocessor-architecture-5584489b9c738.html">8086-microprocessor-architecture</a></li><li><a href="https://www.academia.edu/40314276/8086_microprocessor20190911_87442_nxpkcz">8086-microprocessor</a></li><li><a href="https://www.geeksforgeeks.org/memory-segmentation-8086-microprocessor/">memory-segmentation-8086-microprocessor</a></li><li><a href="https://www.cs.usfca.edu/~cruse/cs630f06/">Advanced Microcomputer Programming</a></li><li><a href="https://www.computerhope.com/jargon/num/16bit.htm">16 bit processor mean?</a></li><li><a href="https://cgnail.github.io/academic/mem-layout/">memory layout</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;操作系统其实很大一部分面向 &lt;code&gt;CPU&lt;/code&gt; 来编程的。一些 &lt;code&gt;OS&lt;/code&gt; 的概念直接来源于 &lt;code&gt;CPU&lt;/code&gt; 的术语，或者和 &lt;code&gt;CPU&lt;/code&gt; 关联性非常大。要想彻底理解 &lt;cod</summary>
      
    
    
    
    
    <category term="x86" scheme="http://stardustman.github.io/tags/x86/"/>
    
  </entry>
  
  <entry>
    <title>select_poll_epoll</title>
    <link href="http://stardustman.github.io/2019/09/19/select-poll-epoll/"/>
    <id>http://stardustman.github.io/2019/09/19/select-poll-epoll/</id>
    <published>2019-09-19T06:43:18.000Z</published>
    <updated>2019-10-20T10:54:11.247Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>弄清楚 I/O Multiplexing 和 Linux 中 select, poll, epoll 之间的关系.</p></blockquote><h2 id="multiplexer"><a href="#multiplexer" class="headerlink" title="multiplexer"></a>multiplexer</h2><blockquote><p><code>Multiplexer</code> is a combinational circuit that has maximum of 2^n data inputs, <code>n</code> <code>selection lines</code> and <code>single output line</code>. One of these data inputs will be connected to the output based on the values of selection lines.<br>Since there are <code>n</code> selection lines, there will be 2^n possible combinations of zeros and ones. So, each combination will select only one data input. Multiplexer is also called as Mux.<br>聚合多个输入, 通过 selection lines 来选择一个输出. </p></blockquote><h3 id="4x1-Multiplexer-分析"><a href="#4x1-Multiplexer-分析" class="headerlink" title="4x1 Multiplexer 分析"></a>4x1 Multiplexer 分析</h3><blockquote><p>聚合 I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub> 这 4 个输入, 通过 S1 和 S0 来选择一个输出.</p></blockquote><h3 id="Block-diagram-of-4x1-Multiplexer"><a href="#Block-diagram-of-4x1-Multiplexer" class="headerlink" title="Block diagram of 4x1 Multiplexer"></a>Block diagram of 4x1 Multiplexer</h3><img src="/2019/09/19/select-poll-epoll/4x1_Multiplexer.png" class="" title="4x1_Multiplexer"><h3 id="Y-output-输出值的分析"><a href="#Y-output-输出值的分析" class="headerlink" title="Y(output) 输出值的分析"></a>Y<sub>(output)</sub> 输出值的分析</h3><h4 id="S1-0-S0-0-时-Y-的值由-I0-决定"><a href="#S1-0-S0-0-时-Y-的值由-I0-决定" class="headerlink" title="S1 = 0, S0 = 0 时 Y 的值由 I0 决定"></a>S<sub>1</sub> = 0, S<sub>0</sub> = 0 时 Y 的值由 I<sub>0</sub> 决定</h4><img src="/2019/09/19/select-poll-epoll/multiplexers_S1_S0_I0.png" class="" title="multiplexers_S1_S0_I0"><blockquote><p>S1 = 0, S0 = 0. 此时的 I1, I2, I3, 无论是 0 还是 1, 对应的 <code>and gate</code> 输出都是 0, 对最终输出 <code>Y</code> 没有影响. 此时 I0 的输入决定 <code>Y</code> 的值. 也就是 <code>Y</code> = I0.</p></blockquote><h4 id="S1-0-S0-1-时-Y-的值由-I1-决定"><a href="#S1-0-S0-1-时-Y-的值由-I1-决定" class="headerlink" title="S1 = 0, S0 = 1 时 Y 的值由 I1 决定"></a>S<sub>1</sub> = 0, S<sub>0</sub> = 1 时 Y 的值由 I<sub>1</sub> 决定</h4><img src="/2019/09/19/select-poll-epoll/multiplexers_S1_S0_I1.png" class="" title="multiplexers_S1_S0_I1"><blockquote><p>S1 = 0, S0 = 1. 此时的 I0, I2, I3, 无论是 0 还是 1, 对应的 <code>and gate</code> 输出都是 0, 对最终输出 <code>Y</code> 没有影响. 此时 I1 的输入决定 <code>Y</code> 的值. 也就是 <code>Y</code> = I1.</p></blockquote><h4 id="S1-1-S0-0-时-Y-的值由-I2-决定"><a href="#S1-1-S0-0-时-Y-的值由-I2-决定" class="headerlink" title="S1 = 1, S0 = 0 时 Y 的值由 I2 决定"></a>S<sub>1</sub> = 1, S<sub>0</sub> = 0 时 Y 的值由 I<sub>2</sub> 决定</h4><img src="/2019/09/19/select-poll-epoll/multiplexers_S1_S0_I2.png" class="" title="multiplexers_S1_S0_I2"><blockquote><p>S1 = 1, S0 = 0. 此时的 I0, I1, I3, 无论是 0 还是 1, 对应的 <code>and gate</code> 输出都是 0, 对最终输出 <code>Y</code> 没有影响. 此时 I2 的输入决定 <code>Y</code> 的值. 也就是 <code>Y</code> = I2.</p></blockquote><h4 id="S1-1-S1-0-时-Y-的值由-I3-决定"><a href="#S1-1-S1-0-时-Y-的值由-I3-决定" class="headerlink" title="S1 = 1, S1 = 0 时 Y 的值由 I3 决定"></a>S<sub>1</sub> = 1, S<sub>1</sub> = 0 时 Y 的值由 I<sub>3</sub> 决定</h4><img src="/2019/09/19/select-poll-epoll/multiplexers_S1_S0_I3.png" class="" title="multiplexers_S1_S0_I3"><blockquote><p>S1 = 1, S0 = 1. 此时的 I0, I1, I2, 无论是 0 还是 1, 对应的 <code>and gate</code> 输出都是 0, 对最终输出 <code>Y</code> 没有影响. 此时 I3 的输入决定 <code>Y</code> 的值. 也就是 <code>Y</code> = I3.</p></blockquote><h3 id="Truth-table-of-4x1-Multiplexer"><a href="#Truth-table-of-4x1-Multiplexer" class="headerlink" title="Truth table of 4x1 Multiplexer"></a>Truth table of 4x1 Multiplexer</h3><table><thead><tr><th>S1(高位)</th><th>S0(低位)</th><th>S1S0(值)</th><th>Y</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>I<sub>0</sub></td></tr><tr><td>0</td><td>1</td><td>1</td><td>I<sub>1</sub></td></tr><tr><td>1</td><td>0</td><td>2</td><td>I<sub>2</sub></td></tr><tr><td>1</td><td>1</td><td>3</td><td>I<sub>3</sub></td></tr></tbody></table><h3 id="Multiplexer-Mux"><a href="#Multiplexer-Mux" class="headerlink" title="Multiplexer (Mux)"></a>Multiplexer (Mux)</h3><blockquote><p>4x1 Multiplexer 相当于提供了一种映射, Y = I<sub>(S1S0)</sub>.<br>通过组合S<sub>1</sub> 和 S<sub>0</sub> 的值, 可以直接得到 I<sub>S1S0</sub> 的值.也就是通过 4x1 Multiplexer 输出的 Y 值是 I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub> 之一.</p></blockquote><h2 id="I-O-Multiplexing"><a href="#I-O-Multiplexing" class="headerlink" title="I/O Multiplexing"></a>I/O Multiplexing</h2><blockquote><p>I/O multiplexing 这里面的 multiplexing 指的其实是在单个线程通过记录跟踪每一个 Sock(I/O 流)的状态.<br>select, poll, epoll 都是 I/O multiplexing的具体的实现, 之所以有这三个存在，其实是他们出现是有先后顺序的.</p></blockquote><h2 id="I-O-Multiplexing-和-Multiplexer"><a href="#I-O-Multiplexing-和-Multiplexer" class="headerlink" title="I/O Multiplexing 和 Multiplexer"></a>I/O Multiplexing 和 Multiplexer</h2><blockquote><p>I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub> 视为 4 个 I/O 流. 值为 1 时, 视为一个 I/O 流. 4x1 Multiplexer 作为硬件实现的 I/O multiplexing. 可以周期性的设置S<sub>1</sub> 和 S<sub>0</sub> 的值, 通过监测 Y 的输出, 得到 I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub> 的输入.</p></blockquote><img src="/2019/09/19/select-poll-epoll/multiplexers_S1_S0_I0.png" class="" title="multiplexers_S1_S0_I0"><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p>select 被实现以后, 很快就暴露出了很多问题.</p><ul><li>select 会修改传入的参数数组, 这个对于一个需要调用很多次的函数, 是非常不友好的.</li><li>select 如果任何一个 sock(I/O stream) 出现了数据, select 仅仅会返回, 但是并不会告诉你是那个 sock 上有数,于是你只能自己一个一个的找.<blockquote><p>相当于监测到 <code>Mutiplexer</code> 的 Y = 1, 但是不知道 I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub>哪一个的输入是 1. 也就是不告诉 S<sub>1</sub> 和 S<sub>0</sub>的值, 那就只好再去具体查看一次.<br>I<sub>0</sub>, I<sub>1</sub>, I<sub>2</sub>, I<sub>3</sub>的值.</p></blockquote></li><li>select 只能监视 1024 个链接. 相当于实现了一个 1024x1 的 Mutiplexer. 只能有1024 个输入.</li><li>select 不是线程安全的.</li></ul><h3 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h3><blockquote><p>修复版的 select</p></blockquote><ul><li>poll 去掉了 1024 个链接的限制</li></ul><h3 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h3><p>epoll 可以说是 I/O 多路复用最新的一个实现, epoll 修复了 poll 和 select 绝大部分问题, 比如:</p><ul><li>epoll 现在是线程安全的。</li><li>epoll 现在不仅告诉你 sock 组里面数据，还会告诉你具体哪个 sock 有数据, 你不用自己去找了.<blockquote><p>相当于监测到  <code>Mutiplexer</code> 的 Y = 1, 且告知了此时的 S<sub>1</sub> 和 S<sub>0</sub> 的值, 通过组合就可以知道是哪一个具体的输入是 1 了.</p></blockquote></li></ul><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://www.tutorialspoint.com/digital_circuits/digital_circuits_multiplexers.htm">circuits_multiplexers</a></li><li><a href="https://www.tutorialspoint.com/digital_circuits/digital_circuits_demultiplexers.htm">circuits_demultiplexers</a></li><li><a href="https://zhuanlan.zhihu.com/p/64138532">epoll的本质</a></li><li><a href="https://www.zhihu.com/question/32163005">I/O multiplexing</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;弄清楚 I/O Multiplexing 和 Linux 中 select, poll, epoll 之间的关系.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;multiplexer&quot;&gt;&lt;a href=&quot;#multiplexer&quot; clas</summary>
      
    
    
    
    
    <category term="io" scheme="http://stardustman.github.io/tags/io/"/>
    
  </entry>
  
  <entry>
    <title>wireshark</title>
    <link href="http://stardustman.github.io/2019/09/10/wireshark/"/>
    <id>http://stardustman.github.io/2019/09/10/wireshark/</id>
    <published>2019-09-10T01:51:07.000Z</published>
    <updated>2019-09-10T06:26:33.349Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Wireshark-Windows-配置-SSL"><a href="#Wireshark-Windows-配置-SSL" class="headerlink" title="Wireshark Windows 配置 SSL"></a>Wireshark Windows 配置 SSL</h2><blockquote><p>Version 3.0.3</p></blockquote><h3 id="配置-SSLKEYLOGFILE-系统变量"><a href="#配置-SSLKEYLOGFILE-系统变量" class="headerlink" title="配置 SSLKEYLOGFILE 系统变量"></a>配置 SSLKEYLOGFILE 系统变量</h3><img src="/2019/09/10/wireshark/SSLKEYLOGFILE.png" class="" title="系统变量 SSLKEYLOGFILE"><h3 id="配置-Wireshark"><a href="#配置-Wireshark" class="headerlink" title="配置 Wireshark"></a>配置 Wireshark</h3><blockquote><p>编辑 -&gt; 首选项 -&gt; Protocols -&gt; TLS</p></blockquote><img src="/2019/09/10/wireshark/wireshark_tls_logfile.png" class="" title="Wireshark 配置 TLS"><h3 id="重启-Wireshark"><a href="#重启-Wireshark" class="headerlink" title="重启 Wireshark"></a>重启 Wireshark</h3><h2 id="过滤器查看"><a href="#过滤器查看" class="headerlink" title="过滤器查看"></a>过滤器查看</h2><blockquote><p>视图 -&gt; 内部 -&gt; 支持的协议</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Wireshark-Windows-配置-SSL&quot;&gt;&lt;a href=&quot;#Wireshark-Windows-配置-SSL&quot; class=&quot;headerlink&quot; title=&quot;Wireshark Windows 配置 SSL&quot;&gt;&lt;/a&gt;Wireshark Wind</summary>
      
    
    
    
    
    <category term="network" scheme="http://stardustman.github.io/tags/network/"/>
    
    <category term="tools" scheme="http://stardustman.github.io/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>docker-practice</title>
    <link href="http://stardustman.github.io/2019/09/03/docker-practice/"/>
    <id>http://stardustman.github.io/2019/09/03/docker-practice/</id>
    <published>2019-09-03T06:20:16.000Z</published>
    <updated>2019-09-11T06:58:58.936Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Centos7 Linux<br>运行的 Docker 容器是: mssql-node-docker-demo-app </p></blockquote><h2 id="docker-info"><a href="#docker-info" class="headerlink" title="docker info"></a>docker info</h2><img src="/2019/09/03/docker-practice/docker-info.png" class="" title="docker info 得到的信息"><h2 id="docker-inspect"><a href="#docker-inspect" class="headerlink" title="docker inspect"></a>docker inspect</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;Id&quot;</span>: <span class="string">&quot;405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;Created&quot;</span>: <span class="string">&quot;2019-08-01T02:57:14.067532309Z&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;Path&quot;</span>: <span class="string">&quot;/bin/sh&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;Args&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;-c&quot;</span>,</span><br><span class="line">            <span class="string">&quot;/bin/bash ./entrypoint.sh&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;State&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;Status&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Running&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">&quot;Paused&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;Restarting&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;OOMKilled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;Dead&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;Pid&quot;</span>: <span class="number">12164</span>,</span><br><span class="line">            <span class="attr">&quot;ExitCode&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;Error&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;StartedAt&quot;</span>: <span class="string">&quot;2019-08-22T06:08:43.334320939Z&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;FinishedAt&quot;</span>: <span class="string">&quot;2019-08-21T09:25:32.130119566Z&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;Image&quot;</span>: <span class="string">&quot;sha256:e600f86aa4e2aced43a193a28aa507651bfb77daa09ca8dbf286451a630cf27e&quot;</span>, <span class="comment">// node-web-app 的 docker 镜像 id</span></span><br><span class="line">        <span class="attr">&quot;ResolvConfPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/resolv.conf&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;HostnamePath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/hostname&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;HostsPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/hosts&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;LogPath&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;Name&quot;</span>: <span class="string">&quot;/friendly_hamilton&quot;</span>, <span class="comment">// docker container 的名称</span></span><br><span class="line">        <span class="attr">&quot;RestartCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;Driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>, <span class="comment">// storage driver</span></span><br><span class="line">        <span class="attr">&quot;MountLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;ProcessLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;AppArmorProfile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;ExecIDs&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;HostConfig&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;Binds&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;ContainerIDFile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;LogConfig&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;Type&quot;</span>: <span class="string">&quot;journald&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Config&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;NetworkMode&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;PortBindings&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;1433/tcp&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">&quot;HostIp&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;HostPort&quot;</span>: <span class="string">&quot;1433&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">&quot;8080/tcp&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">&quot;HostIp&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;HostPort&quot;</span>: <span class="string">&quot;8080&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;RestartPolicy&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;Name&quot;</span>: <span class="string">&quot;no&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;MaximumRetryCount&quot;</span>: <span class="number">0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;AutoRemove&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;VolumeDriver&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;VolumesFrom&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;CapAdd&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;CapDrop&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;Dns&quot;</span>: [],</span><br><span class="line">            <span class="attr">&quot;DnsOptions&quot;</span>: [],</span><br><span class="line">            <span class="attr">&quot;DnsSearch&quot;</span>: [],</span><br><span class="line">            <span class="attr">&quot;ExtraHosts&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;GroupAdd&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;IpcMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Cgroup&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Links&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;OomScoreAdj&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;PidMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Privileged&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;PublishAllPorts&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;ReadonlyRootfs&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;SecurityOpt&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;UTSMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;UsernsMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;ShmSize&quot;</span>: <span class="number">67108864</span>,</span><br><span class="line">            <span class="attr">&quot;Runtime&quot;</span>: <span class="string">&quot;docker-runc&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;ConsoleSize&quot;</span>: [</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;Isolation&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;CpuShares&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;Memory&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;NanoCpus&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;CgroupParent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;BlkioWeight&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;BlkioWeightDevice&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;BlkioDeviceReadBps&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;BlkioDeviceWriteBps&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;BlkioDeviceReadIOps&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;BlkioDeviceWriteIOps&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;CpuPeriod&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;CpuQuota&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;CpuRealtimePeriod&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;CpuRealtimeRuntime&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;CpusetCpus&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;CpusetMems&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Devices&quot;</span>: [],</span><br><span class="line">            <span class="attr">&quot;DiskQuota&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;KernelMemory&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;MemoryReservation&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;MemorySwap&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;MemorySwappiness&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">            <span class="attr">&quot;OomKillDisable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;PidsLimit&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;Ulimits&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;CpuCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;CpuPercent&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;IOMaximumIOps&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;IOMaximumBandwidth&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;Name&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Data&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;LowerDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2-init/diff:/var/lib/docker/overlay2/83b7194d94d42c0ef8f78a2f4105cc7a7a215a8e885b695a933a8f8212db9cfa/diff:/var/lib/docker/overlay2/9549118d3883d39414fadf0dc17e654d1408878be3296b294711ee65ef336b98/diff:/var/lib/docker/overlay2/8e85764472e79d42f469dd3681883cd415e85098d6c42fb3dd239471212f87b3/diff:/var/lib/docker/overlay2/8dc8ec519bade76b07994adc690d1e6fcad408147835198a250b4c66c489a151/diff:/var/lib/docker/overlay2/b07d1c7463b2a4ff25f7800729381fdf5b036c12a065973b9d079580c3a50a5e/diff:/var/lib/docker/overlay2/60c9257cc9d8a7ac4b66d1c4cae5ff994471976f0a344f8ac1856a4fba7b290e/diff:/var/lib/docker/overlay2/2a00c5b47427e151e000ffe05de8121e956dbf15b0d356cfc9ad2754dc5554d5/diff:/var/lib/docker/overlay2/3495bcc2d508cbdad81b1f3eb49645fe0eb05caf0e99fbb6310d40fbdd8118a2/diff:/var/lib/docker/overlay2/9df322481c6f8b91b3583016634664e6ad991b8b846a9585385227a02b898770/diff:/var/lib/docker/overlay2/163747850da2115bac28b39ac6d2e08ca5c0e409fe6cae624155f8e61489aacd/diff:/var/lib/docker/overlay2/52405978404b67e0a67ba95cb12682d0e8a8ae781fd2b21dc2ab94197e97c38b/diff:/var/lib/docker/overlay2/c987c31253bca839eb789feb3e4fe7bc247b1e88dc88c67e2b4209fc26025fe8/diff:/var/lib/docker/overlay2/ed663d4b2fffda783f9b69e5eb7c139f34142e0e2d868460a3c1e1d925ec3e7e/diff:/var/lib/docker/overlay2/a0e3d07a65b7ee70d3869fa41418ecf71056b9ac0ba1182170621c83c77bba94/diff:/var/lib/docker/overlay2/aa4c66b37aae4e55a94aa60ac763a60851af34271ccb1a80f547e3d90e7ac2bf/diff:/var/lib/docker/overlay2/527b1a014d302c1fe835d778be6cd008de6741d290fbc0f2e64e3f25f7a7b8d0/diff&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;MergedDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/merged&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;UpperDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/diff&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;WorkDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/work&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;Mounts&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">&quot;Type&quot;</span>: <span class="string">&quot;volume&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Name&quot;</span>: <span class="string">&quot;7bc1a7ad23925077cf8463c2d7a21b0cafc7d91305d89504f85fa76c33138834&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/7bc1a7ad23925077cf8463c2d7a21b0cafc7d91305d89504f85fa76c33138834/_data&quot;</span>, <span class="comment">// host 主机的被挂在的目录</span></span><br><span class="line">                <span class="attr">&quot;Destination&quot;</span>: <span class="string">&quot;/var/opt/mssql&quot;</span>, <span class="comment">// Volume 挂载点</span></span><br><span class="line">                <span class="attr">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">&quot;Propagation&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;Config&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;Hostname&quot;</span>: <span class="string">&quot;405a378d6f88&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;AttachStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;AttachStdout&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;AttachStderr&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;1433/tcp&quot;</span>: &#123;&#125;,</span><br><span class="line">                <span class="attr">&quot;8080/tcp&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;Tty&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;OpenStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;StdinOnce&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;Env&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;ACCEPT_EULA=Y&quot;</span>,</span><br><span class="line">                <span class="string">&quot;SA_PASSWORD=Yukon900&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;Cmd&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/bin/sh&quot;</span>,</span><br><span class="line">                <span class="string">&quot;-c&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/bin/bash ./entrypoint.sh&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;ArgsEscaped&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">&quot;Image&quot;</span>: <span class="string">&quot;node-web-app&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Volumes&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;/var/opt/mssql&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;WorkingDir&quot;</span>: <span class="string">&quot;/usr/src/app&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Entrypoint&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;OnBuild&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;Labels&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;com.microsoft.product&quot;</span>: <span class="string">&quot;Microsoft SQL Server&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;com.microsoft.version&quot;</span>: <span class="string">&quot;14.0.3048.4&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;vendor&quot;</span>: <span class="string">&quot;Microsoft&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;NetworkSettings&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;Bridge&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;SandboxID&quot;</span>: <span class="string">&quot;d21ee4834e9078042da65677d8db9717748eb7f86a6954c5e4eee29636159aa7&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;HairpinMode&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;LinkLocalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;LinkLocalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;Ports&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;1433/tcp&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">&quot;HostIp&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;HostPort&quot;</span>: <span class="string">&quot;1433&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">&quot;8080/tcp&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">&quot;HostIp&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;HostPort&quot;</span>: <span class="string">&quot;8080&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;SandboxKey&quot;</span>: <span class="string">&quot;/var/run/docker/netns/d21ee4834e90&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;SecondaryIPAddresses&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;SecondaryIPv6Addresses&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;EndpointID&quot;</span>: <span class="string">&quot;46dac1ff81a297ede919100e0d06a743b845e34b802b54bca8cb8f02dcd33c85&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;GlobalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;IPPrefixLen&quot;</span>: <span class="number">16</span>,</span><br><span class="line">            <span class="attr">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Networks&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;bridge&quot;</span>: &#123;</span><br><span class="line">                    <span class="attr">&quot;IPAMConfig&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">&quot;Links&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">&quot;Aliases&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">&quot;NetworkID&quot;</span>: <span class="string">&quot;a8af0599996912141c3f2ce4b0a2bcc48eea9164a35672aac6307333450acb6b&quot;</span>, <span class="comment">//a8af05999969 </span></span><br><span class="line">                    <span class="attr">&quot;EndpointID&quot;</span>: <span class="string">&quot;46dac1ff81a297ede919100e0d06a743b845e34b802b54bca8cb8f02dcd33c85&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;IPPrefixLen&quot;</span>: <span class="number">16</span>,</span><br><span class="line">                    <span class="attr">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;GlobalIPv6PrefixLen&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span> </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="docker-volume"><a href="#docker-volume" class="headerlink" title="docker volume"></a>docker volume</h2><h3 id="mount"><a href="#mount" class="headerlink" title="mount"></a>mount</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="attr">&quot;Type&quot;</span>: <span class="string">&quot;volume&quot;</span>,</span><br><span class="line">             <span class="attr">&quot;Name&quot;</span>: <span class="string">&quot;7bc1a7ad23925077cf8463c2d7a21b0cafc7d91305d89504f85fa76c33138834&quot;</span>,</span><br><span class="line">             <span class="attr">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/7bc1a7ad23925077cf8463c2d7a21b0cafc7d91305d89504f85fa76c33138834/_data&quot;</span>, <span class="comment">// host 主机的被挂载的目录</span></span><br><span class="line">             <span class="attr">&quot;Destination&quot;</span>: <span class="string">&quot;/var/opt/mssql&quot;</span>, <span class="comment">// Volume 挂载点</span></span><br><span class="line">             <span class="attr">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">             <span class="attr">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">             <span class="attr">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">             <span class="attr">&quot;Propagation&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">     ]</span><br></pre></td></tr></table></figure><h2 id="Local-Docker-container-网络"><a href="#Local-Docker-container-网络" class="headerlink" title="Local Docker container 网络"></a>Local Docker container 网络</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;ResolvConfPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/resolv.conf&quot;</span>,</span><br><span class="line"><span class="attr">&quot;HostnamePath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/hostname&quot;</span>,</span><br><span class="line"><span class="attr">&quot;HostsPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/hosts&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2019/09/03/docker-practice/local-var-lib-docker-container.png" class="" title="本地存储的容器的网络配置"><h2 id="Container-网络配置"><a href="#Container-网络配置" class="headerlink" title="Container 网络配置"></a>Container 网络配置</h2><img src="/2019/09/03/docker-practice/container-etc.png" class="" title="容器的网络配置"><h2 id="Docker-Images-分层"><a href="#Docker-Images-分层" class="headerlink" title="Docker Images 分层"></a>Docker Images 分层</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;Name&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;Data&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;LowerDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2-init/diff:/var/lib/docker/overlay2/83b7194d94d42c0ef8f78a2f4105cc7a7a215a8e885b695a933a8f8212db9cfa/diff:/var/lib/docker/overlay2/9549118d3883d39414fadf0dc17e654d1408878be3296b294711ee65ef336b98/diff:/var/lib/docker/overlay2/8e85764472e79d42f469dd3681883cd415e85098d6c42fb3dd239471212f87b3/diff:/var/lib/docker/overlay2/8dc8ec519bade76b07994adc690d1e6fcad408147835198a250b4c66c489a151/diff:/var/lib/docker/overlay2/b07d1c7463b2a4ff25f7800729381fdf5b036c12a065973b9d079580c3a50a5e/diff:/var/lib/docker/overlay2/60c9257cc9d8a7ac4b66d1c4cae5ff994471976f0a344f8ac1856a4fba7b290e/diff:/var/lib/docker/overlay2/2a00c5b47427e151e000ffe05de8121e956dbf15b0d356cfc9ad2754dc5554d5/diff:/var/lib/docker/overlay2/3495bcc2d508cbdad81b1f3eb49645fe0eb05caf0e99fbb6310d40fbdd8118a2/diff:/var/lib/docker/overlay2/9df322481c6f8b91b3583016634664e6ad991b8b846a9585385227a02b898770/diff:/var/lib/docker/overlay2/163747850da2115bac28b39ac6d2e08ca5c0e409fe6cae624155f8e61489aacd/diff:/var/lib/docker/overlay2/52405978404b67e0a67ba95cb12682d0e8a8ae781fd2b21dc2ab94197e97c38b/diff:/var/lib/docker/overlay2/c987c31253bca839eb789feb3e4fe7bc247b1e88dc88c67e2b4209fc26025fe8/diff:/var/lib/docker/overlay2/ed663d4b2fffda783f9b69e5eb7c139f34142e0e2d868460a3c1e1d925ec3e7e/diff:/var/lib/docker/overlay2/a0e3d07a65b7ee70d3869fa41418ecf71056b9ac0ba1182170621c83c77bba94/diff:/var/lib/docker/overlay2/aa4c66b37aae4e55a94aa60ac763a60851af34271ccb1a80f547e3d90e7ac2bf/diff:/var/lib/docker/overlay2/527b1a014d302c1fe835d778be6cd008de6741d290fbc0f2e64e3f25f7a7b8d0/diff&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;MergedDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/merged&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;UpperDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/diff&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;WorkDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/work&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="MergedDir"><a href="#MergedDir" class="headerlink" title="MergedDir"></a>MergedDir</h3><blockquote><p>这个 MergedDir 层就是一个 Linux 镜像 </p></blockquote><img src="/2019/09/03/docker-practice/merged-dir.png" class="" title="镜像 Merged 层"><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><p><a href="https://github.com/twright-msft/mssql-node-docker-demo-app/blob/master/Dockerfile">mssql-node-docker-demo-app</a></p></li><li><p><a href="https://docs.docker.com/storage/storagedriver/">storage driver</a></p></li><li><p><a href="https://medium.com/better-programming/about-var-run-docker-sock-3bfd276e12fd">var-run-docker-sock</a></p></li><li><p><a href="https://blog.csdn.net/boling_cavalry/article/details/92846483">docker 的 /var/run/docker.sock 参数</a></p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Centos7 Linux&lt;br&gt;运行的 Docker 容器是: mssql-node-docker-demo-app &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;docker-info&quot;&gt;&lt;a href=&quot;#docker-info&quot; c</summary>
      
    
    
    
    
    <category term="docker" scheme="http://stardustman.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>hadoop-environment-setup</title>
    <link href="http://stardustman.github.io/2019/07/22/hadoop-environment-setup/"/>
    <id>http://stardustman.github.io/2019/07/22/hadoop-environment-setup/</id>
    <published>2019-07-22T02:40:05.000Z</published>
    <updated>2019-07-22T09:12:14.364Z</updated>
    
    <content type="html"><![CDATA[<h1 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h1><ol><li>CentOS-7-x86_64-Minimal-1810</li><li>hadoop-3.2.0</li><li>jdk8</li><li>vmware 链接克隆 5 台虚拟机</li><li>192.168.126.133 s101</li><li>192.168.126.134 s102</li><li>192.168.126.135 s103</li><li>192.168.126.136 s104</li><li>192.168.126.137 s105</li></ol><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="centos7-minimal-配置静态-ip"><a href="#centos7-minimal-配置静态-ip" class="headerlink" title="centos7-minimal 配置静态 ip"></a>centos7-minimal 配置静态 ip</h3><ol><li>vim /etc/sysconfig/network-scripts/ifcfg-ens33</li><li>静态ip配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">TYPE&#x3D;Ethernet</span><br><span class="line">PROXY_METHOD&#x3D;none</span><br><span class="line">BROWSER_ONLY&#x3D;no</span><br><span class="line">BOOTPROTO&#x3D;static #need</span><br><span class="line">DEFROUTE&#x3D;yes</span><br><span class="line">IPV4_FAILURE_FATAL&#x3D;no</span><br><span class="line">IPV6INIT&#x3D;yes</span><br><span class="line">IPV6_AUTOCONF&#x3D;yes</span><br><span class="line">IPV6_DEFROUTE&#x3D;yes</span><br><span class="line">IPV6_FAILURE_FATAL&#x3D;no</span><br><span class="line">IPV6_ADDR_GEN_MODE&#x3D;stable-privacy</span><br><span class="line">NAME&#x3D;ens33</span><br><span class="line">UUID&#x3D;f5fd61b8-7255-4de9-ae68-5047e1586589</span><br><span class="line">DEVICE&#x3D;ens33</span><br><span class="line">ONBOOT&#x3D;yes</span><br><span class="line">NM_CONTROLLED&#x3D;no #need</span><br><span class="line">IPADDR&#x3D;192.168.126.137 #need</span><br><span class="line">NETMASK&#x3D;255.255.255.0 #need</span><br><span class="line">GATEWAY&#x3D;192.168.126.2 #need</span><br></pre></td></tr></table></figure></li></ol><h3 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h3><ol><li>vim /etc/profile 添加<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME&#x3D;&#x2F;soft&#x2F;java8</span><br><span class="line">export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin</span><br><span class="line">export CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;jre&#x2F;lib:$JAVA_HOME&#x2F;lib:$JAVA_HOME&#x2F;lib&#x2F;tools.jar</span><br></pre></td></tr></table></figure></li><li>source /etc/profile</li><li>java -version</li></ol><h3 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h3><ol><li>vim /etc/profile 添加<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export HADOOP_HOME&#x3D;&#x2F;soft&#x2F;hadoop-3.2.0</span><br><span class="line">export PATH&#x3D;$PATH:$HADOOP_HOME&#x2F;bin:$HADOOP_HOME&#x2F;sbin</span><br></pre></td></tr></table></figure></li><li>source /etc/profile</li><li>hadoop version<h2 id=""><a href="#" class="headerlink" title=""></a></h2></li></ol><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol><li><a href="http://www.mustbegeek.com/configure-static-ip-address-in-centos/">centos7-static-ip-config</a></li><li><a href="https://www.liquidweb.com/kb/install-java-8-on-centos-7/">centos7-openjdk-install</a></li><li><a href="https://blog.csdn.net/crxmai/article/details/49767673">centos7-minimal-network-enable</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;开发环境&quot;&gt;&lt;a href=&quot;#开发环境&quot; class=&quot;headerlink&quot; title=&quot;开发环境&quot;&gt;&lt;/a&gt;开发环境&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;CentOS-7-x86_64-Minimal-1810&lt;/li&gt;
&lt;li&gt;hadoop-3.2.0&lt;/li&gt;
</summary>
      
    
    
    
    
    <category term="hadoop" scheme="http://stardustman.github.io/tags/hadoop/"/>
    
  </entry>
  
  <entry>
    <title>clang-structure</title>
    <link href="http://stardustman.github.io/2019/07/17/clang-structure/"/>
    <id>http://stardustman.github.io/2019/07/17/clang-structure/</id>
    <published>2019-07-17T02:48:46.000Z</published>
    <updated>2019-07-17T02:50:34.384Z</updated>
    
    <content type="html"><![CDATA[<h1 id="size-of-structure"><a href="#size-of-structure" class="headerlink" title="size of structure"></a>size of structure</h1><h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ol><li><a href="https://www.geeksforgeeks.org/flexible-array-members-structure-c/">flexible-array-members-structure-c</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;size-of-structure&quot;&gt;&lt;a href=&quot;#size-of-structure&quot; class=&quot;headerlink&quot; title=&quot;size of structure&quot;&gt;&lt;/a&gt;size of structure&lt;/h1&gt;&lt;h1 id=&quot;refer</summary>
      
    
    
    
    
    <category term="clang" scheme="http://stardustman.github.io/tags/clang/"/>
    
  </entry>
  
</feed>
